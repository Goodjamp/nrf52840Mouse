cscope 15 C:\Private\Programing\Nordic\NRF52840Mouse"               0000598374
	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\ble_advertising\ble_advertising.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
BLE_ADVERTISING
)

42 
	~"bË_advd©a.h
"

43 
	~"bË_adv”tisšg.h
"

44 
	~"Äf_soc.h
"

45 
	~"Äf_log.h
"

46 
	~"Äf_f¡Üage.h
"

47 
	~"sdk_”rÜs.h
"

48 
	~"Äf_sdh_bË.h
"

49 
	~"Äf_sdh_soc.h
"

51 
	#BLE_ADV_MODES
 (5è

	)

54 #ià(
NRF_SD_BLE_API_VERSION
 <= 2)

56 
boŞ
 
	$wh™–i¡_has_’Œ›s
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
)

58  ((
p_adv”tisšg
->
wh™–i¡
.
addr_couÁ
 !ğ0è|| (p_adv”tisšg->wh™–i¡.
œk_couÁ
 != 0));

59 
	}
}

63 
boŞ
 
	$wh™–i¡_has_’Œ›s
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
)

65  
p_adv”tisšg
->
wh™–i¡_š_u£
;

66 
	}
}

74 
boŞ
 
	$addr_is_v®id
(
ušt8_t
 cÚ¡ * cÚ¡ 
addr
)

76 
ušt32_t
 
i
 = 0; i < 
BLE_GAP_ADDR_LEN
; i++)

78 ià(
addr
[
i
] != 0)

80  
Œue
;

83  
çl£
;

84 
	}
}

87 
bË_adv_mode_t
 
	$adv_mode_Ãxt_g‘
(
bË_adv_mode_t
 
adv_mode
)

89  (
bË_adv_mode_t
)((
adv_mode
 + 1è% 
BLE_ADV_MODES
);

90 
	}
}

97 
	$Ú_cÚÃùed
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

99 ià(
p_bË_evt
->
evt
.
g­_evt
.
·¿ms
.
cÚÃùed
.
rŞe
 =ğ
BLE_GAP_ROLE_PERIPH
)

101 
p_adv”tisšg
->
cu¼’t_¦ave_lšk_cÚn_hªdË
 = 
p_bË_evt
->
evt
.
g­_evt
.
cÚn_hªdË
;

103 
	}
}

111 
	$Ú_discÚÃùed
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

113 
ušt32_t
 
»t
;

115 
p_adv”tisšg
->
wh™–i¡_‹mpÜ¬y_di§bËd
 = 
çl£
;

117 ià(
p_bË_evt
->
evt
.
g­_evt
.
cÚn_hªdË
 =ğ
p_adv”tisšg
->
cu¼’t_¦ave_lšk_cÚn_hªdË
 &&

118 
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_Ú_discÚÃù_di§bËd
 =ğ
çl£
)

120 
	`NRF_LOG_INFO
("------start‡dv2-------");

121 
»t
 = 
	`bË_adv”tisšg_¡¬t
(
p_adv”tisšg
, 
BLE_ADV_MODE_DIRECTED
);

122 ià((
»t
 !ğ
NRF_SUCCESS
è&& (
p_adv”tisšg
->
”rÜ_hªdËr
 !ğ
NULL
))

124 
p_adv”tisšg
->
	`”rÜ_hªdËr
(
»t
);

127 
	}
}

135 
	$Ú_timeout
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

137 
»t_code_t
 
»t
;

139 ià(
p_bË_evt
->
evt
.
g­_evt
.
·¿ms
.
timeout
.
¤c
 !ğ
BLE_GAP_TIMEOUT_SRC_ADVERTISING
)

146 
	`NRF_LOG_INFO
("------start‡dv3-------");

147 
»t
 = 
	`bË_adv”tisšg_¡¬t
(
p_adv”tisšg
, 
	`adv_mode_Ãxt_g‘
Õ_adv”tisšg->
adv_mode_cu¼’t
));

149 ià((
»t
 !ğ
NRF_SUCCESS
è&& (
p_adv”tisšg
->
”rÜ_hªdËr
 !ğ
NULL
))

151 
p_adv”tisšg
->
	`”rÜ_hªdËr
(
»t
);

153 
	}
}

160 
boŞ
 
	$æash_acûss_š_´og»ss
()

162  
	`Äf_f¡Üage_is_busy
(
NULL
);

163 
	}
}

173 
bË_adv_mode_t
 
	$adv_mode_Ãxt_ava_g‘
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
,

174 
bË_adv_mode_t
 
adv_mode
)

176 
boŞ
 
³”_addr_is_v®id
 = 
	`addr_is_v®id
(
p_adv”tisšg
->
³”_add»ss
.
addr
);

180 
adv_mode
)

182 
BLE_ADV_MODE_DIRECTED
:

183 ià((
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_dœeùed_’abËd
è&& 
³”_addr_is_v®id
)

185  
BLE_ADV_MODE_DIRECTED
;

189 
BLE_ADV_MODE_DIRECTED_SLOW
:

190 ià((
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_dœeùed_¦ow_’abËd
è&& 
³”_addr_is_v®id
)

192  
BLE_ADV_MODE_DIRECTED_SLOW
;

196 
BLE_ADV_MODE_FAST
:

197 ià(
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_ç¡_’abËd
)

199  
BLE_ADV_MODE_FAST
;

203 
BLE_ADV_MODE_SLOW
:

204 ià(
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_¦ow_’abËd
)

206  
BLE_ADV_MODE_SLOW
;

211  
BLE_ADV_MODE_IDLE
;

213 
	}
}

223 
»t_code_t
 
	$£t_adv_mode_dœeùed
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
,

224 
bË_g­_adv_·¿ms_t
 * 
p_adv_·¿ms
)

226 
p_adv”tisšg
->
adv_evt
 = 
BLE_ADV_EVT_DIRECTED
;

228 
p_adv_·¿ms
->
p_³”_addr
 = &(
p_adv”tisšg
->
³”_add»ss
);

229 
p_adv_·¿ms
->
ty³
 = 
BLE_GAP_ADV_TYPE_ADV_DIRECT_IND
;

230 
p_adv_·¿ms
->
timeout
 = 0;

231 
p_adv_·¿ms
->
š‹rv®
 = 0;

233  
NRF_SUCCESS
;

234 
	}
}

244 
»t_code_t
 
	$£t_adv_mode_dœeùed_¦ow
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
,

245 
bË_g­_adv_·¿ms_t
 * 
p_adv_·¿ms
)

247 
p_adv”tisšg
->
adv_evt
 = 
BLE_ADV_EVT_DIRECTED_SLOW
;

249 
p_adv_·¿ms
->
p_³”_addr
 = &
p_adv”tisšg
->
³”_add»ss
;

250 
p_adv_·¿ms
->
ty³
 = 
BLE_GAP_ADV_TYPE_ADV_DIRECT_IND
;

251 
p_adv_·¿ms
->
timeout
 = 
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_dœeùed_¦ow_timeout
;

252 
p_adv_·¿ms
->
š‹rv®
 = 
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_dœeùed_¦ow_š‹rv®
;

254  
NRF_SUCCESS
;

255 
	}
}

265 
»t_code_t
 
	$£t_adv_mode_ç¡
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
,

266 
bË_g­_adv_·¿ms_t
 * 
p_adv_·¿ms
)

268 
»t_code_t
 
»t
;

270 
p_adv_·¿ms
->
š‹rv®
 = 
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_ç¡_š‹rv®
;

271 
p_adv_·¿ms
->
timeout
 = 
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_ç¡_timeout
;

273 ià((
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_wh™–i¡_’abËd
) &&

274 (!
p_adv”tisšg
->
wh™–i¡_‹mpÜ¬y_di§bËd
) &&

275 (
	`wh™–i¡_has_’Œ›s
(
p_adv”tisšg
)))

277 #ià(
NRF_SD_BLE_API_VERSION
 <= 2)

278 
p_adv_·¿ms
->
p_wh™–i¡
 = &
m_wh™–i¡
;

281 
p_adv_·¿ms
->
å
 = 
BLE_GAP_ADV_FP_FILTER_CONNREQ
;

282 
p_adv”tisšg
->
advd©a
.
æags
 = 
BLE_GAP_ADV_FLAG_BR_EDR_NOT_SUPPORTED
;

284 
»t
 = 
	`bË_advd©a_£t
(&(
p_adv”tisšg
->
advd©a
), 
NULL
);

285 ià(
»t
 !ğ
NRF_SUCCESS
)

287  
»t
;

290 
p_adv”tisšg
->
adv_evt
 = 
BLE_ADV_EVT_FAST_WHITELIST
;

294 
p_adv”tisšg
->
adv_evt
 = 
BLE_ADV_EVT_FAST
;

297  
NRF_SUCCESS
;

298 
	}
}

308 
»t_code_t
 
	$£t_adv_mode_¦ow
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
,

309 
bË_g­_adv_·¿ms_t
 * 
p_adv_·¿ms
)

311 
»t_code_t
 
»t
;

313 
p_adv_·¿ms
->
š‹rv®
 = 
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_¦ow_š‹rv®
;

314 
p_adv_·¿ms
->
timeout
 = 
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_¦ow_timeout
;

316 ià((
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_wh™–i¡_’abËd
) &&

317 (!
p_adv”tisšg
->
wh™–i¡_‹mpÜ¬y_di§bËd
) &&

318 (
	`wh™–i¡_has_’Œ›s
(
p_adv”tisšg
)))

320 #ià(
NRF_SD_BLE_API_VERSION
 <= 2)

322 
p_adv_·¿ms
->
p_wh™–i¡
 = &
p_adv”tisšg
->
wh™–i¡
;

326 
p_adv_·¿ms
->
å
 = 
BLE_GAP_ADV_FP_FILTER_CONNREQ
;

327 
p_adv”tisšg
->
advd©a
.
æags
 = 
BLE_GAP_ADV_FLAG_BR_EDR_NOT_SUPPORTED
;

329 
»t
 = 
	`bË_advd©a_£t
(&(
p_adv”tisšg
->
advd©a
), 
NULL
);

330 ià(
»t
 !ğ
NRF_SUCCESS
)

332  
»t
;

335 
p_adv”tisšg
->
adv_evt
 = 
BLE_ADV_EVT_SLOW_WHITELIST
;

339 
p_adv”tisšg
->
adv_evt
 = 
BLE_ADV_EVT_SLOW
;

342  
NRF_SUCCESS
;

343 
	}
}

346 
	$bË_adv”tisšg_cÚn_cfg_g_£t
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
,

347 
ušt8_t
 
bË_cfg_g
)

349 
p_adv”tisšg
->
cÚn_cfg_g
 = 
bË_cfg_g
;

350 
	}
}

353 
ušt32_t
 
	$bË_adv”tisšg_š™
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
,

354 
bË_adv”tisšg_š™_t
 cÚ¡ * cÚ¡ 
p_š™
)

356 
ušt32_t
 
»t
;

357 ià((
p_š™
 =ğ
NULL
è|| (
p_adv”tisšg
 == NULL))

359  
NRF_ERROR_NULL
;

362 
p_adv”tisšg
->
š™Ÿlized
 = 
Œue
;

363 
p_adv”tisšg
->
adv_mode_cu¼’t
 = 
BLE_ADV_MODE_IDLE
;

364 
p_adv”tisšg
->
adv_modes_cÚfig
 = 
p_š™
->
cÚfig
;

365 
p_adv”tisšg
->
cÚn_cfg_g
 = 
BLE_CONN_CFG_TAG_DEFAULT
;

366 
p_adv”tisšg
->
evt_hªdËr
 = 
p_š™
->evt_handler;

367 
p_adv”tisšg
->
”rÜ_hªdËr
 = 
p_š™
->error_handler;

368 
p_adv”tisšg
->
cu¼’t_¦ave_lšk_cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

370 
	`mem£t
(&
p_adv”tisšg
->
³”_add»ss
, 0, (p_advertising->peer_address));

371 
	`mem£t
(&
p_adv”tisšg
->
advd©a
, 0, (p_advertising->advdata));

374 
p_adv”tisšg
->
advd©a
.
Çme_ty³
 = 
p_š™
->advdata.name_type;

375 
p_adv”tisšg
->
advd©a
.
šşude_­³¬ªû
 = 
p_š™
->advdata.include_appearance;

376 
p_adv”tisšg
->
advd©a
.
æags
 = 
p_š™
->advdata.flags;

377 
p_adv”tisšg
->
advd©a
.
shÜt_Çme_Ën
 = 
p_š™
->advdata.short_name_len;

379 
p_adv”tisšg
->
advd©a
.
uuids_com¶‘e
 = 
p_š™
->advdata.uuids_complete;

380 
p_adv”tisšg
->
advd©a
.
uuids_mÜe_avaabË
 = 
p_š™
->advdata.uuids_more_available;

381 
p_adv”tisšg
->
advd©a
.
uuids_sŞic™ed
 = 
p_š™
->advdata.uuids_solicited;

382 
p_adv”tisšg
->
advd©a
.
šşude_bË_deviû_addr
 = 
p_š™
->advdata.include_ble_device_addr;

384 ià(
p_š™
->
advd©a
.
p_mªuf_¥ecific_d©a
 !ğ
NULL
)

386 
p_adv”tisšg
->
advd©a
.
p_mªuf_¥ecific_d©a
 = &Õ_adv”tisšg->
mªuf_¥ecific_d©a
);

387 
p_adv”tisšg
->
mªuf_¥ecific_d©a
.
d©a
.
p_d©a
 =…_adv”tisšg->
mªuf_d©a_¬¿y
;

388 
p_adv”tisšg
->
advd©a
.
p_mªuf_¥ecific_d©a
->
com·ny_id’tif›r
 =

389 
p_š™
->
advd©a
.
p_mªuf_¥ecific_d©a
->
com·ny_id’tif›r
;

390 
p_adv”tisšg
->
advd©a
.
p_mªuf_¥ecific_d©a
->
d©a
.
size
 = 
p_š™
->advdata.p_manuf_specific_data->data.size;

392 
ušt32_t
 
i
 = 0; i < 
p_adv”tisšg
->
advd©a
.
p_mªuf_¥ecific_d©a
->
d©a
.
size
; i++)

394 
p_adv”tisšg
->
mªuf_d©a_¬¿y
[
i
] = 
p_š™
->
advd©a
.
p_mªuf_¥ecific_d©a
->
d©a
.
p_d©a
[i];

398 ià(
p_š™
->
advd©a
.
p_£rviû_d©a_¬¿y
 !ğ
NULL
)

400 
p_adv”tisšg
->
£rviû_d©a
.
d©a
.
p_d©a
 =…_adv”tisšg->
£rviû_d©a_¬¿y
;

401 
p_adv”tisšg
->
advd©a
.
p_£rviû_d©a_¬¿y
 = &Õ_adv”tisšg->
£rviû_d©a
);

402 
p_adv”tisšg
->
advd©a
.
p_£rviû_d©a_¬¿y
->
d©a
.
p_d©a
 =…_adv”tisšg->
£rviû_d©a_¬¿y
;

403 
p_adv”tisšg
->
advd©a
.
p_£rviû_d©a_¬¿y
->
d©a
.
size
 = 
p_š™
->advdata.p_service_data_array->data.size;

404 
p_adv”tisšg
->
advd©a
.
p_£rviû_d©a_¬¿y
->
£rviû_uuid
 = 
p_š™
->advdata.p_service_data_array->service_uuid;

406 
ušt32_t
 
i
 = 0; i < 
p_adv”tisšg
->
advd©a
.
p_£rviû_d©a_¬¿y
->
d©a
.
size
; i++)

408 
p_adv”tisšg
->
£rviû_d©a_¬¿y
[
i
] = 
p_š™
->
advd©a
.
p_£rviû_d©a_¬¿y
->
d©a
.
p_d©a
[i];

411 
p_adv”tisšg
->
advd©a
.
£rviû_d©a_couÁ
 = 
p_š™
->advdata.service_data_count;

414 ià(
p_š™
->
advd©a
.
p_¦ave_cÚn_št
 !ğ
NULL
)

416 
p_adv”tisšg
->
advd©a
.
p_¦ave_cÚn_št
 = &Õ_adv”tisšg->
¦ave_cÚn_št
);

417 
p_adv”tisšg
->
advd©a
.
p_¦ave_cÚn_št
->
max_cÚn_š‹rv®
 = 
p_š™
->advdata.p_slave_conn_int->max_conn_interval;

418 
p_adv”tisšg
->
advd©a
.
p_¦ave_cÚn_št
->
mš_cÚn_š‹rv®
 = 
p_š™
->advdata.p_slave_conn_int->min_conn_interval;

421 ià(
p_š™
->
advd©a
.
p_tx_pow”_Ëv–
 !ğ
NULL
)

423 
p_adv”tisšg
->
advd©a
.
p_tx_pow”_Ëv–
 = 
p_š™
->advdata.p_tx_power_level;

426 #ià(
NRF_SD_BLE_API_VERSION
 <= 2)

427 
i
 = 0; i <
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
 ; i++)

429 
p_adv”tisšg
->
wh™–i¡
.
µ_addrs
[
i
] = &p_adv”tisšg->
wh™–i¡_addrs
[i];

432 
i
 = 0; i <
BLE_GAP_WHITELIST_IRK_MAX_COUNT
 ; i++)

434 
p_adv”tisšg
->
wh™–i¡
.
µ_œks
[
i
] = &p_adv”tisšg->
wh™–i¡_œks
[i];

437 
»t
 = 
	`bË_advd©a_£t
(&(
p_adv”tisšg
->
advd©a
), &(
p_š™
->
¤d©a
));

438  
»t
;

439 
	}
}

442 
ušt32_t
 
	$bË_adv”tisšg_¡¬t
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
,

443 
bË_adv_mode_t
 
adv”tisšg_mode
)

445 
ušt32_t
 
»t
;

446 
bË_g­_adv_·¿ms_t
 
adv_·¿ms
;

448 ià(
p_adv”tisšg
->
š™Ÿlized
 =ğ
çl£
)

450  
NRF_ERROR_INVALID_STATE
;

453 
p_adv”tisšg
->
adv_mode_cu¼’t
 = 
adv”tisšg_mode
;

456 ià(
	`æash_acûss_š_´og»ss
())

458 
p_adv”tisšg
->
adv”tisšg_¡¬t_³ndšg
 = 
Œue
;

459  
NRF_SUCCESS
;

462 
	`mem£t
(&
p_adv”tisšg
->
³”_add»ss
, 0, (p_advertising->peer_address));

464 iàĞ((
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_dœeùed_’abËd
è&& (p_adv”tisšg->
adv_mode_cu¼’t
 =ğ
BLE_ADV_MODE_DIRECTED
))

465 ||((
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_dœeùed_¦ow_’abËd
è&& (p_adv”tisšg->
adv_mode_cu¼’t
 =ğ
BLE_ADV_MODE_DIRECTED
))

466 ||((
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_dœeùed_¦ow_’abËd
è&& (p_adv”tisšg->
adv_mode_cu¼’t
 =ğ
BLE_ADV_MODE_DIRECTED_SLOW
))

469 ià(
p_adv”tisšg
->
evt_hªdËr
 !ğ
NULL
)

471 
p_adv”tisšg
->
³”_addr_»¶y_ex³ùed
 = 
Œue
;

472 
p_adv”tisšg
->
	`evt_hªdËr
(
BLE_ADV_EVT_PEER_ADDR_REQUEST
);

476 
p_adv”tisšg
->
³”_addr_»¶y_ex³ùed
 = 
çl£
;

480 
p_adv”tisšg
->
adv_mode_cu¼’t
 = 
	`adv_mode_Ãxt_ava_g‘
Õ_adv”tisšg, 
adv”tisšg_mode
);

483 ià((
p_adv”tisšg
->
evt_hªdËr
 !ğ
NULL
) &&

484 (
p_adv”tisšg
->
adv_mode_cu¼’t
 =ğ
BLE_ADV_MODE_FAST
 ||…_adv”tisšg->adv_mode_cu¼’ˆ=ğ
BLE_ADV_MODE_SLOW
) &&

485 (
p_adv”tisšg
->
adv_modes_cÚfig
.
bË_adv_wh™–i¡_’abËd
) &&

486 (!
p_adv”tisšg
->
wh™–i¡_‹mpÜ¬y_di§bËd
))

488 #ià(
NRF_SD_BLE_API_VERSION
 >= 3)

489 
p_adv”tisšg
->
wh™–i¡_š_u£
 = 
çl£
;

491 
p_adv”tisšg
->
wh™–i¡_»¶y_ex³ùed
 = 
Œue
;

492 
p_adv”tisšg
->
	`evt_hªdËr
(
BLE_ADV_EVT_WHITELIST_REQUEST
);

496 
p_adv”tisšg
->
wh™–i¡_»¶y_ex³ùed
 = 
çl£
;

500 
	`mem£t
(&
adv_·¿ms
, 0, (adv_params));

502 
adv_·¿ms
.
ty³
 = 
BLE_GAP_ADV_TYPE_ADV_IND
;

503 
adv_·¿ms
.
å
 = 
BLE_GAP_ADV_FP_ANY
;

506 
p_adv”tisšg
->
adv_mode_cu¼’t
)

508 
BLE_ADV_MODE_DIRECTED
:

509 
»t
 = 
	`£t_adv_mode_dœeùed
(
p_adv”tisšg
, &
adv_·¿ms
);

512 
BLE_ADV_MODE_DIRECTED_SLOW
:

513 
»t
 = 
	`£t_adv_mode_dœeùed_¦ow
(
p_adv”tisšg
, &
adv_·¿ms
);

516 
BLE_ADV_MODE_FAST
:

517 
»t
 = 
	`£t_adv_mode_ç¡
(
p_adv”tisšg
, &
adv_·¿ms
);

520 
BLE_ADV_MODE_SLOW
:

521 
»t
 = 
	`£t_adv_mode_¦ow
(
p_adv”tisšg
, &
adv_·¿ms
);

524 
BLE_ADV_MODE_IDLE
:

525 
p_adv”tisšg
->
adv_evt
 = 
BLE_ADV_EVT_IDLE
;

532 ià(
p_adv”tisšg
->
adv_mode_cu¼’t
 !ğ
BLE_ADV_MODE_IDLE
)

534 
»t
 = 
	`sd_bË_g­_adv_¡¬t
(&
adv_·¿ms
, 
p_adv”tisšg
->
cÚn_cfg_g
);

535 ià(
»t
 !ğ
NRF_SUCCESS
)

537  
»t
;

541 ià(
p_adv”tisšg
->
evt_hªdËr
 !ğ
NULL
)

543 
p_adv”tisšg
->
	`evt_hªdËr
Õ_adv”tisšg->
adv_evt
);

546  
NRF_SUCCESS
;

547 
	}
}

550 
	$bË_adv”tisšg_Ú_bË_evt
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
, * 
p_cÚ‹xt
)

552 
bË_adv”tisšg_t
 * 
p_adv”tisšg
 = (bË_adv”tisšg_ˆ*)
p_cÚ‹xt
;

554 
p_bË_evt
->
h—d”
.
evt_id
)

556 
BLE_GAP_EVT_CONNECTED
:

557 
	`Ú_cÚÃùed
(
p_adv”tisšg
, 
p_bË_evt
);

561 
BLE_GAP_EVT_DISCONNECTED
:

562 
	`Ú_discÚÃùed
(
p_adv”tisšg
, 
p_bË_evt
);

566 
BLE_GAP_EVT_TIMEOUT
:

567 
	`Ú_timeout
(
p_adv”tisšg
, 
p_bË_evt
);

573 
	}
}

576 
	$bË_adv”tisšg_Ú_sys_evt
(
ušt32_t
 
evt_id
, * 
p_cÚ‹xt
)

578 
bË_adv”tisšg_t
 * 
p_adv”tisšg
 = (bË_adv”tisšg_ˆ*)
p_cÚ‹xt
;

580 
evt_id
)

583 
NRF_EVT_FLASH_OPERATION_SUCCESS
:

584 
NRF_EVT_FLASH_OPERATION_ERROR
:

586 ià(
p_adv”tisšg
->
adv”tisšg_¡¬t_³ndšg
)

588 
p_adv”tisšg
->
adv”tisšg_¡¬t_³ndšg
 = 
çl£
;

589 
	`NRF_LOG_INFO
("------start‡dv4-------");

590 
»t_code_t
 
»t
 = 
	`bË_adv”tisšg_¡¬t
(
p_adv”tisšg
,

591 
p_adv”tisšg
->
adv_mode_cu¼’t
);

593 ià((
»t
 !ğ
NRF_SUCCESS
è&& (
p_adv”tisšg
->
”rÜ_hªdËr
 !ğ
NULL
))

595 
p_adv”tisšg
->
	`”rÜ_hªdËr
(
»t
);

604 
	}
}

607 
ušt32_t
 
	$bË_adv”tisšg_³”_addr_»¶y
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
,

608 
bË_g­_addr_t
 * 
p_³”_add»ss
)

610 ià(!
p_adv”tisšg
->
³”_addr_»¶y_ex³ùed
)

612  
NRF_ERROR_INVALID_STATE
;

615 
p_adv”tisšg
->
³”_addr_»¶y_ex³ùed
 = 
çl£
;

617 
	`memıy
(&
p_adv”tisšg
->
³”_add»ss
, 
p_³”_add»ss
, (p_advertising->peer_address));

619  
NRF_SUCCESS
;

620 
	}
}

623 
ušt32_t
 
	$bË_adv”tisšg_wh™–i¡_»¶y
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
,

624 
bË_g­_addr_t
 cÚ¡ * 
p_g­_addrs
,

625 
ušt32_t
 
addr_út
,

626 
bË_g­_œk_t
 cÚ¡ * 
p_g­_œks
,

627 
ušt32_t
 
œk_út
)

629 ià(!
p_adv”tisšg
->
wh™–i¡_»¶y_ex³ùed
)

631  
NRF_ERROR_INVALID_STATE
;

634 
p_adv”tisšg
->
wh™–i¡_»¶y_ex³ùed
 = 
çl£
;

636 #ià(
NRF_SD_BLE_API_VERSION
 <= 2)

638 
p_adv”tisšg
->
wh™–i¡
.
addr_couÁ
 = 
addr_út
;

639 
p_adv”tisšg
->
wh™–i¡
.
œk_couÁ
 = 
œk_út
;

641 
ušt32_t
 
i
 = 0; i < 
addr_út
; i++)

643 *
p_adv”tisšg
->
wh™–i¡
.
µ_addrs
[
i
] = 
p_g­_addrs
[i];

646 
ušt32_t
 
i
 = 0; i < 
œk_út
; i++)

648 *
p_adv”tisšg
->
wh™–i¡
.
µ_œks
[
i
] = 
p_g­_œks
[i];

653 
p_adv”tisšg
->
wh™–i¡_š_u£
 = ((
addr_út
 > 0è|| (
œk_út
 > 0));

657  
NRF_SUCCESS
;

658 
	}
}

661 
ušt32_t
 
	$bË_adv”tisšg_»¡¬t_w™hout_wh™–i¡
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
)

663 
ušt32_t
 
»t
;

665 (è
	`sd_bË_g­_adv_¡İ
();

667 
p_adv”tisšg
->
wh™–i¡_‹mpÜ¬y_di§bËd
 = 
Œue
;

669 #ià(
NRF_SD_BLE_API_VERSION
 >= 3)

670 
p_adv”tisšg
->
wh™–i¡_š_u£
 = 
çl£
;

673 
p_adv”tisšg
->
advd©a
.
æags
 = 
BLE_GAP_ADV_FLAGS_LE_ONLY_GENERAL_DISC_MODE
;

675 
»t
 = 
	`bË_advd©a_£t
(&(
p_adv”tisšg
->
advd©a
), 
NULL
);

676 ià(
»t
 !ğ
NRF_SUCCESS
)

678  
»t
;

680 
	`NRF_LOG_INFO
("------start‡dv5-------");

681 
»t
 = 
	`bË_adv”tisšg_¡¬t
(
p_adv”tisšg
,…_adv”tisšg->
adv_mode_cu¼’t
);

682 ià((
»t
 !ğ
NRF_SUCCESS
è&& (
p_adv”tisšg
->
”rÜ_hªdËr
 !ğ
NULL
))

684 
p_adv”tisšg
->
	`”rÜ_hªdËr
(
»t
);

687  
NRF_SUCCESS
;

688 
	}
}

691 
	$bË_adv”tisšg_modes_cÚfig_£t
(
bË_adv”tisšg_t
 * cÚ¡ 
p_adv”tisšg
,

692 
bË_adv_modes_cÚfig_t
 cÚ¡ * cÚ¡ 
p_adv_modes_cÚfig
)

694 
p_adv”tisšg
->
adv_modes_cÚfig
 = *
p_adv_modes_cÚfig
;

695 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\ble_services\ble_bas\ble_bas.c

44 
	~"sdk_commÚ.h
"

45 #ià
NRF_MODULE_ENABLED
(
BLE_BAS
)

46 
	~"bË_bas.h
"

47 
	~<¡ršg.h
>

48 
	~"bË_¤v_commÚ.h
"

51 
	#INVALID_BATTERY_LEVEL
 255

	)

59 
	$Ú_cÚÃù
(
bË_bas_t
 * 
p_bas
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

61 
p_bas
->
cÚn_hªdË
 = 
p_bË_evt
->
evt
.
g­_evt
.conn_handle;

62 
	}
}

70 
	$Ú_discÚÃù
(
bË_bas_t
 * 
p_bas
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

72 
	`UNUSED_PARAMETER
(
p_bË_evt
);

73 
p_bas
->
cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

74 
	}
}

82 
	$Ú_wr™e
(
bË_bas_t
 * 
p_bas
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

84 ià(!
p_bas
->
is_nÙifiÿtiÚ_suµÜ‹d
)

89 
bË_g©ts_evt_wr™e_t
 cÚ¡ * 
p_evt_wr™e
 = &
p_bË_evt
->
evt
.
g©ts_evt
.
·¿ms
.
wr™e
;

91 iàĞ(
p_evt_wr™e
->
hªdË
 =ğ
p_bas
->
b©‹ry_Ëv–_hªdËs
.
cccd_hªdË
)

92 && (
p_evt_wr™e
->
Ën
 == 2))

94 ià(
p_bas
->
evt_hªdËr
 =ğ
NULL
)

99 
bË_bas_evt_t
 
evt
;

101 ià(
	`bË_¤v_is_nÙifiÿtiÚ_’abËd
(
p_evt_wr™e
->
d©a
))

103 
evt
.
evt_ty³
 = 
BLE_BAS_EVT_NOTIFICATION_ENABLED
;

107 
evt
.
evt_ty³
 = 
BLE_BAS_EVT_NOTIFICATION_DISABLED
;

111 
p_bas
->
	`evt_hªdËr
Õ_bas, &
evt
);

113 
	}
}

116 
	$bË_bas_Ú_bË_evt
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
, * 
p_cÚ‹xt
)

118 ià((
p_cÚ‹xt
 =ğ
NULL
è|| (
p_bË_evt
 == NULL))

123 
bË_bas_t
 * 
p_bas
 = (bË_bas_ˆ*)
p_cÚ‹xt
;

125 
p_bË_evt
->
h—d”
.
evt_id
)

127 
BLE_GAP_EVT_CONNECTED
:

128 
	`Ú_cÚÃù
(
p_bas
, 
p_bË_evt
);

131 
BLE_GAP_EVT_DISCONNECTED
:

132 
	`Ú_discÚÃù
(
p_bas
, 
p_bË_evt
);

135 
BLE_GATTS_EVT_WRITE
:

136 
	`Ú_wr™e
(
p_bas
, 
p_bË_evt
);

143 
	}
}

153 
ušt32_t
 
	$b©‹ry_Ëv–_ch¬_add
(
bË_bas_t
 * 
p_bas
, cÚ¡ 
bË_bas_š™_t
 * 
p_bas_š™
)

155 
ušt32_t
 
”r_code
;

156 
bË_g©ts_ch¬_md_t
 
ch¬_md
;

157 
bË_g©ts_©Œ_md_t
 
cccd_md
;

158 
bË_g©ts_©Œ_t
 
©Œ_ch¬_v®ue
;

159 
bË_uuid_t
 
bË_uuid
;

160 
bË_g©ts_©Œ_md_t
 
©Œ_md
;

161 
ušt8_t
 
š™Ÿl_b©‹ry_Ëv–
;

162 
ušt8_t
 
’coded_»pÜt_»f
[
BLE_SRV_ENCODED_REPORT_REF_LEN
];

163 
ušt8_t
 
š™_Ën
;

166 ià(
p_bas
->
is_nÙifiÿtiÚ_suµÜ‹d
)

168 
	`mem£t
(&
cccd_md
, 0, (cccd_md));

172 
	`BLE_GAP_CONN_SEC_MODE_SET_OPEN
(&
cccd_md
.
»ad_³rm
);

173 
cccd_md
.
wr™e_³rm
 = 
p_bas_š™
->
b©‹ry_Ëv–_ch¬_©Œ_md
.
cccd_wr™e_³rm
;

174 
cccd_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

177 
	`mem£t
(&
ch¬_md
, 0, (char_md));

179 
ch¬_md
.
ch¬_´İs
.
»ad
 = 1;

180 
ch¬_md
.
ch¬_´İs
.
nÙify
 = (
p_bas
->
is_nÙifiÿtiÚ_suµÜ‹d
) ? 1 : 0;

181 
ch¬_md
.
p_ch¬_u£r_desc
 = 
NULL
;

182 
ch¬_md
.
p_ch¬_pf
 = 
NULL
;

183 
ch¬_md
.
p_u£r_desc_md
 = 
NULL
;

184 
ch¬_md
.
p_cccd_md
 = (
p_bas
->
is_nÙifiÿtiÚ_suµÜ‹d
è? &
cccd_md
 : 
NULL
;

185 
ch¬_md
.
p_sccd_md
 = 
NULL
;

187 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
BLE_UUID_BATTERY_LEVEL_CHAR
);

189 
	`mem£t
(&
©Œ_md
, 0, (attr_md));

191 
©Œ_md
.
»ad_³rm
 = 
p_bas_š™
->
b©‹ry_Ëv–_ch¬_©Œ_md
.read_perm;

192 
©Œ_md
.
wr™e_³rm
 = 
p_bas_š™
->
b©‹ry_Ëv–_ch¬_©Œ_md
.write_perm;

193 
©Œ_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

194 
©Œ_md
.
rd_auth
 = 0;

195 
©Œ_md
.
wr_auth
 = 0;

196 
©Œ_md
.
vËn
 = 0;

198 
š™Ÿl_b©‹ry_Ëv–
 = 
p_bas_š™
->
š™Ÿl_b©t_Ëv–
;

200 
	`mem£t
(&
©Œ_ch¬_v®ue
, 0, (attr_char_value));

202 
©Œ_ch¬_v®ue
.
p_uuid
 = &
bË_uuid
;

203 
©Œ_ch¬_v®ue
.
p_©Œ_md
 = &
©Œ_md
;

204 
©Œ_ch¬_v®ue
.
š™_Ën
 = (
ušt8_t
);

205 
©Œ_ch¬_v®ue
.
š™_offs
 = 0;

206 
©Œ_ch¬_v®ue
.
max_Ën
 = (
ušt8_t
);

207 
©Œ_ch¬_v®ue
.
p_v®ue
 = &
š™Ÿl_b©‹ry_Ëv–
;

209 
”r_code
 = 
	`sd_bË_g©ts_ch¬aù”i¡ic_add
(
p_bas
->
£rviû_hªdË
, &
ch¬_md
,

210 &
©Œ_ch¬_v®ue
,

211 &
p_bas
->
b©‹ry_Ëv–_hªdËs
);

212 ià(
”r_code
 !ğ
NRF_SUCCESS
)

214  
”r_code
;

217 ià(
p_bas_š™
->
p_»pÜt_»f
 !ğ
NULL
)

220 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
BLE_UUID_REPORT_REF_DESCR
);

222 
	`mem£t
(&
©Œ_md
, 0, (attr_md));

224 
©Œ_md
.
»ad_³rm
 = 
p_bas_š™
->
b©‹ry_Ëv–_»pÜt_»ad_³rm
;

225 
	`BLE_GAP_CONN_SEC_MODE_SET_NO_ACCESS
(&
©Œ_md
.
wr™e_³rm
);

227 
©Œ_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

228 
©Œ_md
.
rd_auth
 = 0;

229 
©Œ_md
.
wr_auth
 = 0;

230 
©Œ_md
.
vËn
 = 0;

232 
š™_Ën
 = 
	`bË_¤v_»pÜt_»f_’code
(
’coded_»pÜt_»f
, 
p_bas_š™
->
p_»pÜt_»f
);

234 
	`mem£t
(&
©Œ_ch¬_v®ue
, 0, (attr_char_value));

236 
©Œ_ch¬_v®ue
.
p_uuid
 = &
bË_uuid
;

237 
©Œ_ch¬_v®ue
.
p_©Œ_md
 = &
©Œ_md
;

238 
©Œ_ch¬_v®ue
.
š™_Ën
 = init_len;

239 
©Œ_ch¬_v®ue
.
š™_offs
 = 0;

240 
©Œ_ch¬_v®ue
.
max_Ën
 =‡‰r_ch¬_v®ue.
š™_Ën
;

241 
©Œ_ch¬_v®ue
.
p_v®ue
 = 
’coded_»pÜt_»f
;

243 
”r_code
 = 
	`sd_bË_g©ts_desütÜ_add
(
p_bas
->
b©‹ry_Ëv–_hªdËs
.
v®ue_hªdË
,

244 &
©Œ_ch¬_v®ue
,

245 &
p_bas
->
»pÜt_»f_hªdË
);

246 ià(
”r_code
 !ğ
NRF_SUCCESS
)

248  
”r_code
;

253 
p_bas
->
»pÜt_»f_hªdË
 = 
BLE_GATT_HANDLE_INVALID
;

256  
NRF_SUCCESS
;

257 
	}
}

260 
ušt32_t
 
	$bË_bas_š™
(
bË_bas_t
 * 
p_bas
, cÚ¡ 
bË_bas_š™_t
 * 
p_bas_š™
)

262 ià(
p_bas
 =ğ
NULL
 || 
p_bas_š™
 == NULL)

264  
NRF_ERROR_NULL
;

267 
ušt32_t
 
”r_code
;

268 
bË_uuid_t
 
bË_uuid
;

271 
p_bas
->
evt_hªdËr
 = 
p_bas_š™
->evt_handler;

272 
p_bas
->
cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

273 
p_bas
->
is_nÙifiÿtiÚ_suµÜ‹d
 = 
p_bas_š™
->
suµÜt_nÙifiÿtiÚ
;

274 
p_bas
->
b©‹ry_Ëv–_Ï¡
 = 
INVALID_BATTERY_LEVEL
;

277 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
BLE_UUID_BATTERY_SERVICE
);

279 
”r_code
 = 
	`sd_bË_g©ts_£rviû_add
(
BLE_GATTS_SRVC_TYPE_PRIMARY
, &
bË_uuid
, &
p_bas
->
£rviû_hªdË
);

280 ià(
”r_code
 !ğ
NRF_SUCCESS
)

282  
”r_code
;

286  
	`b©‹ry_Ëv–_ch¬_add
(
p_bas
, 
p_bas_š™
);

287 
	}
}

290 
ušt32_t
 
	$bË_bas_b©‹ry_Ëv–_upd©e
(
bË_bas_t
 * 
p_bas
, 
ušt8_t
 
b©‹ry_Ëv–
)

292 ià(
p_bas
 =ğ
NULL
)

294  
NRF_ERROR_NULL
;

297 
ušt32_t
 
”r_code
 = 
NRF_SUCCESS
;

298 
bË_g©ts_v®ue_t
 
g©ts_v®ue
;

300 ià(
b©‹ry_Ëv–
 !ğ
p_bas
->
b©‹ry_Ëv–_Ï¡
)

303 
	`mem£t
(&
g©ts_v®ue
, 0, (gatts_value));

305 
g©ts_v®ue
.
Ën
 = (
ušt8_t
);

306 
g©ts_v®ue
.
off£t
 = 0;

307 
g©ts_v®ue
.
p_v®ue
 = &
b©‹ry_Ëv–
;

310 
”r_code
 = 
	`sd_bË_g©ts_v®ue_£t
(
p_bas
->
cÚn_hªdË
,

311 
p_bas
->
b©‹ry_Ëv–_hªdËs
.
v®ue_hªdË
,

312 &
g©ts_v®ue
);

313 ià(
”r_code
 =ğ
NRF_SUCCESS
)

316 
p_bas
->
b©‹ry_Ëv–_Ï¡
 = 
b©‹ry_Ëv–
;

320  
”r_code
;

324 ià((
p_bas
->
cÚn_hªdË
 !ğ
BLE_CONN_HANDLE_INVALID
è&&…_bas->
is_nÙifiÿtiÚ_suµÜ‹d
)

326 
bË_g©ts_hvx_·¿ms_t
 
hvx_·¿ms
;

328 
	`mem£t
(&
hvx_·¿ms
, 0, (hvx_params));

330 
hvx_·¿ms
.
hªdË
 = 
p_bas
->
b©‹ry_Ëv–_hªdËs
.
v®ue_hªdË
;

331 
hvx_·¿ms
.
ty³
 = 
BLE_GATT_HVX_NOTIFICATION
;

332 
hvx_·¿ms
.
off£t
 = 
g©ts_v®ue
.offset;

333 
hvx_·¿ms
.
p_Ën
 = &
g©ts_v®ue
.
Ën
;

334 
hvx_·¿ms
.
p_d©a
 = 
g©ts_v®ue
.
p_v®ue
;

336 
”r_code
 = 
	`sd_bË_g©ts_hvx
(
p_bas
->
cÚn_hªdË
, &
hvx_·¿ms
);

340 
”r_code
 = 
NRF_ERROR_INVALID_STATE
;

344  
”r_code
;

345 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\ble_services\ble_dis\ble_dis.c

44 
	~"sdk_commÚ.h
"

45 #ià
NRF_MODULE_ENABLED
(
BLE_DIS
)

46 
	~"bË_dis.h
"

48 
	~<¡dlib.h
>

49 
	~<¡ršg.h
>

50 
	~"­p_”rÜ.h
"

51 
	~"bË_g©ts.h
"

52 
	~"bË_¤v_commÚ.h
"

55 
	#BLE_DIS_SYS_ID_LEN
 8

	)

56 
	#BLE_DIS_PNP_ID_LEN
 7

	)

58 
ušt16_t
 
	g£rviû_hªdË
;

59 
bË_g©ts_ch¬_hªdËs_t
 
	gmªuçù_Çme_hªdËs
;

60 
bË_g©ts_ch¬_hªdËs_t
 
	gmod–_num_hªdËs
;

61 
bË_g©ts_ch¬_hªdËs_t
 
	g£rŸl_num_hªdËs
;

62 
bË_g©ts_ch¬_hªdËs_t
 
	ghw_»v_hªdËs
;

63 
bË_g©ts_ch¬_hªdËs_t
 
	gfw_»v_hªdËs
;

64 
bË_g©ts_ch¬_hªdËs_t
 
	gsw_»v_hªdËs
;

65 
bË_g©ts_ch¬_hªdËs_t
 
	gsys_id_hªdËs
;

66 
bË_g©ts_ch¬_hªdËs_t
 
	g»g_û¹_d©a_li¡_hªdËs
;

67 
bË_g©ts_ch¬_hªdËs_t
 
	g²p_id_hªdËs
;

75 
	$sys_id_’code
(
ušt8_t
 * 
p_’coded_bufãr
, 
bË_dis_sys_id_t
 cÚ¡ * 
p_sys_id
)

77 
	`APP_ERROR_CHECK_BOOL
(
p_sys_id
 !ğ
NULL
);

78 
	`APP_ERROR_CHECK_BOOL
(
p_’coded_bufãr
 !ğ
NULL
);

80 
p_’coded_bufãr
[0] = (
p_sys_id
->
mªuçùu»r_id
 & 0x00000000FF);

81 
p_’coded_bufãr
[1] = (
p_sys_id
->
mªuçùu»r_id
 & 0x000000FF00) >> 8;

82 
p_’coded_bufãr
[2] = (
p_sys_id
->
mªuçùu»r_id
 & 0x0000FF0000) >> 16;

83 
p_’coded_bufãr
[3] = (
p_sys_id
->
mªuçùu»r_id
 & 0x00FF000000) >> 24;

84 
p_’coded_bufãr
[4] = (
p_sys_id
->
mªuçùu»r_id
 & 0xFF00000000) >> 32;

86 
p_’coded_bufãr
[5] = (
p_sys_id
->
Ügªiz©iÚ®ly_unique_id
 & 0x0000FF);

87 
p_’coded_bufãr
[6] = (
p_sys_id
->
Ügªiz©iÚ®ly_unique_id
 & 0x00FF00) >> 8;

88 
p_’coded_bufãr
[7] = (
p_sys_id
->
Ügªiz©iÚ®ly_unique_id
 & 0xFF0000) >> 16;

89 
	}
}

97 
	$²p_id_’code
(
ušt8_t
 * 
p_’coded_bufãr
, 
bË_dis_²p_id_t
 cÚ¡ * 
p_²p_id
)

99 
ušt8_t
 
Ën
 = 0;

101 
	`APP_ERROR_CHECK_BOOL
(
p_²p_id
 !ğ
NULL
);

102 
	`APP_ERROR_CHECK_BOOL
(
p_’coded_bufãr
 !ğ
NULL
);

104 
p_’coded_bufãr
[
Ën
++] = 
p_²p_id
->
v’dÜ_id_sourû
;

106 
Ën
 +ğ
	`ušt16_’code
(
p_²p_id
->
v’dÜ_id
, &
p_’coded_bufãr
[len]);

107 
Ën
 +ğ
	`ušt16_’code
(
p_²p_id
->
´oduù_id
, &
p_’coded_bufãr
[len]);

108 
Ën
 +ğ
	`ušt16_’code
(
p_²p_id
->
´oduù_v”siÚ
, &
p_’coded_bufãr
[len]);

110 
	`APP_ERROR_CHECK_BOOL
(
Ën
 =ğ
BLE_DIS_PNP_ID_LEN
);

111 
	}
}

124 
ušt32_t
 
	$ch¬_add
(
ušt16_t
 
uuid
,

125 
ušt8_t
 * 
p_ch¬_v®ue
,

126 
ušt16_t
 
ch¬_Ën
,

127 
bË_¤v_£cur™y_mode_t
 cÚ¡ * 
dis_©Œ_md
,

128 
bË_g©ts_ch¬_hªdËs_t
 * 
p_hªdËs
)

130 
bË_uuid_t
 
bË_uuid
;

131 
bË_g©ts_ch¬_md_t
 
ch¬_md
;

132 
bË_g©ts_©Œ_t
 
©Œ_ch¬_v®ue
;

133 
bË_g©ts_©Œ_md_t
 
©Œ_md
;

135 
	`APP_ERROR_CHECK_BOOL
(
p_ch¬_v®ue
 !ğ
NULL
);

136 
	`APP_ERROR_CHECK_BOOL
(
ch¬_Ën
 > 0);

139 
	`mem£t
(&
ch¬_md
, 0, (char_md));

141 
ch¬_md
.
ch¬_´İs
.
»ad
 = 1;

142 
ch¬_md
.
p_ch¬_u£r_desc
 = 
NULL
;

143 
ch¬_md
.
p_ch¬_pf
 = 
NULL
;

144 
ch¬_md
.
p_u£r_desc_md
 = 
NULL
;

145 
ch¬_md
.
p_cccd_md
 = 
NULL
;

146 
ch¬_md
.
p_sccd_md
 = 
NULL
;

148 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
uuid
);

150 
	`mem£t
(&
©Œ_md
, 0, (attr_md));

152 
©Œ_md
.
»ad_³rm
 = 
dis_©Œ_md
->read_perm;

153 
©Œ_md
.
wr™e_³rm
 = 
dis_©Œ_md
->write_perm;

154 
©Œ_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

155 
©Œ_md
.
rd_auth
 = 0;

156 
©Œ_md
.
wr_auth
 = 0;

157 
©Œ_md
.
vËn
 = 0;

159 
	`mem£t
(&
©Œ_ch¬_v®ue
, 0, (attr_char_value));

161 
©Œ_ch¬_v®ue
.
p_uuid
 = &
bË_uuid
;

162 
©Œ_ch¬_v®ue
.
p_©Œ_md
 = &
©Œ_md
;

163 
©Œ_ch¬_v®ue
.
š™_Ën
 = 
ch¬_Ën
;

164 
©Œ_ch¬_v®ue
.
š™_offs
 = 0;

165 
©Œ_ch¬_v®ue
.
max_Ën
 = 
ch¬_Ën
;

166 
©Œ_ch¬_v®ue
.
p_v®ue
 = 
p_ch¬_v®ue
;

168  
	`sd_bË_g©ts_ch¬aù”i¡ic_add
(
£rviû_hªdË
, &
ch¬_md
, &
©Œ_ch¬_v®ue
, 
p_hªdËs
);

169 
	}
}

172 
ušt32_t
 
	$bË_dis_š™
(
bË_dis_š™_t
 cÚ¡ * 
p_dis_š™
)

174 
ušt32_t
 
”r_code
;

175 
bË_uuid_t
 
bË_uuid
;

178 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
BLE_UUID_DEVICE_INFORMATION_SERVICE
);

180 
”r_code
 = 
	`sd_bË_g©ts_£rviû_add
(
BLE_GATTS_SRVC_TYPE_PRIMARY
, &
bË_uuid
, &
£rviû_hªdË
);

181 ià(
”r_code
 !ğ
NRF_SUCCESS
)

183  
”r_code
;

187 ià(
p_dis_š™
->
mªuçù_Çme_¡r
.
Ëngth
 > 0)

189 
”r_code
 = 
	`ch¬_add
(
BLE_UUID_MANUFACTURER_NAME_STRING_CHAR
,

190 
p_dis_š™
->
mªuçù_Çme_¡r
.
p_¡r
,

191 
p_dis_š™
->
mªuçù_Çme_¡r
.
Ëngth
,

192 &
p_dis_š™
->
dis_©Œ_md
,

193 &
mªuçù_Çme_hªdËs
);

194 ià(
”r_code
 !ğ
NRF_SUCCESS
)

196  
”r_code
;

199 ià(
p_dis_š™
->
mod–_num_¡r
.
Ëngth
 > 0)

201 
”r_code
 = 
	`ch¬_add
(
BLE_UUID_MODEL_NUMBER_STRING_CHAR
,

202 
p_dis_š™
->
mod–_num_¡r
.
p_¡r
,

203 
p_dis_š™
->
mod–_num_¡r
.
Ëngth
,

204 &
p_dis_š™
->
dis_©Œ_md
,

205 &
mod–_num_hªdËs
);

206 ià(
”r_code
 !ğ
NRF_SUCCESS
)

208  
”r_code
;

211 ià(
p_dis_š™
->
£rŸl_num_¡r
.
Ëngth
 > 0)

213 
”r_code
 = 
	`ch¬_add
(
BLE_UUID_SERIAL_NUMBER_STRING_CHAR
,

214 
p_dis_š™
->
£rŸl_num_¡r
.
p_¡r
,

215 
p_dis_š™
->
£rŸl_num_¡r
.
Ëngth
,

216 &
p_dis_š™
->
dis_©Œ_md
,

217 &
£rŸl_num_hªdËs
);

218 ià(
”r_code
 !ğ
NRF_SUCCESS
)

220  
”r_code
;

223 ià(
p_dis_š™
->
hw_»v_¡r
.
Ëngth
 > 0)

225 
”r_code
 = 
	`ch¬_add
(
BLE_UUID_HARDWARE_REVISION_STRING_CHAR
,

226 
p_dis_š™
->
hw_»v_¡r
.
p_¡r
,

227 
p_dis_š™
->
hw_»v_¡r
.
Ëngth
,

228 &
p_dis_š™
->
dis_©Œ_md
,

229 &
hw_»v_hªdËs
);

230 ià(
”r_code
 !ğ
NRF_SUCCESS
)

232  
”r_code
;

235 ià(
p_dis_š™
->
fw_»v_¡r
.
Ëngth
 > 0)

237 
”r_code
 = 
	`ch¬_add
(
BLE_UUID_FIRMWARE_REVISION_STRING_CHAR
,

238 
p_dis_š™
->
fw_»v_¡r
.
p_¡r
,

239 
p_dis_š™
->
fw_»v_¡r
.
Ëngth
,

240 &
p_dis_š™
->
dis_©Œ_md
,

241 &
fw_»v_hªdËs
);

242 ià(
”r_code
 !ğ
NRF_SUCCESS
)

244  
”r_code
;

247 ià(
p_dis_š™
->
sw_»v_¡r
.
Ëngth
 > 0)

249 
”r_code
 = 
	`ch¬_add
(
BLE_UUID_SOFTWARE_REVISION_STRING_CHAR
,

250 
p_dis_š™
->
sw_»v_¡r
.
p_¡r
,

251 
p_dis_š™
->
sw_»v_¡r
.
Ëngth
,

252 &
p_dis_š™
->
dis_©Œ_md
,

253 &
sw_»v_hªdËs
);

254 ià(
”r_code
 !ğ
NRF_SUCCESS
)

256  
”r_code
;

259 ià(
p_dis_š™
->
p_sys_id
 !ğ
NULL
)

261 
ušt8_t
 
’coded_sys_id
[
BLE_DIS_SYS_ID_LEN
];

263 
	`sys_id_’code
(
’coded_sys_id
, 
p_dis_š™
->
p_sys_id
);

264 
”r_code
 = 
	`ch¬_add
(
BLE_UUID_SYSTEM_ID_CHAR
,

265 
’coded_sys_id
,

266 
BLE_DIS_SYS_ID_LEN
,

267 &
p_dis_š™
->
dis_©Œ_md
,

268 &
sys_id_hªdËs
);

269 ià(
”r_code
 !ğ
NRF_SUCCESS
)

271  
”r_code
;

274 ià(
p_dis_š™
->
p_»g_û¹_d©a_li¡
 !ğ
NULL
)

276 
”r_code
 = 
	`ch¬_add
(
BLE_UUID_IEEE_REGULATORY_CERTIFICATION_DATA_LIST_CHAR
,

277 
p_dis_š™
->
p_»g_û¹_d©a_li¡
->
p_li¡
,

278 
p_dis_š™
->
p_»g_û¹_d©a_li¡
->
li¡_Ën
,

279 &
p_dis_š™
->
dis_©Œ_md
,

280 &
»g_û¹_d©a_li¡_hªdËs
);

281 ià(
”r_code
 !ğ
NRF_SUCCESS
)

283  
”r_code
;

286 ià(
p_dis_š™
->
p_²p_id
 !ğ
NULL
)

288 
ušt8_t
 
’coded_²p_id
[
BLE_DIS_PNP_ID_LEN
];

290 
	`²p_id_’code
(
’coded_²p_id
, 
p_dis_š™
->
p_²p_id
);

291 
”r_code
 = 
	`ch¬_add
(
BLE_UUID_PNP_ID_CHAR
,

292 
’coded_²p_id
,

293 
BLE_DIS_PNP_ID_LEN
,

294 &
p_dis_š™
->
dis_©Œ_md
,

295 &
²p_id_hªdËs
);

296 ià(
”r_code
 !ğ
NRF_SUCCESS
)

298  
”r_code
;

302  
NRF_SUCCESS
;

303 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\ble_services\ble_hids\ble_hids.c

44 
	~"sdk_commÚ.h
"

45 #ià
NRF_MODULE_ENABLED
(
BLE_HIDS
)

46 
	~"bË_hids.h
"

47 
	~<¡ršg.h
>

48 
	~"­p_”rÜ.h
"

49 
	~"bË_¤v_commÚ.h
"

53 
	#PROTOCOL_MODE_BOOT
 0x00

	)

54 
	#PROTOCOL_MODE_REPORT
 0x01

	)

57 
	#HIDS_CONTROL_POINT_SUSPEND
 0

	)

58 
	#HIDS_CONTROL_POINT_EXIT_SUSPEND
 1

	)

60 
	#DEFAULT_PROTOCOL_MODE
 
PROTOCOL_MODE_REPORT


	)

61 
	#INITIAL_VALUE_HID_CONTROL_POINT
 
HIDS_CONTROL_POINT_SUSPEND


	)

63 
	#ENCODED_HID_INFORMATION_LEN
 4

	)

65 
	#BOOT_KB_INPUT_REPORT_MAX_SIZE
 8

	)

66 
	#BOOT_KB_OUTPUT_REPORT_MAX_SIZE
 1

	)

67 
	#BOOT_MOUSE_INPUT_REPORT_MIN_SIZE
 3

	)

68 
	#BOOT_MOUSE_INPUT_REPORT_MAX_SIZE
 8

	)

79 
bË_hids_ch¬_id_t
 
	$make_ch¬_id
(
ušt16_t
 
uuid
, 
ušt8_t
 
»p_ty³
, ušt8_ˆ
»p_šdex
)

81 
bË_hids_ch¬_id_t
 
ch¬_id
 = {0};

83 
ch¬_id
.
uuid
 = uuid;

84 
ch¬_id
.
»p_ty³
 =„ep_type;

85 
ch¬_id
.
»p_šdex
 =„ep_index;

87  
ch¬_id
;

88 
	}
}

96 
	$Ú_cÚÃù
(
bË_hids_t
 * 
p_hids
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

98 
ušt32_t
 
”r_code
;

99 
ušt8_t
 
deçuÉ_´ÙocŞ_mode
;

100 
bË_g©ts_v®ue_t
 
g©ts_v®ue
;

102 
p_hids
->
cÚn_hªdË
 = 
p_bË_evt
->
evt
.
g­_evt
.conn_handle;

104 ià(
p_hids
->
´ÙocŞ_mode_hªdËs
.
v®ue_hªdË
)

107 
deçuÉ_´ÙocŞ_mode
 = 
DEFAULT_PROTOCOL_MODE
;

110 
	`mem£t
(&
g©ts_v®ue
, 0, (gatts_value));

112 
g©ts_v®ue
.
Ën
 = (
ušt8_t
);

113 
g©ts_v®ue
.
off£t
 = 0;

114 
g©ts_v®ue
.
p_v®ue
 = &
deçuÉ_´ÙocŞ_mode
;

116 
”r_code
 = 
	`sd_bË_g©ts_v®ue_£t
(
p_hids
->
cÚn_hªdË
,

117 
p_hids
->
´ÙocŞ_mode_hªdËs
.
v®ue_hªdË
,

118 &
g©ts_v®ue
);

119 ià((
”r_code
 !ğ
NRF_SUCCESS
è&& (
p_hids
->
”rÜ_hªdËr
 !ğ
NULL
))

121 
p_hids
->
	`”rÜ_hªdËr
(
”r_code
);

124 
	}
}

132 
	$Ú_discÚÃù
(
bË_hids_t
 * 
p_hids
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

134 
	`UNUSED_PARAMETER
(
p_bË_evt
);

135 
p_hids
->
cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

136 
	}
}

144 
	$Ú_cÚŒŞ_pošt_wr™e
(
bË_hids_t
 * 
p_hids
, 
bË_g©ts_evt_wr™e_t
 cÚ¡ * 
p_evt_wr™e
)

146 ià((
p_evt_wr™e
->
Ën
 =ğ1è&& (
p_hids
->
evt_hªdËr
 !ğ
NULL
))

148 
bË_hids_evt_t
 
evt
;

151 
p_evt_wr™e
->
d©a
[0])

153 
HIDS_CONTROL_POINT_SUSPEND
:

154 
evt
.
evt_ty³
 = 
BLE_HIDS_EVT_HOST_SUSP
;

157 
HIDS_CONTROL_POINT_EXIT_SUSPEND
:

158 
evt
.
evt_ty³
 = 
BLE_HIDS_EVT_HOST_EXIT_SUSP
;

166 
p_hids
->
	`evt_hªdËr
Õ_hids, &
evt
);

168 
	}
}

176 
	$Ú_´ÙocŞ_mode_wr™e
(
bË_hids_t
 * 
p_hids
, 
bË_g©ts_evt_wr™e_t
 cÚ¡ * 
p_evt_wr™e
)

178 ià((
p_evt_wr™e
->
Ën
 =ğ1è&& (
p_hids
->
evt_hªdËr
 !ğ
NULL
))

180 
bË_hids_evt_t
 
evt
;

183 
p_evt_wr™e
->
d©a
[0])

185 
PROTOCOL_MODE_BOOT
:

186 
evt
.
evt_ty³
 = 
BLE_HIDS_EVT_BOOT_MODE_ENTERED
;

189 
PROTOCOL_MODE_REPORT
:

190 
evt
.
evt_ty³
 = 
BLE_HIDS_EVT_REPORT_MODE_ENTERED
;

198 
p_hids
->
	`evt_hªdËr
Õ_hids, &
evt
);

200 
	}
}

209 
	$Ú_»pÜt_cccd_wr™e
(
bË_hids_t
 * 
p_hids
,

210 
bË_hids_ch¬_id_t
 * 
p_ch¬_id
,

211 
bË_g©ts_evt_wr™e_t
 cÚ¡ * 
p_evt_wr™e
)

213 ià(
p_evt_wr™e
->
Ën
 == 2)

216 ià(
p_hids
->
evt_hªdËr
 !ğ
NULL
)

218 
bË_hids_evt_t
 
evt
;

220 ià(
	`bË_¤v_is_nÙifiÿtiÚ_’abËd
(
p_evt_wr™e
->
d©a
))

222 
evt
.
evt_ty³
 = 
BLE_HIDS_EVT_NOTIF_ENABLED
;

226 
evt
.
evt_ty³
 = 
BLE_HIDS_EVT_NOTIF_DISABLED
;

228 
evt
.
·¿ms
.
nÙifiÿtiÚ
.
ch¬_id
 = *
p_ch¬_id
;

230 
p_hids
->
	`evt_hªdËr
Õ_hids, &
evt
);

233 
	}
}

241 
	$Ú_»pÜt_v®ue_wr™e
(
bË_hids_t
 * 
p_hids
,

242 
bË_evt_t
 cÚ¡ * 
p_bË_evt
,

243 
bË_hids_ch¬_id_t
 * 
p_ch¬_id
)

245 ià(
p_hids
->
evt_hªdËr
 !ğ
NULL
)

247 
bË_hids_evt_t
 
evt
;

249 
evt
.
evt_ty³
 = 
BLE_HIDS_EVT_REP_CHAR_WRITE
;

250 
evt
.
·¿ms
.
ch¬_wr™e
.
ch¬_id
 = *
p_ch¬_id
;

251 
evt
.
·¿ms
.
ch¬_wr™e
.
off£t
 = 
p_bË_evt
->evt.
g©ts_evt
.·¿ms.
wr™e
.offset;

252 
evt
.
·¿ms
.
ch¬_wr™e
.
Ën
 = 
p_bË_evt
->evt.
g©ts_evt
.·¿ms.
wr™e
.len;

253 
evt
.
·¿ms
.
ch¬_wr™e
.
d©a
 = (
ušt8_t
*)
p_bË_evt
->evt.
g©ts_evt
.·¿ms.
wr™e
.data;

255 
p_hids
->
	`evt_hªdËr
Õ_hids, &
evt
);

257 
	}
}

264 
	$Ú_»pÜt_v®ue_»ad_auth
(
bË_hids_t
 * 
p_hids
,

265 
bË_hids_ch¬_id_t
 * 
p_ch¬_id
,

266 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

268 ià(
p_hids
->
evt_hªdËr
 !ğ
NULL
)

270 
bË_hids_evt_t
 
evt
;

272 
evt
.
evt_ty³
 = 
BLE_HIDS_EVT_REPORT_READ
;

273 
evt
.
·¿ms
.
ch¬_auth_»ad
.
ch¬_id
 = *
p_ch¬_id
;

274 
evt
.
p_bË_evt
 = (
bË_evt_t
*)p_ble_evt;

276 
p_hids
->
	`evt_hªdËr
Õ_hids, &
evt
);

278 
	}
}

288 
boŞ
 
	$šp_»p_cccd_id’tify
(
bË_hids_t
 * 
p_hids
,

289 
ušt16_t
 
hªdË
,

290 
bË_hids_ch¬_id_t
 * 
p_ch¬_id
)

292 
ušt8_t
 
i
;

294 
i
 = 0; i < 
p_hids
->
šp_»p_couÁ
; i++)

296 ià(
hªdË
 =ğ
p_hids
->
šp_»p_¬¿y
[
i
].
ch¬_hªdËs
.
cccd_hªdË
)

298 *
p_ch¬_id
 = 
	`make_ch¬_id
(
BLE_UUID_REPORT_CHAR
, 
BLE_HIDS_REP_TYPE_INPUT
, 
i
);

299  
Œue
;

303  
çl£
;

304 
	}
}

315 
boŞ
 
	$»p_v®ue_id’tify
(
bË_hids_t
 * 
p_hids
,

316 
ušt16_t
 
hªdË
,

317 
bË_hids_ch¬_id_t
 * 
p_ch¬_id
)

319 
ušt8_t
 
i
;

321 
i
 = 0; i < 
p_hids
->
šp_»p_couÁ
; i++)

323 ià(
hªdË
 =ğ
p_hids
->
šp_»p_¬¿y
[
i
].
ch¬_hªdËs
.
v®ue_hªdË
)

325 *
p_ch¬_id
 = 
	`make_ch¬_id
(
BLE_UUID_REPORT_CHAR
, 
BLE_HIDS_REP_TYPE_INPUT
, 
i
);

326  
Œue
;

330 
i
 = 0; i < 
p_hids
->
ou_»p_couÁ
; i++)

332 ià(
hªdË
 =ğ
p_hids
->
ou_»p_¬¿y
[
i
].
ch¬_hªdËs
.
v®ue_hªdË
)

334 *
p_ch¬_id
 = 
	`make_ch¬_id
(
BLE_UUID_REPORT_CHAR
, 
BLE_HIDS_REP_TYPE_OUTPUT
, 
i
);

335  
Œue
;

339 
i
 = 0; i < 
p_hids
->
ã©u»_»p_couÁ
; i++)

341 ià(
hªdË
 =ğ
p_hids
->
ã©u»_»p_¬¿y
[
i
].
ch¬_hªdËs
.
v®ue_hªdË
)

343 *
p_ch¬_id
 = 
	`make_ch¬_id
(
BLE_UUID_REPORT_CHAR
, 
BLE_HIDS_REP_TYPE_FEATURE
, 
i
);

344  
Œue
;

348  
çl£
;

349 
	}
}

357 
	$Ú_wr™e
(
bË_hids_t
 * 
p_hids
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

359 
bË_hids_ch¬_id_t
 
ch¬_id
;

360 
bË_g©ts_evt_wr™e_t
 cÚ¡ * 
p_evt_wr™e
 = &
p_bË_evt
->
evt
.
g©ts_evt
.
·¿ms
.
wr™e
;

362 ià(
p_evt_wr™e
->
hªdË
 =ğ
p_hids
->
hid_cÚŒŞ_pošt_hªdËs
.
v®ue_hªdË
)

364 
	`Ú_cÚŒŞ_pošt_wr™e
(
p_hids
, 
p_evt_wr™e
);

366 ià(
p_evt_wr™e
->
hªdË
 =ğ
p_hids
->
´ÙocŞ_mode_hªdËs
.
v®ue_hªdË
)

368 
	`Ú_´ÙocŞ_mode_wr™e
(
p_hids
, 
p_evt_wr™e
);

370 ià(
p_evt_wr™e
->
hªdË
 =ğ
p_hids
->
boÙ_kb_šp_»p_hªdËs
.
cccd_hªdË
)

372 
ch¬_id
 = 
	`make_ch¬_id
(
BLE_UUID_BOOT_KEYBOARD_INPUT_REPORT_CHAR
, 0, 0);

373 
	`Ú_»pÜt_cccd_wr™e
(
p_hids
, &
ch¬_id
, 
p_evt_wr™e
);

375 ià(
p_evt_wr™e
->
hªdË
 =ğ
p_hids
->
boÙ_kb_šp_»p_hªdËs
.
v®ue_hªdË
)

377 
ch¬_id
 = 
	`make_ch¬_id
(
BLE_UUID_BOOT_KEYBOARD_INPUT_REPORT_CHAR
, 0, 0);

378 
	`Ú_»pÜt_v®ue_wr™e
(
p_hids
, 
p_bË_evt
, &
ch¬_id
);

380 ià(
p_evt_wr™e
->
hªdË
 =ğ
p_hids
->
boÙ_mou£_šp_»p_hªdËs
.
cccd_hªdË
)

382 
ch¬_id
 = 
	`make_ch¬_id
(
BLE_UUID_BOOT_MOUSE_INPUT_REPORT_CHAR
, 0, 0);

383 
	`Ú_»pÜt_cccd_wr™e
(
p_hids
, &
ch¬_id
, 
p_evt_wr™e
);

385 ià(
p_evt_wr™e
->
hªdË
 =ğ
p_hids
->
boÙ_mou£_šp_»p_hªdËs
.
v®ue_hªdË
)

387 
ch¬_id
 = 
	`make_ch¬_id
(
BLE_UUID_BOOT_MOUSE_INPUT_REPORT_CHAR
, 0, 0);

388 
	`Ú_»pÜt_v®ue_wr™e
(
p_hids
, 
p_bË_evt
, &
ch¬_id
);

390 ià(
	`šp_»p_cccd_id’tify
(
p_hids
, 
p_evt_wr™e
->
hªdË
, &
ch¬_id
))

392 
	`Ú_»pÜt_cccd_wr™e
(
p_hids
, &
ch¬_id
, 
p_evt_wr™e
);

394 ià(
	`»p_v®ue_id’tify
(
p_hids
, 
p_evt_wr™e
->
hªdË
, &
ch¬_id
))

396 
	`Ú_»pÜt_v®ue_wr™e
(
p_hids
, 
p_bË_evt
, &
ch¬_id
);

402 
	}
}

409 
	$Ú_rw_authÜize_»que¡
(
bË_hids_t
 * 
p_hids
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

411 
bË_g©ts_evt_rw_authÜize_»que¡_t
 cÚ¡ * 
evt_rw_auth
 =

412 &
p_bË_evt
->
evt
.
g©ts_evt
.
·¿ms
.
authÜize_»que¡
;

414 
bË_hids_ch¬_id_t
 
ch¬_id
;

416 ià(
evt_rw_auth
->
ty³
 !ğ
BLE_GATTS_AUTHORIZE_TYPE_READ
)

422 ià(
	`»p_v®ue_id’tify
(
p_hids
, 
evt_rw_auth
->
»que¡
.
»ad
.
hªdË
, &
ch¬_id
))

424 
	`Ú_»pÜt_v®ue_»ad_auth
(
p_hids
, &
ch¬_id
, 
p_bË_evt
);

426 
	}
}

429 
	$bË_hids_Ú_bË_evt
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
, * 
p_cÚ‹xt
)

431 
bË_hids_t
 * 
p_hids
 = (bË_hids_ˆ*)
p_cÚ‹xt
;

433 
p_bË_evt
->
h—d”
.
evt_id
)

435 
BLE_GAP_EVT_CONNECTED
:

436 
	`Ú_cÚÃù
(
p_hids
, 
p_bË_evt
);

439 
BLE_GAP_EVT_DISCONNECTED
:

440 
	`Ú_discÚÃù
(
p_hids
, 
p_bË_evt
);

443 
BLE_GATTS_EVT_WRITE
:

444 
	`Ú_wr™e
(
p_hids
, 
p_bË_evt
);

447 
BLE_GATTS_EVT_RW_AUTHORIZE_REQUEST
:

448 
	`Ú_rw_authÜize_»que¡
(
p_hids
, 
p_bË_evt
);

455 
	}
}

465 
ušt32_t
 
	$´ÙocŞ_mode_ch¬_add
(
bË_hids_t
 * 
p_hids
,

466 
bË_¤v_£cur™y_mode_t
 cÚ¡ * 
p_£c_mode
)

468 
bË_g©ts_ch¬_md_t
 
ch¬_md
;

469 
bË_g©ts_©Œ_t
 
©Œ_ch¬_v®ue
;

470 
bË_uuid_t
 
bË_uuid
;

471 
bË_g©ts_©Œ_md_t
 
©Œ_md
;

472 
ušt8_t
 
š™Ÿl_´ÙocŞ_mode
;

474 
	`mem£t
(&
ch¬_md
, 0, (char_md));

476 
ch¬_md
.
ch¬_´İs
.
»ad
 = 1;

477 
ch¬_md
.
ch¬_´İs
.
wr™e_wo_»¥
 = 1;

478 
ch¬_md
.
p_ch¬_u£r_desc
 = 
NULL
;

479 
ch¬_md
.
p_ch¬_pf
 = 
NULL
;

480 
ch¬_md
.
p_u£r_desc_md
 = 
NULL
;

481 
ch¬_md
.
p_cccd_md
 = 
NULL
;

482 
ch¬_md
.
p_sccd_md
 = 
NULL
;

484 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
BLE_UUID_PROTOCOL_MODE_CHAR
);

486 
	`mem£t
(&
©Œ_md
, 0, (attr_md));

488 
©Œ_md
.
»ad_³rm
 = 
p_£c_mode
->read_perm;

489 
©Œ_md
.
wr™e_³rm
 = 
p_£c_mode
->write_perm;

490 
©Œ_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

491 
©Œ_md
.
rd_auth
 = 0;

492 
©Œ_md
.
wr_auth
 = 0;

493 
©Œ_md
.
vËn
 = 0;

495 
	`mem£t
(&
©Œ_ch¬_v®ue
, 0, (attr_char_value));

497 
š™Ÿl_´ÙocŞ_mode
 = 
DEFAULT_PROTOCOL_MODE
;

499 
©Œ_ch¬_v®ue
.
p_uuid
 = &
bË_uuid
;

500 
©Œ_ch¬_v®ue
.
p_©Œ_md
 = &
©Œ_md
;

501 
©Œ_ch¬_v®ue
.
š™_Ën
 = (
ušt8_t
);

502 
©Œ_ch¬_v®ue
.
š™_offs
 = 0;

503 
©Œ_ch¬_v®ue
.
max_Ën
 = (
ušt8_t
);

504 
©Œ_ch¬_v®ue
.
p_v®ue
 = &
š™Ÿl_´ÙocŞ_mode
;

506  
	`sd_bË_g©ts_ch¬aù”i¡ic_add
(
p_hids
->
£rviû_hªdË
,

507 &
ch¬_md
,

508 &
©Œ_ch¬_v®ue
,

509 &
p_hids
->
´ÙocŞ_mode_hªdËs
);

510 
	}
}

525 
ušt32_t
 
	$»p_ch¬_add
(
bË_hids_t
 * 
p_hids
,

526 
bË_g©t_ch¬_´İs_t
 * 
p_´İ”t›s
,

527 
ušt16_t
 
max_Ën
,

528 
bË_¤v_»pÜt_»f_t
 * 
p_»p_»f
,

529 
bË_¤v_cccd_£cur™y_mode_t
 * 
p_»p_»f_©Œ_md
,

530 
boŞ
 
is_»ad_»¥
,

531 
bË_hids_»p_ch¬_t
 * 
p_»p_ch¬
)

533 
ušt32_t
 
”r_code
;

534 
bË_g©ts_ch¬_md_t
 
ch¬_md
;

535 
bË_g©ts_©Œ_md_t
 
cccd_md
;

536 
bË_g©ts_©Œ_t
 
©Œ_ch¬_v®ue
;

537 
bË_uuid_t
 
bË_uuid
;

538 
bË_g©ts_©Œ_md_t
 
©Œ_md
;

539 
ušt8_t
 
’coded_»p_»f
[
BLE_SRV_ENCODED_REPORT_REF_LEN
];

542 ià(
p_´İ”t›s
->
nÙify
)

544 
	`mem£t
(&
cccd_md
, 0, (cccd_md));

545 
	`BLE_GAP_CONN_SEC_MODE_SET_OPEN
(&
cccd_md
.
»ad_³rm
);

546 
cccd_md
.
wr™e_³rm
 = 
p_»p_»f_©Œ_md
->
cccd_wr™e_³rm
;

547 
cccd_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

550 
	`mem£t
(&
ch¬_md
, 0, (char_md));

552 
ch¬_md
.
ch¬_´İs
 = *
p_´İ”t›s
;

553 
ch¬_md
.
p_ch¬_u£r_desc
 = 
NULL
;

554 
ch¬_md
.
p_ch¬_pf
 = 
NULL
;

555 
ch¬_md
.
p_u£r_desc_md
 = 
NULL
;

556 
ch¬_md
.
p_cccd_md
 = (
p_´İ”t›s
->
nÙify
è? &
cccd_md
 : 
NULL
;

557 
ch¬_md
.
p_sccd_md
 = 
NULL
;

559 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
BLE_UUID_REPORT_CHAR
);

561 
	`mem£t
(&
©Œ_md
, 0, (attr_md));

563 
©Œ_md
.
»ad_³rm
 = 
p_»p_»f_©Œ_md
->read_perm;

564 
©Œ_md
.
wr™e_³rm
 = 
p_»p_»f_©Œ_md
->write_perm;

565 
©Œ_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

566 
©Œ_md
.
rd_auth
 = 
is_»ad_»¥
 ? 1 : 0;

567 
©Œ_md
.
wr_auth
 = 0;

568 
©Œ_md
.
vËn
 = 1;

570 
	`mem£t
(&
©Œ_ch¬_v®ue
, 0, (attr_char_value));

572 
©Œ_ch¬_v®ue
.
p_uuid
 = &
bË_uuid
;

573 
©Œ_ch¬_v®ue
.
p_©Œ_md
 = &
©Œ_md
;

574 
©Œ_ch¬_v®ue
.
š™_Ën
 = 0;

575 
©Œ_ch¬_v®ue
.
š™_offs
 = 0;

576 
©Œ_ch¬_v®ue
.
max_Ën
 = max_len;

577 
©Œ_ch¬_v®ue
.
p_v®ue
 = 
NULL
;

579 
”r_code
 = 
	`sd_bË_g©ts_ch¬aù”i¡ic_add
(
p_hids
->
£rviû_hªdË
,

580 &
ch¬_md
,

581 &
©Œ_ch¬_v®ue
,

582 &
p_»p_ch¬
->
ch¬_hªdËs
);

583 ià(
”r_code
 !ğ
NRF_SUCCESS
)

585  
”r_code
;

589 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
BLE_UUID_REPORT_REF_DESCR
);

591 
	`mem£t
(&
©Œ_md
, 0, (attr_md));

593 
©Œ_md
.
»ad_³rm
 = 
p_»p_»f_©Œ_md
->read_perm;

594 
©Œ_md
.
wr™e_³rm
 = 
p_»p_»f_©Œ_md
->write_perm;

595 
©Œ_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

596 
©Œ_md
.
rd_auth
 = 0;

597 
©Œ_md
.
wr_auth
 = 0;

598 
©Œ_md
.
vËn
 = 0;

600 
	`mem£t
(&
©Œ_ch¬_v®ue
, 0, (attr_char_value));

602 
©Œ_ch¬_v®ue
.
p_uuid
 = &
bË_uuid
;

603 
©Œ_ch¬_v®ue
.
p_©Œ_md
 = &
©Œ_md
;

604 
©Œ_ch¬_v®ue
.
š™_Ën
 = 
	`bË_¤v_»pÜt_»f_’code
(
’coded_»p_»f
, 
p_»p_»f
);

605 
©Œ_ch¬_v®ue
.
š™_offs
 = 0;

606 
©Œ_ch¬_v®ue
.
max_Ën
 =‡‰r_ch¬_v®ue.
š™_Ën
;

607 
©Œ_ch¬_v®ue
.
p_v®ue
 = 
’coded_»p_»f
;

609  
	`sd_bË_g©ts_desütÜ_add
(
p_»p_ch¬
->
ch¬_hªdËs
.
v®ue_hªdË
,

610 &
©Œ_ch¬_v®ue
,

611 &
p_»p_ch¬
->
»f_hªdË
);

612 
	}
}

622 
ušt32_t
 
	$»p_m­_ch¬_add
(
bË_hids_t
 * 
p_hids
, 
bË_hids_š™_t
 cÚ¡ * 
p_hids_š™
)

624 
ušt32_t
 
”r_code
;

625 
bË_g©ts_ch¬_md_t
 
ch¬_md
;

626 
bË_g©ts_©Œ_t
 
©Œ_ch¬_v®ue
;

627 
bË_uuid_t
 
bË_uuid
;

628 
bË_g©ts_©Œ_md_t
 
©Œ_md
;

631 
	`mem£t
(&
ch¬_md
, 0, (char_md));

633 
ch¬_md
.
ch¬_´İs
.
»ad
 = 1;

634 
ch¬_md
.
p_ch¬_u£r_desc
 = 
NULL
;

635 
ch¬_md
.
p_ch¬_pf
 = 
NULL
;

636 
ch¬_md
.
p_u£r_desc_md
 = 
NULL
;

637 
ch¬_md
.
p_cccd_md
 = 
NULL
;

638 
ch¬_md
.
p_sccd_md
 = 
NULL
;

640 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
BLE_UUID_REPORT_MAP_CHAR
);

642 
	`mem£t
(&
©Œ_md
, 0, (attr_md));

644 
©Œ_md
.
»ad_³rm
 = 
p_hids_š™
->
»p_m­
.
£cur™y_mode
.read_perm;

645 
©Œ_md
.
wr™e_³rm
 = 
p_hids_š™
->
»p_m­
.
£cur™y_mode
.write_perm;

646 
©Œ_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

647 
©Œ_md
.
rd_auth
 = 0;

648 
©Œ_md
.
wr_auth
 = 0;

649 
©Œ_md
.
vËn
 = 1;

651 
	`mem£t
(&
©Œ_ch¬_v®ue
, 0, (attr_char_value));

653 
©Œ_ch¬_v®ue
.
p_uuid
 = &
bË_uuid
;

654 
©Œ_ch¬_v®ue
.
p_©Œ_md
 = &
©Œ_md
;

655 
©Œ_ch¬_v®ue
.
š™_Ën
 = 
p_hids_š™
->
»p_m­
.
d©a_Ën
;

656 
©Œ_ch¬_v®ue
.
š™_offs
 = 0;

657 
©Œ_ch¬_v®ue
.
max_Ën
 = 
p_hids_š™
->
»p_m­
.
d©a_Ën
;

658 
©Œ_ch¬_v®ue
.
p_v®ue
 = 
p_hids_š™
->
»p_m­
.
p_d©a
;

660 
”r_code
 = 
	`sd_bË_g©ts_ch¬aù”i¡ic_add
(
p_hids
->
£rviû_hªdË
,

661 &
ch¬_md
,

662 &
©Œ_ch¬_v®ue
,

663 &
p_hids
->
»p_m­_hªdËs
);

664 ià(
”r_code
 !ğ
NRF_SUCCESS
)

666  
”r_code
;

669 ià(
p_hids_š™
->
»p_m­
.
ext_»p_»f_num
 !ğ0 &&…_hids_š™->»p_m­.
p_ext_»p_»f
 =ğ
NULL
)

671  
NRF_ERROR_INVALID_PARAM
;

673 
i
 = 0; i < 
p_hids_š™
->
»p_m­
.
ext_»p_»f_num
; ++i)

675 
ušt8_t
 
’coded_»p_»f
[(
bË_uuid128_t
)];

676 
ušt8_t
 
’coded_»p_»f_Ën
;

679 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
BLE_UUID_EXTERNAL_REPORT_REF_DESCR
);

681 
	`mem£t
(&
©Œ_md
, 0, (attr_md));

683 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
©Œ_md
.
»ad_³rm
);

684 
	`BLE_GAP_CONN_SEC_MODE_SET_NO_ACCESS
(&
©Œ_md
.
wr™e_³rm
);

686 
©Œ_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

687 
©Œ_md
.
rd_auth
 = 0;

688 
©Œ_md
.
wr_auth
 = 0;

689 
©Œ_md
.
vËn
 = 0;

691 
”r_code
 = 
	`sd_bË_uuid_’code
(&
p_hids_š™
->
»p_m­
.
p_ext_»p_»f
[
i
],

692 &
’coded_»p_»f_Ën
,

693 
’coded_»p_»f
);

694 ià(
”r_code
 !ğ
NRF_SUCCESS
)

696  
”r_code
;

699 
	`mem£t
(&
©Œ_ch¬_v®ue
, 0, (attr_char_value));

701 
©Œ_ch¬_v®ue
.
p_uuid
 = &
bË_uuid
;

702 
©Œ_ch¬_v®ue
.
p_©Œ_md
 = &
©Œ_md
;

703 
©Œ_ch¬_v®ue
.
š™_Ën
 = 
’coded_»p_»f_Ën
;

704 
©Œ_ch¬_v®ue
.
š™_offs
 = 0;

705 
©Œ_ch¬_v®ue
.
max_Ën
 =‡‰r_ch¬_v®ue.
š™_Ën
;

706 
©Œ_ch¬_v®ue
.
p_v®ue
 = 
’coded_»p_»f
;

708 
”r_code
 = 
	`sd_bË_g©ts_desütÜ_add
(
p_hids
->
»p_m­_hªdËs
.
v®ue_hªdË
,

709 &
©Œ_ch¬_v®ue
,

710 &
p_hids
->
»p_m­_ext_»p_»f_hªdË
);

711 ià(
”r_code
 !ğ
NRF_SUCCESS
)

713  
”r_code
;

717  
NRF_SUCCESS
;

718 
	}
}

731 
ušt32_t
 
	$boÙ_šp_»p_ch¬_add
(
bË_hids_t
 * 
p_hids
,

732 
ušt16_t
 
uuid
,

733 
ušt16_t
 
max_d©a_Ën
,

734 
bË_¤v_cccd_£cur™y_mode_t
 cÚ¡ * 
p_£c_mode
,

735 
bË_g©ts_ch¬_hªdËs_t
 * 
p_ch¬_hªdËs
)

737 
bË_g©ts_ch¬_md_t
 
ch¬_md
;

738 
bË_g©ts_©Œ_md_t
 
cccd_md
;

739 
bË_g©ts_©Œ_t
 
©Œ_ch¬_v®ue
;

740 
bË_uuid_t
 
bË_uuid
;

741 
bË_g©ts_©Œ_md_t
 
©Œ_md
;

743 
	`mem£t
(&
cccd_md
, 0, (cccd_md));

745 
	`BLE_GAP_CONN_SEC_MODE_SET_OPEN
(&
cccd_md
.
»ad_³rm
);

746 
cccd_md
.
wr™e_³rm
 = 
p_£c_mode
->
cccd_wr™e_³rm
;

747 
cccd_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

749 
	`mem£t
(&
ch¬_md
, 0, (char_md));

751 
ch¬_md
.
ch¬_´İs
.
»ad
 = 1;

752 
ch¬_md
.
ch¬_´İs
.
wr™e
 = (
p_£c_mode
->
wr™e_³rm
.
sm
) ? 1 : 0;

753 
ch¬_md
.
ch¬_´İs
.
nÙify
 = 1;

754 
ch¬_md
.
p_ch¬_u£r_desc
 = 
NULL
;

755 
ch¬_md
.
p_ch¬_pf
 = 
NULL
;

756 
ch¬_md
.
p_u£r_desc_md
 = 
NULL
;

757 
ch¬_md
.
p_cccd_md
 = &
cccd_md
;

758 
ch¬_md
.
p_sccd_md
 = 
NULL
;

760 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
uuid
);

762 
	`mem£t
(&
©Œ_md
, 0, (attr_md));

764 
©Œ_md
.
»ad_³rm
 = 
p_£c_mode
->read_perm;

765 
©Œ_md
.
wr™e_³rm
 = 
p_£c_mode
->write_perm;

766 
©Œ_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

767 
©Œ_md
.
rd_auth
 = 0;

768 
©Œ_md
.
wr_auth
 = 0;

769 
©Œ_md
.
vËn
 = 0;

771 
	`mem£t
(&
©Œ_ch¬_v®ue
, 0, (attr_char_value));

773 
©Œ_ch¬_v®ue
.
p_uuid
 = &
bË_uuid
;

774 
©Œ_ch¬_v®ue
.
p_©Œ_md
 = &
©Œ_md
;

775 
©Œ_ch¬_v®ue
.
š™_Ën
 = 0;

776 
©Œ_ch¬_v®ue
.
š™_offs
 = 0;

777 
©Œ_ch¬_v®ue
.
max_Ën
 = 
max_d©a_Ën
;

778 
©Œ_ch¬_v®ue
.
p_v®ue
 = 
NULL
;

780  
	`sd_bË_g©ts_ch¬aù”i¡ic_add
(
p_hids
->
£rviû_hªdË
,

781 &
ch¬_md
,

782 &
©Œ_ch¬_v®ue
,

783 
p_ch¬_hªdËs
);

784 
	}
}

794 
ušt32_t
 
	$boÙ_kb_ou_»p_ch¬_add
(
bË_hids_t
 * 
p_hids
, 
bË_hids_š™_t
 cÚ¡ * 
p_hids_š™
)

796 
bË_g©ts_ch¬_md_t
 
ch¬_md
;

797 
bË_g©ts_©Œ_t
 
©Œ_ch¬_v®ue
;

798 
bË_uuid_t
 
bË_uuid
;

799 
bË_g©ts_©Œ_md_t
 
©Œ_md
;

801 
	`mem£t
(&
ch¬_md
, 0, (char_md));

803 
ch¬_md
.
ch¬_´İs
.
»ad
 = 1;

804 
ch¬_md
.
ch¬_´İs
.
wr™e
 = 1;

805 
ch¬_md
.
ch¬_´İs
.
wr™e_wo_»¥
 = 1;

806 
ch¬_md
.
p_ch¬_u£r_desc
 = 
NULL
;

807 
ch¬_md
.
p_ch¬_pf
 = 
NULL
;

808 
ch¬_md
.
p_u£r_desc_md
 = 
NULL
;

809 
ch¬_md
.
p_cccd_md
 = 
NULL
;

810 
ch¬_md
.
p_sccd_md
 = 
NULL
;

812 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
BLE_UUID_BOOT_KEYBOARD_OUTPUT_REPORT_CHAR
);

814 
	`mem£t
(&
©Œ_md
, 0, (attr_md));

816 
©Œ_md
.
»ad_³rm
 = 
p_hids_š™
->
£cur™y_mode_boÙ_kb_ou_»p
.read_perm;

817 
©Œ_md
.
wr™e_³rm
 = 
p_hids_š™
->
£cur™y_mode_boÙ_kb_ou_»p
.write_perm;

818 
©Œ_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

819 
©Œ_md
.
rd_auth
 = 0;

820 
©Œ_md
.
wr_auth
 = 0;

821 
©Œ_md
.
vËn
 = 0;

823 
	`mem£t
(&
©Œ_ch¬_v®ue
, 0, (attr_char_value));

825 
©Œ_ch¬_v®ue
.
p_uuid
 = &
bË_uuid
;

826 
©Œ_ch¬_v®ue
.
p_©Œ_md
 = &
©Œ_md
;

827 
©Œ_ch¬_v®ue
.
š™_Ën
 = 0;

828 
©Œ_ch¬_v®ue
.
š™_offs
 = 0;

829 
©Œ_ch¬_v®ue
.
max_Ën
 = 
BOOT_KB_OUTPUT_REPORT_MAX_SIZE
;

830 
©Œ_ch¬_v®ue
.
p_v®ue
 = 
NULL
;

832  
	`sd_bË_g©ts_ch¬aù”i¡ic_add
(
p_hids
->
£rviû_hªdË
, &
ch¬_md
, &
©Œ_ch¬_v®ue
,

833 &
p_hids
->
boÙ_kb_ou_»p_hªdËs
);

834 
	}
}

844 
ušt8_t
 
	$’code_hid_šfÜm©iÚ
(
ušt8_t
 * 
p_’coded_bufãr
,

845 
bË_hids_hid_šfÜm©iÚ_t
 cÚ¡ * 
p_hid_šfÜm©iÚ
)

847 
ušt8_t
 
Ën
 = 
	`ušt16_’code
(
p_hid_šfÜm©iÚ
->
bcd_hid
, 
p_’coded_bufãr
);

849 
p_’coded_bufãr
[
Ën
++] = 
p_hid_šfÜm©iÚ
->
b_couÁry_code
;

850 
p_’coded_bufãr
[
Ën
++] = 
p_hid_šfÜm©iÚ
->
æags
;

852 
	`APP_ERROR_CHECK_BOOL
(
Ën
 =ğ
ENCODED_HID_INFORMATION_LEN
);

854  
Ën
;

855 
	}
}

865 
ušt32_t
 
	$hid_šfÜm©iÚ_ch¬_add
(
bË_hids_t
 * 
p_hids
, 
bË_hids_š™_t
 cÚ¡ * 
p_hids_š™
)

867 
bË_g©ts_ch¬_md_t
 
ch¬_md
;

868 
bË_g©ts_©Œ_t
 
©Œ_ch¬_v®ue
;

869 
bË_uuid_t
 
bË_uuid
;

870 
bË_g©ts_©Œ_md_t
 
©Œ_md
;

871 
ušt8_t
 
’coded_hid_šfÜm©iÚ
[
ENCODED_HID_INFORMATION_LEN
];

872 
ušt8_t
 
hid_šfo_Ën
;

874 
	`mem£t
(&
ch¬_md
, 0, (char_md));

876 
ch¬_md
.
ch¬_´İs
.
»ad
 = 1;

877 
ch¬_md
.
p_ch¬_u£r_desc
 = 
NULL
;

878 
ch¬_md
.
p_ch¬_pf
 = 
NULL
;

879 
ch¬_md
.
p_u£r_desc_md
 = 
NULL
;

880 
ch¬_md
.
p_cccd_md
 = 
NULL
;

881 
ch¬_md
.
p_sccd_md
 = 
NULL
;

883 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
BLE_UUID_HID_INFORMATION_CHAR
);

885 
	`mem£t
(&
©Œ_md
, 0, (attr_md));

887 
©Œ_md
.
»ad_³rm
 = 
p_hids_š™
->
hid_šfÜm©iÚ
.
£cur™y_mode
.read_perm;

888 
©Œ_md
.
wr™e_³rm
 = 
p_hids_š™
->
hid_šfÜm©iÚ
.
£cur™y_mode
.write_perm;

889 
©Œ_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

890 
©Œ_md
.
rd_auth
 = 0;

891 
©Œ_md
.
wr_auth
 = 0;

892 
©Œ_md
.
vËn
 = 0;

894 
hid_šfo_Ën
 = 
	`’code_hid_šfÜm©iÚ
(
’coded_hid_šfÜm©iÚ
, &
p_hids_š™
->
hid_šfÜm©iÚ
);

896 
	`mem£t
(&
©Œ_ch¬_v®ue
, 0, (attr_char_value));

898 
©Œ_ch¬_v®ue
.
p_uuid
 = &
bË_uuid
;

899 
©Œ_ch¬_v®ue
.
p_©Œ_md
 = &
©Œ_md
;

900 
©Œ_ch¬_v®ue
.
š™_Ën
 = 
hid_šfo_Ën
;

901 
©Œ_ch¬_v®ue
.
š™_offs
 = 0;

902 
©Œ_ch¬_v®ue
.
max_Ën
 =‡‰r_ch¬_v®ue.
š™_Ën
;

903 
©Œ_ch¬_v®ue
.
p_v®ue
 = 
’coded_hid_šfÜm©iÚ
;

905  
	`sd_bË_g©ts_ch¬aù”i¡ic_add
(
p_hids
->
£rviû_hªdË
, &
ch¬_md
,

906 &
©Œ_ch¬_v®ue
,

907 &
p_hids
->
hid_šfÜm©iÚ_hªdËs
);

908 
	}
}

918 
ušt32_t
 
	$hid_cÚŒŞ_pošt_ch¬_add
(
bË_hids_t
 * 
p_hids
,

919 
bË_¤v_£cur™y_mode_t
 cÚ¡ * 
p_£c_mode
)

921 
bË_g©ts_ch¬_md_t
 
ch¬_md
;

922 
bË_g©ts_©Œ_t
 
©Œ_ch¬_v®ue
;

923 
bË_uuid_t
 
bË_uuid
;

924 
bË_g©ts_©Œ_md_t
 
©Œ_md
;

925 
ušt8_t
 
š™Ÿl_hid_cÚŒŞ_pošt
;

927 
	`mem£t
(&
ch¬_md
, 0, (char_md));

929 
ch¬_md
.
ch¬_´İs
.
wr™e_wo_»¥
 = 1;

930 
ch¬_md
.
p_ch¬_u£r_desc
 = 
NULL
;

931 
ch¬_md
.
p_ch¬_pf
 = 
NULL
;

932 
ch¬_md
.
p_u£r_desc_md
 = 
NULL
;

933 
ch¬_md
.
p_cccd_md
 = 
NULL
;

934 
ch¬_md
.
p_sccd_md
 = 
NULL
;

936 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
BLE_UUID_HID_CONTROL_POINT_CHAR
);

938 
	`mem£t
(&
©Œ_md
, 0, (attr_md));

940 
©Œ_md
.
»ad_³rm
 = 
p_£c_mode
->read_perm;

941 
©Œ_md
.
wr™e_³rm
 = 
p_£c_mode
->write_perm;

942 
©Œ_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

943 
©Œ_md
.
rd_auth
 = 0;

944 
©Œ_md
.
wr_auth
 = 0;

945 
©Œ_md
.
vËn
 = 0;

947 
š™Ÿl_hid_cÚŒŞ_pošt
 = 
INITIAL_VALUE_HID_CONTROL_POINT
;

949 
	`mem£t
(&
©Œ_ch¬_v®ue
, 0, (attr_char_value));

951 
©Œ_ch¬_v®ue
.
p_uuid
 = &
bË_uuid
;

952 
©Œ_ch¬_v®ue
.
p_©Œ_md
 = &
©Œ_md
;

953 
©Œ_ch¬_v®ue
.
š™_Ën
 = (
ušt8_t
);

954 
©Œ_ch¬_v®ue
.
š™_offs
 = 0;

955 
©Œ_ch¬_v®ue
.
max_Ën
 = (
ušt8_t
);

956 
©Œ_ch¬_v®ue
.
p_v®ue
 = &
š™Ÿl_hid_cÚŒŞ_pošt
;

958  
	`sd_bË_g©ts_ch¬aù”i¡ic_add
(
p_hids
->
£rviû_hªdË
, &
ch¬_md
,

959 &
©Œ_ch¬_v®ue
,

960 &
p_hids
->
hid_cÚŒŞ_pošt_hªdËs
);

961 
	}
}

971 
ušt32_t
 
	$šp_»p_ch¬aù”i¡ics_add
(
bË_hids_t
 * 
p_hids
,

972 
bË_hids_š™_t
 cÚ¡ * 
p_hids_š™
)

974 ià((
p_hids_š™
->
šp_»p_couÁ
 !ğ0è&& (p_hids_š™->
p_šp_»p_¬¿y
 !ğ
NULL
))

976 
ušt8_t
 
i
;

978 
i
 = 0; i < 
p_hids_š™
->
šp_»p_couÁ
; i++)

980 
ušt32_t
 
”r_code
;

981 
bË_hids_šp_»p_š™_t
 * 
p_»p_š™
 = &
p_hids_š™
->
p_šp_»p_¬¿y
[
i
];

982 
bË_g©t_ch¬_´İs_t
 
´İ”t›s
;

984 
	`mem£t
(&
´İ”t›s
, 0, (properties));

986 
´İ”t›s
.
»ad
 = 
Œue
;

987 
´İ”t›s
.
wr™e
 = 
p_»p_š™
->
£cur™y_mode
.
wr™e_³rm
.
sm
 ? 1 : 0;

988 
´İ”t›s
.
nÙify
 = 
Œue
;

990 
”r_code
 = 
	`»p_ch¬_add
(
p_hids
,

991 &
´İ”t›s
,

992 
p_»p_š™
->
max_Ën
,

993 &
p_»p_š™
->
»p_»f
,

994 &
p_»p_š™
->
£cur™y_mode
,

995 
p_»p_š™
->
»ad_»¥
,

996 &
p_hids
->
šp_»p_¬¿y
[
i
]);

997 ià(
”r_code
 !ğ
NRF_SUCCESS
)

999  
”r_code
;

1004  
NRF_SUCCESS
;

1005 
	}
}

1015 
ušt32_t
 
	$ou_»p_ch¬aù”i¡ics_add
(
bË_hids_t
 * 
p_hids
,

1016 
bË_hids_š™_t
 cÚ¡ * 
p_hids_š™
)

1018 ià((
p_hids_š™
->
ou_»p_couÁ
 !ğ0è&& (p_hids_š™->
p_ou_»p_¬¿y
 !ğ
NULL
))

1020 
ušt8_t
 
i
;

1022 
i
 = 0; i < 
p_hids_š™
->
ou_»p_couÁ
; i++)

1024 
ušt32_t
 
”r_code
;

1025 
bË_hids_ou_»p_š™_t
 * 
p_»p_š™
 = &
p_hids_š™
->
p_ou_»p_¬¿y
[
i
];

1026 
bË_g©t_ch¬_´İs_t
 
´İ”t›s
;

1028 
	`mem£t
(&
´İ”t›s
, 0, (properties));

1030 
´İ”t›s
.
»ad
 = 
Œue
;

1031 
´İ”t›s
.
wr™e
 = 
Œue
;

1032 
´İ”t›s
.
wr™e_wo_»¥
 = 
Œue
;

1034 
”r_code
 = 
	`»p_ch¬_add
(
p_hids
,

1035 &
´İ”t›s
,

1036 
p_»p_š™
->
max_Ën
,

1037 &
p_»p_š™
->
»p_»f
,

1038 &
p_»p_š™
->
£cur™y_mode
,

1039 
p_»p_š™
->
»ad_»¥
,

1040 &
p_hids
->
ou_»p_¬¿y
[
i
]);

1041 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1043  
”r_code
;

1048  
NRF_SUCCESS
;

1049 
	}
}

1059 
ušt32_t
 
	$ã©u»_»p_ch¬aù”i¡ics_add
(
bË_hids_t
 * 
p_hids
,

1060 
bË_hids_š™_t
 cÚ¡ * 
p_hids_š™
)

1062 ià((
p_hids_š™
->
ã©u»_»p_couÁ
 !ğ0è&& (p_hids_š™->
p_ã©u»_»p_¬¿y
 !ğ
NULL
))

1064 
ušt8_t
 
i
;

1066 
i
 = 0; i < 
p_hids_š™
->
ã©u»_»p_couÁ
; i++)

1068 
ušt32_t
 
”r_code
;

1069 
bË_hids_ã©u»_»p_š™_t
 * 
p_»p_š™
 = &
p_hids_š™
->
p_ã©u»_»p_¬¿y
[
i
];

1070 
bË_g©t_ch¬_´İs_t
 
´İ”t›s
;

1072 
	`mem£t
(&
´İ”t›s
, 0, (properties));

1074 
´İ”t›s
.
»ad
 = 
Œue
;

1075 
´İ”t›s
.
wr™e
 = 
Œue
;

1077 
”r_code
 = 
	`»p_ch¬_add
(
p_hids
,

1078 &
´İ”t›s
,

1079 
p_»p_š™
->
max_Ën
,

1080 &
p_»p_š™
->
»p_»f
,

1081 &
p_»p_š™
->
£cur™y_mode
,

1082 
p_»p_š™
->
»ad_»¥
,

1083 &
p_hids
->
ã©u»_»p_¬¿y
[
i
]);

1084 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1086  
”r_code
;

1091  
NRF_SUCCESS
;

1092 
	}
}

1102 
ušt32_t
 
	$šşudes_add
(
bË_hids_t
 * 
p_hids
, 
bË_hids_š™_t
 cÚ¡ * 
p_hids_š™
)

1104 
ušt32_t
 
”r_code
;

1105 
ušt8_t
 
i
;

1106 
ušt16_t
 
unu£d_šşude_hªdË
;

1108 
i
 = 0; i < 
p_hids_š™
->
šşuded_£rviûs_couÁ
; i++)

1110 
”r_code
 = 
	`sd_bË_g©ts_šşude_add
(
p_hids
->
£rviû_hªdË
,

1111 
p_hids_š™
->
p_šşuded_£rviûs_¬¿y
[
i
],

1112 &
unu£d_šşude_hªdË
);

1113 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1115  
”r_code
;

1119  
NRF_SUCCESS
;

1120 
	}
}

1123 
ušt32_t
 
	$bË_hids_š™
(
bË_hids_t
 * 
p_hids
, 
bË_hids_š™_t
 cÚ¡ * 
p_hids_š™
)

1125 
ušt32_t
 
”r_code
;

1126 
bË_uuid_t
 
bË_uuid
;

1128 ià((
p_hids_š™
->
šp_»p_couÁ
 > 
BLE_HIDS_MAX_INPUT_REP
) ||

1129 (
p_hids_š™
->
ou_»p_couÁ
 > 
BLE_HIDS_MAX_OUTPUT_REP
) ||

1130 (
p_hids_š™
->
ã©u»_»p_couÁ
 > 
BLE_HIDS_MAX_FEATURE_REP
)

1133  
NRF_ERROR_INVALID_PARAM
;

1137 
p_hids
->
evt_hªdËr
 = 
p_hids_š™
->evt_handler;

1138 
p_hids
->
”rÜ_hªdËr
 = 
p_hids_š™
->error_handler;

1139 
p_hids
->
šp_»p_couÁ
 = 
p_hids_š™
->inp_rep_count;

1140 
p_hids
->
ou_»p_couÁ
 = 
p_hids_š™
->outp_rep_count;

1141 
p_hids
->
ã©u»_»p_couÁ
 = 
p_hids_š™
->feature_rep_count;

1142 
p_hids
->
cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

1145 
	`BLE_UUID_BLE_ASSIGN
(
bË_uuid
, 
BLE_UUID_HUMAN_INTERFACE_DEVICE_SERVICE
);

1147 
”r_code
 = 
	`sd_bË_g©ts_£rviû_add
(
BLE_GATTS_SRVC_TYPE_PRIMARY
,

1148 &
bË_uuid
,

1149 &
p_hids
->
£rviû_hªdË
);

1150 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1152  
”r_code
;

1156 
”r_code
 = 
	`šşudes_add
(
p_hids
, 
p_hids_š™
);

1157 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1159  
”r_code
;

1162 ià(
p_hids_š™
->
is_kb
 ||…_hids_š™->
is_mou£
)

1165 
”r_code
 = 
	`´ÙocŞ_mode_ch¬_add
(
p_hids
, &
p_hids_š™
->
£cur™y_mode_´ÙocŞ
);

1166 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1168  
”r_code
;

1173 
”r_code
 = 
	`šp_»p_ch¬aù”i¡ics_add
(
p_hids
, 
p_hids_š™
);

1174 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1176  
”r_code
;

1180 
”r_code
 = 
	`ou_»p_ch¬aù”i¡ics_add
(
p_hids
, 
p_hids_š™
);

1181 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1183  
”r_code
;

1187 
”r_code
 = 
	`ã©u»_»p_ch¬aù”i¡ics_add
(
p_hids
, 
p_hids_š™
);

1188 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1190  
”r_code
;

1194 
”r_code
 = 
	`»p_m­_ch¬_add
(
p_hids
, 
p_hids_š™
);

1195 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1197  
”r_code
;

1200 ià(
p_hids_š™
->
is_kb
)

1203 
”r_code
 = 
	`boÙ_šp_»p_ch¬_add
(
p_hids
,

1204 
BLE_UUID_BOOT_KEYBOARD_INPUT_REPORT_CHAR
,

1205 
BOOT_KB_INPUT_REPORT_MAX_SIZE
,

1206 &
p_hids_š™
->
£cur™y_mode_boÙ_kb_šp_»p
,

1207 &
p_hids
->
boÙ_kb_šp_»p_hªdËs
);

1208 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1210  
”r_code
;

1214 
”r_code
 = 
	`boÙ_kb_ou_»p_ch¬_add
(
p_hids
, 
p_hids_š™
);

1215 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1217  
”r_code
;

1221 ià(
p_hids_š™
->
is_mou£
)

1224 
”r_code
 = 
	`boÙ_šp_»p_ch¬_add
(
p_hids
,

1225 
BLE_UUID_BOOT_MOUSE_INPUT_REPORT_CHAR
,

1226 
BOOT_MOUSE_INPUT_REPORT_MAX_SIZE
,

1227 &
p_hids_š™
->
£cur™y_mode_boÙ_mou£_šp_»p
,

1228 &
p_hids
->
boÙ_mou£_šp_»p_hªdËs
);

1229 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1231  
”r_code
;

1236 
”r_code
 = 
	`hid_šfÜm©iÚ_ch¬_add
(
p_hids
, 
p_hids_š™
);

1237 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1239  
”r_code
;

1243 
”r_code
 = 
	`hid_cÚŒŞ_pošt_ch¬_add
(
p_hids
, &
p_hids_š™
->
£cur™y_mode_ù¾_pošt
);

1244 ià(
”r_code
 !ğ
NRF_SUCCESS
)

1246  
”r_code
;

1249  
NRF_SUCCESS
;

1250 
	}
}

1253 
ušt32_t
 
	$bË_hids_šp_»p_£nd
(
bË_hids_t
 * 
p_hids
,

1254 
ušt8_t
 
»p_šdex
,

1255 
ušt16_t
 
Ën
,

1256 
ušt8_t
 * 
p_d©a
)

1258 
ušt32_t
 
”r_code
;

1260 ià(
»p_šdex
 < 
p_hids
->
šp_»p_couÁ
)

1262 
bË_hids_»p_ch¬_t
 * 
p_»p_ch¬
 = &
p_hids
->
šp_»p_¬¿y
[
»p_šdex
];

1264 ià(
p_hids
->
cÚn_hªdË
 !ğ
BLE_CONN_HANDLE_INVALID
)

1266 
bË_g©ts_hvx_·¿ms_t
 
hvx_·¿ms
;

1267 
ušt16_t
 
hvx_Ën
 = 
Ën
;

1269 
	`mem£t
(&
hvx_·¿ms
, 0, (hvx_params));

1271 
hvx_·¿ms
.
hªdË
 = 
p_»p_ch¬
->
ch¬_hªdËs
.
v®ue_hªdË
;

1272 
hvx_·¿ms
.
ty³
 = 
BLE_GATT_HVX_NOTIFICATION
;

1273 
hvx_·¿ms
.
off£t
 = 0;

1274 
hvx_·¿ms
.
p_Ën
 = &
hvx_Ën
;

1275 
hvx_·¿ms
.
p_d©a
 =…_data;

1277 
”r_code
 = 
	`sd_bË_g©ts_hvx
(
p_hids
->
cÚn_hªdË
, &
hvx_·¿ms
);

1278 ià((
”r_code
 =ğ
NRF_SUCCESS
è&& (
hvx_Ën
 !ğ
Ën
))

1280 
”r_code
 = 
NRF_ERROR_DATA_SIZE
;

1285 
”r_code
 = 
NRF_ERROR_INVALID_STATE
;

1290 
”r_code
 = 
NRF_ERROR_INVALID_PARAM
;

1293  
”r_code
;

1294 
	}
}

1297 
ušt32_t
 
	$bË_hids_boÙ_kb_šp_»p_£nd
(
bË_hids_t
 * 
p_hids
, 
ušt16_t
 
Ën
, 
ušt8_t
 * 
p_d©a
)

1299 
ušt32_t
 
”r_code
;

1301 ià(
p_hids
->
cÚn_hªdË
 !ğ
BLE_CONN_HANDLE_INVALID
)

1303 
bË_g©ts_hvx_·¿ms_t
 
hvx_·¿ms
;

1304 
ušt16_t
 
hvx_Ën
 = 
Ën
;

1306 
	`mem£t
(&
hvx_·¿ms
, 0, (hvx_params));

1308 
hvx_·¿ms
.
hªdË
 = 
p_hids
->
boÙ_kb_šp_»p_hªdËs
.
v®ue_hªdË
;

1309 
hvx_·¿ms
.
ty³
 = 
BLE_GATT_HVX_NOTIFICATION
;

1310 
hvx_·¿ms
.
off£t
 = 0;

1311 
hvx_·¿ms
.
p_Ën
 = &
hvx_Ën
;

1312 
hvx_·¿ms
.
p_d©a
 =…_data;

1314 
”r_code
 = 
	`sd_bË_g©ts_hvx
(
p_hids
->
cÚn_hªdË
, &
hvx_·¿ms
);

1315 ià((
”r_code
 =ğ
NRF_SUCCESS
è&& (
hvx_Ën
 !ğ
Ën
))

1317 
”r_code
 = 
NRF_ERROR_DATA_SIZE
;

1322 
”r_code
 = 
NRF_ERROR_INVALID_STATE
;

1325  
”r_code
;

1326 
	}
}

1329 
ušt32_t
 
	$bË_hids_boÙ_mou£_šp_»p_£nd
(
bË_hids_t
 * 
p_hids
,

1330 
ušt8_t
 
bu‰Ús
,

1331 
št8_t
 
x_d–
,

1332 
št8_t
 
y_d–
,

1333 
ušt16_t
 
İtiÚ®_d©a_Ën
,

1334 
ušt8_t
 * 
p_İtiÚ®_d©a
)

1336 
ušt32_t
 
”r_code
;

1338 ià(
p_hids
->
cÚn_hªdË
 !ğ
BLE_CONN_HANDLE_INVALID
)

1340 
ušt16_t
 
hvx_Ën
 = 
BOOT_MOUSE_INPUT_REPORT_MIN_SIZE
 + 
İtiÚ®_d©a_Ën
;

1342 ià(
hvx_Ën
 <ğ
BOOT_MOUSE_INPUT_REPORT_MAX_SIZE
)

1344 
ušt8_t
 
bufãr
[
BOOT_MOUSE_INPUT_REPORT_MAX_SIZE
];

1345 
bË_g©ts_hvx_·¿ms_t
 
hvx_·¿ms
;

1347 
	`APP_ERROR_CHECK_BOOL
(
BOOT_MOUSE_INPUT_REPORT_MIN_SIZE
 == 3);

1350 
bufãr
[0] = 
bu‰Ús
;

1351 
bufãr
[1] = (
ušt8_t
)
x_d–
;

1352 
bufãr
[2] = (
ušt8_t
)
y_d–
;

1354 ià(
İtiÚ®_d©a_Ën
 > 0)

1356 
	`memıy
(&
bufãr
[3], 
p_İtiÚ®_d©a
, 
İtiÚ®_d©a_Ën
);

1360 
	`mem£t
(&
hvx_·¿ms
, 0, (hvx_params));

1362 
hvx_·¿ms
.
hªdË
 = 
p_hids
->
boÙ_mou£_šp_»p_hªdËs
.
v®ue_hªdË
;

1363 
hvx_·¿ms
.
ty³
 = 
BLE_GATT_HVX_NOTIFICATION
;

1364 
hvx_·¿ms
.
off£t
 = 0;

1365 
hvx_·¿ms
.
p_Ën
 = &
hvx_Ën
;

1366 
hvx_·¿ms
.
p_d©a
 = 
bufãr
;

1368 
”r_code
 = 
	`sd_bË_g©ts_hvx
(
p_hids
->
cÚn_hªdË
, &
hvx_·¿ms
);

1369 ià((
”r_code
 =ğ
NRF_SUCCESS
) &&

1370 (
hvx_Ën
 !ğ
BOOT_MOUSE_INPUT_REPORT_MIN_SIZE
 + 
İtiÚ®_d©a_Ën
)

1373 
”r_code
 = 
NRF_ERROR_DATA_SIZE
;

1378 
”r_code
 = 
NRF_ERROR_DATA_SIZE
;

1383 
”r_code
 = 
NRF_ERROR_INVALID_STATE
;

1386  
”r_code
;

1387 
	}
}

1390 
ušt32_t
 
	$bË_hids_ou_»p_g‘
(
bË_hids_t
 * 
p_hids
,

1391 
ušt8_t
 
»p_šdex
,

1392 
ušt16_t
 
Ën
,

1393 
ušt8_t
 
off£t
,

1394 
ušt8_t
 * 
p_ou_»p
)

1396 
bË_g©ts_v®ue_t
 
g©ts_v®ue
;

1399 
	`mem£t
(&
g©ts_v®ue
, 0, (gatts_value));

1401 
g©ts_v®ue
.
Ën
 =†en;

1402 
g©ts_v®ue
.
off£t
 = offset;

1403 
g©ts_v®ue
.
p_v®ue
 = 
p_ou_»p
;

1405  
	`sd_bË_g©ts_v®ue_g‘
(
p_hids
->
cÚn_hªdË
,

1406 
p_hids
->
ou_»p_¬¿y
[
»p_šdex
].
ch¬_hªdËs
.
v®ue_hªdË
,

1407 &
g©ts_v®ue
);

1408 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\common\ble_advdata.c

40 
	~"bË_advd©a.h
"

41 
	~"bË_g­.h
"

42 
	~"bË_¤v_commÚ.h
"

43 
	~"sdk_commÚ.h
"

47 
	#AD_LENGTH_FIELD_SIZE
 1UL

	)

48 
	#AD_TYPE_FIELD_SIZE
 1UL

	)

49 
	#AD_DATA_OFFSET
 (
AD_LENGTH_FIELD_SIZE
 + 
AD_TYPE_FIELD_SIZE
è

	)

51 
	#AD_TYPE_BLE_DEVICE_ADDR_TYPE_SIZE
 1UL

	)

52 
	#AD_TYPE_BLE_DEVICE_ADDR_DATA_SIZE
 (
BLE_GAP_ADDR_LEN
 + \

53 
AD_TYPE_BLE_DEVICE_ADDR_TYPE_SIZE
è

	)

54 
	#AD_TYPE_BLE_DEVICE_ADDR_SIZE
 (
AD_DATA_OFFSET
 + \

55 
AD_TYPE_BLE_DEVICE_ADDR_DATA_SIZE
è

	)

56 
	#AD_TYPE_APPEARANCE_DATA_SIZE
 2UL

	)

57 
	#AD_TYPE_APPEARANCE_SIZE
 (
AD_DATA_OFFSET
 + \

58 
AD_TYPE_APPEARANCE_DATA_SIZE
è

	)

59 
	#AD_TYPE_FLAGS_DATA_SIZE
 1UL

	)

60 
	#AD_TYPE_FLAGS_SIZE
 (
AD_DATA_OFFSET
 + \

61 
AD_TYPE_FLAGS_DATA_SIZE
è

	)

62 
	#AD_TYPE_TX_POWER_LEVEL_DATA_SIZE
 1UL

	)

63 
	#AD_TYPE_TX_POWER_LEVEL_SIZE
 (
AD_DATA_OFFSET
 + \

64 
AD_TYPE_TX_POWER_LEVEL_DATA_SIZE
è

	)

65 
	#AD_TYPE_CONN_INT_DATA_SIZE
 4UL

	)

66 
	#AD_TYPE_CONN_INT_SIZE
 (
AD_DATA_OFFSET
 + \

67 
AD_TYPE_CONN_INT_DATA_SIZE
è

	)

68 
	#AD_TYPE_MANUF_SPEC_DATA_ID_SIZE
 2UL

	)

69 
	#AD_TYPE_SERV_DATA_16BIT_UUID_SIZE
 2UL

	)

72 
	#AD_TYPE_BLE_DEVICE_ADDR_TYPE_PUBLIC
 0UL

	)

73 
	#AD_TYPE_BLE_DEVICE_ADDR_TYPE_RANDOM
 1UL

	)

75 
ušt32_t
 
	$bË_deviû_addr_’code
(
ušt8_t
 * 
p_’coded_d©a
,

76 
ušt16_t
 * 
p_off£t
,

77 
ušt16_t
 
max_size
)

79 
ušt32_t
 
”r_code
;

80 
bË_g­_addr_t
 
deviû_addr
;

83 ià(((*
p_off£t
è+ 
AD_TYPE_BLE_DEVICE_ADDR_SIZE
è> 
max_size
)

85  
NRF_ERROR_DATA_SIZE
;

89 #ià(
NRF_SD_BLE_API_VERSION
 >= 3)

90 
”r_code
 = 
	`sd_bË_g­_addr_g‘
(&
deviû_addr
);

92 
”r_code
 = 
	`sd_bË_g­_add»ss_g‘
(&
deviû_addr
);

94 
	`VERIFY_SUCCESS
(
”r_code
);

97 
p_’coded_d©a
[*
p_off£t
] = (
ušt8_t
)(
AD_TYPE_FIELD_SIZE
 +

98 
AD_TYPE_BLE_DEVICE_ADDR_DATA_SIZE
);

99 *
p_off£t
 +ğ
AD_LENGTH_FIELD_SIZE
;

100 
p_’coded_d©a
[*
p_off£t
] = 
BLE_GAP_AD_TYPE_LE_BLUETOOTH_DEVICE_ADDRESS
;

101 *
p_off£t
 +ğ
AD_TYPE_FIELD_SIZE
;

102 
	`memıy
(&
p_’coded_d©a
[*
p_off£t
], &
deviû_addr
.
addr
[0], 
BLE_GAP_ADDR_LEN
);

103 *
p_off£t
 +ğ
BLE_GAP_ADDR_LEN
;

104 ià(
BLE_GAP_ADDR_TYPE_PUBLIC
 =ğ
deviû_addr
.
addr_ty³
)

106 
p_’coded_d©a
[*
p_off£t
] = 
AD_TYPE_BLE_DEVICE_ADDR_TYPE_PUBLIC
;

110 
p_’coded_d©a
[*
p_off£t
] = 
AD_TYPE_BLE_DEVICE_ADDR_TYPE_RANDOM
;

112 *
p_off£t
 +ğ
AD_TYPE_BLE_DEVICE_ADDR_TYPE_SIZE
;

114  
NRF_SUCCESS
;

115 
	}
}

117 
ušt32_t
 
	$Çme_’code
(cÚ¡ 
bË_advd©a_t
 * 
p_advd©a
,

118 
ušt8_t
 * 
p_’coded_d©a
,

119 
ušt16_t
 * 
p_off£t
,

120 
ušt16_t
 
max_size
)

122 
ušt32_t
 
”r_code
;

123 
ušt16_t
 
»m_adv_d©a_Ën
;

124 
ušt16_t
 
aùu®_Ëngth
;

125 
ušt8_t
 
adv_d©a_fÜm©
;

129 ià((
BLE_ADVDATA_SHORT_NAME
 =ğ
p_advd©a
->
Çme_ty³
è&& (0 =ğp_advd©a->
shÜt_Çme_Ën
))

131  
NRF_ERROR_INVALID_PARAM
;

135 iàĞ(((*
p_off£t
è+ 
AD_DATA_OFFSET
è> 
max_size
) ||

136 Ğ(
BLE_ADVDATA_SHORT_NAME
 =ğ
p_advd©a
->
Çme_ty³
) &&

137 (((*
p_off£t
è+ 
AD_DATA_OFFSET
 + 
p_advd©a
->
shÜt_Çme_Ën
è> 
max_size
)))

139  
NRF_ERROR_DATA_SIZE
;

142 
»m_adv_d©a_Ën
 = 
max_size
 - (*
p_off£t
è- 
AD_DATA_OFFSET
;

143 
aùu®_Ëngth
 = 
»m_adv_d©a_Ën
;

146 
”r_code
 = 
	`sd_bË_g­_deviû_Çme_g‘
(&
p_’coded_d©a
[(*
p_off£t
è+ 
AD_DATA_OFFSET
],

147 &
aùu®_Ëngth
);

148 
	`VERIFY_SUCCESS
(
”r_code
);

151 ià((
p_advd©a
->
Çme_ty³
 =ğ
BLE_ADVDATA_FULL_NAME
è&& (
aùu®_Ëngth
 <ğ
»m_adv_d©a_Ën
))

154 
adv_d©a_fÜm©
 = 
BLE_GAP_AD_TYPE_COMPLETE_LOCAL_NAME
;

159 
adv_d©a_fÜm©
 = 
BLE_GAP_AD_TYPE_SHORT_LOCAL_NAME
;

163 ià((
BLE_ADVDATA_SHORT_NAME
 =ğ
p_advd©a
->
Çme_ty³
) &&

164 (
p_advd©a
->
shÜt_Çme_Ën
 <ğ
»m_adv_d©a_Ën
))

167 
aùu®_Ëngth
 = 
p_advd©a
->
shÜt_Çme_Ën
;

172 
aùu®_Ëngth
 = 
»m_adv_d©a_Ën
;

177 ià(
aùu®_Ëngth
 > (0x00FF - 
AD_TYPE_FIELD_SIZE
))

179  
NRF_ERROR_DATA_SIZE
;

183 
p_’coded_d©a
[*
p_off£t
] = (
ušt8_t
)(
AD_TYPE_FIELD_SIZE
 + 
aùu®_Ëngth
);

184 *
p_off£t
 +ğ
AD_LENGTH_FIELD_SIZE
;

185 
p_’coded_d©a
[*
p_off£t
] = 
adv_d©a_fÜm©
;

186 *
p_off£t
 +ğ
AD_TYPE_FIELD_SIZE
;

187 *
p_off£t
 +ğ
aùu®_Ëngth
;

189  
NRF_SUCCESS
;

190 
	}
}

193 
ušt32_t
 
	$­³¬ªû_’code
(
ušt8_t
 * 
p_’coded_d©a
,

194 
ušt16_t
 * 
p_off£t
,

195 
ušt16_t
 
max_size
)

197 
ušt32_t
 
”r_code
;

198 
ušt16_t
 
­³¬ªû
;

201 ià(((*
p_off£t
è+ 
AD_TYPE_APPEARANCE_SIZE
è> 
max_size
)

203  
NRF_ERROR_DATA_SIZE
;

207 
”r_code
 = 
	`sd_bË_g­_­³¬ªû_g‘
(&
­³¬ªû
);

208 
	`VERIFY_SUCCESS
(
”r_code
);

211 
p_’coded_d©a
[*
p_off£t
] = (
ušt8_t
)(
AD_TYPE_FIELD_SIZE
 + 
AD_TYPE_APPEARANCE_DATA_SIZE
);

212 *
p_off£t
 +ğ
AD_LENGTH_FIELD_SIZE
;

213 
p_’coded_d©a
[*
p_off£t
] = 
BLE_GAP_AD_TYPE_APPEARANCE
;

214 *
p_off£t
 +ğ
AD_TYPE_FIELD_SIZE
;

215 *
p_off£t
 +ğ
	`ušt16_’code
(
­³¬ªû
, &
p_’coded_d©a
[*p_offset]);

217  
NRF_SUCCESS
;

218 
	}
}

220 
ušt32_t
 
	$æags_’code
(
št8_t
 
æags
,

221 
ušt8_t
 * 
p_’coded_d©a
,

222 
ušt16_t
 * 
p_off£t
,

223 
ušt16_t
 
max_size
)

226 ià(((*
p_off£t
è+ 
AD_TYPE_FLAGS_SIZE
è> 
max_size
)

228  
NRF_ERROR_DATA_SIZE
;

232 
p_’coded_d©a
[*
p_off£t
] = (
ušt8_t
)(
AD_TYPE_FIELD_SIZE
 + 
AD_TYPE_FLAGS_DATA_SIZE
);

233 *
p_off£t
 +ğ
AD_LENGTH_FIELD_SIZE
;

234 
p_’coded_d©a
[*
p_off£t
] = 
BLE_GAP_AD_TYPE_FLAGS
;

235 *
p_off£t
 +ğ
AD_TYPE_FIELD_SIZE
;

236 
p_’coded_d©a
[*
p_off£t
] = 
æags
;

237 *
p_off£t
 +ğ
AD_TYPE_FLAGS_DATA_SIZE
;

239  
NRF_SUCCESS
;

240 
	}
}

242 
ušt32_t
 
	$tx_pow”_Ëv–_’code
(
št8_t
 
tx_pow”_Ëv–
,

243 
ušt8_t
 * 
p_’coded_d©a
,

244 
ušt16_t
 * 
p_off£t
,

245 
ušt16_t
 
max_size
)

248 ià(((*
p_off£t
è+ 
AD_TYPE_TX_POWER_LEVEL_SIZE
è> 
max_size
)

250  
NRF_ERROR_DATA_SIZE
;

254 
p_’coded_d©a
[*
p_off£t
] = (
ušt8_t
)(
AD_TYPE_FIELD_SIZE
 +

255 
AD_TYPE_TX_POWER_LEVEL_DATA_SIZE
);

256 *
p_off£t
 +ğ
AD_LENGTH_FIELD_SIZE
;

257 
p_’coded_d©a
[*
p_off£t
] = 
BLE_GAP_AD_TYPE_TX_POWER_LEVEL
;

258 *
p_off£t
 +ğ
AD_TYPE_FIELD_SIZE
;

259 
p_’coded_d©a
[*
p_off£t
] = 
tx_pow”_Ëv–
;

260 *
p_off£t
 +ğ
AD_TYPE_TX_POWER_LEVEL_DATA_SIZE
;

262  
NRF_SUCCESS
;

263 
	}
}

266 
ušt32_t
 
	$uuid_li¡_sized_’code
(cÚ¡ 
bË_advd©a_uuid_li¡_t
 * 
p_uuid_li¡
,

267 
ušt8_t
 
adv_ty³
,

268 
ušt8_t
 
uuid_size
,

269 
ušt8_t
 * 
p_’coded_d©a
,

270 
ušt16_t
 * 
p_off£t
,

271 
ušt16_t
 
max_size
)

273 
i
;

274 
boŞ
 
is_h—dšg_wr™‹n
 = 
çl£
;

275 
ušt16_t
 
¡¬t_pos
 = *
p_off£t
;

276 
ušt16_t
 
Ëngth
;

278 
i
 = 0; i < 
p_uuid_li¡
->
uuid_út
; i++)

280 
ušt32_t
 
”r_code
;

281 
ušt8_t
 
’coded_size
;

282 
bË_uuid_t
 
uuid
 = 
p_uuid_li¡
->
p_uuids
[
i
];

285 
”r_code
 = 
	`sd_bË_uuid_’code
(&
uuid
, &
’coded_size
, 
NULL
);

286 
	`VERIFY_SUCCESS
(
”r_code
);

289 ià(
’coded_size
 =ğ
uuid_size
)

291 
ušt8_t
 
h—dšg_by‹s
 = (
is_h—dšg_wr™‹n
è? 0 : 
AD_DATA_OFFSET
;

294 ià(((*
p_off£t
è+ 
’coded_size
 + 
h—dšg_by‹s
è> 
max_size
)

296  
NRF_ERROR_DATA_SIZE
;

299 ià(!
is_h—dšg_wr™‹n
)

302 *
p_off£t
 +ğ
AD_LENGTH_FIELD_SIZE
;

303 
p_’coded_d©a
[*
p_off£t
] = 
adv_ty³
;

304 *
p_off£t
 +ğ
AD_TYPE_FIELD_SIZE
;

305 
is_h—dšg_wr™‹n
 = 
Œue
;

309 
”r_code
 = 
	`sd_bË_uuid_’code
(&
uuid
, &
’coded_size
, &
p_’coded_d©a
[*
p_off£t
]);

310 
	`VERIFY_SUCCESS
(
”r_code
);

311 *
p_off£t
 +ğ
’coded_size
;

315 ià(
is_h—dšg_wr™‹n
)

318 
Ëngth
 = (*
p_off£t
è- (
¡¬t_pos
 + 
AD_LENGTH_FIELD_SIZE
);

320 ià(
Ëngth
 > 0x00FF)

322  
NRF_ERROR_DATA_SIZE
;

324 
p_’coded_d©a
[
¡¬t_pos
] = (
ušt8_t
)
Ëngth
;

327  
NRF_SUCCESS
;

328 
	}
}

331 
ušt32_t
 
	$uuid_li¡_’code
(cÚ¡ 
bË_advd©a_uuid_li¡_t
 * 
p_uuid_li¡
,

332 
ušt8_t
 
adv_ty³_16
,

333 
ušt8_t
 
adv_ty³_128
,

334 
ušt8_t
 * 
p_’coded_d©a
,

335 
ušt16_t
 * 
p_off£t
,

336 
ušt16_t
 
max_size
)

338 
ušt32_t
 
”r_code
;

341 
”r_code
 = 
	`uuid_li¡_sized_’code
(
p_uuid_li¡
,

342 
adv_ty³_16
,

343 (
ušt16_Ë_t
),

344 
p_’coded_d©a
,

345 
p_off£t
,

346 
max_size
);

347 
	`VERIFY_SUCCESS
(
”r_code
);

350 
”r_code
 = 
	`uuid_li¡_sized_’code
(
p_uuid_li¡
,

351 
adv_ty³_128
,

352 (
bË_uuid128_t
),

353 
p_’coded_d©a
,

354 
p_off£t
,

355 
max_size
);

356 
	`VERIFY_SUCCESS
(
”r_code
);

358  
NRF_SUCCESS
;

359 
	}
}

362 
ušt32_t
 
	$cÚn_št_check
(cÚ¡ 
bË_advd©a_cÚn_št_t
 *
p_cÚn_št
)

365 ià((
p_cÚn_št
->
mš_cÚn_š‹rv®
 < 0x0006) ||

367 (
p_cÚn_št
->
mš_cÚn_š‹rv®
 > 0x0c80) &&

368 (
p_cÚn_št
->
mš_cÚn_š‹rv®
 != 0xffff)

372  
NRF_ERROR_INVALID_PARAM
;

376 ià((
p_cÚn_št
->
max_cÚn_š‹rv®
 < 0x0006) ||

378 (
p_cÚn_št
->
max_cÚn_š‹rv®
 > 0x0c80) &&

379 (
p_cÚn_št
->
max_cÚn_š‹rv®
 != 0xffff)

383  
NRF_ERROR_INVALID_PARAM
;

387 ià((
p_cÚn_št
->
mš_cÚn_š‹rv®
 != 0xffff) &&

388 (
p_cÚn_št
->
max_cÚn_š‹rv®
 != 0xffff) &&

389 (
p_cÚn_št
->
mš_cÚn_š‹rv®
 >…_cÚn_št->
max_cÚn_š‹rv®
)

392  
NRF_ERROR_INVALID_PARAM
;

395  
NRF_SUCCESS
;

396 
	}
}

399 
ušt32_t
 
	$cÚn_št_’code
(cÚ¡ 
bË_advd©a_cÚn_št_t
 * 
p_cÚn_št
,

400 
ušt8_t
 * 
p_’coded_d©a
,

401 
ušt16_t
 * 
p_off£t
,

402 
ušt16_t
 
max_size
)

404 
ušt32_t
 
”r_code
;

407 ià(((*
p_off£t
è+ 
AD_TYPE_CONN_INT_SIZE
è> 
max_size
)

409  
NRF_ERROR_DATA_SIZE
;

413 
”r_code
 = 
	`cÚn_št_check
(
p_cÚn_št
);

414 
	`VERIFY_SUCCESS
(
”r_code
);

417 
p_’coded_d©a
[*
p_off£t
] = (
ušt8_t
)(
AD_TYPE_FIELD_SIZE
 + 
AD_TYPE_CONN_INT_DATA_SIZE
);

418 *
p_off£t
 +ğ
AD_LENGTH_FIELD_SIZE
;

419 
p_’coded_d©a
[*
p_off£t
] = 
BLE_GAP_AD_TYPE_SLAVE_CONNECTION_INTERVAL_RANGE
;

420 *
p_off£t
 +ğ
AD_TYPE_FIELD_SIZE
;

423 *
p_off£t
 +ğ
	`ušt16_’code
(
p_cÚn_št
->
mš_cÚn_š‹rv®
, &
p_’coded_d©a
[*p_offset]);

424 *
p_off£t
 +ğ
	`ušt16_’code
(
p_cÚn_št
->
max_cÚn_š‹rv®
, &
p_’coded_d©a
[*p_offset]);

426  
NRF_SUCCESS
;

427 
	}
}

430 
ušt32_t
 
	$mªuf_¥ecific_d©a_’code
(cÚ¡ 
bË_advd©a_mªuf_d©a_t
 * 
p_mªuf_¥_d©a
,

431 
ušt8_t
 * 
p_’coded_d©a
,

432 
ušt16_t
 * 
p_off£t
,

433 
ušt16_t
 
max_size
)

435 
ušt32_t
 
d©a_size
 = 
AD_TYPE_MANUF_SPEC_DATA_ID_SIZE
 + 
p_mªuf_¥_d©a
->
d©a
.
size
;

438 ià(((*
p_off£t
è+ 
AD_DATA_OFFSET
 + 
d©a_size
è> 
max_size
)

440  
NRF_ERROR_DATA_SIZE
;

444 ià(
d©a_size
 > (0x00FF - 
AD_TYPE_FIELD_SIZE
))

446  
NRF_ERROR_DATA_SIZE
;

450 
p_’coded_d©a
[*
p_off£t
] = (
ušt8_t
)(
AD_TYPE_FIELD_SIZE
 + 
d©a_size
);

451 *
p_off£t
 +ğ
AD_LENGTH_FIELD_SIZE
;

452 
p_’coded_d©a
[*
p_off£t
] = 
BLE_GAP_AD_TYPE_MANUFACTURER_SPECIFIC_DATA
;

453 *
p_off£t
 +ğ
AD_TYPE_FIELD_SIZE
;

456 *
p_off£t
 +ğ
	`ušt16_’code
(
p_mªuf_¥_d©a
->
com·ny_id’tif›r
, &
p_’coded_d©a
[*p_offset]);

459 ià(
p_mªuf_¥_d©a
->
d©a
.
size
 > 0)

461 ià(
p_mªuf_¥_d©a
->
d©a
.
p_d©a
 =ğ
NULL
)

463  
NRF_ERROR_INVALID_PARAM
;

465 
	`memıy
(&
p_’coded_d©a
[*
p_off£t
], 
p_mªuf_¥_d©a
->
d©a
.
p_d©a
,…_mªuf_¥_d©a->d©a.
size
);

466 *
p_off£t
 +ğ
p_mªuf_¥_d©a
->
d©a
.
size
;

469  
NRF_SUCCESS
;

470 
	}
}

473 
ušt32_t
 
	$£rviû_d©a_’code
(cÚ¡ 
bË_advd©a_t
 * 
p_advd©a
,

474 
ušt8_t
 * 
p_’coded_d©a
,

475 
ušt16_t
 * 
p_off£t
,

476 
ušt16_t
 
max_size
)

478 
ušt8_t
 
i
;

481 ià(
p_advd©a
->
p_£rviû_d©a_¬¿y
 =ğ
NULL
)

483  
NRF_ERROR_INVALID_PARAM
;

486 
i
 = 0; i < 
p_advd©a
->
£rviû_d©a_couÁ
; i++)

488 
bË_advd©a_£rviû_d©a_t
 * 
p_£rviû_d©a
;

489 
ušt32_t
 
d©a_size
;

491 
p_£rviû_d©a
 = &
p_advd©a
->
p_£rviû_d©a_¬¿y
[
i
];

493 
d©a_size
 = 
AD_TYPE_SERV_DATA_16BIT_UUID_SIZE
 + 
p_£rviû_d©a
->
d©a
.
size
;

496 ià(
d©a_size
 > (0x00FF - 
AD_TYPE_FIELD_SIZE
))

498  
NRF_ERROR_DATA_SIZE
;

502 
p_’coded_d©a
[*
p_off£t
] = (
ušt8_t
)(
AD_TYPE_FIELD_SIZE
 + 
d©a_size
);

503 *
p_off£t
 +ğ
AD_LENGTH_FIELD_SIZE
;

504 
p_’coded_d©a
[*
p_off£t
] = 
BLE_GAP_AD_TYPE_SERVICE_DATA
;

505 *
p_off£t
 +ğ
AD_TYPE_FIELD_SIZE
;

508 *
p_off£t
 +ğ
	`ušt16_’code
(
p_£rviû_d©a
->
£rviû_uuid
, &
p_’coded_d©a
[*p_offset]);

511 ià(
p_£rviû_d©a
->
d©a
.
size
 > 0)

513 ià(
p_£rviû_d©a
->
d©a
.
p_d©a
 =ğ
NULL
)

515  
NRF_ERROR_INVALID_PARAM
;

517 
	`memıy
(&
p_’coded_d©a
[*
p_off£t
], 
p_£rviû_d©a
->
d©a
.
p_d©a
,…_£rviû_d©a->d©a.
size
);

518 *
p_off£t
 +ğ
p_£rviû_d©a
->
d©a
.
size
;

522  
NRF_SUCCESS
;

523 
	}
}

525 
ušt32_t
 
	$bË_advd©a_’code
(
bË_advd©a_t
 cÚ¡ * cÚ¡ 
p_advd©a
,

526 
ušt8_t
 * cÚ¡ 
p_’coded_d©a
,

527 
ušt16_t
 * cÚ¡ 
p_Ën
)

529 
ušt32_t
 
”r_code
 = 
NRF_SUCCESS
;

530 
ušt16_t
 
max_size
 = *
p_Ën
;

531 *
p_Ën
 = 0;

534 ià(
p_advd©a
->
šşude_bË_deviû_addr
)

536 
”r_code
 = 
	`bË_deviû_addr_’code
(
p_’coded_d©a
, 
p_Ën
, 
max_size
);

537 
	`VERIFY_SUCCESS
(
”r_code
);

541 ià(
p_advd©a
->
šşude_­³¬ªû
)

543 
”r_code
 = 
	`­³¬ªû_’code
(
p_’coded_d©a
, 
p_Ën
, 
max_size
);

544 
	`VERIFY_SUCCESS
(
”r_code
);

548 ià(
p_advd©a
->
æags
 != 0 )

550 
”r_code
 = 
	`æags_’code
(
p_advd©a
->
æags
, 
p_’coded_d©a
, 
p_Ën
, 
max_size
);

551 
	`VERIFY_SUCCESS
(
”r_code
);

555 ià(
p_advd©a
->
p_tx_pow”_Ëv–
 !ğ
NULL
)

557 
”r_code
 = 
	`tx_pow”_Ëv–_’code
(*
p_advd©a
->
p_tx_pow”_Ëv–
,

558 
p_’coded_d©a
,

559 
p_Ën
,

560 
max_size
);

561 
	`VERIFY_SUCCESS
(
”r_code
);

565 ià(
p_advd©a
->
uuids_mÜe_avaabË
.
uuid_út
 > 0)

567 
”r_code
 = 
	`uuid_li¡_’code
(&
p_advd©a
->
uuids_mÜe_avaabË
,

568 
BLE_GAP_AD_TYPE_16BIT_SERVICE_UUID_MORE_AVAILABLE
,

569 
BLE_GAP_AD_TYPE_128BIT_SERVICE_UUID_MORE_AVAILABLE
,

570 
p_’coded_d©a
,

571 
p_Ën
,

572 
max_size
);

573 
	`VERIFY_SUCCESS
(
”r_code
);

577 ià(
p_advd©a
->
uuids_com¶‘e
.
uuid_út
 > 0)

579 
”r_code
 = 
	`uuid_li¡_’code
(&
p_advd©a
->
uuids_com¶‘e
,

580 
BLE_GAP_AD_TYPE_16BIT_SERVICE_UUID_COMPLETE
,

581 
BLE_GAP_AD_TYPE_128BIT_SERVICE_UUID_COMPLETE
,

582 
p_’coded_d©a
,

583 
p_Ën
,

584 
max_size
);

585 
	`VERIFY_SUCCESS
(
”r_code
);

589 ià(
p_advd©a
->
uuids_sŞic™ed
.
uuid_út
 > 0)

591 
”r_code
 = 
	`uuid_li¡_’code
(&
p_advd©a
->
uuids_sŞic™ed
,

592 
BLE_GAP_AD_TYPE_SOLICITED_SERVICE_UUIDS_16BIT
,

593 
BLE_GAP_AD_TYPE_SOLICITED_SERVICE_UUIDS_128BIT
,

594 
p_’coded_d©a
,

595 
p_Ën
,

596 
max_size
);

597 
	`VERIFY_SUCCESS
(
”r_code
);

601 ià(
p_advd©a
->
p_¦ave_cÚn_št
 !ğ
NULL
)

603 
”r_code
 = 
	`cÚn_št_’code
(
p_advd©a
->
p_¦ave_cÚn_št
, 
p_’coded_d©a
, 
p_Ën
, 
max_size
);

604 
	`VERIFY_SUCCESS
(
”r_code
);

608 ià(
p_advd©a
->
p_mªuf_¥ecific_d©a
 !ğ
NULL
)

610 
”r_code
 = 
	`mªuf_¥ecific_d©a_’code
(
p_advd©a
->
p_mªuf_¥ecific_d©a
,

611 
p_’coded_d©a
,

612 
p_Ën
,

613 
max_size
);

614 
	`VERIFY_SUCCESS
(
”r_code
);

618 ià(
p_advd©a
->
£rviû_d©a_couÁ
 > 0)

620 
”r_code
 = 
	`£rviû_d©a_’code
(
p_advd©a
, 
p_’coded_d©a
, 
p_Ën
, 
max_size
);

621 
	`VERIFY_SUCCESS
(
”r_code
);

625 ià(
p_advd©a
->
Çme_ty³
 !ğ
BLE_ADVDATA_NO_NAME
)

627 
”r_code
 = 
	`Çme_’code
(
p_advd©a
, 
p_’coded_d©a
, 
p_Ën
, 
max_size
);

628 
	`VERIFY_SUCCESS
(
”r_code
);

631  
”r_code
;

632 
	}
}

635 
ušt32_t
 
	$advd©a_check
(cÚ¡ 
bË_advd©a_t
 * 
p_advd©a
)

639 ((
p_advd©a
->
æags
 & 
BLE_GAP_ADV_FLAG_BR_EDR_NOT_SUPPORTED
) == 0)

642  
NRF_ERROR_INVALID_PARAM
;

645  
NRF_SUCCESS
;

646 
	}
}

649 
ušt32_t
 
	$¤d©a_check
(cÚ¡ 
bË_advd©a_t
 * 
p_¤d©a
)

652 ià(
p_¤d©a
->
æags
)

654  
NRF_ERROR_INVALID_PARAM
;

657  
NRF_SUCCESS
;

658 
	}
}

661 
ušt32_t
 
	$bË_advd©a_£t
(cÚ¡ 
bË_advd©a_t
 * 
p_advd©a
, cÚ¡ bË_advd©a_ˆ* 
p_¤d©a
)

663 
ušt32_t
 
”r_code
;

664 
ušt16_t
 
Ën_advd©a
 = 
BLE_GAP_ADV_MAX_SIZE
;

665 
ušt16_t
 
Ën_¤d©a
 = 
BLE_GAP_ADV_MAX_SIZE
;

666 
ušt8_t
 
’coded_advd©a
[
BLE_GAP_ADV_MAX_SIZE
];

667 
ušt8_t
 
’coded_¤d©a
[
BLE_GAP_ADV_MAX_SIZE
];

668 
ušt8_t
 * 
p_’coded_advd©a
;

669 
ušt8_t
 * 
p_’coded_¤d©a
;

672 ià(
p_advd©a
 !ğ
NULL
)

674 
”r_code
 = 
	`advd©a_check
(
p_advd©a
);

675 
	`VERIFY_SUCCESS
(
”r_code
);

677 
”r_code
 = 
	`bË_advd©a_’code
(
p_advd©a
, 
’coded_advd©a
, &
Ën_advd©a
);

678 
	`VERIFY_SUCCESS
(
”r_code
);

679 
p_’coded_advd©a
 = 
’coded_advd©a
;

683 
p_’coded_advd©a
 = 
NULL
;

684 
Ën_advd©a
 = 0;

688 ià(
p_¤d©a
 !ğ
NULL
)

690 
”r_code
 = 
	`¤d©a_check
(
p_¤d©a
);

691 
	`VERIFY_SUCCESS
(
”r_code
);

693 
”r_code
 = 
	`bË_advd©a_’code
(
p_¤d©a
, 
’coded_¤d©a
, &
Ën_¤d©a
);

694 
	`VERIFY_SUCCESS
(
”r_code
);

695 
p_’coded_¤d©a
 = 
’coded_¤d©a
;

699 
p_’coded_¤d©a
 = 
NULL
;

700 
Ën_¤d©a
 = 0;

704  
	`sd_bË_g­_adv_d©a_£t
(
p_’coded_advd©a
, 
Ën_advd©a
, 
p_’coded_¤d©a
, 
Ën_¤d©a
);

705 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\common\ble_conn_params.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
NRF_BLE_CONN_PARAMS
)

42 
	~<¡dlib.h
>

43 
	~"Äf.h
"

44 
	~"sdk_”rÜs.h
"

45 
	~"bË_hci.h
"

46 
	~"bË_”r.h
"

47 
	~"bË_cÚn_·¿ms.h
"

48 
	~"bË_¤v_commÚ.h
"

49 
	~"bË_cÚn_¡©e.h
"

50 
	~"Äf_sdh_bË.h
"

51 
	~"­p_tim”.h
"

52 
	~"­p_ut.h
"

55 
	#NRF_BLE_CONN_PARAMS_N_INSTANCES
 
NRF_SDH_BLE_PERIPHERAL_LINK_COUNT


56 

	)

57 #ià(
NRF_BLE_CONN_PARAMS_N_INSTANCES
 < 1)

58 #”rÜ 
Inv®id
 
NRF_SDH_BLE_PERIPHERAL_LINK_COUNT
 
v®ue
. 
S‘
 
™
 
š
 
SDK
 
cÚfig
 (
Äf_sdh_bË
).

65 
ušt16_t
 
	mcÚn_hªdË
;

66 
­p_tim”_id_t
 
	mtim”_id
;

67 
ušt8_t
 
	mupd©e_couÁ
;

68 
ušt8_t
 
	m·¿ms_ok
;

69 
bË_g­_cÚn_·¿ms_t
 
	m´eã¼ed_cÚn_·¿ms
;

70 } 
	tbË_cÚn_·¿ms_š¡ªû_t
;

72 
­p_tim”_t
 
	gm_tim”_d©a
[
NRF_BLE_CONN_PARAMS_N_INSTANCES
] = {{{0}}};

73 
bË_cÚn_·¿ms_š¡ªû_t
 
	gm_cÚn_·¿ms_š¡ªûs
[
NRF_BLE_CONN_PARAMS_N_INSTANCES
] = {{0}};

74 
bË_cÚn_·¿ms_š™_t
 
	gm_cÚn_·¿ms_cÚfig
;

75 
bË_g­_cÚn_·¿ms_t
 
	gm_´eã¼ed_cÚn_·¿ms
;

85 
bË_cÚn_·¿ms_š¡ªû_t
 * 
	$š¡ªû_g‘
(
ušt16_t
 
cÚn_hªdË
)

88 
ušt32_t
 
i
 = 0; i < 
NRF_BLE_CONN_PARAMS_N_INSTANCES
; i++)

90 ià(
m_cÚn_·¿ms_š¡ªûs
[
i
].
cÚn_hªdË
 == conn_handle)

92  &
m_cÚn_·¿ms_š¡ªûs
[
i
];

96  
NULL
;

97 
	}
}

105 
__INLINE
 
	$š¡ªû_şaim
(
bË_cÚn_·¿ms_š¡ªû_t
 * 
p_š¡ªû
, 
ušt16_t
 
cÚn_hªdË
)

107 
p_š¡ªû
->
cÚn_hªdË
 = conn_handle;

108 
p_š¡ªû
->
upd©e_couÁ
 = 0;

109 
p_š¡ªû
->
´eã¼ed_cÚn_·¿ms
 = 
m_´eã¼ed_cÚn_·¿ms
;

110 
	}
}

117 
__INLINE
 
	$š¡ªû_ä“
(
bË_cÚn_·¿ms_š¡ªû_t
 * 
p_š¡ªû
)

119 
p_š¡ªû
->
cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

120 
	}
}

134 
boŞ
 
	$is_cÚn_·¿ms_ok
(
bË_g­_cÚn_·¿ms_t
 cÚ¡ * 
p_´eã¼ed_cÚn_·¿ms
,

135 
bË_g­_cÚn_·¿ms_t
 cÚ¡ * 
p_aùu®_cÚn_·¿ms
,

136 
ušt16_t
 
max_¦ave_Ï‹ncy_”r
,

137 
ušt16_t
 
max_sup_timeout_”r
)

139 
ušt32_t
 
max_®lowed_¦
 = 
p_´eã¼ed_cÚn_·¿ms
->
¦ave_Ï‹ncy
 + 
max_¦ave_Ï‹ncy_”r
;

140 
ušt32_t
 
mš_®lowed_¦
 = 
p_´eã¼ed_cÚn_·¿ms
->
¦ave_Ï‹ncy


141 - 
	`MIN
(
max_¦ave_Ï‹ncy_”r
, 
p_´eã¼ed_cÚn_·¿ms
->
¦ave_Ï‹ncy
);

142 
ušt32_t
 
max_®lowed_to
 = 
p_´eã¼ed_cÚn_·¿ms
->
cÚn_sup_timeout
 + 
max_sup_timeout_”r
;

143 
ušt32_t
 
mš_®lowed_to
 = 
p_´eã¼ed_cÚn_·¿ms
->
cÚn_sup_timeout


144 - 
	`MIN
(
max_sup_timeout_”r
, 
p_´eã¼ed_cÚn_·¿ms
->
cÚn_sup_timeout
);

149 ià((
p_aùu®_cÚn_·¿ms
->
max_cÚn_š‹rv®
 < 
p_´eã¼ed_cÚn_·¿ms
->
mš_cÚn_š‹rv®
)

150 || (
p_aùu®_cÚn_·¿ms
->
max_cÚn_š‹rv®
 > 
p_´eã¼ed_cÚn_·¿ms
->max_conn_interval))

152  
çl£
;

156 ià((
p_aùu®_cÚn_·¿ms
->
¦ave_Ï‹ncy
 < 
mš_®lowed_¦
)

157 || (
p_aùu®_cÚn_·¿ms
->
¦ave_Ï‹ncy
 > 
max_®lowed_¦
))

159  
çl£
;

163 ià((
p_aùu®_cÚn_·¿ms
->
cÚn_sup_timeout
 < 
mš_®lowed_to
)

164 || (
p_aùu®_cÚn_·¿ms
->
cÚn_sup_timeout
 > 
max_®lowed_to
))

166  
çl£
;

169  
Œue
;

170 
	}
}

173 
	$£nd_”rÜ_evt
(
»t_code_t
 
”r_code
)

175 ià(
m_cÚn_·¿ms_cÚfig
.
”rÜ_hªdËr
 !ğ
NULL
)

177 
m_cÚn_·¿ms_cÚfig
.
	`”rÜ_hªdËr
(
”r_code
);

179 
	}
}

189 
boŞ
 
	$£nd_upd©e_»que¡
(
ušt16_t
 
cÚn_hªdË
, 
bË_g­_cÚn_·¿ms_t
 * 
p_Ãw_cÚn_·¿ms
)

191 
»t_code_t
 
”r_code
;

193 
”r_code
 = 
	`sd_bË_g­_cÚn_·¿m_upd©e
(
cÚn_hªdË
, 
p_Ãw_cÚn_·¿ms
);

194 ià((
”r_code
 !ğ
NRF_SUCCESS
è&& (”r_cod!ğ
NRF_ERROR_BUSY
))

196 
	`£nd_”rÜ_evt
(
”r_code
);

199  (
”r_code
 =ğ
NRF_SUCCESS
);

200 
	}
}

207 
	$upd©e_timeout_hªdËr
(* 
p_cÚ‹xt
)

209 
ušt32_t
 
cÚn_hªdË
 = (ušt32_t)
p_cÚ‹xt
;

210 
bË_cÚn_·¿ms_š¡ªû_t
 * 
p_š¡ªû
 = 
	`š¡ªû_g‘
(
cÚn_hªdË
);

212 ià(
p_š¡ªû
 !ğ
NULL
)

215 ià(
p_š¡ªû
->
upd©e_couÁ
 < 
m_cÚn_·¿ms_cÚfig
.
max_cÚn_·¿ms_upd©e_couÁ
)

217 
boŞ
 
upd©e_£Á
 = 
	`£nd_upd©e_»que¡
(
cÚn_hªdË
, &
p_š¡ªû
->
´eã¼ed_cÚn_·¿ms
);

218 ià(
upd©e_£Á
)

220 
p_š¡ªû
->
upd©e_couÁ
++;

225 
p_š¡ªû
->
upd©e_couÁ
 = 0;

228 ià(
m_cÚn_·¿ms_cÚfig
.
discÚÃù_Ú_ç
)

230 
»t_code_t
 
”r_code
;

232 
”r_code
 = 
	`sd_bË_g­_discÚÃù
(
cÚn_hªdË
, 
BLE_HCI_CONN_INTERVAL_UNACCEPTABLE
);

233 ià((
”r_code
 !ğ
NRF_SUCCESS
è&& (”r_cod!ğ
NRF_ERROR_INVALID_STATE
))

235 
	`£nd_”rÜ_evt
(
”r_code
);

240 ià(
m_cÚn_·¿ms_cÚfig
.
evt_hªdËr
 !ğ
NULL
)

242 
bË_cÚn_·¿ms_evt_t
 
evt
;

244 
evt
.
evt_ty³
 = 
BLE_CONN_PARAMS_EVT_FAILED
;

245 
evt
.
cÚn_hªdË
 = conn_handle;

246 
m_cÚn_·¿ms_cÚfig
.
	`evt_hªdËr
(&
evt
);

250 
	}
}

253 
»t_code_t
 
	$bË_cÚn_·¿ms_š™
(cÚ¡ 
bË_cÚn_·¿ms_š™_t
 * 
p_š™
)

255 
»t_code_t
 
”r_code
;

257 
	`VERIFY_PARAM_NOT_NULL
(
p_š™
);

259 
m_cÚn_·¿ms_cÚfig
 = *
p_š™
;

260 
m_cÚn_·¿ms_cÚfig
.
p_cÚn_·¿ms
 = &
m_´eã¼ed_cÚn_·¿ms
;

262 ià(
p_š™
->
p_cÚn_·¿ms
 !ğ
NULL
)

265 
”r_code
 = 
	`sd_bË_g­_µı_£t
(
p_š™
->
p_cÚn_·¿ms
);

266 ià(
”r_code
 !ğ
NRF_SUCCESS
)

268  
”r_code
;

270 
m_´eã¼ed_cÚn_·¿ms
 = *
p_š™
->
p_cÚn_·¿ms
;

275 
”r_code
 = 
	`sd_bË_g­_µı_g‘
(&
m_´eã¼ed_cÚn_·¿ms
);

276 ià(
”r_code
 !ğ
NRF_SUCCESS
)

278  
”r_code
;

283 
ušt32_t
 
i
 = 0; i < 
NRF_BLE_CONN_PARAMS_N_INSTANCES
; i++)

285 
bË_cÚn_·¿ms_š¡ªû_t
 * 
p_š¡ªû
 = &
m_cÚn_·¿ms_š¡ªûs
[
i
];

287 
	`š¡ªû_ä“
(
p_š¡ªû
);

288 
p_š¡ªû
->
tim”_id
 = &
m_tim”_d©a
[
i
];

290 
”r_code
 = 
	`­p_tim”_ü—‹
(&
p_š¡ªû
->
tim”_id
,

291 
APP_TIMER_MODE_SINGLE_SHOT
,

292 
upd©e_timeout_hªdËr
);

293 ià(
”r_code
 !ğ
NRF_SUCCESS
)

295  
NRF_ERROR_INTERNAL
;

300  
NRF_SUCCESS
;

301 
	}
}

304 
»t_code_t
 
	$bË_cÚn_·¿ms_¡İ
()

306 
»t_code_t
 
”r_code
;

309 
ušt32_t
 
i
 = 0; i < 
NRF_BLE_CONN_PARAMS_N_INSTANCES
; i++)

311 
”r_code
 = 
	`­p_tim”_¡İ
(
m_cÚn_·¿ms_š¡ªûs
[
i
].
tim”_id
);

312 
”r_code
)

314 
NRF_SUCCESS
:

318 
NRF_ERROR_INVALID_STATE
:

322 
NRF_ERROR_NO_MEM
:

323  
NRF_ERROR_BUSY
;

325 
NRF_ERROR_INVALID_PARAM
:

328  
NRF_ERROR_INTERNAL
;

332  
NRF_SUCCESS
;

333 
	}
}

341 
	$cÚn_·¿ms_ÃgÙŸtiÚ
(
ušt16_t
 
cÚn_hªdË
, 
bË_cÚn_·¿ms_š¡ªû_t
 * 
p_š¡ªû
)

344 ià(!
p_š¡ªû
->
·¿ms_ok
)

346 
»t_code_t
 
”r_code
;

347 
ušt32_t
 
timeout_ticks
;

349 ià(
p_š¡ªû
->
upd©e_couÁ
 == 0)

352 
timeout_ticks
 = 
m_cÚn_·¿ms_cÚfig
.
fœ¡_cÚn_·¿ms_upd©e_d–ay
;

356 
timeout_ticks
 = 
m_cÚn_·¿ms_cÚfig
.
Ãxt_cÚn_·¿ms_upd©e_d–ay
;

359 
”r_code
 = 
	`­p_tim”_¡¬t
(
p_š¡ªû
->
tim”_id
, 
timeout_ticks
, (*)(
ušt32_t
)
cÚn_hªdË
);

360 ià(
”r_code
 !ğ
NRF_SUCCESS
)

362 
	`£nd_”rÜ_evt
(
”r_code
);

367 
p_š¡ªû
->
upd©e_couÁ
 = 0;

370 ià(
m_cÚn_·¿ms_cÚfig
.
evt_hªdËr
 !ğ
NULL
)

372 
bË_cÚn_·¿ms_evt_t
 
evt
;

374 
evt
.
evt_ty³
 = 
BLE_CONN_PARAMS_EVT_SUCCEEDED
;

375 
evt
.
cÚn_hªdË
 = conn_handle;

376 
m_cÚn_·¿ms_cÚfig
.
	`evt_hªdËr
(&
evt
);

379 
	}
}

386 
	$Ú_cÚÃù
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

388 
ušt8_t
 
rŞe
 = 
p_bË_evt
->
evt
.
g­_evt
.
·¿ms
.
cÚÃùed
.role;

389 
ušt16_t
 
cÚn_hªdË
 = 
p_bË_evt
->
evt
.
g­_evt
.conn_handle;

391 ià(
rŞe
 !ğ
BLE_GAP_ROLE_PERIPH
)

396 
bË_cÚn_·¿ms_š¡ªû_t
 * 
p_š¡ªû
 = 
	`š¡ªû_g‘
(
BLE_CONN_HANDLE_INVALID
);

398 ià(
p_š¡ªû
 =ğ
NULL
)

400 
	`£nd_”rÜ_evt
(
NRF_ERROR_NO_MEM
);

404 
	`š¡ªû_şaim
(
p_š¡ªû
, 
cÚn_hªdË
);

405 
p_š¡ªû
->
·¿ms_ok
 = 
	`is_cÚn_·¿ms_ok
(&p_š¡ªû->
´eã¼ed_cÚn_·¿ms
,

406 &
p_bË_evt
->
evt
.
g­_evt
.
·¿ms
.
cÚÃùed
.
cÚn_·¿ms
,

407 
NRF_BLE_CONN_PARAMS_MAX_SLAVE_LATENCY_DEVIATION
,

408 
NRF_BLE_CONN_PARAMS_MAX_SUPERVISION_TIMEOUT_DEVIATION
);

411 ià(
m_cÚn_·¿ms_cÚfig
.
¡¬t_Ú_nÙify_cccd_hªdË
 =ğ
BLE_GATT_HANDLE_INVALID
)

413 
	`cÚn_·¿ms_ÃgÙŸtiÚ
(
cÚn_hªdË
, 
p_š¡ªû
);

415 
	}
}

422 
	$Ú_discÚÃù
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

424 
»t_code_t
 
”r_code
;

425 
ušt16_t
 
cÚn_hªdË
 = 
p_bË_evt
->
evt
.
g­_evt
.conn_handle;

426 
bË_cÚn_·¿ms_š¡ªû_t
 * 
p_š¡ªû
 = 
	`š¡ªû_g‘
(
cÚn_hªdË
);

428 ià(
p_š¡ªû
 !ğ
NULL
)

431 
”r_code
 = 
	`­p_tim”_¡İ
(
p_š¡ªû
->
tim”_id
);

432 ià(
”r_code
 !ğ
NRF_SUCCESS
)

434 
	`£nd_”rÜ_evt
(
”r_code
);

437 
	`š¡ªû_ä“
(
p_š¡ªû
);

439 
	}
}

448 
	$Ú_wr™e
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

450 
bË_g©ts_evt_wr™e_t
 cÚ¡ * 
p_evt_wr™e
 = &
p_bË_evt
->
evt
.
g©ts_evt
.
·¿ms
.
wr™e
;

454 (
p_evt_wr™e
->
hªdË
 =ğ
m_cÚn_·¿ms_cÚfig
.
¡¬t_Ú_nÙify_cccd_hªdË
)

456 (
p_evt_wr™e
->
Ën
 == 2)

459 
ušt16_t
 
cÚn_hªdË
 = 
p_bË_evt
->
evt
.
g­_evt
.conn_handle;

460 
bË_cÚn_·¿ms_š¡ªû_t
 * 
p_š¡ªû
 = 
	`š¡ªû_g‘
(
cÚn_hªdË
);

462 ià(
p_š¡ªû
 !ğ
NULL
)

465 ià(
	`bË_¤v_is_nÙifiÿtiÚ_’abËd
(
p_evt_wr™e
->
d©a
))

468 
	`cÚn_·¿ms_ÃgÙŸtiÚ
(
cÚn_hªdË
, 
p_š¡ªû
);

472 
»t_code_t
 
”r_code
;

475 
”r_code
 = 
	`­p_tim”_¡İ
(
p_š¡ªû
->
tim”_id
);

476 ià(
”r_code
 !ğ
NRF_SUCCESS
)

478 
	`£nd_”rÜ_evt
(
”r_code
);

483 
	}
}

493 
	$Ú_cÚn_·¿ms_upd©e
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

495 
ušt16_t
 
cÚn_hªdË
 = 
p_bË_evt
->
evt
.
g­_evt
.conn_handle;

496 
bË_cÚn_·¿ms_š¡ªû_t
 * 
p_š¡ªû
 = 
	`š¡ªû_g‘
(
cÚn_hªdË
);

498 ià(
p_š¡ªû
 !ğ
NULL
)

500 
p_š¡ªû
->
·¿ms_ok
 = 
	`is_cÚn_·¿ms_ok
(

501 &
p_š¡ªû
->
´eã¼ed_cÚn_·¿ms
,

502 &
p_bË_evt
->
evt
.
g­_evt
.
·¿ms
.
cÚn_·¿m_upd©e
.
cÚn_·¿ms
,

503 
NRF_BLE_CONN_PARAMS_MAX_SLAVE_LATENCY_DEVIATION
,

504 
NRF_BLE_CONN_PARAMS_MAX_SUPERVISION_TIMEOUT_DEVIATION
);

506 
	`cÚn_·¿ms_ÃgÙŸtiÚ
(
cÚn_hªdË
, 
p_š¡ªû
);

508 
	}
}

517 
	$bË_evt_hªdËr
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
, * 
p_cÚ‹xt
)

519 
p_bË_evt
->
h—d”
.
evt_id
)

521 
BLE_GAP_EVT_CONNECTED
:

522 
	`Ú_cÚÃù
(
p_bË_evt
);

525 
BLE_GAP_EVT_DISCONNECTED
:

526 
	`Ú_discÚÃù
(
p_bË_evt
);

529 
BLE_GATTS_EVT_WRITE
:

530 
	`Ú_wr™e
(
p_bË_evt
);

533 
BLE_GAP_EVT_CONN_PARAM_UPDATE
:

534 
	`Ú_cÚn_·¿ms_upd©e
(
p_bË_evt
);

541 
	}
}

544 
»t_code_t
 
	$bË_cÚn_·¿ms_chªge_cÚn_·¿ms
(
ušt16_t
 
cÚn_hªdË
,

545 
bË_g­_cÚn_·¿ms_t
 * 
p_Ãw_·¿ms
)

547 
»t_code_t
 
”r_code
 = 
BLE_ERROR_INVALID_CONN_HANDLE
;

548 
bË_cÚn_·¿ms_š¡ªû_t
 * 
p_š¡ªû
 = 
	`š¡ªû_g‘
(
cÚn_hªdË
);

550 ià(
p_Ãw_·¿ms
 =ğ
NULL
)

552 
p_Ãw_·¿ms
 = &
m_´eã¼ed_cÚn_·¿ms
;

555 ià(
p_š¡ªû
 !ğ
NULL
)

558 
”r_code
 = 
	`sd_bË_g­_cÚn_·¿m_upd©e
(
cÚn_hªdË
, 
p_Ãw_·¿ms
);

559 ià(
”r_code
 =ğ
NRF_SUCCESS
)

561 
p_š¡ªû
->
·¿ms_ok
 = 
çl£
;

562 
p_š¡ªû
->
upd©e_couÁ
 = 1;

563 
p_š¡ªû
->
´eã¼ed_cÚn_·¿ms
 = *
p_Ãw_·¿ms
;

567  
”r_code
;

568 
	}
}

570 
NRF_SDH_BLE_OBSERVER
(
m_bË_ob£rv”
, 
BLE_CONN_PARAMS_BLE_OBSERVER_PRIO
, 
bË_evt_hªdËr
, 
NULL
);

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\common\ble_conn_state.c

40 
	~"bË_cÚn_¡©e.h
"

41 
	~<¡dboŞ.h
>

42 
	~<¡dšt.h
>

43 
	~<¡ršg.h
>

44 
	~"bË.h
"

45 
	~"sdk_m­³d_æags.h
"

46 
	~"­p_”rÜ.h
"

47 
	~"Äf_sdh_bË.h
"

50 #ià
defšed
(
__CC_ARM
)

51 #´agm¨
push


52 #´agm¨
ªÚ_uniÚs


53 #–ià
defšed
(
__ICCARM__
)

54 #´agm¨
Ïnguage
=
ex‹nded


55 #–ià
defšed
(
__GNUC__
)

60 
	#BLE_CONN_STATE_N_DEFAULT_FLAGS
 5

	)

61 
	#BLE_CONN_STATE_N_FLAGS
 (
BLE_CONN_STATE_N_DEFAULT_FLAGS
 + 
BLE_CONN_STATE_N_USER_FLAGS
è

	)

67 
sdk_m­³d_æags_t
 
	mv®id_æags
;

68 
sdk_m­³d_æags_t
 
	mcÚÃùed_æags
;

69 
sdk_m­³d_æags_t
 
	mûÁ¿l_æags
;

70 
sdk_m­³d_æags_t
 
	m’üy±ed_æags
;

71 
sdk_m­³d_æags_t
 
	mm™m_´Ùeùed_æags
;

72 
sdk_m­³d_æags_t
 
	mu£r_æags
[
BLE_CONN_STATE_N_USER_FLAGS
];

73 } 
	tbË_cÚn_¡©e_æag_cŞËùiÚs_t
;

80 
ušt32_t
 
	macquœed_æags
;

81 
ušt16_t
 
	mv®id_cÚn_hªdËs
[
SDK_MAPPED_FLAGS_N_KEYS
];

84 
bË_cÚn_¡©e_æag_cŞËùiÚs_t
 
	mæags
;

85 
sdk_m­³d_æags_t
 
	mæag_¬¿y
[
BLE_CONN_STATE_N_FLAGS
];

87 } 
	tbË_cÚn_¡©e_t
;

90 #ià
defšed
(
__CC_ARM
)

91 #´agm¨
pİ


92 #–ià
defšed
(
__ICCARM__
)

94 #–ià
defšed
(
__GNUC__
)

99 
bË_cÚn_¡©e_t
 
	gm_bcs
 = {0};

104 
	$bcs_š‹º®_¡©e_»£t
()

106 
	`mem£t
Ğ&
m_bcs
, 0, (
bË_cÚn_¡©e_t
) );

107 
	}
}

118 
boŞ
 
	$»cÜd_aùiv©e
(
ušt16_t
 
cÚn_hªdË
)

120 
ušt16_t
 
avaabË_šdex
 = 
	`sdk_m­³d_æags_fœ¡_key_šdex_g‘
(~
m_bcs
.
æags
.
v®id_æags
);

122 ià(
avaabË_šdex
 !ğ
SDK_MAPPED_FLAGS_INVALID_INDEX
)

124 
m_bcs
.
v®id_cÚn_hªdËs
[
avaabË_šdex
] = 
cÚn_hªdË
;

125 
	`sdk_m­³d_æags_upd©e_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
,

126 &
m_bcs
.
æags
.
cÚÃùed_æags
,

127 
cÚn_hªdË
,

129 
	`sdk_m­³d_æags_upd©e_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
,

130 &
m_bcs
.
æags
.
v®id_æags
,

131 
cÚn_hªdË
,

134  
Œue
;

137  
çl£
;

138 
	}
}

145 
	$»cÜd_šv®id©e
(
ušt16_t
 
cÚn_hªdË
)

147 
	`sdk_m­³d_æags_bulk_upd©e_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
,

148 
m_bcs
.
æag_¬¿y
,

149 
BLE_CONN_STATE_N_FLAGS
,

150 
cÚn_hªdË
,

152 
	}
}

159 
	$»cÜd_£t_discÚÃùed
(
ušt16_t
 
cÚn_hªdË
)

161 
	`sdk_m­³d_æags_upd©e_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
,

162 &
m_bcs
.
æags
.
cÚÃùed_æags
,

163 
cÚn_hªdË
,

165 
	}
}

171 
	$»cÜd_purge_discÚÃùed
()

173 
sdk_m­³d_æags_key_li¡_t
 
discÚÃùed_li¡
;

175 
discÚÃùed_li¡
 = 
	`sdk_m­³d_æags_key_li¡_g‘
(

176 
m_bcs
.
v®id_cÚn_hªdËs
,

177 (~
m_bcs
.
æags
.
cÚÃùed_æags
è& (m_bcs.æags.
v®id_æags
));

179 
ušt32_t
 
i
 = 0; i < 
discÚÃùed_li¡
.
Ën
; i++)

181 
	`»cÜd_šv®id©e
(
discÚÃùed_li¡
.
æag_keys
[
i
]);

183 
	}
}

192 
boŞ
 
	$u£r_æag_is_acquœed
(
bË_cÚn_¡©e_u£r_æag_id_t
 
æag_id
)

194  ((
m_bcs
.
acquœed_æags
 & (1 << 
æag_id
)) != 0);

195 
	}
}

202 
	$u£r_æag_acquœe
(
bË_cÚn_¡©e_u£r_æag_id_t
 
æag_id
)

204 
m_bcs
.
acquœed_æags
 |ğ(1 << 
æag_id
);

205 
	}
}

208 
	$bË_cÚn_¡©e_š™
()

210 
	`bcs_š‹º®_¡©e_»£t
();

211 
	}
}

219 
	$bË_evt_hªdËr
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
, * 
p_cÚ‹xt
)

221 
p_bË_evt
->
h—d”
.
evt_id
)

223 
BLE_GAP_EVT_CONNECTED
:

224 
	`»cÜd_purge_discÚÃùed
();

226 iàĞ!
	`»cÜd_aùiv©e
(
p_bË_evt
->
evt
.
g­_evt
.
cÚn_hªdË
) )

229 
	`APP_ERROR_HANDLER
(
NRF_ERROR_NO_MEM
);

231 #ià!
	`defšed
 (
S112
)

234 
boŞ
 
is_ûÁ¿l
 =

235 (
p_bË_evt
->
evt
.
g­_evt
.
·¿ms
.
cÚÃùed
.
rŞe
 =ğ
BLE_GAP_ROLE_CENTRAL
);

237 
	`sdk_m­³d_æags_upd©e_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
,

238 &
m_bcs
.
æags
.
ûÁ¿l_æags
,

239 
p_bË_evt
->
evt
.
g­_evt
.
cÚn_hªdË
,

240 
is_ûÁ¿l
);

246 
BLE_GAP_EVT_DISCONNECTED
:

247 
	`»cÜd_£t_discÚÃùed
(
p_bË_evt
->
evt
.
g­_evt
.
cÚn_hªdË
);

250 
BLE_GAP_EVT_CONN_SEC_UPDATE
:

251 
	`sdk_m­³d_æags_upd©e_by_key
(

252 
m_bcs
.
v®id_cÚn_hªdËs
,

253 &
m_bcs
.
æags
.
’üy±ed_æags
,

254 
p_bË_evt
->
evt
.
g­_evt
.
cÚn_hªdË
,

255 (
p_bË_evt
->
evt
.
g­_evt
.
·¿ms
.
cÚn_£c_upd©e
.
cÚn_£c
.
£c_mode
.
lv
 > 1));

256 
	`sdk_m­³d_æags_upd©e_by_key
(

257 
m_bcs
.
v®id_cÚn_hªdËs
,

258 &
m_bcs
.
æags
.
m™m_´Ùeùed_æags
,

259 
p_bË_evt
->
evt
.
g­_evt
.
cÚn_hªdË
,

260 (
p_bË_evt
->
evt
.
g­_evt
.
·¿ms
.
cÚn_£c_upd©e
.
cÚn_£c
.
£c_mode
.
lv
 > 2));

263 
	}
}

265 
NRF_SDH_BLE_OBSERVER
(
m_bË_evt_ob£rv”
, 
BLE_CONN_STATE_BLE_OBSERVER_PRIO
, 
bË_evt_hªdËr
, 
NULL
);

268 
boŞ
 
	$bË_cÚn_¡©e_v®id
(
ušt16_t
 
cÚn_hªdË
)

270  
	`sdk_m­³d_æags_g‘_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
,

271 
m_bcs
.
æags
.
v®id_æags
,

272 
cÚn_hªdË
);

273 
	}
}

276 
ušt8_t
 
	$bË_cÚn_¡©e_rŞe
(
ušt16_t
 
cÚn_hªdË
)

278 
ušt8_t
 
rŞe
 = 
BLE_GAP_ROLE_INVALID
;

280 iàĞ
	`sdk_m­³d_æags_g‘_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
, m_bcs.
æags
.
v®id_æags
, 
cÚn_hªdË
) )

282 
boŞ
 
ûÁ¿l
 = 
	`sdk_m­³d_æags_g‘_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
,

283 
m_bcs
.
æags
.
ûÁ¿l_æags
,

284 
cÚn_hªdË
);

285 #ià!
	`defšed
 (
S112
)

286 
rŞe
 = 
ûÁ¿l
 ? 
BLE_GAP_ROLE_CENTRAL
 : 
BLE_GAP_ROLE_PERIPH
;

288 
rŞe
 = 
BLE_GAP_ROLE_PERIPH
;

289 
	`UNUSED_VARIABLE
(
ûÁ¿l
);

293  
rŞe
;

294 
	}
}

297 
bË_cÚn_¡©e_¡©us_t
 
	$bË_cÚn_¡©e_¡©us
(
ušt16_t
 
cÚn_hªdË
)

299 
bË_cÚn_¡©e_¡©us_t
 
cÚn_¡©us
 = 
BLE_CONN_STATUS_INVALID
;

300 
boŞ
 
v®id
 = 
	`sdk_m­³d_æags_g‘_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
,

301 
m_bcs
.
æags
.
v®id_æags
,

302 
cÚn_hªdË
);

304 ià(
v®id
)

306 
boŞ
 
cÚÃùed
 = 
	`sdk_m­³d_æags_g‘_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
,

307 
m_bcs
.
æags
.
cÚÃùed_æags
,

308 
cÚn_hªdË
);

310 
cÚn_¡©us
 = 
cÚÃùed
 ? 
BLE_CONN_STATUS_CONNECTED
 : 
BLE_CONN_STATUS_DISCONNECTED
;

313  
cÚn_¡©us
;

314 
	}
}

317 
boŞ
 
	$bË_cÚn_¡©e_’üy±ed
(
ušt16_t
 
cÚn_hªdË
)

319  
	`sdk_m­³d_æags_g‘_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
,

320 
m_bcs
.
æags
.
’üy±ed_æags
,

321 
cÚn_hªdË
);

322 
	}
}

325 
boŞ
 
	$bË_cÚn_¡©e_m™m_´Ùeùed
(
ušt16_t
 
cÚn_hªdË
)

327  
	`sdk_m­³d_æags_g‘_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
,

328 
m_bcs
.
æags
.
m™m_´Ùeùed_æags
,

329 
cÚn_hªdË
);

330 
	}
}

333 
ušt32_t
 
	$bË_cÚn_¡©e_n_cÚÃùiÚs
()

335  
	`sdk_m­³d_æags_n_æags_£t
(
m_bcs
.
æags
.
cÚÃùed_æags
);

336 
	}
}

339 
ušt32_t
 
	$bË_cÚn_¡©e_n_ûÁ¿ls
()

341  
	`sdk_m­³d_æags_n_æags_£t
((
m_bcs
.
æags
.
ûÁ¿l_æags
è& (m_bcs.æags.
cÚÃùed_æags
));

342 
	}
}

345 
ušt32_t
 
	$bË_cÚn_¡©e_n_³rh”®s
()

347  
	`sdk_m­³d_æags_n_æags_£t
((~
m_bcs
.
æags
.
ûÁ¿l_æags
è& (m_bcs.æags.
cÚÃùed_æags
));

348 
	}
}

351 
sdk_m­³d_æags_key_li¡_t
 
	$bË_cÚn_¡©e_cÚn_hªdËs
()

353  
	`sdk_m­³d_æags_key_li¡_g‘
(
m_bcs
.
v®id_cÚn_hªdËs
, m_bcs.
æags
.
v®id_æags
);

354 
	}
}

357 
sdk_m­³d_æags_key_li¡_t
 
	$bË_cÚn_¡©e_ûÁ¿l_hªdËs
()

359  
	`sdk_m­³d_æags_key_li¡_g‘
(
m_bcs
.
v®id_cÚn_hªdËs
,

360 (
m_bcs
.
æags
.
ûÁ¿l_æags
è& (m_bcs.æags.
cÚÃùed_æags
));

361 
	}
}

364 
sdk_m­³d_æags_key_li¡_t
 
	$bË_cÚn_¡©e_³rh_hªdËs
()

366  
	`sdk_m­³d_æags_key_li¡_g‘
(
m_bcs
.
v®id_cÚn_hªdËs
,

367 (~
m_bcs
.
æags
.
ûÁ¿l_æags
è& (m_bcs.æags.
cÚÃùed_æags
));

368 
	}
}

371 
ušt8_t
 
	$bË_cÚn_¡©e_cÚn_idx
(
ušt16_t
 
cÚn_hªdË
)

373 
ušt8_t
 
šdex
;

374 ià(
	`sdk_m­³d_æags_g‘_by_key_w_idx
(
m_bcs
.
v®id_cÚn_hªdËs
,

375 
m_bcs
.
æags
.
v®id_æags
,

376 
cÚn_hªdË
,

377 &
šdex
))

379  
šdex
;

383  
BLE_CONN_STATE_MAX_CONNECTIONS
;

385 
	}
}

388 
bË_cÚn_¡©e_u£r_æag_id_t
 
	$bË_cÚn_¡©e_u£r_æag_acquœe
()

390 
bË_cÚn_¡©e_u£r_æag_id_t
 
i
 = 
BLE_CONN_STATE_USER_FLAG0
;

391 
i
 < 
BLE_CONN_STATE_N_USER_FLAGS
;

392 
i
++)

394 iàĞ!
	`u£r_æag_is_acquœed
(
i
) )

396 
	`u£r_æag_acquœe
(
i
);

397  
i
;

401  
BLE_CONN_STATE_USER_FLAG_INVALID
;

402 
	}
}

405 
boŞ
 
	$bË_cÚn_¡©e_u£r_æag_g‘
(
ušt16_t
 
cÚn_hªdË
, 
bË_cÚn_¡©e_u£r_æag_id_t
 
æag_id
)

407 ià(
	`u£r_æag_is_acquœed
(
æag_id
))

409  
	`sdk_m­³d_æags_g‘_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
,

410 
m_bcs
.
æags
.
u£r_æags
[
æag_id
],

411 
cÚn_hªdË
);

415  
çl£
;

417 
	}
}

420 
	$bË_cÚn_¡©e_u£r_æag_£t
(
ušt16_t
 
cÚn_hªdË
,

421 
bË_cÚn_¡©e_u£r_æag_id_t
 
æag_id
,

422 
boŞ
 
v®ue
)

424 ià(
	`u£r_æag_is_acquœed
(
æag_id
))

426 
	`sdk_m­³d_æags_upd©e_by_key
(
m_bcs
.
v®id_cÚn_hªdËs
,

427 &
m_bcs
.
æags
.
u£r_æags
[
æag_id
],

428 
cÚn_hªdË
,

429 
v®ue
);

431 
	}
}

434 
sdk_m­³d_æags_t
 
	$bË_cÚn_¡©e_u£r_æag_cŞËùiÚ
(
bË_cÚn_¡©e_u£r_æag_id_t
 
æag_id
)

436 iàĞ
	`u£r_æag_is_acquœed
(
æag_id
) )

438  
m_bcs
.
æags
.
u£r_æags
[
æag_id
];

444 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\common\ble_srv_common.c

45 
	~"bË_¤v_commÚ.h
"

46 
	~<¡ršg.h
>

47 
	~"nÜdic_commÚ.h
"

48 
	~"­p_”rÜ.h
"

49 
	~"bË.h
"

51 
boŞ
 
	$bË_¤v_is_nÙifiÿtiÚ_’abËd
(
ušt8_t
 cÚ¡ * 
p_’coded_d©a
)

53 
ušt16_t
 
cccd_v®ue
 = 
	`ušt16_decode
(
p_’coded_d©a
);

54  ((
cccd_v®ue
 & 
BLE_GATT_HVX_NOTIFICATION
) != 0);

55 
	}
}

57 
boŞ
 
	$bË_¤v_is_šdiÿtiÚ_’abËd
(
ušt8_t
 cÚ¡ * 
p_’coded_d©a
)

59 
ušt16_t
 
cccd_v®ue
 = 
	`ušt16_decode
(
p_’coded_d©a
);

60  ((
cccd_v®ue
 & 
BLE_GATT_HVX_INDICATION
) != 0);

61 
	}
}

63 
ušt8_t
 
	$bË_¤v_»pÜt_»f_’code
(
ušt8_t
 * 
p_’coded_bufãr
,

64 cÚ¡ 
bË_¤v_»pÜt_»f_t
 * 
p_»pÜt_»f
)

66 
ušt8_t
 
Ën
 = 0;

68 
p_’coded_bufãr
[
Ën
++] = 
p_»pÜt_»f
->
»pÜt_id
;

69 
p_’coded_bufãr
[
Ën
++] = 
p_»pÜt_»f
->
»pÜt_ty³
;

71 
	`APP_ERROR_CHECK_BOOL
(
Ën
 =ğ
BLE_SRV_ENCODED_REPORT_REF_LEN
);

72  
Ën
;

73 
	}
}

76 
	$bË_¤v_ascii_to_utf8
(
bË_¤v_utf8_¡r_t
 * 
p_utf8
, * 
p_ascii
)

78 
p_utf8
->
Ëngth
 = (
ušt16_t
)
	`¡¾’
(
p_ascii
);

79 
p_utf8
->
p_¡r
 = (
ušt8_t
 *)
p_ascii
;

80 
	}
}

90 
šlše
 
	$£t_£cur™y_»q
(
£cur™y_»q_t
 
Ëv–
, 
bË_g­_cÚn_£c_mode_t
 * 
p_³rm
)

94 
	`BLE_GAP_CONN_SEC_MODE_SET_NO_ACCESS
(
p_³rm
);

95 
Ëv–
)

97 
SEC_NO_ACCESS
:

98 
	`BLE_GAP_CONN_SEC_MODE_SET_NO_ACCESS
(
p_³rm
);

100 
SEC_OPEN
:

101 
	`BLE_GAP_CONN_SEC_MODE_SET_OPEN
(
p_³rm
);

103 
SEC_JUST_WORKS
:

104 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(
p_³rm
);

106 
SEC_MITM
:

107 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_WITH_MITM
(
p_³rm
);

109 
SEC_SIGNED
:

110 
	`BLE_GAP_CONN_SEC_MODE_SET_SIGNED_NO_MITM
(
p_³rm
);

112 
SEC_SIGNED_MITM
:

113 
	`BLE_GAP_CONN_SEC_MODE_SET_SIGNED_WITH_MITM
(
p_³rm
);

117 
	}
}

120 
ušt32_t
 
	$ch¬aù”i¡ic_add
(
ušt16_t
 
£rviû_hªdË
,

121 
bË_add_ch¬_·¿ms_t
 * 
p_ch¬_´İs
,

122 
bË_g©ts_ch¬_hªdËs_t
 * 
p_ch¬_hªdË
)

124 
bË_g©ts_ch¬_md_t
 
ch¬_md
;

125 
bË_g©ts_©Œ_t
 
©Œ_ch¬_v®ue
;

126 
bË_uuid_t
 
ch¬_uuid
;

127 
bË_g©ts_©Œ_md_t
 
©Œ_md
;

128 
bË_g©ts_©Œ_md_t
 
u£r_desü_©Œ_md
;

129 
bË_g©ts_©Œ_md_t
 
cccd_md
;

131 ià(
p_ch¬_´İs
->
uuid_ty³
 == 0)

133 
ch¬_uuid
.
ty³
 = 
BLE_UUID_TYPE_BLE
;

137 
ch¬_uuid
.
ty³
 = 
p_ch¬_´İs
->
uuid_ty³
;

139 
ch¬_uuid
.
uuid
 = 
p_ch¬_´İs
->uuid;

141 
	`mem£t
(&
©Œ_md
, 0, (
bË_g©ts_©Œ_md_t
));

142 
	`£t_£cur™y_»q
(
p_ch¬_´İs
->
»ad_acûss
, &
©Œ_md
.
»ad_³rm
);

143 
	`£t_£cur™y_»q
(
p_ch¬_´İs
->
wr™e_acûss
, & 
©Œ_md
.
wr™e_³rm
);

144 
©Œ_md
.
rd_auth
 = (
p_ch¬_´İs
->
is_deã»d_»ad
 ? 1 : 0);

145 
©Œ_md
.
wr_auth
 = (
p_ch¬_´İs
->
is_deã»d_wr™e
 ? 1 : 0);

146 
©Œ_md
.
vËn
 = (
p_ch¬_´İs
->
is_v¬_Ën
 ? 1 : 0);

147 
©Œ_md
.
vloc
 = (
p_ch¬_´İs
->
is_v®ue_u£r
 ? 
BLE_GATTS_VLOC_USER
 : 
BLE_GATTS_VLOC_STACK
);

150 
	`mem£t
(&
ch¬_md
, 0, (
bË_g©ts_ch¬_md_t
));

151 ià((
p_ch¬_´İs
->
ch¬_´İs
.
nÙify
 =ğ1)||Õ_ch¬_´İs->ch¬_´İs.
šdiÿ‹
 == 1))

154 
	`mem£t
(&
cccd_md
, 0, (cccd_md));

155 
	`£t_£cur™y_»q
(
p_ch¬_´İs
->
cccd_wr™e_acûss
, &
cccd_md
.
wr™e_³rm
);

156 
	`BLE_GAP_CONN_SEC_MODE_SET_OPEN
(&
cccd_md
.
»ad_³rm
);

158 
cccd_md
.
vloc
 = 
BLE_GATTS_VLOC_STACK
;

160 
ch¬_md
.
p_cccd_md
 = &
cccd_md
;

162 
ch¬_md
.
ch¬_´İs
 = 
p_ch¬_´İs
->char_props;

163 
ch¬_md
.
ch¬_ext_´İs
 = 
p_ch¬_´İs
->char_ext_props;

165 
	`mem£t
(&
©Œ_ch¬_v®ue
, 0, (
bË_g©ts_©Œ_t
));

166 
©Œ_ch¬_v®ue
.
p_uuid
 = &
ch¬_uuid
;

167 
©Œ_ch¬_v®ue
.
p_©Œ_md
 = &
©Œ_md
;

168 
©Œ_ch¬_v®ue
.
max_Ën
 = 
p_ch¬_´İs
->max_len;

169 ià(
p_ch¬_´İs
->
p_š™_v®ue
 !ğ
NULL
)

171 
©Œ_ch¬_v®ue
.
š™_Ën
 = 
p_ch¬_´İs
->init_len;

172 
©Œ_ch¬_v®ue
.
p_v®ue
 = 
p_ch¬_´İs
->
p_š™_v®ue
;

174 ià(
p_ch¬_´İs
->
p_u£r_desü
 !ğ
NULL
)

176 
	`mem£t
(&
u£r_desü_©Œ_md
, 0, (
bË_g©ts_©Œ_md_t
));

177 
ch¬_md
.
ch¬_u£r_desc_max_size
 = 
p_ch¬_´İs
->
p_u£r_desü
->
max_size
;

178 
ch¬_md
.
ch¬_u£r_desc_size
 = 
p_ch¬_´İs
->
p_u£r_desü
->
size
;

179 
ch¬_md
.
p_ch¬_u£r_desc
 = 
p_ch¬_´İs
->
p_u£r_desü
->p_char_user_desc;

181 
ch¬_md
.
p_u£r_desc_md
 = &
u£r_desü_©Œ_md
;

183 
	`£t_£cur™y_»q
(
p_ch¬_´İs
->
p_u£r_desü
->
»ad_acûss
, &
u£r_desü_©Œ_md
.
»ad_³rm
);

184 
	`£t_£cur™y_»q
(
p_ch¬_´İs
->
p_u£r_desü
->
wr™e_acûss
, &
u£r_desü_©Œ_md
.
wr™e_³rm
);

186 
u£r_desü_©Œ_md
.
rd_auth
 = (
p_ch¬_´İs
->
p_u£r_desü
->
is_deã»d_»ad
 ? 1 : 0);

187 
u£r_desü_©Œ_md
.
wr_auth
 = (
p_ch¬_´İs
->
p_u£r_desü
->
is_deã»d_wr™e
 ? 1 : 0);

188 
u£r_desü_©Œ_md
.
vËn
 = (
p_ch¬_´İs
->
p_u£r_desü
->
is_v¬_Ën
 ? 1 : 0);

189 
u£r_desü_©Œ_md
.
vloc
 = (
p_ch¬_´İs
->
p_u£r_desü
->
is_v®ue_u£r
 ? 
BLE_GATTS_VLOC_USER
 : 
BLE_GATTS_VLOC_STACK
);

191 ià(
p_ch¬_´İs
->
p_´e£Á©iÚ_fÜm©
 !ğ
NULL
)

193 
ch¬_md
.
p_ch¬_pf
 = 
p_ch¬_´İs
->
p_´e£Á©iÚ_fÜm©
;

195  
	`sd_bË_g©ts_ch¬aù”i¡ic_add
(
£rviû_hªdË
,

196 &
ch¬_md
,

197 &
©Œ_ch¬_v®ue
,

198 
p_ch¬_hªdË
);

199 
	}
}

202 
ušt32_t
 
	$desütÜ_add
(
ušt16_t
 
ch¬_hªdË
,

203 
bË_add_desü_·¿ms_t
 * 
p_desü_´İs
,

204 
ušt16_t
 * 
p_desü_hªdË
)

206 
bË_g©ts_©Œ_t
 
desü_·¿ms
;

207 
bË_uuid_t
 
desc_uuid
;

208 
bË_g©ts_©Œ_md_t
 
©Œ_md
;

210 
	`mem£t
(&
desü_·¿ms
, 0, (descr_params));

211 ià(
p_desü_´İs
->
uuid_ty³
 == 0)

213 
desc_uuid
.
ty³
 = 
BLE_UUID_TYPE_BLE
;

217 
desc_uuid
.
ty³
 = 
p_desü_´İs
->
uuid_ty³
;

219 
desc_uuid
.
uuid
 = 
p_desü_´İs
->uuid;

220 
desü_·¿ms
.
p_uuid
 = &
desc_uuid
;

222 
	`£t_£cur™y_»q
(
p_desü_´İs
->
»ad_acûss
, &
©Œ_md
.
»ad_³rm
);

223 
	`£t_£cur™y_»q
(
p_desü_´İs
->
wr™e_acûss
,&
©Œ_md
.
wr™e_³rm
);

225 
©Œ_md
.
rd_auth
 = (
p_desü_´İs
->
is_deã»d_»ad
 ? 1 : 0);

226 
©Œ_md
.
wr_auth
 = (
p_desü_´İs
->
is_deã»d_wr™e
 ? 1 : 0);

227 
©Œ_md
.
vËn
 = (
p_desü_´İs
->
is_v¬_Ën
 ? 1 : 0);

228 
©Œ_md
.
vloc
 = (
p_desü_´İs
->
is_v®ue_u£r
 ? 
BLE_GATTS_VLOC_USER
 : 
BLE_GATTS_VLOC_STACK
);

229 
desü_·¿ms
.
p_©Œ_md
 = &
©Œ_md
;

231 
desü_·¿ms
.
š™_Ën
 = 
p_desü_´İs
->init_len;

232 
desü_·¿ms
.
š™_offs
 = 
p_desü_´İs
->init_offs;

233 
desü_·¿ms
.
max_Ën
 = 
p_desü_´İs
->max_len;

234 
desü_·¿ms
.
p_v®ue
 = 
p_desü_´İs
->p_value;

236  
	`sd_bË_g©ts_desütÜ_add
(
ch¬_hªdË
, &
desü_·¿ms
, 
p_desü_hªdË
);

237 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\nrf_ble_gatt\nrf_ble_gatt.c

41 
	~"sdk_commÚ.h
"

42 #ià
NRF_MODULE_ENABLED
(
NRF_BLE_GATT
)

44 
	~"Äf_bË_g©t.h
"

46 
	#NRF_LOG_MODULE_NAME
 
bË_g©t


	)

47 
	~"Äf_log.h
"

48 
NRF_LOG_MODULE_REGISTER
();

51 
	#L2CAP_HDR_LEN
 4

52 

	)

54 
STATIC_ASSERT
(
NRF_SDH_BLE_GATT_MAX_MTU_SIZE
 <= 251);

55 
STATIC_ASSERT
(
NRF_SDH_BLE_GATT_MAX_MTU_SIZE
 + 
L2CAP_HDR_LEN
 <= 255);

59 
	$lšk_š™
(
Äf_bË_g©t_lšk_t
 * 
p_lšk
)

61 
p_lšk
->
©t_mtu_desœed
 = 
NRF_SDH_BLE_GATT_MAX_MTU_SIZE
;

62 
p_lšk
->
©t_mtu_efãùive
 = 
BLE_GATT_ATT_MTU_DEFAULT
;

63 
p_lšk
->
©t_mtu_exchªge_³ndšg
 = 
çl£
;

64 
p_lšk
->
©t_mtu_exchªge_»que¡ed
 = 
çl£
;

65 #ià!
	`defšed
 (
S112
)

66 
p_lšk
->
d©a_Ëngth_desœed
 = 
NRF_SDH_BLE_GATT_MAX_MTU_SIZE
 + 
L2CAP_HDR_LEN
;

67 
p_lšk
->
d©a_Ëngth_efãùive
 = 
BLE_GATT_ATT_MTU_DEFAULT
 + 
L2CAP_HDR_LEN
;

69 
	}
}

77 #ià!
defšed
 (
S112
)

78 
	$d©a_Ëngth_upd©e
(
ušt16_t
 
cÚn_hªdË
, 
Äf_bË_g©t_t
 cÚ¡ * 
p_g©t
)

80 
	`NRF_LOG_DEBUG
("Requestingo update data†engtho %u on connection 0x%x.",

81 
p_g©t
->
lšks
[
cÚn_hªdË
].
d©a_Ëngth_desœed
, conn_handle);

83 
bË_g­_d©a_Ëngth_·¿ms_t
 cÚ¡ 
dÍ
 =

85 .
max_rx_où‘s
 = 
p_g©t
->
lšks
[
cÚn_hªdË
].
d©a_Ëngth_desœed
,

86 .
max_tx_où‘s
 = 
p_g©t
->
lšks
[
cÚn_hªdË
].
d©a_Ëngth_desœed
,

87 .
max_rx_time_us
 = 
BLE_GAP_DATA_LENGTH_AUTO
,

88 .
max_tx_time_us
 = 
BLE_GAP_DATA_LENGTH_AUTO
,

91 
»t_code_t
 
”r_code
 = 
	`sd_bË_g­_d©a_Ëngth_upd©e
(
cÚn_hªdË
, &
dÍ
, 
NULL
);

92 ià(
”r_code
 !ğ
NRF_SUCCESS
)

94 
	`NRF_LOG_ERROR
("sd_ble_gap_data_length_update() (request)"

96 
cÚn_hªdË
, 
”r_code
);

98 
	}
}

107 
	$Ú_cÚÃùed_evt
(
Äf_bË_g©t_t
 * 
p_g©t
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

109 
»t_code_t
 
”r_code
;

110 
ušt16_t
 
cÚn_hªdË
 = 
p_bË_evt
->
evt
.
commÚ_evt
.conn_handle;

111 
Äf_bË_g©t_lšk_t
 * 
p_lšk
 = &
p_g©t
->
lšks
[
cÚn_hªdË
];

114 #ià!
	`defšed
 (
S112
)

115 
p_lšk
->
d©a_Ëngth_desœed
 = 
p_g©t
->
d©a_Ëngth
;

117 
p_bË_evt
->
evt
.
g­_evt
.
·¿ms
.
cÚÃùed
.
rŞe
)

119 
BLE_GAP_ROLE_PERIPH
:

120 
p_lšk
->
©t_mtu_desœed
 = 
p_g©t
->
©t_mtu_desœed_³rh
;

122 #ià!
	`defšed
 (
S112
)

123 
BLE_GAP_ROLE_CENTRAL
:

124 
p_lšk
->
©t_mtu_desœed
 = 
p_g©t
->
©t_mtu_desœed_ûÁ¿l
;

133 ià(
p_lšk
->
©t_mtu_desœed
 >…_lšk->
©t_mtu_efãùive
)

135 
	`NRF_LOG_DEBUG
("Requestingo update ATT MTUo %u bytes on connection 0x%x.",

136 
p_lšk
->
©t_mtu_desœed
, 
cÚn_hªdË
);

138 
”r_code
 = 
	`sd_bË_g©tc_exchªge_mtu_»que¡
(
cÚn_hªdË
, 
p_lšk
->
©t_mtu_desœed
);

140 ià(
”r_code
 =ğ
NRF_SUCCESS
)

142 
p_lšk
->
©t_mtu_exchªge_»que¡ed
 = 
Œue
;

144 ià(
”r_code
 =ğ
NRF_ERROR_BUSY
)

146 
p_lšk
->
©t_mtu_exchªge_³ndšg
 = 
Œue
;

147 
	`NRF_LOG_DEBUG
("sd_ble_gattc_exchange_mtu_request()"

148 " oÀcÚÃùiÚ 0x%x„‘uºed busy, wÈ»Œy.", 
cÚn_hªdË
);

152 
	`NRF_LOG_ERROR
("sd_ble_gattc_exchange_mtu_request()"

154 
”r_code
);

158 #ià!
	`defšed
 (
S112
)

160 ià(
p_lšk
->
d©a_Ëngth_desœed
 >…_lšk->
d©a_Ëngth_efãùive
)

162 
	`d©a_Ëngth_upd©e
(
cÚn_hªdË
, 
p_g©t
);

165 
	}
}

168 
	$Ú_discÚÃùed_evt
(
Äf_bË_g©t_t
 * 
p_g©t
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

171 
	`lšk_š™
(&
p_g©t
->
lšks
[
p_bË_evt
->
evt
.
g­_evt
.
cÚn_hªdË
]);

172 
	}
}

184 
	$Ú_exchªge_mtu_r¥_evt
(
Äf_bË_g©t_t
 * 
p_g©t
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

186 
ušt16_t
 
cÚn_hªdË
 = 
p_bË_evt
->
evt
.
g©tc_evt
.conn_handle;

187 
ušt16_t
 
£rv”_rx_mtu
 = 
p_bË_evt
->
evt
.
g©tc_evt
.
·¿ms
.
exchªge_mtu_r¥
.server_rx_mtu;

189 
Äf_bË_g©t_lšk_t
 * 
p_lšk
 = &
p_g©t
->
lšks
[
cÚn_hªdË
];

193 
p_lšk
->
©t_mtu_efãùive
 = 
	`MIN
(
£rv”_rx_mtu
,…_lšk->
©t_mtu_desœed
);

194 
p_lšk
->
©t_mtu_efãùive
 = 
	`MAX
Õ_lšk->©t_mtu_efãùive, 
BLE_GATT_ATT_MTU_DEFAULT
);

196 
	`NRF_LOG_DEBUG
("ATT MTU updatedo %u bytes on connection 0x%x (response).",

197 
p_lšk
->
©t_mtu_efãùive
, 
cÚn_hªdË
);

201 ià((
p_g©t
->
evt_hªdËr
 !ğ
NULL
è&& (
p_lšk
->
©t_mtu_exchªge_»que¡ed
))

203 
Äf_bË_g©t_evt_t
 cÚ¡ 
evt
 =

205 .
evt_id
 = 
NRF_BLE_GATT_EVT_ATT_MTU_UPDATED
,

206 .
cÚn_hªdË
 = conn_handle,

207 .
·¿ms
.
©t_mtu_efãùive
 = 
p_lšk
->att_mtu_effective,

210 
p_g©t
->
	`evt_hªdËr
Õ_g©t, &
evt
);

213 
p_lšk
->
©t_mtu_exchªge_»que¡ed
 = 
çl£
;

214 
p_lšk
->
©t_mtu_exchªge_³ndšg
 = 
çl£
;

215 
	}
}

223 
	$Ú_exchªge_mtu_»que¡_evt
(
Äf_bË_g©t_t
 * 
p_g©t
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

225 
»t_code_t
 
”r_code
;

226 
ušt16_t
 
cÚn_hªdË
 = 
p_bË_evt
->
evt
.
g©ts_evt
.conn_handle;

227 
ušt16_t
 
ş›Á_mtu
 = 
p_bË_evt
->
evt
.
g©ts_evt
.
·¿ms
.
exchªge_mtu_»que¡
.
ş›Á_rx_mtu
;

229 
Äf_bË_g©t_lšk_t
 * 
p_lšk
 = &
p_g©t
->
lšks
[
cÚn_hªdË
];

231 
	`NRF_LOG_DEBUG
("Peer on connection 0x%x„equested‡n ATT MTU of %u bytes.",

232 
cÚn_hªdË
, 
ş›Á_mtu
);

234 
ş›Á_mtu
 = 
	`MAX
(ş›Á_mtu, 
BLE_GATT_ATT_MTU_DEFAULT
);

235 
p_lšk
->
©t_mtu_efãùive
 = 
	`MIN
(
ş›Á_mtu
,…_lšk->
©t_mtu_desœed
);

236 
p_lšk
->
©t_mtu_exchªge_³ndšg
 = 
çl£
;

238 
	`NRF_LOG_DEBUG
("Updating ATT MTUo %u bytes (desired: %u) on connection 0x%x.",

239 
p_lšk
->
©t_mtu_efãùive
,…_lšk->
©t_mtu_desœed
, 
cÚn_hªdË
);

241 
”r_code
 = 
	`sd_bË_g©ts_exchªge_mtu_»¶y
(
cÚn_hªdË
, 
p_lšk
->
©t_mtu_desœed
);

243 ià(
”r_code
 !ğ
NRF_SUCCESS
)

245 
	`NRF_LOG_ERROR
("sd_ble_gatts_exchange_mtu_reply()„eturned unexpected value 0x%x.",

246 
”r_code
);

252 ià(
p_lšk
->
©t_mtu_exchªge_»que¡ed
)

258 ià(
p_g©t
->
evt_hªdËr
 !ğ
NULL
)

260 
Äf_bË_g©t_evt_t
 cÚ¡ 
evt
 =

262 .
evt_id
 = 
NRF_BLE_GATT_EVT_ATT_MTU_UPDATED
,

263 .
cÚn_hªdË
 = conn_handle,

264 .
·¿ms
.
©t_mtu_efãùive
 = 
p_lšk
->att_mtu_effective,

267 
p_g©t
->
	`evt_hªdËr
Õ_g©t, &
evt
);

269 
	}
}

279 #ià!
defšed
 (
S112
)

280 
	$Ú_d©a_Ëngth_upd©e_evt
(
Äf_bË_g©t_t
 * 
p_g©t
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

282 
bË_g­_evt_t
 cÚ¡ 
g­_evt
 = 
p_bË_evt
->
evt
.gap_evt;

283 
ušt16_t
 cÚ¡ 
cÚn_hªdË
 = 
g­_evt
.conn_handle;

286 
p_g©t
->
lšks
[
cÚn_hªdË
].
d©a_Ëngth_efãùive
 =

287 
g­_evt
.
·¿ms
.
d©a_Ëngth_upd©e
.
efãùive_·¿ms
.
max_tx_où‘s
;

289 
	`NRF_LOG_DEBUG
("Data†ength updatedo %u on connection 0x%0x.",

290 
p_g©t
->
lšks
[
cÚn_hªdË
].
d©a_Ëngth_efãùive
,

291 
cÚn_hªdË
);

293 
	`NRF_LOG_DEBUG
("max_rx_octets: %u",

294 
g­_evt
.
·¿ms
.
d©a_Ëngth_upd©e
.
efãùive_·¿ms
.
max_rx_où‘s
);

295 
	`NRF_LOG_DEBUG
("max_tx_octets: %u",

296 
g­_evt
.
·¿ms
.
d©a_Ëngth_upd©e
.
efãùive_·¿ms
.
max_tx_où‘s
);

297 
	`NRF_LOG_DEBUG
("max_rx_time: %u",

298 
g­_evt
.
·¿ms
.
d©a_Ëngth_upd©e
.
efãùive_·¿ms
.
max_rx_time_us
);

299 
	`NRF_LOG_DEBUG
("max_tx_time: %u",

300 
g­_evt
.
·¿ms
.
d©a_Ëngth_upd©e
.
efãùive_·¿ms
.
max_tx_time_us
);

302 ià(
p_g©t
->
evt_hªdËr
 !ğ
NULL
)

304 
Äf_bË_g©t_evt_t
 cÚ¡ 
evt
 =

306 .
evt_id
 = 
NRF_BLE_GATT_EVT_DATA_LENGTH_UPDATED
,

307 .
cÚn_hªdË
 = conn_handle,

308 .
·¿ms
.
d©a_Ëngth
 = 
p_g©t
->
lšks
[
cÚn_hªdË
].
d©a_Ëngth_efãùive
,

311 
p_g©t
->
	`evt_hªdËr
Õ_g©t, &
evt
);

313 
	}
}

332 #ià!
defšed
 (
S112
)

333 
	$Ú_d©a_Ëngth_upd©e_»que¡_evt
(
Äf_bË_g©t_t
 * 
p_g©t
, 
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

335 
»t_code_t
 
”r_code
;

337 
bË_g­_evt_t
 cÚ¡ * 
p_g­_evt
 = &
p_bË_evt
->
evt
.
g­_evt
;

338 
Äf_bË_g©t_lšk_t
 * 
p_lšk
 = &
p_g©t
->
lšks
[
p_g­_evt
->
cÚn_hªdË
];

340 
ušt8_t
 cÚ¡ 
d©a_Ëngth_³”
 =

341 
p_g­_evt
->
·¿ms
.
d©a_Ëngth_upd©e_»que¡
.
³”_·¿ms
.
max_tx_où‘s
;

343 
	`NRF_LOG_DEBUG
("Peer on connection 0x%x„equested‡ data†ength of %u bytes.",

344 
p_g­_evt
->
cÚn_hªdË
, 
d©a_Ëngth_³”
);

346 
ušt8_t
 cÚ¡ 
d©a_Ëngth
 = 
	`MIN
(
p_lšk
->
d©a_Ëngth_desœed
, 
d©a_Ëngth_³”
);

348 
bË_g­_d©a_Ëngth_·¿ms_t
 cÚ¡ 
dÍ
 =

350 .
max_rx_où‘s
 = 
d©a_Ëngth
,

351 .
max_tx_où‘s
 = 
d©a_Ëngth
,

354 
	`NRF_LOG_DEBUG
("Updating data†engtho %u bytes on connection 0x%x.",

355 
d©a_Ëngth
, 
p_g­_evt
->
cÚn_hªdË
);

357 
”r_code
 = 
	`sd_bË_g­_d©a_Ëngth_upd©e
(
p_g­_evt
->
cÚn_hªdË
, &
dÍ
, 
NULL
);

359 ià(
”r_code
 !ğ
NRF_SUCCESS
)

361 
	`NRF_LOG_ERROR
("sd_ble_gap_data_length_update() (reply)"

363 
”r_code
);

365 
	}
}

369 
»t_code_t
 
	$Äf_bË_g©t_š™
(
Äf_bË_g©t_t
 * 
p_g©t
, 
Äf_bË_g©t_evt_hªdËr_t
 
evt_hªdËr
)

371 
	`VERIFY_PARAM_NOT_NULL
(
p_g©t
);

373 
p_g©t
->
evt_hªdËr
 =ƒvt_handler;

374 
p_g©t
->
©t_mtu_desœed_³rh
 = 
NRF_SDH_BLE_GATT_MAX_MTU_SIZE
;

375 
p_g©t
->
©t_mtu_desœed_ûÁ¿l
 = 
NRF_SDH_BLE_GATT_MAX_MTU_SIZE
;

376 
p_g©t
->
d©a_Ëngth
 = 
NRF_SDH_BLE_GATT_MAX_MTU_SIZE
 + 
L2CAP_HDR_LEN
;

378 
ušt32_t
 
i
 = 0; i < 
NRF_BLE_GATT_LINK_COUNT
; i++)

380 
	`lšk_š™
(&
p_g©t
->
lšks
[
i
]);

383  
NRF_SUCCESS
;

384 
	}
}

387 
»t_code_t
 
	$Äf_bË_g©t_©t_mtu_³rh_£t
(
Äf_bË_g©t_t
 * 
p_g©t
, 
ušt16_t
 
desœed_mtu
)

389 
	`VERIFY_PARAM_NOT_NULL
(
p_g©t
);

391 ià((
desœed_mtu
 < 
BLE_GATT_ATT_MTU_DEFAULT
è|| (desœed_mtu > 
NRF_SDH_BLE_GATT_MAX_MTU_SIZE
))

393  
NRF_ERROR_INVALID_PARAM
;

396 
p_g©t
->
©t_mtu_desœed_³rh
 = 
desœed_mtu
;

397  
NRF_SUCCESS
;

398 
	}
}

401 
»t_code_t
 
	$Äf_bË_g©t_©t_mtu_ûÁ¿l_£t
(
Äf_bË_g©t_t
 * 
p_g©t
, 
ušt16_t
 
desœed_mtu
)

403 
	`VERIFY_PARAM_NOT_NULL
(
p_g©t
);

405 ià((
desœed_mtu
 < 
BLE_GATT_ATT_MTU_DEFAULT
è|| (desœed_mtu > 
NRF_SDH_BLE_GATT_MAX_MTU_SIZE
))

407  
NRF_ERROR_INVALID_PARAM
;

410 
p_g©t
->
©t_mtu_desœed_ûÁ¿l
 = 
desœed_mtu
;

411  
NRF_SUCCESS
;

412 
	}
}

415 
ušt16_t
 
	$Äf_bË_g©t_eff_mtu_g‘
(
Äf_bË_g©t_t
 cÚ¡ * 
p_g©t
, 
ušt16_t
 
cÚn_hªdË
)

417 ià((
p_g©t
 =ğ
NULL
è|| (
cÚn_hªdË
 >ğ
NRF_BLE_GATT_LINK_COUNT
))

422  
p_g©t
->
lšks
[
cÚn_hªdË
].
©t_mtu_efãùive
;

423 
	}
}

425 #ià!
defšed
 (
S112
)

426 
»t_code_t
 
	$Äf_bË_g©t_d©a_Ëngth_£t
(
Äf_bË_g©t_t
 * 
p_g©t
,

427 
ušt16_t
 
cÚn_hªdË
,

428 
ušt8_t
 
d©a_Ëngth
)

430 
»t_code_t
 
”r_code
;

432 ià(
p_g©t
 =ğ
NULL
)

434  
NRF_ERROR_NULL
;

437 ià(
cÚn_hªdË
 =ğ
BLE_CONN_HANDLE_INVALID
)

439 
p_g©t
->
d©a_Ëngth
 = 
	`MIN
(d©a_Ëngth, 
NRF_SDH_BLE_GATT_MAX_MTU_SIZE
 + 
L2CAP_HDR_LEN
);

440  
NRF_SUCCESS
;

443 ià(
cÚn_hªdË
 >ğ
NRF_BLE_GATT_LINK_COUNT
)

445  
NRF_ERROR_INVALID_PARAM
;

448 
p_g©t
->
lšks
[
cÚn_hªdË
].
d©a_Ëngth_desœed
 = 
d©a_Ëngth
;

450 
bË_g­_d©a_Ëngth_·¿ms_t
 cÚ¡ 
dÍ
 =

452 .
max_rx_où‘s
 = 
d©a_Ëngth
,

453 .
max_tx_où‘s
 = 
d©a_Ëngth
,

456 
”r_code
 = 
	`sd_bË_g­_d©a_Ëngth_upd©e
(
cÚn_hªdË
, &
dÍ
, 
NULL
);

457  
”r_code
;

458 
	}
}

462 #ià!
defšed
 (
S112
)

463 
»t_code_t
 
	$Äf_bË_g©t_d©a_Ëngth_g‘
(
Äf_bË_g©t_t
 cÚ¡ * 
p_g©t
,

464 
ušt16_t
 
cÚn_hªdË
,

465 
ušt8_t
 * 
p_d©a_Ëngth
)

467 ià((
p_g©t
 =ğ
NULL
è|| (
p_d©a_Ëngth
 == NULL))

469  
NRF_ERROR_NULL
;

472 ià(
cÚn_hªdË
 =ğ
BLE_CONN_HANDLE_INVALID
)

474 *
p_d©a_Ëngth
 = 
p_g©t
->
d©a_Ëngth
;

475  
NRF_SUCCESS
;

478 ià(
cÚn_hªdË
 >ğ
NRF_BLE_GATT_LINK_COUNT
)

480  
NRF_ERROR_INVALID_PARAM
;

483 *
p_d©a_Ëngth
 = 
p_g©t
->
lšks
[
cÚn_hªdË
].
d©a_Ëngth_efãùive
;

484  
NRF_SUCCESS
;

485 
	}
}

489 
	$Äf_bË_g©t_Ú_bË_evt
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
, * 
p_cÚ‹xt
)

491 
Äf_bË_g©t_t
 * 
p_g©t
 = (Äf_bË_g©t_ˆ*)
p_cÚ‹xt
;

492 
ušt16_t
 
cÚn_hªdË
 = 
p_bË_evt
->
evt
.
commÚ_evt
.conn_handle;

494 ià(
cÚn_hªdË
 >ğ
NRF_BLE_GATT_LINK_COUNT
)

499 
p_bË_evt
->
h—d”
.
evt_id
)

501 
BLE_GAP_EVT_CONNECTED
:

502 
	`Ú_cÚÃùed_evt
(
p_g©t
, 
p_bË_evt
);

505 
BLE_GAP_EVT_DISCONNECTED
:

506 
	`Ú_discÚÃùed_evt
(
p_g©t
, 
p_bË_evt
);

509 
BLE_GATTC_EVT_EXCHANGE_MTU_RSP
:

510 
	`Ú_exchªge_mtu_r¥_evt
(
p_g©t
, 
p_bË_evt
);

513 
BLE_GATTS_EVT_EXCHANGE_MTU_REQUEST
:

514 
	`Ú_exchªge_mtu_»que¡_evt
(
p_g©t
, 
p_bË_evt
);

516 #ià!
	`defšed
 (
S112
)

517 
BLE_GAP_EVT_DATA_LENGTH_UPDATE
:

518 
	`Ú_d©a_Ëngth_upd©e_evt
(
p_g©t
, 
p_bË_evt
);

521 
BLE_GAP_EVT_DATA_LENGTH_UPDATE_REQUEST
:

522 
	`Ú_d©a_Ëngth_upd©e_»que¡_evt
(
p_g©t
, 
p_bË_evt
);

529 ià(
p_g©t
->
lšks
[
cÚn_hªdË
].
©t_mtu_exchªge_³ndšg
)

531 
»t_code_t
 
”r_code
;

533 
”r_code
 = 
	`sd_bË_g©tc_exchªge_mtu_»que¡
(
cÚn_hªdË
,

534 
p_g©t
->
lšks
[
cÚn_hªdË
].
©t_mtu_desœed
);

536 ià(
”r_code
 =ğ
NRF_SUCCESS
)

538 
p_g©t
->
lšks
[
cÚn_hªdË
].
©t_mtu_exchªge_³ndšg
 = 
çl£
;

539 
p_g©t
->
lšks
[
cÚn_hªdË
].
©t_mtu_exchªge_»que¡ed
 = 
Œue
;

541 
	`NRF_LOG_DEBUG
("Requestingo update ATT MTUo %u bytes on connection 0x%x (retry).",

542 
p_g©t
->
lšks
[
cÚn_hªdË
].
©t_mtu_desœed
, conn_handle);

544 ià(
”r_code
 !ğ
NRF_ERROR_BUSY
)

546 
	`NRF_LOG_ERROR
("sd_ble_gattc_exchange_mtu_request()„eturned unexpected value 0x%x.",

547 
”r_code
);

550 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\gatt_cache_manager.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
PEER_MANAGER
)

42 
	~"g©t_ÿche_mªag”.h
"

44 
	~"bË_g­.h
"

45 
	~"bË_”r.h
"

46 
	~"bË_cÚn_¡©e.h
"

47 
	~"³”_mªag”_ty³s.h
"

48 
	~"³”_mªag”_š‹º®.h
"

49 
	~"id_mªag”.h
"

50 
	~"g©ts_ÿche_mªag”.h
"

51 
	~"³”_d©aba£.h
"

52 
	~"pm_mu‹x.h
"

56 
	#GCM_EVENT_HANDLERS_CNT
 ((
m_evt_hªdËrs
è/ (m_evt_hªdËrs[0]))

	)

59 
pm_gcm_evt_hªdËr
(
pm_evt_t
 * 
p_gcm_evt
);

63 
pm_evt_hªdËr_š‹º®_t
 
	gm_evt_hªdËrs
[] =

65 
pm_gcm_evt_hªdËr


68 
boŞ
 
	gm_moduË_š™Ÿlized
;

69 
ušt8_t
 
	gm_db_upd©e_š_´og»ss_mu‹x
;

70 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_loÿl_db_upd©e_³ndšg
;

71 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_loÿl_db_­¶y_³ndšg
;

72 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_£rviû_chªged_³ndšg
;

73 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_£rviû_chªged_£Á
;

80 
	$š‹º®_¡©e_»£t
()

82 
m_moduË_š™Ÿlized
 = 
çl£
;

83 
	}
}

86 
	$evt_£nd
(
pm_evt_t
 * 
p_gcm_evt
)

88 
p_gcm_evt
->
³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
Õ_gcm_evt->
cÚn_hªdË
);

90 
ušt32_t
 
i
 = 0; i < 
GCM_EVENT_HANDLERS_CNT
; i++)

92 
m_evt_hªdËrs
[
i
](
p_gcm_evt
);

94 
	}
}

104 
boŞ
 
	$cccd_wr™‹n
(
bË_g©ts_evt_wr™e_t
 cÚ¡ * 
p_wr™e_evt
)

106  ( (
p_wr™e_evt
->
İ
 =ğ
BLE_GATTS_OP_WRITE_REQ
)

107 && (
p_wr™e_evt
->
uuid
.
ty³
 =ğ
BLE_UUID_TYPE_BLE
)

108 && (
p_wr™e_evt
->
uuid
.uuid =ğ
BLE_UUID_DESCRIPTOR_CLIENT_CHAR_CONFIG
)

110 
	}
}

118 
	$£nd_uÃx³ùed_”rÜ
(
ušt16_t
 
cÚn_hªdË
, 
»t_code_t
 
”r_code
)

120 
pm_evt_t
 
”rÜ_evt
 =

122 .
evt_id
 = 
PM_EVT_ERROR_UNEXPECTED
,

123 .
cÚn_hªdË
 = conn_handle,

124 .
·¿ms
 =

126 .
”rÜ_uÃx³ùed
 =

128 .
”rÜ
 = 
”r_code
,

132 
	`evt_£nd
(&
”rÜ_evt
);

133 
	}
}

144 
	$loÿl_db_­¶y_š_evt
(
ušt16_t
 
cÚn_hªdË
)

146 
boŞ
 
£t_´oûdu»_as_³ndšg
 = 
çl£
;

147 
»t_code_t
 
”r_code
;

148 
pm_evt_t
 
ev’t
 =

150 .
cÚn_hªdË
 = conn_handle,

153 ià(
cÚn_hªdË
 =ğ
BLE_CONN_HANDLE_INVALID
)

158 
”r_code
 = 
	`gscm_loÿl_db_ÿche_­¶y
(
cÚn_hªdË
);

160 
”r_code
)

162 
NRF_SUCCESS
:

163 
ev’t
.
evt_id
 = 
PM_EVT_LOCAL_DB_CACHE_APPLIED
;

165 
	`evt_£nd
(&
ev’t
);

168 
NRF_ERROR_BUSY
:

169 
£t_´oûdu»_as_³ndšg
 = 
Œue
;

172 
NRF_ERROR_INVALID_DATA
:

173 
ev’t
.
evt_id
 = 
PM_EVT_LOCAL_DB_CACHE_APPLY_FAILED
;

175 
	`evt_£nd
(&
ev’t
);

178 
BLE_ERROR_INVALID_CONN_HANDLE
:

183 
	`£nd_uÃx³ùed_”rÜ
(
cÚn_hªdË
, 
”r_code
);

187 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_loÿl_db_­¶y_³ndšg
, 
£t_´oûdu»_as_³ndšg
);

188 
	}
}

198 
__INLINE
 
	$loÿl_db_upd©e
(
ušt16_t
 
cÚn_hªdË
, 
boŞ
 
upd©e
)

200 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_loÿl_db_upd©e_³ndšg
, 
upd©e
);

201 
	}
}

212 
boŞ
 
	$loÿl_db_upd©e_š_evt
(
ušt16_t
 
cÚn_hªdË
)

214 
boŞ
 
£t_´oûdu»_as_³ndšg
 = 
çl£
;

215 
boŞ
 
sucûss
 = 
çl£
;

216 
»t_code_t
 
”r_code
 = 
	`gscm_loÿl_db_ÿche_upd©e
(
cÚn_hªdË
);

218 
”r_code
)

220 
NRF_SUCCESS
:

221 
sucûss
 = 
Œue
;

224 
BLE_ERROR_INVALID_CONN_HANDLE
:

228 
NRF_ERROR_BUSY
:

229 
£t_´oûdu»_as_³ndšg
 = 
Œue
;

232 
NRF_ERROR_STORAGE_FULL
:

234 
pm_evt_t
 
ev’t
 =

236 .
evt_id
 = 
PM_EVT_STORAGE_FULL
,

237 .
cÚn_hªdË
 = conn_handle,

240 
	`evt_£nd
(&
ev’t
);

245 
	`£nd_uÃx³ùed_”rÜ
(
cÚn_hªdË
, 
”r_code
);

249 
	`loÿl_db_upd©e
(
cÚn_hªdË
, 
£t_´oûdu»_as_³ndšg
);

251  
sucûss
;

252 
	}
}

263 
	$£rviû_chªged_£nd_š_evt
(
ušt16_t
 
cÚn_hªdË
)

265 
boŞ
 
sc_³ndšg_¡©e
 = 
Œue
;

266 
boŞ
 
sc_£Á_¡©e
 = 
çl£
;

267 
»t_code_t
 
”r_code
 = 
	`gscm_£rviû_chªged_šd_£nd
(
cÚn_hªdË
);

269 
”r_code
)

271 
NRF_SUCCESS
:

273 
pm_evt_t
 
ev’t
 =

275 .
evt_id
 = 
PM_EVT_SERVICE_CHANGED_IND_SENT
,

276 .
cÚn_hªdË
 = conn_handle,

279 
sc_£Á_¡©e
 = 
Œue
;

281 
	`evt_£nd
(&
ev’t
);

285 
NRF_ERROR_BUSY
:

289 
NRF_ERROR_INVALID_STATE
:

293 
NRF_ERROR_NOT_SUPPORTED
:

295 
sc_³ndšg_¡©e
 = 
çl£
;

296 
	`gscm_db_chªge_nÙifiÿtiÚ_dÚe
(
	`im_³”_id_g‘_by_cÚn_hªdË
(
cÚn_hªdË
));

299 
BLE_ERROR_GATTS_SYS_ATTR_MISSING
:

300 
	`loÿl_db_­¶y_š_evt
(
cÚn_hªdË
);

303 
BLE_ERROR_INVALID_CONN_HANDLE
:

308 
	`£nd_uÃx³ùed_”rÜ
(
cÚn_hªdË
, 
”r_code
);

312 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_£rviû_chªged_³ndšg
, 
sc_³ndšg_¡©e
);

313 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_£rviû_chªged_£Á
, 
sc_£Á_¡©e
);

314 
	}
}

321 
	$³ndšg_æags_check
(
bË_cÚn_¡©e_u£r_æag_id_t
 
æag_id
)

324 ià(
	`sdk_m­³d_æags_ªy_£t
(
	`bË_cÚn_¡©e_u£r_æag_cŞËùiÚ
(
æag_id
)))

326 
sdk_m­³d_æags_key_li¡_t
 
cÚn_hªdË_li¡
 = 
	`bË_cÚn_¡©e_cÚn_hªdËs
();

329 
ušt32_t
 
i
 = 0; i < 
cÚn_hªdË_li¡
.
Ën
; i++)

331 
ušt16_t
 
cÚn_hªdË
 = 
cÚn_hªdË_li¡
.
æag_keys
[
i
];

332 ià(
	`bË_cÚn_¡©e_u£r_æag_g‘
(
cÚn_hªdË
, 
æag_id
))

335 ià(
æag_id
 =ğ
m_æag_loÿl_db_­¶y_³ndšg
)

337 
	`loÿl_db_­¶y_š_evt
(
cÚn_hªdË
);

339 ià(
æag_id
 =ğ
m_æag_loÿl_db_upd©e_³ndšg
)

341 ià(
	`pm_mu‹x_lock
(&
m_db_upd©e_š_´og»ss_mu‹x
, 0))

343 ià(
	`loÿl_db_upd©e_š_evt
(
cÚn_hªdË
))

350 
	`pm_mu‹x_uÆock
(&
m_db_upd©e_š_´og»ss_mu‹x
, 0);

354 ià(
æag_id
 =ğ
m_æag_£rviû_chªged_³ndšg
)

356 ià(!
	`bË_cÚn_¡©e_u£r_æag_g‘
(
cÚn_hªdË
, 
m_æag_£rviû_chªged_£Á
))

358 
	`£rviû_chªged_£nd_š_evt
(
cÚn_hªdË
);

364 
	}
}

367 
__INLINE
 
	$­¶y_³ndšg_æags_check
()

369 
	`³ndšg_æags_check
(
m_æag_loÿl_db_­¶y_³ndšg
);

370 
	}
}

373 
__INLINE
 
	$upd©e_³ndšg_æags_check
()

375 
	`³ndšg_æags_check
(
m_æag_loÿl_db_upd©e_³ndšg
);

376 
	}
}

379 
__INLINE
 
	$£rviû_chªged_³ndšg_æags_check
()

381 
	`³ndšg_æags_check
(
m_æag_£rviû_chªged_³ndšg
);

382 
	}
}

390 
	$gcm_im_evt_hªdËr
(
pm_evt_t
 * 
p_ev’t
)

392 
p_ev’t
->
evt_id
)

394 
PM_EVT_BONDED_PEER_CONNECTED
:

395 
	`loÿl_db_­¶y_š_evt
(
p_ev’t
->
cÚn_hªdË
);

396 ià(
	`gscm_£rviû_chªged_šd_Ãeded
(
p_ev’t
->
cÚn_hªdË
))

398 
	`bË_cÚn_¡©e_u£r_æag_£t
(
p_ev’t
->
cÚn_hªdË
, 
m_æag_£rviû_chªged_³ndšg
, 
Œue
);

404 
	}
}

412 
	$gcm_pdb_evt_hªdËr
(
pm_evt_t
 * 
p_ev’t
)

414 iàĞ
p_ev’t
->
evt_id
 =ğ
PM_EVT_PEER_DATA_UPDATE_SUCCEEDED


415 && 
p_ev’t
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
aùiÚ
 =ğ
PM_PEER_DATA_OP_UPDATE
)

417 
p_ev’t
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
d©a_id
)

419 
PM_PEER_DATA_ID_BONDING
:

421 
ušt16_t
 
cÚn_hªdË
 = 
	`im_cÚn_hªdË_g‘
(
p_ev’t
->
³”_id
);

423 ià(
cÚn_hªdË
 !ğ
BLE_CONN_HANDLE_INVALID
)

425 
	`loÿl_db_upd©e
(
cÚn_hªdË
, 
Œue
);

430 
PM_PEER_DATA_ID_SERVICE_CHANGED_PENDING
:

432 
»t_code_t
 
”r_code
;

433 
pm_³”_d©a_æash_t
 
³”_d©a
;

435 
”r_code
 = 
	`pdb_³”_d©a_±r_g‘
(
p_ev’t
->
³”_id
,

436 
PM_PEER_DATA_ID_SERVICE_CHANGED_PENDING
,

437 &
³”_d©a
);

439 ià(
”r_code
 =ğ
NRF_SUCCESS
)

441 ià(*
³”_d©a
.
p_£rviû_chªged_³ndšg
)

443 
ušt16_t
 
cÚn_hªdË
 = 
	`im_cÚn_hªdË_g‘
(
p_ev’t
->
³”_id
);

444 ià(
cÚn_hªdË
 !ğ
BLE_CONN_HANDLE_INVALID
)

446 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_£rviû_chªged_³ndšg
, 
Œue
);

447 
	`£rviû_chªged_³ndšg_æags_check
();

454 
PM_PEER_DATA_ID_GATT_LOCAL
:

455 
	`pm_mu‹x_uÆock
(&
m_db_upd©e_š_´og»ss_mu‹x
, 0);

465 
	`upd©e_³ndšg_æags_check
();

466 
	}
}

469 
»t_code_t
 
	$gcm_š™
()

471 
	`NRF_PM_DEBUG_CHECK
(!
m_moduË_š™Ÿlized
);

473 
	`š‹º®_¡©e_»£t
();

475 
m_æag_loÿl_db_upd©e_³ndšg
 = 
	`bË_cÚn_¡©e_u£r_æag_acquœe
();

476 
m_æag_loÿl_db_­¶y_³ndšg
 = 
	`bË_cÚn_¡©e_u£r_æag_acquœe
();

477 
m_æag_£rviû_chªged_³ndšg
 = 
	`bË_cÚn_¡©e_u£r_æag_acquœe
();

478 
m_æag_£rviû_chªged_£Á
 = 
	`bË_cÚn_¡©e_u£r_æag_acquœe
();

480 ià((
m_æag_loÿl_db_upd©e_³ndšg
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
)

481 || (
m_æag_loÿl_db_­¶y_³ndšg
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
)

482 || (
m_æag_£rviû_chªged_³ndšg
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
)

483 || (
m_æag_£rviû_chªged_£Á
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
))

485  
NRF_ERROR_INTERNAL
;

488 
	`pm_mu‹x_š™
(&
m_db_upd©e_š_´og»ss_mu‹x
, 1);

490 
m_moduË_š™Ÿlized
 = 
Œue
;

492  
NRF_SUCCESS
;

493 
	}
}

500 
	$gcm_bË_evt_hªdËr
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

502 
ušt16_t
 
cÚn_hªdË
 = 
p_bË_evt
->
evt
.
g©ts_evt
.conn_handle;

504 
p_bË_evt
->
h—d”
.
evt_id
)

506 
BLE_GATTS_EVT_SYS_ATTR_MISSING
:

507 
	`loÿl_db_­¶y_š_evt
(
cÚn_hªdË
);

510 
BLE_GATTS_EVT_SC_CONFIRM
:

512 
pm_evt_t
 
ev’t
 =

514 .
evt_id
 = 
PM_EVT_SERVICE_CHANGED_IND_CONFIRMED
,

515 .
³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
(
cÚn_hªdË
),

516 .
cÚn_hªdË
 = conn_handle,

519 
	`gscm_db_chªge_nÙifiÿtiÚ_dÚe
(
ev’t
.
³”_id
);

521 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_£rviû_chªged_£Á
, 
çl£
);

522 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_£rviû_chªged_³ndšg
, 
çl£
);

523 
	`evt_£nd
(&
ev’t
);

527 
BLE_GATTS_EVT_WRITE
:

528 ià(
	`cccd_wr™‹n
(&
p_bË_evt
->
evt
.
g©ts_evt
.
·¿ms
.
wr™e
))

530 
	`loÿl_db_upd©e
(
cÚn_hªdË
, 
Œue
);

531 
	`upd©e_³ndšg_æags_check
();

536 
	`­¶y_³ndšg_æags_check
();

537 
	`£rviû_chªged_³ndšg_æags_check
();

538 
	}
}

541 
»t_code_t
 
	$gcm_loÿl_db_ÿche_upd©e
(
ušt16_t
 
cÚn_hªdË
)

543 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

545 
	`loÿl_db_upd©e
(
cÚn_hªdË
, 
Œue
);

546 
	`upd©e_³ndšg_æags_check
();

548  
NRF_SUCCESS
;

549 
	}
}

552 
	$gcm_loÿl_d©aba£_has_chªged
()

554 
	`gscm_loÿl_d©aba£_has_chªged
();

556 
sdk_m­³d_æags_key_li¡_t
 
cÚn_hªdËs
 = 
	`bË_cÚn_¡©e_cÚn_hªdËs
();

558 
ušt16_t
 
i
 = 0; i < 
cÚn_hªdËs
.
Ën
; i++)

560 ià(
	`im_³”_id_g‘_by_cÚn_hªdË
(
cÚn_hªdËs
.
æag_keys
[
i
]è=ğ
PM_PEER_ID_INVALID
)

562 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdËs
.
æag_keys
[
i
], 
m_æag_£rviû_chªged_³ndšg
, 
Œue
);

566 
	`£rviû_chªged_³ndšg_æags_check
();

567 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\gatts_cache_manager.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
PEER_MANAGER
)

42 
	~"g©ts_ÿche_mªag”.h
"

44 
	~<¡ršg.h
>

45 
	~"bË_g­.h
"

46 
	~"bË_”r.h
"

47 
	~"³”_mªag”_ty³s.h
"

48 
	~"³”_mªag”_š‹º®.h
"

49 
	~"³”_d©aba£.h
"

50 
	~"id_mªag”.h
"

54 
	#SYS_ATTR_SYS
 (
BLE_GATTS_SYS_ATTR_FLAG_SYS_SRVCS
)

	)

55 
	#SYS_ATTR_USR
 (
BLE_GATTS_SYS_ATTR_FLAG_USR_SRVCS
)

	)

56 
	#SYS_ATTR_BOTH
 (
SYS_ATTR_SYS
 | 
SYS_ATTR_USR
)

	)

58 
boŞ
 
	gm_moduË_š™Ÿlized
;

59 
pm_³”_id_t
 
	gm_cu¼’t_sc_¡Üe_³”_id
;

64 
	$š‹º®_¡©e_»£t
()

66 
m_moduË_š™Ÿlized
 = 
çl£
;

67 
m_cu¼’t_sc_¡Üe_³”_id
 = 
PM_PEER_ID_INVALID
;

68 
	}
}

77 
	$£rviû_chªged_³ndšg_£t
()

79 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

81 
»t_code_t
 
”r_code
;

83 cÚ¡ 
ušt32_t
 
£rviû_chªged_³ndšg
 = 
Œue
;

86 
pm_³”_d©a_cÚ¡_t
 
³”_d©a
 =

88 .
d©a_id
 = 
PM_PEER_DATA_ID_SERVICE_CHANGED_PENDING
,

89 .
Ëngth_wÜds
 = 
	`PM_SC_STATE_N_WORDS
(),

90 .
p_£rviû_chªged_³ndšg
 = (
boŞ
*)&
£rviû_chªged_³ndšg
,

94 
”r_code
 = 
	`pdb_¿w_¡Üe
(
m_cu¼’t_sc_¡Üe_³”_id
, &
³”_d©a
, 
NULL
);

95 (
m_cu¼’t_sc_¡Üe_³”_id
 !ğ
PM_PEER_ID_INVALID
è&& (
”r_code
 !ğ
NRF_ERROR_BUSY
))

97 
m_cu¼’t_sc_¡Üe_³”_id
 = 
	`pdb_Ãxt_³”_id_g‘
(m_current_sc_store_peer_id);

98 
”r_code
 = 
	`pdb_¿w_¡Üe
(
m_cu¼’t_sc_¡Üe_³”_id
, &
³”_d©a
, 
NULL
);

100 
	}
}

110 
	$gscm_pdb_evt_hªdËr
(
pm_evt_t
 * 
p_ev’t
)

112 ià(
m_cu¼’t_sc_¡Üe_³”_id
 !ğ
PM_PEER_ID_INVALID
)

114 
	`£rviû_chªged_³ndšg_£t
();

116 
	}
}

119 
»t_code_t
 
	$gscm_š™
()

121 
	`NRF_PM_DEBUG_CHECK
(!
m_moduË_š™Ÿlized
);

123 
	`š‹º®_¡©e_»£t
();

124 
m_moduË_š™Ÿlized
 = 
Œue
;

126  
NRF_SUCCESS
;

127 
	}
}

130 
»t_code_t
 
	$gscm_loÿl_db_ÿche_upd©e
(
ušt16_t
 
cÚn_hªdË
)

132 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

134 
pm_³”_id_t
 
³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
(
cÚn_hªdË
);

135 
»t_code_t
 
”r_code
;

137 ià(
³”_id
 =ğ
PM_PEER_ID_INVALID
)

139  
BLE_ERROR_INVALID_CONN_HANDLE
;

143 
pm_³”_d©a_t
 
³”_d©a
;

144 
ušt16_t
 
n_bufs
 = 1;

145 
boŞ
 
»Œy_w™h_bigg”_bufãr
 = 
çl£
;

149 
»Œy_w™h_bigg”_bufãr
 = 
çl£
;

151 
”r_code
 = 
	`pdb_wr™e_buf_g‘
(
³”_id
, 
PM_PEER_DATA_ID_GATT_LOCAL
, 
n_bufs
++, &
³”_d©a
);

152 ià(
”r_code
 =ğ
NRF_SUCCESS
)

154 
pm_³”_d©a_loÿl_g©t_db_t
 * 
p_loÿl_g©t_db
 = 
³”_d©a
.p_local_gatt_db;

156 
p_loÿl_g©t_db
->
æags
 = 
SYS_ATTR_BOTH
;

158 
”r_code
 = 
	`sd_bË_g©ts_sys_©Œ_g‘
(
cÚn_hªdË
, &
p_loÿl_g©t_db
->
d©a
[0], &p_loÿl_g©t_db->
Ën
,…_loÿl_g©t_db->
æags
);

160 ià(
”r_code
 =ğ
NRF_SUCCESS
)

162 
”r_code
 = 
	`pdb_wr™e_buf_¡Üe
(
³”_id
, 
PM_PEER_DATA_ID_GATT_LOCAL
,…eer_id);

166 ià(
”r_code
 =ğ
NRF_ERROR_DATA_SIZE
)

169 
»Œy_w™h_bigg”_bufãr
 = 
Œue
;

171 ià(
”r_code
 =ğ
NRF_ERROR_NOT_FOUND
)

174 
”r_code
 = 
NRF_SUCCESS
;

177 
»t_code_t
 
”r_code_»Ëa£
 = 
	`pdb_wr™e_buf_»Ëa£
(
³”_id
, 
PM_PEER_DATA_ID_GATT_LOCAL
);

178 ià(
”r_code_»Ëa£
 !ğ
NRF_SUCCESS
)

180 
”r_code
 = 
NRF_ERROR_INTERNAL
;

184 ià(
”r_code
 =ğ
NRF_ERROR_INVALID_PARAM
)

187 
”r_code
 = 
NRF_ERROR_DATA_SIZE
;

189 } 
»Œy_w™h_bigg”_bufãr
);

192  
”r_code
;

193 
	}
}

196 
»t_code_t
 
	$gscm_loÿl_db_ÿche_­¶y
(
ušt16_t
 
cÚn_hªdË
)

198 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

200 
pm_³”_id_t
 
³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
(
cÚn_hªdË
);

201 
»t_code_t
 
”r_code
;

202 
pm_³”_d©a_æash_t
 
³”_d©a
;

203 
ušt8_t
 cÚ¡ * 
p_sys_©Œ_d©a
 = 
NULL
;

204 
ušt16_t
 
sys_©Œ_Ën
 = 0;

205 
ušt32_t
 
sys_©Œ_æags
 = (
SYS_ATTR_BOTH
);

206 
boŞ
 
®l_©Œibu‹s_­¶›d
 = 
Œue
;

208 ià(
³”_id
 !ğ
PM_PEER_ID_INVALID
)

210 
”r_code
 = 
	`pdb_³”_d©a_±r_g‘
(
³”_id
, 
PM_PEER_DATA_ID_GATT_LOCAL
, &
³”_d©a
);

211 ià(
”r_code
 =ğ
NRF_SUCCESS
)

213 
pm_³”_d©a_loÿl_g©t_db_t
 cÚ¡ * 
p_loÿl_g©t_db
;

215 
p_loÿl_g©t_db
 = 
³”_d©a
.p_local_gatt_db;

216 
p_sys_©Œ_d©a
 = 
p_loÿl_g©t_db
->
d©a
;

217 
sys_©Œ_Ën
 = 
p_loÿl_g©t_db
->
Ën
;

218 
sys_©Œ_æags
 = 
p_loÿl_g©t_db
->
æags
;

224 
”r_code
 = 
	`sd_bË_g©ts_sys_©Œ_£t
(
cÚn_hªdË
, 
p_sys_©Œ_d©a
, 
sys_©Œ_Ën
, 
sys_©Œ_æags
);

226 ià(
”r_code
 =ğ
NRF_ERROR_NO_MEM
)

228 
”r_code
 = 
NRF_ERROR_BUSY
;

230 ià(
”r_code
 =ğ
NRF_ERROR_INVALID_STATE
)

232 
”r_code
 = 
NRF_SUCCESS
;

234 ià(
”r_code
 =ğ
NRF_ERROR_INVALID_DATA
)

236 
®l_©Œibu‹s_­¶›d
 = 
çl£
;

238 ià(
sys_©Œ_æags
 & 
SYS_ATTR_USR
)

241 
sys_©Œ_æags
 = 
SYS_ATTR_SYS
;

243 ià(
p_sys_©Œ_d©a
 || 
sys_©Œ_Ën
)

246 
p_sys_©Œ_d©a
 = 
NULL
;

247 
sys_©Œ_Ën
 = 0;

248 
sys_©Œ_æags
 = 
SYS_ATTR_BOTH
;

252 
”r_code
 = 
NRF_ERROR_INTERNAL
;

255 } 
”r_code
 =ğ
NRF_ERROR_INVALID_DATA
);

257 ià(!
®l_©Œibu‹s_­¶›d
)

259 
”r_code
 = 
NRF_ERROR_INVALID_DATA
;

262  
”r_code
;

263 
	}
}

265 
	$gscm_loÿl_d©aba£_has_chªged
()

267 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

268 
m_cu¼’t_sc_¡Üe_³”_id
 = 
	`pdb_Ãxt_³”_id_g‘
(
PM_PEER_ID_INVALID
);

269 
	`£rviû_chªged_³ndšg_£t
();

270 
	}
}

273 
boŞ
 
	$gscm_£rviû_chªged_šd_Ãeded
(
ušt16_t
 
cÚn_hªdË
)

275 
»t_code_t
 
”r_code
;

276 
boŞ
 
£rviû_chªged_¡©e
;

277 
pm_³”_d©a_æash_t
 
³”_d©a
;

279 
³”_d©a
.
p_£rviû_chªged_³ndšg
 = &
£rviû_chªged_¡©e
;

280 
pm_³”_id_t
 
³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
(
cÚn_hªdË
);

282 
”r_code
 = 
	`pdb_³”_d©a_±r_g‘
(
³”_id
, 
PM_PEER_DATA_ID_SERVICE_CHANGED_PENDING
, &
³”_d©a
);

284 ià(
”r_code
 !ğ
NRF_SUCCESS
)

286  
çl£
;

289  *
³”_d©a
.
p_£rviû_chªged_³ndšg
;

290 
	}
}

293 
»t_code_t
 
	$gscm_£rviû_chªged_šd_£nd
(
ušt16_t
 
cÚn_hªdË
)

295 
ušt16_t
 
¡¬t_hªdË
;

296 cÚ¡ 
ušt16_t
 
’d_hªdË
 = 0xFFFF;

297 
»t_code_t
 
”r_code
;

299 
”r_code
 = 
	`sd_bË_g©ts_š™Ÿl_u£r_hªdË_g‘
(&
¡¬t_hªdË
);

301 ià(
”r_code
 !ğ
NRF_SUCCESS
)

303  
NRF_ERROR_INTERNAL
;

308 
”r_code
 = 
	`sd_bË_g©ts_£rviû_chªged
(
cÚn_hªdË
, 
¡¬t_hªdË
, 
’d_hªdË
);

309 ià(
”r_code
 =ğ
BLE_ERROR_INVALID_ATTR_HANDLE
)

311 
¡¬t_hªdË
 += 1;

313 } 
”r_code
 =ğ
BLE_ERROR_INVALID_ATTR_HANDLE
);

315  
”r_code
;

316 
	}
}

319 
	$gscm_db_chªge_nÙifiÿtiÚ_dÚe
(
pm_³”_id_t
 
³”_id
)

321 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

324 cÚ¡ 
ušt32_t
 
£rviû_chªged_³ndšg
 = 
çl£
;

327 
pm_³”_d©a_cÚ¡_t
 
³”_d©a
 =

329 .
d©a_id
 = 
PM_PEER_DATA_ID_SERVICE_CHANGED_PENDING
,

330 .
Ëngth_wÜds
 = 
	`PM_SC_STATE_N_WORDS
(),

331 .
p_£rviû_chªged_³ndšg
 = (
boŞ
*)&
£rviû_chªged_³ndšg
,

337 (è
	`pdb_¿w_¡Üe
(
³”_id
, &
³”_d©a
, 
NULL
);

339 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\id_manager.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
PEER_MANAGER
)

42 
	~"id_mªag”.h
"

44 
	~<¡ršg.h
>

45 
	~"bË.h
"

46 
	~"bË_g­.h
"

47 
	~"bË_”r.h
"

48 
	~"bË_cÚn_¡©e.h
"

49 
	~"³”_mªag”_ty³s.h
"

50 
	~"³”_d©aba£.h
"

51 
	~"³”_d©a_¡Üage.h
"

52 
	~"Äf_soc.h
"

55 
	#IM_MAX_CONN_HANDLES
 (20)

	)

56 
	#IM_NO_INVALID_CONN_HANDLES
 (0xFF)

	)

57 
	#IM_ADDR_CLEARTEXT_LENGTH
 (3)

	)

58 
	#IM_ADDR_CIPHERTEXT_LENGTH
 (3)

	)

61 
	#IM_EVENT_HANDLERS_CNT
 ((
m_evt_hªdËrs
è/ (m_evt_hªdËrs[0]))

	)

65 
pm_im_evt_hªdËr
(
pm_evt_t
 * 
p_ev’t
);

66 
gcm_im_evt_hªdËr
(
pm_evt_t
 * 
p_ev’t
);

70 
pm_evt_hªdËr_š‹º®_t
 cÚ¡ 
	gm_evt_hªdËrs
[] =

72 
pm_im_evt_hªdËr
,

73 
gcm_im_evt_hªdËr


79 
pm_³”_id_t
 
	m³”_id
;

80 
ušt16_t
 
	mcÚn_hªdË
;

81 
bË_g­_addr_t
 
	m³”_add»ss
;

82 } 
	tim_cÚÃùiÚ_t
;

84 
boŞ
 
	gm_moduË_š™Ÿlized
;

85 
im_cÚÃùiÚ_t
 
	gm_cÚÃùiÚs
[
IM_MAX_CONN_HANDLES
];

86 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_cÚn_¡©e_u£r_æag_id
;

88 
ušt8_t
 
	gm_wli¡ed_³”_út
;

89 
pm_³”_id_t
 
	gm_wli¡ed_³”s
[
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
];

91 #ià(
NRF_SD_BLE_API_VERSION
 <= 2)

92 
bË_g­_addr_t
 
	gm_cu¼’t_id_addr
;

96 
	$š‹º®_¡©e_»£t
()

98 
m_cÚn_¡©e_u£r_æag_id
 = 
BLE_CONN_STATE_USER_FLAG_INVALID
;

100 
ušt32_t
 
i
 = 0; i < 
IM_MAX_CONN_HANDLES
; i++)

102 
m_cÚÃùiÚs
[
i
].
cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

104 
	}
}

111 
	$evt_£nd
(
pm_evt_t
 * 
p_ev’t
)

113 
ušt32_t
 
i
 = 0; i < 
IM_EVENT_HANDLERS_CNT
; i++)

115 
m_evt_hªdËrs
[
i
](
p_ev’t
);

117 
	}
}

128 
ušt8_t
 
	$g‘_ä“_cÚÃùiÚ
()

130 
ušt32_t
 
i
 = 0; i < 
IM_MAX_CONN_HANDLES
; i++)

134 ià(!
	`bË_cÚn_¡©e_u£r_æag_g‘
(
m_cÚÃùiÚs
[
i
].
cÚn_hªdË
, 
m_cÚn_¡©e_u£r_æag_id
))

136  
i
;

140  
IM_NO_INVALID_CONN_HANDLES
;

141 
	}
}

151 
ušt8_t
 
	$g‘_cÚÃùiÚ_by_cÚn_hªdË
(
ušt16_t
 
cÚn_hªdË
)

153 ià(
	`bË_cÚn_¡©e_u£r_æag_g‘
(
cÚn_hªdË
, 
m_cÚn_¡©e_u£r_æag_id
))

155 
ušt32_t
 
i
 = 0; i < 
IM_MAX_CONN_HANDLES
; i++)

157 ià(
m_cÚÃùiÚs
[
i
].
cÚn_hªdË
 == conn_handle)

159  
i
;

164  
IM_NO_INVALID_CONN_HANDLES
;

165 
	}
}

176 
ušt8_t
 
	$Ãw_cÚÃùiÚ
(
ušt16_t
 
cÚn_hªdË
, 
bË_g­_addr_t
 * 
p_bË_addr
)

178 
ušt8_t
 
cÚn_šdex
 = 
IM_NO_INVALID_CONN_HANDLES
;

180 ià((
p_bË_addr
 !ğ
NULL
è&& (
cÚn_hªdË
 !ğ
BLE_CONN_HANDLE_INVALID
))

182 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_cÚn_¡©e_u£r_æag_id
, 
Œue
);

184 
cÚn_šdex
 = 
	`g‘_cÚÃùiÚ_by_cÚn_hªdË
(
cÚn_hªdË
);

185 ià(
cÚn_šdex
 =ğ
IM_NO_INVALID_CONN_HANDLES
)

187 
cÚn_šdex
 = 
	`g‘_ä“_cÚÃùiÚ
();

190 ià(
cÚn_šdex
 !ğ
IM_NO_INVALID_CONN_HANDLES
)

192 
m_cÚÃùiÚs
[
cÚn_šdex
].
cÚn_hªdË
 = conn_handle;

193 
m_cÚÃùiÚs
[
cÚn_šdex
].
³”_id
 = 
PM_PEER_ID_INVALID
;

194 
m_cÚÃùiÚs
[
cÚn_šdex
].
³”_add»ss
 = *
p_bË_addr
;

197  
cÚn_šdex
;

198 
	}
}

210 
boŞ
 
	$is_v®id_œk
(
bË_g­_œk_t
 cÚ¡ * 
p_œk
)

212 
	`NRF_PM_DEBUG_CHECK
(
p_œk
 !ğ
NULL
);

214 
ušt32_t
 
i
 = 0; i < 
BLE_GAP_SEC_KEY_LEN
; i++)

216 ià(
p_œk
->
œk
[
i
] != 0)

218  
Œue
;

221  
çl£
;

222 
	}
}

235 
boŞ
 
	$addr_com·»
(
bË_g­_addr_t
 cÚ¡ * 
p_addr1
, bË_g­_addr_ˆcÚ¡ * 
p_addr2
)

238 ià((
p_addr1
 =ğ
NULL
è|| (
p_addr2
 == NULL))

240  
çl£
;

244 ià(
p_addr1
->
addr_ty³
 !ğ
p_addr2
->addr_type)

246  
çl£
;

250  (
	`memcmp
(
p_addr1
->
addr
, 
p_addr2
->addr, 
BLE_GAP_ADDR_LEN
) == 0);

251 
	}
}

254 
	$im_bË_evt_hªdËr
(
bË_evt_t
 cÚ¡ * 
bË_evt
)

256 
bË_g­_evt_t
 
g­_evt
;

257 
pm_³”_id_t
 
bÚded_m©chšg_³”_id
;

259 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

261 ià(
bË_evt
->
h—d”
.
evt_id
 !ğ
BLE_GAP_EVT_CONNECTED
)

267 
g­_evt
 = 
bË_evt
->
evt
.gap_evt;

268 
bÚded_m©chšg_³”_id
 = 
PM_PEER_ID_INVALID
;

270 iàĞ
g­_evt
.
·¿ms
.
cÚÃùed
.
³”_addr
.
addr_ty³


271 !ğ
BLE_GAP_ADDR_TYPE_RANDOM_PRIVATE_NON_RESOLVABLE
)

279 
pm_³”_id_t
 
³”_id
;

280 
pm_³”_d©a_æash_t
 
³”_d©a
;

282 
	`pds_³”_d©a_™”©e_´•¬e
();

284 
g­_evt
.
·¿ms
.
cÚÃùed
.
³”_addr
.
addr_ty³
)

286 
BLE_GAP_ADDR_TYPE_PUBLIC
:

287 
BLE_GAP_ADDR_TYPE_RANDOM_STATIC
:

289 
	`pds_³”_d©a_™”©e
(
PM_PEER_DATA_ID_BONDING
, &
³”_id
, &
³”_d©a
))

291 ià(
	`addr_com·»
(&
g­_evt
.
·¿ms
.
cÚÃùed
.
³”_addr
,

292 &
³”_d©a
.
p_bÚdšg_d©a
->
³”_bË_id
.
id_addr_šfo
))

294 
bÚded_m©chšg_³”_id
 = 
³”_id
;

301 
BLE_GAP_ADDR_TYPE_RANDOM_PRIVATE_RESOLVABLE
:

303 
	`pds_³”_d©a_™”©e
(
PM_PEER_DATA_ID_BONDING
, &
³”_id
, &
³”_d©a
))

305 ià(
	`im_add»ss_»sŞve
(&
g­_evt
.
·¿ms
.
cÚÃùed
.
³”_addr
,

306 &
³”_d©a
.
p_bÚdšg_d©a
->
³”_bË_id
.
id_šfo
))

308 
bÚded_m©chšg_³”_id
 = 
³”_id
;

316 
	`NRF_PM_DEBUG_CHECK
(
çl£
);

321 
ušt8_t
 
Ãw_šdex
 = 
	`Ãw_cÚÃùiÚ
(
g­_evt
.
cÚn_hªdË
,

322 &
g­_evt
.
·¿ms
.
cÚÃùed
.
³”_addr
);

323 
	`UNUSED_VARIABLE
(
Ãw_šdex
);

325 ià(
bÚded_m©chšg_³”_id
 !ğ
PM_PEER_ID_INVALID
)

327 
	`im_Ãw_³”_id
(
g­_evt
.
cÚn_hªdË
, 
bÚded_m©chšg_³”_id
);

330 
pm_evt_t
 
im_evt
;

331 
im_evt
.
cÚn_hªdË
 = 
g­_evt
.conn_handle;

332 
im_evt
.
³”_id
 = 
bÚded_m©chšg_³”_id
;

333 
im_evt
.
evt_id
 = 
PM_EVT_BONDED_PEER_CONNECTED
;

334 
	`evt_£nd
(&
im_evt
);

336 
	}
}

347 
boŞ
 
	$im_is_du¶iÿ‹_bÚdšg_d©a
(
pm_³”_d©a_bÚdšg_t
 cÚ¡ * 
p_bÚdšg_d©a1
,

348 
pm_³”_d©a_bÚdšg_t
 cÚ¡ * 
p_bÚdšg_d©a2
)

350 
	`NRF_PM_DEBUG_CHECK
(
p_bÚdšg_d©a1
 !ğ
NULL
);

351 
	`NRF_PM_DEBUG_CHECK
(
p_bÚdšg_d©a2
 !ğ
NULL
);

353 
bË_g­_addr_t
 cÚ¡ * 
p_addr1
 = &
p_bÚdšg_d©a1
->
³”_bË_id
.
id_addr_šfo
;

354 
bË_g­_addr_t
 cÚ¡ * 
p_addr2
 = &
p_bÚdšg_d©a2
->
³”_bË_id
.
id_addr_šfo
;

356 
boŞ
 
du¶iÿ‹_œk
 = ((
	`memcmp
(
p_bÚdšg_d©a1
->
³”_bË_id
.
id_šfo
.
œk
,

357 
p_bÚdšg_d©a2
->
³”_bË_id
.
id_šfo
.
œk
,

358 
BLE_GAP_SEC_KEY_LEN
) == 0)

359 && 
	`is_v®id_œk
(&
p_bÚdšg_d©a1
->
³”_bË_id
.
id_šfo
)

360 && 
	`is_v®id_œk
(&
p_bÚdšg_d©a2
->
³”_bË_id
.
id_šfo
));

362 
boŞ
 
du¶iÿ‹_addr
 = 
	`addr_com·»
(
p_addr1
, 
p_addr2
);

364 
boŞ
 
id_addrs
 = ((
p_addr1
->
addr_ty³
 !ğ
BLE_GAP_ADDR_TYPE_RANDOM_PRIVATE_RESOLVABLE
)

365 && (
p_addr1
->
addr_ty³
 !ğ
BLE_GAP_ADDR_TYPE_RANDOM_PRIVATE_NON_RESOLVABLE
)

366 && (
p_addr2
->
addr_ty³
 !ğ
BLE_GAP_ADDR_TYPE_RANDOM_PRIVATE_RESOLVABLE
)

367 && (
p_addr2
->
addr_ty³
 !ğ
BLE_GAP_ADDR_TYPE_RANDOM_PRIVATE_NON_RESOLVABLE
));

369  (
du¶iÿ‹_addr
 && 
id_addrs
è|| (
du¶iÿ‹_œk
 && !id_addrs);

370 
	}
}

373 
pm_³”_id_t
 
	$im_fšd_du¶iÿ‹_bÚdšg_d©a
(
pm_³”_d©a_bÚdšg_t
 cÚ¡ * 
p_bÚdšg_d©a
,

374 
pm_³”_id_t
 
³”_id_sk
)

376 
pm_³”_id_t
 
³”_id
;

377 
pm_³”_d©a_æash_t
 
³”_d©a_du¶iÿ‹
;

379 
	`NRF_PM_DEBUG_CHECK
(
p_bÚdšg_d©a
 !ğ
NULL
);

381 
	`pds_³”_d©a_™”©e_´•¬e
();

383 
	`pds_³”_d©a_™”©e
(
PM_PEER_DATA_ID_BONDING
, &
³”_id
, &
³”_d©a_du¶iÿ‹
))

385 iàĞ(
³”_id
 !ğ
³”_id_sk
)

386 && 
	`im_is_du¶iÿ‹_bÚdšg_d©a
(
p_bÚdšg_d©a
,

387 
³”_d©a_du¶iÿ‹
.
p_bÚdšg_d©a
))

389  
³”_id
;

392  
PM_PEER_ID_INVALID
;

393 
	}
}

396 
»t_code_t
 
	$im_š™
()

398 
	`NRF_PM_DEBUG_CHECK
(!
m_moduË_š™Ÿlized
);

400 
	`š‹º®_¡©e_»£t
();

402 
m_cÚn_¡©e_u£r_æag_id
 = 
	`bË_cÚn_¡©e_u£r_æag_acquœe
();

403 ià(
m_cÚn_¡©e_u£r_æag_id
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
)

405  
NRF_ERROR_INTERNAL
;

408 #ià(
NRF_SD_BLE_API_VERSION
 <= 2)

409 
»t_code_t
 
»t_code
 = 
	`sd_bË_g­_add»ss_g‘
(&
m_cu¼’t_id_addr
);

410 ià(
»t_code
 !ğ
NRF_SUCCESS
)

412  
NRF_ERROR_INTERNAL
;

416 
m_moduË_š™Ÿlized
 = 
Œue
;

418  
NRF_SUCCESS
;

419 
	}
}

422 
pm_³”_id_t
 
	$im_³”_id_g‘_by_cÚn_hªdË
(
ušt16_t
 
cÚn_hªdË
)

424 
ušt8_t
 
cÚn_šdex
;

426 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

428 
cÚn_šdex
 = 
	`g‘_cÚÃùiÚ_by_cÚn_hªdË
(
cÚn_hªdË
);

430 ià(
cÚn_šdex
 !ğ
IM_NO_INVALID_CONN_HANDLES
)

432  
m_cÚÃùiÚs
[
cÚn_šdex
].
³”_id
;

435  
PM_PEER_ID_INVALID
;

436 
	}
}

439 
»t_code_t
 
	$im_bË_addr_g‘
(
ušt16_t
 
cÚn_hªdË
, 
bË_g­_addr_t
 * 
p_bË_addr
)

441 
ušt8_t
 
cÚn_šdex
;

443 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

444 
	`NRF_PM_DEBUG_CHECK
(
p_bË_addr
 !ğ
NULL
);

446 
cÚn_šdex
 = 
	`g‘_cÚÃùiÚ_by_cÚn_hªdË
(
cÚn_hªdË
);

448 ià(
cÚn_šdex
 !ğ
IM_NO_INVALID_CONN_HANDLES
)

450 *
p_bË_addr
 = 
m_cÚÃùiÚs
[
cÚn_šdex
].
³”_add»ss
;

451  
NRF_SUCCESS
;

454  
NRF_ERROR_NOT_FOUND
;

455 
	}
}

458 
boŞ
 
	$im_ma¡”_ids_com·»
(
bË_g­_ma¡”_id_t
 cÚ¡ * 
p_ma¡”_id1
,

459 
bË_g­_ma¡”_id_t
 cÚ¡ * 
p_ma¡”_id2
)

461 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

462 
	`NRF_PM_DEBUG_CHECK
(
p_ma¡”_id1
 !ğ
NULL
);

463 
	`NRF_PM_DEBUG_CHECK
(
p_ma¡”_id2
 !ğ
NULL
);

465 ià(!
	`im_ma¡”_id_is_v®id
(
p_ma¡”_id1
))

467  
çl£
;

470 ià(
p_ma¡”_id1
->
ediv
 !ğ
p_ma¡”_id2
->ediv)

472  
çl£
;

475  (
	`memcmp
(
p_ma¡”_id1
->
¿nd
, 
p_ma¡”_id2
->¿nd, 
BLE_GAP_SEC_RAND_LEN
) == 0);

476 
	}
}

479 
pm_³”_id_t
 
	$im_³”_id_g‘_by_ma¡”_id
(
bË_g­_ma¡”_id_t
 cÚ¡ * 
p_ma¡”_id
)

481 
pm_³”_id_t
 
³”_id
;

482 
pm_³”_d©a_æash_t
 
³”_d©a
;

484 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

485 
	`NRF_PM_DEBUG_CHECK
(
p_ma¡”_id
 !ğ
NULL
);

487 
	`pds_³”_d©a_™”©e_´•¬e
();

490 
	`pds_³”_d©a_™”©e
(
PM_PEER_DATA_ID_BONDING
, &
³”_id
, &
³”_d©a
))

492 ià(
	`im_ma¡”_ids_com·»
(
p_ma¡”_id
, &
³”_d©a
.
p_bÚdšg_d©a
->
own_Ék
.
ma¡”_id
) ||

493 
	`im_ma¡”_ids_com·»
(
p_ma¡”_id
, &
³”_d©a
.
p_bÚdšg_d©a
->
³”_Ék
.
ma¡”_id
))

496  
³”_id
;

501  
PM_PEER_ID_INVALID
;

502 
	}
}

505 
ušt16_t
 
	$im_cÚn_hªdË_g‘
(
pm_³”_id_t
 
³”_id
)

507 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

509 
ušt32_t
 
i
 = 0; i < 
IM_MAX_CONN_HANDLES
; i++)

511 ià(
³”_id
 =ğ
m_cÚÃùiÚs
[
i
].peer_id)

513  
m_cÚÃùiÚs
[
i
].
cÚn_hªdË
;

516  
BLE_CONN_HANDLE_INVALID
;

517 
	}
}

520 
boŞ
 
	$im_ma¡”_id_is_v®id
(
bË_g­_ma¡”_id_t
 cÚ¡ * 
p_ma¡”_id
)

522 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

524 ià(
p_ma¡”_id
->
ediv
 != 0)

526  
Œue
;

529 
ušt32_t
 
i
 = 0; i < 
BLE_GAP_SEC_RAND_LEN
; i++)

531 ià(
p_ma¡”_id
->
¿nd
[
i
] != 0)

533  
Œue
;

536  
çl£
;

537 
	}
}

545 
	$³”_id_£t
(
ušt16_t
 
cÚn_hªdË
, 
pm_³”_id_t
 
³”_id
)

547 
ušt8_t
 
cÚn_šdex
 = 
	`g‘_cÚÃùiÚ_by_cÚn_hªdË
(
cÚn_hªdË
);

548 ià(
cÚn_šdex
 !ğ
IM_NO_INVALID_CONN_HANDLES
)

550 
m_cÚÃùiÚs
[
cÚn_šdex
].
³”_id
 =…eer_id;

552 
	}
}

555 
	$im_Ãw_³”_id
(
ušt16_t
 
cÚn_hªdË
, 
pm_³”_id_t
 
³”_id
)

557 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

559 
	`³”_id_£t
(
cÚn_hªdË
, 
³”_id
);

560 
	}
}

563 
»t_code_t
 
	$im_³”_ä“
(
pm_³”_id_t
 
³”_id
)

565 
ušt16_t
 
cÚn_hªdË
;

566 
»t_code_t
 
»t
;

568 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

570 
cÚn_hªdË
 = 
	`im_cÚn_hªdË_g‘
(
³”_id
);

571 
»t
 = 
	`pdb_³”_ä“
(
³”_id
);

573 ià((
cÚn_hªdË
 !ğ
BLE_CONN_HANDLE_INVALID
è&& (
»t
 =ğ
NRF_SUCCESS
))

575 
	`³”_id_£t
(
cÚn_hªdË
, 
PM_PEER_ID_INVALID
);

577  
»t
;

578 
	}
}

583 
»t_code_t
 
	$³”s_id_keys_g‘
(
pm_³”_id_t
 cÚ¡ * 
p_³”s
,

584 
ušt32_t
 
³”_út
,

585 
bË_g­_addr_t
 * 
p_g­_addrs
,

586 
ušt32_t
 * 
p_addr_út
,

587 
bË_g­_œk_t
 * 
p_g­_œks
,

588 
ušt32_t
 * 
p_œk_út
)

590 
»t_code_t
 
»t
;

592 
pm_³”_d©a_bÚdšg_t
 
bÚd_d©a
;

593 
pm_³”_d©a_t
 
³”_d©a
;

595 
ušt32_t
 cÚ¡ 
buf_size
 = (
bÚd_d©a
);

597 
boŞ
 
cİy_addrs
 = 
çl£
;

598 
boŞ
 
cİy_œks
 = 
çl£
;

600 
	`NRF_PM_DEBUG_CHECK
(
p_³”s
 !ğ
NULL
);

603 
	`NRF_PM_DEBUG_CHECK
((
p_g­_addrs
 !ğ
NULL
è|| (
p_g­_œks
 != NULL));

605 ià((
p_g­_addrs
 !ğ
NULL
è&& (
p_addr_út
 != NULL))

607 
	`NRF_PM_DEBUG_CHECK
((*
p_addr_út
è>ğ
³”_út
);

609 
cİy_addrs
 = 
Œue
;

610 *
p_addr_út
 = 0;

613 ià((
p_g­_œks
 !ğ
NULL
è&& (
p_œk_út
 != NULL))

615 
	`NRF_PM_DEBUG_CHECK
((*
p_œk_út
è>ğ
³”_út
);

617 
cİy_œks
 = 
Œue
;

618 *
p_œk_út
 = 0;

621 
	`mem£t
(&
³”_d©a
, 0x00, (peer_data));

622 
³”_d©a
.
p_bÚdšg_d©a
 = &
bÚd_d©a
;

626 
ušt32_t
 
i
 = 0; i < 
³”_út
; i++)

628 
	`mem£t
(&
bÚd_d©a
, 0x00, (bond_data));

631 
»t
 = 
	`pds_³”_d©a_»ad
(
p_³”s
[
i
], 
PM_PEER_DATA_ID_BONDING
,

632 &
³”_d©a
, &
buf_size
);

634 ià((
»t
 =ğ
NRF_ERROR_NOT_FOUND
è|| (»ˆ=ğ
NRF_ERROR_INVALID_PARAM
))

637  
NRF_ERROR_NOT_FOUND
;

640 
ušt8_t
 cÚ¡ 
addr_ty³
 = 
bÚd_d©a
.
³”_bË_id
.
id_addr_šfo
.addr_type;

642 ià((
addr_ty³
 !ğ
BLE_GAP_ADDR_TYPE_PUBLIC
) &&

643 (
addr_ty³
 !ğ
BLE_GAP_ADDR_TYPE_RANDOM_STATIC
))

646  
BLE_ERROR_GAP_INVALID_BLE_ADDR
;

650 ià(
cİy_addrs
)

652 
	`memıy
(&
p_g­_addrs
[
i
], &
bÚd_d©a
.
³”_bË_id
.
id_addr_šfo
, (
bË_g­_addr_t
));

653 (*
p_addr_út
)++;

657 ià(
cİy_œks
)

659 
	`memıy
(&
p_g­_œks
[
i
], 
bÚd_d©a
.
³”_bË_id
.
id_šfo
.
œk
, 
BLE_GAP_SEC_KEY_LEN
);

660 (*
p_œk_út
)++;

664  
NRF_SUCCESS
;

665 
	}
}

668 
»t_code_t
 
	$im_deviû_id’t™›s_li¡_£t
(
pm_³”_id_t
 cÚ¡ * 
p_³”s
,

669 
ušt32_t
 
³”_út
)

671 #ià(
NRF_SD_BLE_API_VERSION
 >= 3)

673 
»t_code_t
 
»t
;

674 
pm_³”_d©a_t
 
³”_d©a
;

675 
pm_³”_d©a_bÚdšg_t
 
bÚd_d©a
;

677 
bË_g­_id_key_t
 
keys
[
BLE_GAP_DEVICE_IDENTITIES_MAX_COUNT
];

678 
bË_g­_id_key_t
 cÚ¡ * 
key_±rs
[
BLE_GAP_DEVICE_IDENTITIES_MAX_COUNT
];

680 ià((
p_³”s
 =ğ
NULL
è|| (
³”_út
 == 0))

683  
	`sd_bË_g­_deviû_id’t™›s_£t
(
NULL
, NULL, 0);

686 
³”_d©a
.
p_bÚdšg_d©a
 = &
bÚd_d©a
;

687 
ušt32_t
 cÚ¡ 
buf_size
 = (
bÚd_d©a
);

689 
	`mem£t
(
keys
, 0x00, (keys));

690 
ušt32_t
 
i
 = 0; i < 
BLE_GAP_DEVICE_IDENTITIES_MAX_COUNT
; i++)

692 
key_±rs
[
i
] = &
keys
[i];

695 
ušt32_t
 
i
 = 0; i < 
³”_út
; i++)

697 
	`mem£t
(&
bÚd_d©a
, 0x00, (bond_data));

700 
»t
 = 
	`pds_³”_d©a_»ad
(
p_³”s
[
i
], 
PM_PEER_DATA_ID_BONDING
,

701 &
³”_d©a
, &
buf_size
);

703 ià((
»t
 =ğ
NRF_ERROR_NOT_FOUND
è|| (»ˆ=ğ
NRF_ERROR_INVALID_PARAM
))

706  
NRF_ERROR_NOT_FOUND
;

709 
ušt8_t
 cÚ¡ 
addr_ty³
 = 
bÚd_d©a
.
³”_bË_id
.
id_addr_šfo
.addr_type;

711 ià((
addr_ty³
 !ğ
BLE_GAP_ADDR_TYPE_PUBLIC
) &&

712 (
addr_ty³
 !ğ
BLE_GAP_ADDR_TYPE_RANDOM_STATIC
))

715  
BLE_ERROR_GAP_INVALID_BLE_ADDR
;

719 
	`memıy
(&
keys
[
i
], &
bÚd_d©a
.
³”_bË_id
, (
bË_g­_id_key_t
));

722  
	`sd_bË_g­_deviû_id’t™›s_£t
(
key_±rs
, 
NULL
, 
³”_út
);

726  
NRF_ERROR_NOT_SUPPORTED
;

729 
	}
}

732 #ià(
NRF_SD_BLE_API_VERSION
 <= 2)

734 
»t_code_t
 
	$add»ss_£t_v2
(
ušt8_t
 
cyşe_mode
, 
bË_g­_addr_t
 * 
p_addr
)

736 
	`NRF_PM_DEBUG_CHECK
(
p_addr
 !ğ
NULL
);

738 
»t_code_t
 
»t
 = 
	`sd_bË_g­_add»ss_£t
(
cyşe_mode
, 
p_addr
);

740 
»t
)

742 
NRF_SUCCESS
:

743 
NRF_ERROR_BUSY
:

744 
NRF_ERROR_INVALID_STATE
:

745 
NRF_ERROR_INVALID_PARAM
:

746 
BLE_ERROR_GAP_INVALID_BLE_ADDR
:

747  
»t
;

750  
NRF_ERROR_INTERNAL
;

752 
	}
}

757 
»t_code_t
 
	$im_id_addr_£t
(
bË_g­_addr_t
 cÚ¡ * 
p_addr
)

759 #ià(
NRF_SD_BLE_API_VERSION
 <= 2)

761 
»t_code_t
 
»t
;

762 
bË_g­_addr_t
 
cu¼’t_addr
;

764 
	`NRF_PM_DEBUG_CHECK
(
p_addr
 !ğ
NULL
);

766 (è
	`sd_bË_g­_add»ss_g‘
(&
cu¼’t_addr
);

768 
»t
 = 
	`add»ss_£t_v2
(
BLE_GAP_ADDR_CYCLE_MODE_NONE
, (
bË_g­_addr_t
 *)
p_addr
);

769 ià(
»t
 !ğ
NRF_SUCCESS
)

771  
»t
;

774 iàĞ
cu¼’t_addr
.
addr_ty³
 =ğ
BLE_GAP_ADDR_TYPE_RANDOM_PRIVATE_RESOLVABLE


775 || 
cu¼’t_addr
.
addr_ty³
 =ğ
BLE_GAP_ADDR_TYPE_RANDOM_PRIVATE_NON_RESOLVABLE
)

779 
»t
 = 
	`add»ss_£t_v2
(
BLE_GAP_ADDR_CYCLE_MODE_AUTO
, &
cu¼’t_addr
);

780 ià(
»t
 !ğ
NRF_SUCCESS
)

782  
»t
;

786 
	`memıy
(&
m_cu¼’t_id_addr
, 
p_addr
, (
bË_g­_addr_t
));

788  
NRF_SUCCESS
;

792  
	`sd_bË_g­_addr_£t
(
p_addr
);

795 
	}
}

798 
»t_code_t
 
	$im_id_addr_g‘
(
bË_g­_addr_t
 * 
p_addr
)

800 
	`NRF_PM_DEBUG_CHECK
(
p_addr
 !ğ
NULL
);

802 #ià(
NRF_SD_BLE_API_VERSION
 <= 2)

803 
	`memıy
(
p_addr
, &
m_cu¼’t_id_addr
, (
bË_g­_addr_t
));

804  
NRF_SUCCESS
;

806  
	`sd_bË_g­_addr_g‘
(
p_addr
);

808 
	}
}

811 
»t_code_t
 
	$im_´ivacy_£t
(
pm_´ivacy_·¿ms_t
 cÚ¡ * 
p_´ivacy_·¿ms
)

813 #ià(
NRF_SD_BLE_API_VERSION
 <= 2)

815 
»t_code_t
 
»t
;

816 
bË_g­_addr_t
 
´ivacy_addr
;

817 
bË_g­_œk_t
 
cu¼’t_œk
;

818 
bË_İt_t
 
´ivacy_İtiÚs
;

819 
bË_İt_t
 
cu¼’t_´ivacy_İtiÚs
;

821 
	`NRF_PM_DEBUG_CHECK
(
p_´ivacy_·¿ms
 !ğ
NULL
);

823 
´ivacy_addr
.
addr_ty³
 = 
p_´ivacy_·¿ms
->
´iv©e_addr_ty³
;

824 
´ivacy_İtiÚs
.
g­_İt
.
´ivacy
.
p_œk
 = 
p_´ivacy_·¿ms
->
p_deviû_œk
;

825 
´ivacy_İtiÚs
.
g­_İt
.
´ivacy
.
š‹rv®_s
 = 
p_´ivacy_·¿ms
->
´iv©e_addr_cyşe_s
;

826 
cu¼’t_´ivacy_İtiÚs
.
g­_İt
.
´ivacy
.
p_œk
 = &
cu¼’t_œk
;

829 (è
	`sd_bË_İt_g‘
(
BLE_GAP_OPT_PRIVACY
, &
cu¼’t_´ivacy_İtiÚs
);

830 (è
	`sd_bË_İt_£t
(
BLE_GAP_OPT_PRIVACY
, &
´ivacy_İtiÚs
);

832 ià(
p_´ivacy_·¿ms
->
´ivacy_mode
 =ğ
BLE_GAP_PRIVACY_MODE_OFF
)

834 
»t
 = 
	`add»ss_£t_v2
(
BLE_GAP_ADDR_CYCLE_MODE_NONE
, &
m_cu¼’t_id_addr
);

838 
»t
 = 
	`add»ss_£t_v2
(
BLE_GAP_ADDR_CYCLE_MODE_AUTO
, &
´ivacy_addr
);

841 ià(
»t
 !ğ
NRF_SUCCESS
)

844 (è
	`sd_bË_İt_£t
(
BLE_GAP_OPT_PRIVACY
, &
cu¼’t_´ivacy_İtiÚs
);

850  
»t
;

854  
	`sd_bË_g­_´ivacy_£t
(
p_´ivacy_·¿ms
);

857 
	}
}

860 
»t_code_t
 
	$im_´ivacy_g‘
(
pm_´ivacy_·¿ms_t
 * 
p_´ivacy_·¿ms
)

862 #ià(
NRF_SD_BLE_API_VERSION
 <= 2)

864 
bË_g­_addr_t
 
cur_addr
;

865 
bË_İt_t
 
cur_´ivacy_İt
;

867 
	`NRF_PM_DEBUG_CHECK
(
p_´ivacy_·¿ms
 !ğ
NULL
);

868 
	`NRF_PM_DEBUG_CHECK
(
p_´ivacy_·¿ms
->
p_deviû_œk
 !ğ
NULL
);

870 
cur_´ivacy_İt
.
g­_İt
.
´ivacy
.
p_œk
 = 
p_´ivacy_·¿ms
->
p_deviû_œk
;

873 (è
	`sd_bË_g­_add»ss_g‘
(&
cur_addr
);

875 iàĞ
cur_addr
.
addr_ty³
 =ğ
BLE_GAP_ADDR_TYPE_RANDOM_PRIVATE_RESOLVABLE


876 || 
cur_addr
.
addr_ty³
 =ğ
BLE_GAP_ADDR_TYPE_RANDOM_PRIVATE_NON_RESOLVABLE
)

878 
p_´ivacy_·¿ms
->
´ivacy_mode
 = 
BLE_GAP_PRIVACY_MODE_DEVICE_PRIVACY
;

879 
p_´ivacy_·¿ms
->
´iv©e_addr_ty³
 = 
cur_addr
.
addr_ty³
;

883 
p_´ivacy_·¿ms
->
´ivacy_mode
 = 
BLE_GAP_PRIVACY_MODE_OFF
;

887 (è
	`sd_bË_İt_g‘
(
BLE_GAP_OPT_PRIVACY
, &
cur_´ivacy_İt
);

889 
p_´ivacy_·¿ms
->
´iv©e_addr_cyşe_s
 = 
cur_´ivacy_İt
.
g­_İt
.
´ivacy
.
š‹rv®_s
;

891  
NRF_SUCCESS
;

895  
	`sd_bË_g­_´ivacy_g‘
(
p_´ivacy_·¿ms
);

898 
	}
}

904 
»t_code_t
 
	$im_wh™–i¡_g‘
(
bË_g­_addr_t
 * 
p_addrs
,

905 
ušt32_t
 * 
p_addr_út
,

906 
bË_g­_œk_t
 * 
p_œks
,

907 
ušt32_t
 * 
p_œk_út
)

910 
	`NRF_PM_DEBUG_CHECK
((
p_addrs
 !ğ
NULL
è|| (
p_œks
 != NULL));

911 
	`NRF_PM_DEBUG_CHECK
((
p_addr_út
 !ğ
NULL
è|| (
p_œk_út
 != NULL));

913 ià(((
p_addr_út
 !ğ
NULL
è&& (
m_wli¡ed_³”_út
 > *p_addr_cnt)) ||

914 ((
p_œk_út
 !ğ
NULL
è&& (
m_wli¡ed_³”_út
 > *p_irk_cnt)))

917  
NRF_ERROR_NO_MEM
;

923  
	`³”s_id_keys_g‘
(
m_wli¡ed_³”s
, 
m_wli¡ed_³”_út
,

924 
p_addrs
, 
p_addr_út
,

925 
p_œks
, 
p_œk_út
);

926 
	}
}

934 
»t_code_t
 
	$im_wh™–i¡_£t
(
pm_³”_id_t
 cÚ¡ * 
p_³”s
,

935 
ušt32_t
 
³”_út
)

938 
	`mem£t
(
m_wli¡ed_³”s
, 0x00, (m_wlisted_peers));

940 ià((
p_³”s
 =ğ
NULL
è|| (
³”_út
 == 0))

943 
m_wli¡ed_³”_út
 = 0;

944 #ià(
NRF_SD_BLE_API_VERSION
 >= 3)

947  
	`sd_bË_g­_wh™–i¡_£t
(
NULL
, 0);

950  
NRF_SUCCESS
;

957 
m_wli¡ed_³”_út
 = 
³”_út
;

958 
	`memıy
(
m_wli¡ed_³”s
, 
p_³”s
, (
pm_³”_id_t
è* 
³”_út
);

960 #ià(
NRF_SD_BLE_API_VERSION
 >= 3)

962 
»t_code_t
 
»t
;

963 
ušt32_t
 
wli¡_addr_út
 = 0;

965 
bË_g­_addr_t
 cÚ¡ * 
addr_±rs
[
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
];

966 
bË_g­_addr_t
 
addrs
[
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
];

968 
	`mem£t
(
addrs
, 0x00, (addrs));

971 
»t
 = 
	`³”s_id_keys_g‘
(
p_³”s
, 
³”_út
, 
addrs
, &
wli¡_addr_út
, 
NULL
, NULL);

973 ià(
»t
 !ğ
NRF_SUCCESS
)

977  
»t
;

980 
ušt32_t
 
i
 = 0; i < 
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
; i++)

982 
addr_±rs
[
i
] = &
addrs
[i];

987  
	`sd_bË_g­_wh™–i¡_£t
(
addr_±rs
, 
³”_út
);

991  
NRF_SUCCESS
;

994 
	}
}

1020 
	$ah
(
ušt8_t
 cÚ¡ * 
p_k
, ušt8_ˆcÚ¡ * 
p_r
, ušt8_ˆ* 
p_loÿl_hash
)

1022 
Äf_ecb_h®_d©a_t
 
ecb_h®_d©a
;

1024 
ušt32_t
 
i
 = 0; i < 
SOC_ECB_KEY_LENGTH
; i++)

1026 
ecb_h®_d©a
.
key
[
i
] = 
p_k
[
SOC_ECB_KEY_LENGTH
 - 1 - i];

1029 
	`mem£t
(
ecb_h®_d©a
.
ş—¹ext
, 0, 
SOC_ECB_KEY_LENGTH
 - 
IM_ADDR_CLEARTEXT_LENGTH
);

1031 
ušt32_t
 
i
 = 0; i < 
IM_ADDR_CLEARTEXT_LENGTH
; i++)

1033 
ecb_h®_d©a
.
ş—¹ext
[
SOC_ECB_KEY_LENGTH
 - 1 - 
i
] = 
p_r
[i];

1037 (è
	`sd_ecb_block_’üy±
(&
ecb_h®_d©a
);

1039 
ušt32_t
 
i
 = 0; i < 
IM_ADDR_CIPHERTEXT_LENGTH
; i++)

1041 
p_loÿl_hash
[
i
] = 
ecb_h®_d©a
.
ch”‹xt
[
SOC_ECB_KEY_LENGTH
 - 1 - i];

1043 
	}
}

1046 
boŞ
 
	$im_add»ss_»sŞve
(
bË_g­_addr_t
 cÚ¡ * 
p_addr
, 
bË_g­_œk_t
 cÚ¡ * 
p_œk
)

1048 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

1050 
ušt8_t
 
hash
[
IM_ADDR_CIPHERTEXT_LENGTH
];

1051 
ušt8_t
 
loÿl_hash
[
IM_ADDR_CIPHERTEXT_LENGTH
];

1052 
ušt8_t
 
´ªd
[
IM_ADDR_CLEARTEXT_LENGTH
];

1054 ià(
p_addr
->
addr_ty³
 !ğ
BLE_GAP_ADDR_TYPE_RANDOM_PRIVATE_RESOLVABLE
)

1056  
çl£
;

1059 
	`memıy
(
hash
, 
p_addr
->
addr
, 
IM_ADDR_CIPHERTEXT_LENGTH
);

1060 
	`memıy
(
´ªd
, &
p_addr
->
addr
[
IM_ADDR_CIPHERTEXT_LENGTH
], 
IM_ADDR_CLEARTEXT_LENGTH
);

1061 
	`ah
(
p_œk
->
œk
, 
´ªd
, 
loÿl_hash
);

1063  (
	`memcmp
(
hash
, 
loÿl_hash
, 
IM_ADDR_CIPHERTEXT_LENGTH
) == 0);

1064 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\peer_data_storage.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
PEER_MANAGER
)

42 
	~"³”_d©a_¡Üage.h
"

44 
	~<¡dšt.h
>

45 
	~<¡ršg.h
>

46 
	~"sdk_”rÜs.h
"

47 
	~"³”_mªag”_ty³s.h
"

48 
	~"³”_mªag”_š‹º®.h
"

49 
	~"³”_id.h
"

50 
	~"fds.h
"

54 
	#VERIFY_PEER_ID_IN_RANGE
(
id
è
	`VERIFY_FALSE
((id >ğ
PM_PEER_ID_N_AVAILABLE_IDS
), \

55 
NRF_ERROR_INVALID_PARAM
)

	)

58 
	#VERIFY_PEER_DATA_ID_IN_RANGE
(
id
è
	`VERIFY_TRUE
(
	`³”_d©a_id_is_v®id
(id), \

59 
NRF_ERROR_INVALID_PARAM
)

	)

62 
	#PDS_EVENT_HANDLERS_CNT
 ((
m_evt_hªdËrs
è/ (m_evt_hªdËrs[0]))

	)

66 
pdb_pds_evt_hªdËr
(
pm_evt_t
 *);

70 
pm_evt_hªdËr_š‹º®_t
 cÚ¡ 
	gm_evt_hªdËrs
[] =

72 
pdb_pds_evt_hªdËr
,

75 
boŞ
 
	gm_moduË_š™Ÿlized
 = 
çl£
;

76 
boŞ
 
	gm_³”_d–‘e_queued
 = 
çl£
;

77 
boŞ
 
	gm_³”_d–‘e_Úgošg
 = 
çl£
;

80 
fds_fšd_tok’_t
 
	gm_fds_áok
;

84 
	$pds_evt_£nd
(
pm_evt_t
 * 
p_ev’t
)

86 
p_ev’t
->
cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

88 
ušt32_t
 
i
 = 0; i < 
PDS_EVENT_HANDLERS_CNT
; i++)

90 
m_evt_hªdËrs
[
i
](
p_ev’t
);

92 
	}
}

96 
ušt16_t
 
	$³”_id_to_fe_id
(
pm_³”_id_t
 
³”_id
)

98  (
ušt16_t
)(
³”_id
 + 
PEER_ID_TO_FILE_ID
);

99 
	}
}

103 
pm_³”_id_t
 
	$fe_id_to_³”_id
(
ušt16_t
 
fe_id
)

105  (
pm_³”_id_t
)(
fe_id
 + 
FILE_ID_TO_PEER_ID
);

106 
	}
}

110 
ušt16_t
 
	$³”_d©a_id_to_»cÜd_key
(
pm_³”_d©a_id_t
 
³”_d©a_id
)

112  (
ušt16_t
)(
³”_d©a_id
 + 
DATA_ID_TO_RECORD_KEY
);

113 
	}
}

117 
pm_³”_d©a_id_t
 
	$»cÜd_key_to_³”_d©a_id
(
ušt16_t
 
»cÜd_key
)

119  (
pm_³”_d©a_id_t
)(
»cÜd_key
 + 
RECORD_KEY_TO_DATA_ID
);

120 
	}
}

124 
boŞ
 
	$fe_id_w™hš_pm_¿nge
(
ušt16_t
 
fe_id
)

126  ((
PDS_FIRST_RESERVED_FILE_ID
 <ğ
fe_id
)

127 && (
fe_id
 <ğ
PDS_LAST_RESERVED_FILE_ID
));

128 
	}
}

132 
boŞ
 
	$»cÜd_key_w™hš_pm_¿nge
(
ušt16_t
 
»cÜd_key
)

134  ((
PDS_FIRST_RESERVED_RECORD_KEY
 <ğ
»cÜd_key
)

135 && (
»cÜd_key
 <ğ
PDS_LAST_RESERVED_RECORD_KEY
));

136 
	}
}

139 
boŞ
 
	$³”_d©a_id_is_v®id
(
pm_³”_d©a_id_t
 
d©a_id
)

141  ((
d©a_id
 =ğ
PM_PEER_DATA_ID_BONDING
) ||

142 (
d©a_id
 =ğ
PM_PEER_DATA_ID_SERVICE_CHANGED_PENDING
) ||

143 (
d©a_id
 =ğ
PM_PEER_DATA_ID_GATT_LOCAL
) ||

144 (
d©a_id
 =ğ
PM_PEER_DATA_ID_GATT_REMOTE
) ||

145 (
d©a_id
 =ğ
PM_PEER_DATA_ID_PEER_RANK
) ||

146 (
d©a_id
 =ğ
PM_PEER_DATA_ID_APPLICATION
));

147 
	}
}

155 
	$£nd_uÃx³ùed_”rÜ
(
pm_³”_id_t
 
³”_id
, 
»t_code_t
 
”r_code
)

157 
pm_evt_t
 
”rÜ_evt
 =

159 .
evt_id
 = 
PM_EVT_ERROR_UNEXPECTED
,

160 .
³”_id
 =…eer_id,

161 .
·¿ms
 =

163 .
”rÜ_uÃx³ùed
 =

165 .
”rÜ
 = 
”r_code
,

169 
	`pds_evt_£nd
(&
”rÜ_evt
);

170 
	}
}

175 
	$³”_d©a_d–‘e
()

177 
»t_code_t
 
»t
;

178 
pm_³”_id_t
 
³”_id
;

179 
ušt16_t
 
fe_id
;

180 
fds_»cÜd_desc_t
 
desc
;

181 
fds_fšd_tok’_t
 
áok
;

183 
	`mem£t
(&
áok
, 0x00, (
fds_fšd_tok’_t
));

184 
³”_id
 = 
	`³”_id_g‘_Ãxt_d–‘ed
(
PM_PEER_ID_INVALID
);

186  (
³”_id
 !ğ
PM_PEER_ID_INVALID
)

187 && (
	`fds_»cÜd_fšd_š_fe
(
	`³”_id_to_fe_id
(
³”_id
), &
desc
, &
áok
)

188 =ğ
FDS_ERR_NOT_FOUND
))

190 
	`³”_id_ä“
(
³”_id
);

191 
³”_id
 = 
	`³”_id_g‘_Ãxt_d–‘ed
(peer_id);

194 ià(!
m_³”_d–‘e_Úgošg
 && (
³”_id
 !ğ
PM_PEER_ID_INVALID
))

196 
m_³”_d–‘e_Úgošg
 = 
Œue
;

198 
fe_id
 = 
	`³”_id_to_fe_id
(
³”_id
);

199 
»t
 = 
	`fds_fe_d–‘e
(
fe_id
);

201 ià(
»t
 =ğ
FDS_ERR_NO_SPACE_IN_QUEUES
)

203 
m_³”_d–‘e_queued
 = 
Œue
;

205 ià(
»t
 !ğ
NRF_SUCCESS
)

207 
m_³”_d–‘e_Úgošg
 = 
çl£
;

209 
	`£nd_uÃx³ùed_”rÜ
(
³”_id
, 
»t
);

212 
	}
}

215 
»t_code_t
 
	$³”_d©a_fšd
(
pm_³”_id_t
 
³”_id
,

216 
pm_³”_d©a_id_t
 
d©a_id
,

217 
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
)

219 
»t_code_t
 
»t
;

220 
fds_fšd_tok’_t
 
áok
;

222 
	`NRF_PM_DEBUG_CHECK
(
³”_id
 < 
PM_PEER_ID_N_AVAILABLE_IDS
);

223 
	`NRF_PM_DEBUG_CHECK
(
	`³”_d©a_id_is_v®id
(
d©a_id
));

224 
	`NRF_PM_DEBUG_CHECK
(
p_desc
 !ğ
NULL
);

226 
	`mem£t
(&
áok
, 0x00, (
fds_fšd_tok’_t
));

228 
ušt16_t
 
fe_id
 = 
	`³”_id_to_fe_id
(
³”_id
);

229 
ušt16_t
 
»cÜd_key
 = 
	`³”_d©a_id_to_»cÜd_key
(
d©a_id
);

231 
»t
 = 
	`fds_»cÜd_fšd
(
fe_id
, 
»cÜd_key
, 
p_desc
, &
áok
);

233 ià(
»t
 !ğ
FDS_SUCCESS
)

235  
NRF_ERROR_NOT_FOUND
;

238  
NRF_SUCCESS
;

239 
	}
}

242 
	$³”_ids_lßd
()

244 
fds_»cÜd_desc_t
 
»cÜd_desc
;

245 
fds_æash_»cÜd_t
 
»cÜd
;

246 
fds_fšd_tok’_t
 
áok
;

248 
	`mem£t
(&
áok
, 0x00, (
fds_fšd_tok’_t
));

250 
ušt16_t
 cÚ¡ 
»cÜd_key
 = 
	`³”_d©a_id_to_»cÜd_key
(
PM_PEER_DATA_ID_BONDING
);

252 
	`fds_»cÜd_fšd_by_key
(
»cÜd_key
, &
»cÜd_desc
, &
áok
è=ğ
FDS_SUCCESS
)

254 
pm_³”_id_t
 
³”_id
;

258 ()
	`fds_»cÜd_İ’
(&
»cÜd_desc
, &
»cÜd
);

259 
³”_id
 = 
	`fe_id_to_³”_id
(
»cÜd
.
p_h—d”
->
fe_id
);

260 ()
	`fds_»cÜd_şo£
(&
»cÜd_desc
);

262 ()
	`³”_id_®loÿ‹
(
³”_id
);

264 
	}
}

267 
	$fds_evt_hªdËr
(
fds_evt_t
 cÚ¡ * cÚ¡ 
p_fds_evt
)

269 
pm_evt_t
 
pds_evt
 =

271 .
³”_id
 = 
	`fe_id_to_³”_id
(
p_fds_evt
->
wr™e
.
fe_id
)

274 
p_fds_evt
->
id
)

276 
FDS_EVT_WRITE
:

277 
FDS_EVT_UPDATE
:

278 
FDS_EVT_DEL_RECORD
:

279 iàĞ
	`fe_id_w™hš_pm_¿nge
(
p_fds_evt
->
wr™e
.
fe_id
)

280 || 
	`»cÜd_key_w™hš_pm_¿nge
(
p_fds_evt
->
wr™e
.
»cÜd_key
))

282 
pds_evt
.
·¿ms
.
³”_d©a_upd©e_sucûeded
.
d©a_id


283 ğ
	`»cÜd_key_to_³”_d©a_id
(
p_fds_evt
->
wr™e
.
»cÜd_key
);

284 
pds_evt
.
·¿ms
.
³”_d©a_upd©e_sucûeded
.
aùiÚ


285 ğ(
p_fds_evt
->
id
 =ğ
FDS_EVT_DEL_RECORD
è? 
PM_PEER_DATA_OP_DELETE


286 : 
PM_PEER_DATA_OP_UPDATE
;

287 
pds_evt
.
·¿ms
.
³”_d©a_upd©e_sucûeded
.
tok’
 = 
p_fds_evt
->
wr™e
.
»cÜd_id
;

289 ià(
p_fds_evt
->
»suÉ
 =ğ
FDS_SUCCESS
)

291 
pds_evt
.
evt_id
 = 
PM_EVT_PEER_DATA_UPDATE_SUCCEEDED
;

292 
pds_evt
.
·¿ms
.
³”_d©a_upd©e_sucûeded
.
æash_chªged
 = 
Œue
;

296 
pds_evt
.
evt_id
 = 
PM_EVT_PEER_DATA_UPDATE_FAILED
;

297 
pds_evt
.
·¿ms
.
³”_d©a_upd©e_çed
.
”rÜ
 = 
p_fds_evt
->
»suÉ
;

300 
	`pds_evt_£nd
(&
pds_evt
);

304 
FDS_EVT_DEL_FILE
:

305 iàĞ
	`fe_id_w™hš_pm_¿nge
(
p_fds_evt
->
d–
.
fe_id
)

306 && (
p_fds_evt
->
d–
.
»cÜd_key
 =ğ
FDS_RECORD_KEY_DIRTY
))

308 ià(
p_fds_evt
->
»suÉ
 =ğ
FDS_SUCCESS
)

310 
pds_evt
.
evt_id
 = 
PM_EVT_PEER_DELETE_SUCCEEDED
;

311 
	`³”_id_ä“
(
pds_evt
.
³”_id
);

315 
pds_evt
.
evt_id
 = 
PM_EVT_PEER_DELETE_FAILED
;

318 
m_³”_d–‘e_queued
 = 
çl£
;

319 
m_³”_d–‘e_Úgošg
 = 
çl£
;

321 
	`³”_d©a_d–‘e
();

323 
	`pds_evt_£nd
(&
pds_evt
);

327 
FDS_EVT_GC
:

328 
pds_evt
.
evt_id
 = 
PM_EVT_FLASH_GARBAGE_COLLECTED
;

329 
pds_evt
.
³”_id
 = 
PM_PEER_ID_INVALID
;

331 
	`pds_evt_£nd
(&
pds_evt
);

339 ià(
m_³”_d–‘e_queued
)

341 
m_³”_d–‘e_queued
 = 
çl£
;

342 
	`³”_d©a_d–‘e
();

344 
	}
}

347 
»t_code_t
 
	$pds_š™
()

349 
»t_code_t
 
»t
;

352 
	`NRF_PM_DEBUG_CHECK
(!
m_moduË_š™Ÿlized
);

354 
»t
 = 
	`fds_»gi¡”
(
fds_evt_hªdËr
);

355 ià(
»t
 !ğ
NRF_SUCCESS
)

357  
NRF_ERROR_INTERNAL
;

360 
»t
 = 
	`fds_š™
();

361 ià(
»t
 !ğ
NRF_SUCCESS
)

363  
NRF_ERROR_STORAGE_FULL
;

366 
	`³”_id_š™
();

367 
	`³”_ids_lßd
();

369 
m_moduË_š™Ÿlized
 = 
Œue
;

371  
NRF_SUCCESS
;

372 
	}
}

375 
»t_code_t
 
	$pds_³”_d©a_»ad
(
pm_³”_id_t
 
³”_id
,

376 
pm_³”_d©a_id_t
 
d©a_id
,

377 
pm_³”_d©a_t
 * cÚ¡ 
p_d©a
,

378 
ušt32_t
 cÚ¡ * cÚ¡ 
p_buf_Ën
)

380 
»t_code_t
 
»t
;

381 
fds_»cÜd_desc_t
 
»c_desc
;

382 
fds_æash_»cÜd_t
 
»c_æash
;

384 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

385 
	`NRF_PM_DEBUG_CHECK
(
p_d©a
 !ğ
NULL
);

387 
	`VERIFY_PEER_ID_IN_RANGE
(
³”_id
);

388 
	`VERIFY_PEER_DATA_ID_IN_RANGE
(
d©a_id
);

390 
»t
 = 
	`³”_d©a_fšd
(
³”_id
, 
d©a_id
, &
»c_desc
);

392 ià(
»t
 !ğ
NRF_SUCCESS
)

394  
NRF_ERROR_NOT_FOUND
;

398 
»t
 = 
	`fds_»cÜd_İ’
(&
»c_desc
, &
»c_æash
);

400 ià(
»t
 !ğ
NRF_SUCCESS
)

402  
NRF_ERROR_NOT_FOUND
;

405 
p_d©a
->
d©a_id
 = data_id;

406 
p_d©a
->
Ëngth_wÜds
 = 
»c_æash
.
p_h—d”
->length_words;

410 ià(
p_buf_Ën
 =ğ
NULL
)

415 
p_d©a
->
p_®l_d©a
 = (*)
»c_æash
.p_data;

419 
ušt32_t
 cÚ¡ 
d©a_Ën_by‹s
 = (
p_d©a
->
Ëngth_wÜds
 * (uint32_t));

421 ià((*
p_buf_Ën
è>ğ
d©a_Ën_by‹s
)

423 
	`memıy
(
p_d©a
->
p_®l_d©a
, 
»c_æash
.p_d©a, 
d©a_Ën_by‹s
);

427  
NRF_ERROR_NO_MEM
;

432 ()
	`fds_»cÜd_şo£
(&
»c_desc
);

434  
NRF_SUCCESS
;

435 
	}
}

438 
	$pds_³”_d©a_™”©e_´•¬e
()

440 
	`mem£t
(&
m_fds_áok
, 0x00, (
fds_fšd_tok’_t
));

441 
	}
}

444 
boŞ
 
	$pds_³”_d©a_™”©e
(
pm_³”_d©a_id_t
 
d©a_id
,

445 
pm_³”_id_t
 * cÚ¡ 
p_³”_id
,

446 
pm_³”_d©a_æash_t
 * cÚ¡ 
p_d©a
)

448 
»t_code_t
 
»t
;

449 
ušt16_t
 
»c_key
;

450 
fds_»cÜd_desc_t
 
»c_desc
;

451 
fds_æash_»cÜd_t
 
»c_æash
;

453 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

454 
	`NRF_PM_DEBUG_CHECK
(
p_³”_id
 !ğ
NULL
);

455 
	`NRF_PM_DEBUG_CHECK
(
p_d©a
 !ğ
NULL
);

457 
	`VERIFY_PEER_DATA_ID_IN_RANGE
(
d©a_id
);

459 
»c_key
 = 
	`³”_d©a_id_to_»cÜd_key
(
d©a_id
);

461 ià(
	`fds_»cÜd_fšd_by_key
(
»c_key
, &
»c_desc
, &
m_fds_áok
è!ğ
NRF_SUCCESS
)

463  
çl£
;

466 
»t
 = 
	`fds_»cÜd_İ’
(&
»c_desc
, &
»c_æash
);

468 ià(
»t
 !ğ
NRF_SUCCESS
)

473  
çl£
;

476 
p_d©a
->
d©a_id
 = data_id;

477 
p_d©a
->
Ëngth_wÜds
 = 
»c_æash
.
p_h—d”
->length_words;

478 
p_d©a
->
p_®l_d©a
 = 
»c_æash
.p_data;

480 *
p_³”_id
 = 
	`fe_id_to_³”_id
(
»c_æash
.
p_h—d”
->
fe_id
);

482 ()
	`fds_»cÜd_şo£
(&
»c_desc
);

484  
Œue
;

485 
	}
}

488 
»t_code_t
 
	$pds_¥aû_»£rve
(
pm_³”_d©a_cÚ¡_t
 cÚ¡ * 
p_³”_d©a
,

489 
pm_´•¬e_tok’_t
 * 
p_´•¬e_tok’
)

491 
»t_code_t
 
»t
;

493 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

494 
	`NRF_PM_DEBUG_CHECK
(
p_³”_d©a
 !ğ
NULL
);

495 
	`NRF_PM_DEBUG_CHECK
(
p_´•¬e_tok’
 !ğ
NULL
);

497 
	`VERIFY_PEER_DATA_ID_IN_RANGE
(
p_³”_d©a
->
d©a_id
);

499 
»t
 = 
	`fds_»£rve
((
fds_»£rve_tok’_t
*)
p_´•¬e_tok’
, 
p_³”_d©a
->
Ëngth_wÜds
);

501 
»t
)

503 
FDS_SUCCESS
:

504  
NRF_SUCCESS
;

506 
FDS_ERR_RECORD_TOO_LARGE
:

507  
NRF_ERROR_INVALID_LENGTH
;

509 
FDS_ERR_NO_SPACE_IN_FLASH
:

510  
NRF_ERROR_STORAGE_FULL
;

513  
NRF_ERROR_INTERNAL
;

515 
	}
}

518 
»t_code_t
 
	$pds_¥aû_»£rve_ÿnûl
(
pm_´•¬e_tok’_t
 
´•¬e_tok’
)

520 
»t_code_t
 
»t
;

522 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

523 
	`NRF_PM_DEBUG_CHECK
(
´•¬e_tok’
 !ğ
PDS_PREPARE_TOKEN_INVALID
);

525 
»t
 = 
	`fds_»£rve_ÿnûl
((
fds_»£rve_tok’_t
*)&
´•¬e_tok’
);

527 ià(
»t
 !ğ
FDS_SUCCESS
)

529  
NRF_ERROR_INTERNAL
;

532  
NRF_SUCCESS
;

533 
	}
}

536 
»t_code_t
 
	$pds_³”_d©a_¡Üe
(
pm_³”_id_t
 
³”_id
,

537 
pm_³”_d©a_cÚ¡_t
 cÚ¡ * 
p_³”_d©a
,

538 
pm_´•¬e_tok’_t
 
´•¬e_tok’
,

539 
pm_¡Üe_tok’_t
 * 
p_¡Üe_tok’
)

541 
»t_code_t
 
»t
;

542 
fds_»cÜd_t
 
»c
;

543 
fds_»cÜd_desc_t
 
»c_desc
;

545 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

546 
	`NRF_PM_DEBUG_CHECK
(
p_³”_d©a
 !ğ
NULL
);

548 
	`VERIFY_PEER_ID_IN_RANGE
(
³”_id
);

549 
	`VERIFY_PEER_DATA_ID_IN_RANGE
(
p_³”_d©a
->
d©a_id
);

552 
»c
.
fe_id
 = 
	`³”_id_to_fe_id
(
³”_id
);

553 
»c
.
key
 = 
	`³”_d©a_id_to_»cÜd_key
(
p_³”_d©a
->
d©a_id
);

554 
»c
.
d©a
.
p_d©a
 = (*)
p_³”_d©a
->
p_®l_d©a
;

555 
»c
.
d©a
.
Ëngth_wÜds
 = 
p_³”_d©a
->length_words;

557 
»t
 = 
	`³”_d©a_fšd
(
³”_id
, 
p_³”_d©a
->
d©a_id
, &
»c_desc
);

559 ià(
»t
 =ğ
NRF_ERROR_NOT_FOUND
)

562 ià(
´•¬e_tok’
 =ğ
PDS_PREPARE_TOKEN_INVALID
)

565 
»t
 = 
	`fds_»cÜd_wr™e
(&
»c_desc
, &
»c
);

570 
»t
 = 
	`fds_»cÜd_wr™e_»£rved
(&
»c_desc
, &
»c
, (
fds_»£rve_tok’_t
*)&
´•¬e_tok’
);

575 ià(
´•¬e_tok’
 !ğ
PDS_PREPARE_TOKEN_INVALID
)

577 ()
	`fds_»£rve_ÿnûl
((
fds_»£rve_tok’_t
*)&
´•¬e_tok’
);

581 
»t
 = 
	`fds_»cÜd_upd©e
(&
»c_desc
, &
»c
);

584 
»t
)

586 
FDS_SUCCESS
:

587 ià(
p_¡Üe_tok’
 !ğ
NULL
)

590 ()
	`fds_»cÜd_id_äom_desc
(&
»c_desc
, (
ušt32_t
*)
p_¡Üe_tok’
);

592  
NRF_SUCCESS
;

594 
FDS_ERR_BUSY
:

595 
FDS_ERR_NO_SPACE_IN_QUEUES
:

596  
NRF_ERROR_BUSY
;

598 
FDS_ERR_NO_SPACE_IN_FLASH
:

599  
NRF_ERROR_STORAGE_FULL
;

602  
NRF_ERROR_INTERNAL
;

604 
	}
}

607 
»t_code_t
 
	$pds_³”_d©a_d–‘e
(
pm_³”_id_t
 
³”_id
, 
pm_³”_d©a_id_t
 
d©a_id
)

609 
»t_code_t
 
»t
;

610 
fds_»cÜd_desc_t
 
»cÜd_desc
;

612 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

614 
	`VERIFY_PEER_ID_IN_RANGE
(
³”_id
);

615 
	`VERIFY_PEER_DATA_ID_IN_RANGE
(
d©a_id
);

617 
»t
 = 
	`³”_d©a_fšd
(
³”_id
, 
d©a_id
, &
»cÜd_desc
);

619 ià(
»t
 !ğ
NRF_SUCCESS
)

621  
NRF_ERROR_NOT_FOUND
;

624 
»t
 = 
	`fds_»cÜd_d–‘e
(&
»cÜd_desc
);

626 
»t
)

628 
FDS_SUCCESS
:

629  
NRF_SUCCESS
;

631 
FDS_ERR_NO_SPACE_IN_QUEUES
:

632  
NRF_ERROR_BUSY
;

635  
NRF_ERROR_INTERNAL
;

637 
	}
}

640 
pm_³”_id_t
 
	$pds_³”_id_®loÿ‹
()

642 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

643  
	`³”_id_®loÿ‹
(
PM_PEER_ID_INVALID
);

644 
	}
}

647 
»t_code_t
 
	$pds_³”_id_ä“
(
pm_³”_id_t
 
³”_id
)

649 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

650 
	`VERIFY_PEER_ID_IN_RANGE
(
³”_id
);

652 ()
	`³”_id_d–‘e
(
³”_id
);

653 
	`³”_d©a_d–‘e
();

655  
NRF_SUCCESS
;

656 
	}
}

659 
boŞ
 
	$pds_³”_id_is_®loÿ‹d
(
pm_³”_id_t
 
³”_id
)

661 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

662  
	`³”_id_is_®loÿ‹d
(
³”_id
);

663 
	}
}

666 
pm_³”_id_t
 
	$pds_Ãxt_³”_id_g‘
(
pm_³”_id_t
 
´ev_³”_id
)

668 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

669  
	`³”_id_g‘_Ãxt_u£d
(
´ev_³”_id
);

670 
	}
}

673 
pm_³”_id_t
 
	$pds_Ãxt_d–‘ed_³”_id_g‘
(
pm_³”_id_t
 
´ev_³”_id
)

675 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

676  
	`³”_id_g‘_Ãxt_d–‘ed
(
´ev_³”_id
);

677 
	}
}

680 
ušt32_t
 
	$pds_³”_couÁ_g‘
()

682 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

683  
	`³”_id_n_ids
();

684 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\peer_database.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
PEER_MANAGER
)

42 
	~"³”_d©aba£.h
"

44 
	~<¡ršg.h
>

45 
	~"³”_mªag”_ty³s.h
"

46 
	~"³”_mªag”_š‹º®.h
"

47 
	~"³”_d©a_¡Üage.h
"

48 
	~"pm_bufãr.h
"

56 
	#VERIFY_DATA_ID_WRITE_BUF
(
d©a_id
) \

59 ià(((
d©a_id
è!ğ
PM_PEER_DATA_ID_BONDING
è&& ((d©a_idè!ğ
PM_PEER_DATA_ID_GATT_LOCAL
)) \

61  
NRF_ERROR_INVALID_PARAM
; \

63 } 0)

	)

67 
	#PDB_EVENT_HANDLERS_CNT
 ((
m_evt_hªdËrs
è/ (m_evt_hªdËrs[0]))

	)

71 
pm_pdb_evt_hªdËr
(
pm_evt_t
 * 
p_ev’t
);

72 
sm_pdb_evt_hªdËr
(
pm_evt_t
 * 
p_ev’t
);

73 
gscm_pdb_evt_hªdËr
(
pm_evt_t
 * 
p_ev’t
);

74 
gcm_pdb_evt_hªdËr
(
pm_evt_t
 * 
p_ev’t
);

78 
pm_evt_hªdËr_š‹º®_t
 cÚ¡ 
	gm_evt_hªdËrs
[] =

80 
pm_pdb_evt_hªdËr
,

81 
sm_pdb_evt_hªdËr
,

82 
gscm_pdb_evt_hªdËr
,

83 
gcm_pdb_evt_hªdËr
,

92 
pm_³”_id_t
 
	m³”_id
;

93 
pm_³”_d©a_id_t
 
	md©a_id
;

94 
pm_´•¬e_tok’_t
 
	m´•¬e_tok’
;

95 
pm_¡Üe_tok’_t
 
	m¡Üe_tok’
;

96 
ušt8_t
 
	mn_bufs
;

97 
ušt8_t
 
	mbufãr_block_id
;

98 
ušt8_t
 
	m¡Üe_æash_fuÎ
 : 1;

99 
ušt8_t
 
	m¡Üe_busy
 : 1;

100 } 
	tpdb_bufãr_»cÜd_t
;

103 
boŞ
 
	gm_moduË_š™Ÿlized
;

104 
pm_bufãr_t
 
	gm_wr™e_bufãr
;

105 
pdb_bufãr_»cÜd_t
 
	gm_wr™e_bufãr_»cÜds
[
PM_FLASH_BUFFERS
];

106 
ušt32_t
 
	gm_n_³ndšg_wr™es
;

114 
	$wr™e_bufãr_»cÜd_šv®id©e
(
pdb_bufãr_»cÜd_t
 * 
p_»cÜd
)

116 
p_»cÜd
->
³”_id
 = 
PM_PEER_ID_INVALID
;

117 
p_»cÜd
->
d©a_id
 = 
PM_PEER_DATA_ID_INVALID
;

118 
p_»cÜd
->
bufãr_block_id
 = 
PM_BUFFER_INVALID_ID
;

119 
p_»cÜd
->
¡Üe_busy
 = 
çl£
;

120 
p_»cÜd
->
¡Üe_æash_fuÎ
 = 
çl£
;

121 
p_»cÜd
->
n_bufs
 = 0;

122 
p_»cÜd
->
´•¬e_tok’
 = 
PDS_PREPARE_TOKEN_INVALID
;

123 
p_»cÜd
->
¡Üe_tok’
 = 
PM_STORE_TOKEN_INVALID
;

124 
	}
}

134 
pdb_bufãr_»cÜd_t
 * 
	$wr™e_bufãr_»cÜd_fšd_Ãxt
(
pm_³”_id_t
 
³”_id
, 
ušt32_t
 * 
p_šdex
)

136 
ušt32_t
 
i
 = *
p_šdex
; i < 
PM_FLASH_BUFFERS
; i++)

138 ià((
m_wr™e_bufãr_»cÜds
[
i
].
³”_id
 ==…eer_id))

140 *
p_šdex
 = 
i
;

141  &
m_wr™e_bufãr_»cÜds
[
i
];

144  
NULL
;

145 
	}
}

155 
pdb_bufãr_»cÜd_t
 * 
	$wr™e_bufãr_»cÜd_fšd
(
pm_³”_id_t
 
³”_id
,

156 
pm_³”_d©a_id_t
 
d©a_id
)

158 
ušt32_t
 
šdex
 = 0;

159 
pdb_bufãr_»cÜd_t
 * 
p_»cÜd
 = 
	`wr™e_bufãr_»cÜd_fšd_Ãxt
(
³”_id
, &
šdex
);

161 (
p_»cÜd
 !ğ
NULL
è&& ( (p_»cÜd->
d©a_id
 != data_id)

162 || (
p_»cÜd
->
¡Üe_busy
)

163 || (
p_»cÜd
->
¡Üe_æash_fuÎ
)

164 || (
p_»cÜd
->
¡Üe_tok’
 !ğ
PM_STORE_TOKEN_INVALID
)))

166 
šdex
++;

167 
p_»cÜd
 = 
	`wr™e_bufãr_»cÜd_fšd_Ãxt
(
³”_id
, &
šdex
);

170  
p_»cÜd
;

171 
	}
}

180 
pdb_bufãr_»cÜd_t
 * 
	$wr™e_bufãr_»cÜd_fšd_¡Üed
(
pm_¡Üe_tok’_t
 
¡Üe_tok’
)

182 
i
 = 0; i < 
PM_FLASH_BUFFERS
; i++)

184 ià(
m_wr™e_bufãr_»cÜds
[
i
].
¡Üe_tok’
 == store_token)

186  &
m_wr™e_bufãr_»cÜds
[
i
];

189  
NULL
;

190 
	}
}

197 
pdb_bufãr_»cÜd_t
 * 
	$wr™e_bufãr_»cÜd_fšd_unu£d
()

199  
	`wr™e_bufãr_»cÜd_fšd
(
PM_PEER_ID_INVALID
, 
PM_PEER_DATA_ID_INVALID
);

200 
	}
}

211 
	$wr™e_bufãr_»cÜd_»Ëa£
(
pdb_bufãr_»cÜd_t
 * 
p_wr™e_bufãr_»cÜd
)

213 
ušt32_t
 
i
 = 0; i < 
p_wr™e_bufãr_»cÜd
->
n_bufs
; i++)

215 
	`pm_bufãr_»Ëa£
(&
m_wr™e_bufãr
, 
p_wr™e_bufãr_»cÜd
->
bufãr_block_id
 + 
i
);

218 
	`wr™e_bufãr_»cÜd_šv®id©e
(
p_wr™e_bufãr_»cÜd
);

219 
	}
}

228 
	$wr™e_bufãr_»cÜd_acquœe
(
pdb_bufãr_»cÜd_t
 ** 
µ_wr™e_bufãr_»cÜd
,

229 
pm_³”_id_t
 
³”_id
,

230 
pm_³”_d©a_id_t
 
d©a_id
)

232 ià(
µ_wr™e_bufãr_»cÜd
 =ğ
NULL
)

236 *
µ_wr™e_bufãr_»cÜd
 = 
	`wr™e_bufãr_»cÜd_fšd_unu£d
();

237 ià(*
µ_wr™e_bufãr_»cÜd
 =ğ
NULL
)

242 (*
µ_wr™e_bufãr_»cÜd
)->
³”_id
 =…eer_id;

243 (*
µ_wr™e_bufãr_»cÜd
)->
d©a_id
 = data_id;

244 
	}
}

251 
	$pdb_evt_£nd
(
pm_evt_t
 * 
p_ev’t
)

253 
ušt32_t
 
i
 = 0; i < 
PDB_EVENT_HANDLERS_CNT
; i++)

255 
m_evt_hªdËrs
[
i
](
p_ev’t
);

257 
	}
}

264 
	$š‹º®_¡©e_»£t
()

266 
ušt32_t
 
i
 = 0; i < 
PM_FLASH_BUFFERS
; i++)

268 
	`wr™e_bufãr_»cÜd_šv®id©e
(&
m_wr™e_bufãr_»cÜds
[
i
]);

270 
	}
}

273 
	$³”_d©a_pošt_to_bufãr
(
pm_³”_d©a_t
 * 
p_³”_d©a
, 
pm_³”_d©a_id_t
 
d©a_id
, 
ušt8_t
 * 
p_bufãr_memÜy
, 
ušt16_t
 
n_bufs
)

275 
ušt16_t
 
n_by‹s
 = 
n_bufs
 * 
PDB_WRITE_BUF_SIZE
;

276 
p_³”_d©a
->
d©a_id
 = data_id;

278 
p_³”_d©a
->
p_®l_d©a
 = (
pm_³”_d©a_bÚdšg_t
 *)
p_bufãr_memÜy
;

279 
p_³”_d©a
->
Ëngth_wÜds
 = 
	`BYTES_TO_WORDS
(
n_by‹s
);

280 
	}
}

283 
	$³”_d©a_cÚ¡_pošt_to_bufãr
(
pm_³”_d©a_cÚ¡_t
 * 
p_³”_d©a
, 
pm_³”_d©a_id_t
 
d©a_id
, 
ušt8_t
 * 
p_bufãr_memÜy
, 
ušt32_t
 
n_bufs
)

285 
	`³”_d©a_pošt_to_bufãr
((
pm_³”_d©a_t
*)
p_³”_d©a
, 
d©a_id
, 
p_bufãr_memÜy
, 
n_bufs
);

286 
	}
}

289 
	$wr™e_buf_Ëngth_wÜds_£t
(
pm_³”_d©a_cÚ¡_t
 * 
p_³”_d©a
)

291 
p_³”_d©a
->
d©a_id
)

293 
PM_PEER_DATA_ID_BONDING
:

294 
p_³”_d©a
->
Ëngth_wÜds
 = 
	`PM_BONDING_DATA_N_WORDS
();

296 
PM_PEER_DATA_ID_SERVICE_CHANGED_PENDING
:

297 
p_³”_d©a
->
Ëngth_wÜds
 = 
	`PM_SC_STATE_N_WORDS
();

299 
PM_PEER_DATA_ID_PEER_RANK
:

300 
p_³”_d©a
->
Ëngth_wÜds
 = 
	`PM_USAGE_INDEX_N_WORDS
();

302 
PM_PEER_DATA_ID_GATT_LOCAL
:

303 
p_³”_d©a
->
Ëngth_wÜds
 = 
	`PM_LOCAL_DB_N_WORDS
Õ_³”_d©a->
p_loÿl_g©t_db
->
Ën
);

309 
	}
}

327 
»t_code_t
 
	$wr™e_buf_¡Üe
(
pdb_bufãr_»cÜd_t
 * 
p_wr™e_bufãr_»cÜd
)

329 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

330 
pm_³”_d©a_cÚ¡_t
 
³”_d©a
 = {.
d©a_id
 = 
p_wr™e_bufãr_»cÜd
->data_id};

331 
ušt8_t
 * 
p_bufãr_memÜy
;

333 
p_bufãr_memÜy
 = 
	`pm_bufãr_±r_g‘
(&
m_wr™e_bufãr
, 
p_wr™e_bufãr_»cÜd
->
bufãr_block_id
);

334 ià(
p_bufãr_memÜy
 =ğ
NULL
)

336  
NRF_ERROR_INTERNAL
;

339 
	`³”_d©a_cÚ¡_pošt_to_bufãr
(&
³”_d©a
,

340 
p_wr™e_bufãr_»cÜd
->
d©a_id
,

341 
p_bufãr_memÜy
,

342 
p_wr™e_bufãr_»cÜd
->
n_bufs
);

343 
	`wr™e_buf_Ëngth_wÜds_£t
(&
³”_d©a
);

345 
”r_code
 = 
	`pds_³”_d©a_¡Üe
(
p_wr™e_bufãr_»cÜd
->
³”_id
,

346 &
³”_d©a
,

347 
p_wr™e_bufãr_»cÜd
->
´•¬e_tok’
,

348 &
p_wr™e_bufãr_»cÜd
->
¡Üe_tok’
);

350 ià(
p_wr™e_bufãr_»cÜd
->
¡Üe_busy
 &&…_wr™e_bufãr_»cÜd->
¡Üe_æash_fuÎ
)

352 
m_n_³ndšg_wr™es
--;

355 
”r_code
)

357 
NRF_SUCCESS
:

358 
p_wr™e_bufãr_»cÜd
->
¡Üe_busy
 = 
çl£
;

359 
p_wr™e_bufãr_»cÜd
->
¡Üe_æash_fuÎ
 = 
çl£
;

362 
NRF_ERROR_BUSY
:

363 
m_n_³ndšg_wr™es
++;

365 
p_wr™e_bufãr_»cÜd
->
¡Üe_busy
 = 
Œue
;

366 
p_wr™e_bufãr_»cÜd
->
¡Üe_æash_fuÎ
 = 
çl£
;

368 
”r_code
 = 
NRF_SUCCESS
;

371 
NRF_ERROR_STORAGE_FULL
:

372 
m_n_³ndšg_wr™es
++;

374 
p_wr™e_bufãr_»cÜd
->
¡Üe_busy
 = 
çl£
;

375 
p_wr™e_bufãr_»cÜd
->
¡Üe_æash_fuÎ
 = 
Œue
;

378 
NRF_ERROR_INVALID_PARAM
:

383 
”r_code
 = 
NRF_ERROR_INTERNAL
;

387  
”r_code
;

388 
	}
}

397 
boŞ
 
	$wr™e_buf_¡Üe_š_ev’t
(
pdb_bufãr_»cÜd_t
 * 
p_wr™e_bufãr_»cÜd
)

399 
»t_code_t
 
”r_code
;

400 
pm_evt_t
 
ev’t
;

402 
”r_code
 = 
	`wr™e_buf_¡Üe
(
p_wr™e_bufãr_»cÜd
);

403 ià(
”r_code
 !ğ
NRF_SUCCESS
)

405 
ev’t
.
cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

406 
ev’t
.
³”_id
 = 
p_wr™e_bufãr_»cÜd
->peer_id;

408 ià(
”r_code
 =ğ
NRF_ERROR_STORAGE_FULL
)

410 
ev’t
.
evt_id
 = 
PM_EVT_STORAGE_FULL
;

414 
ev’t
.
evt_id
 = 
PM_EVT_ERROR_UNEXPECTED
;

415 
ev’t
.
·¿ms
.
”rÜ_uÃx³ùed
.
”rÜ
 = 
”r_code
;

418 
	`pdb_evt_£nd
(&
ev’t
);

420  
çl£
;

423  
Œue
;

424 
	}
}

433 
	$»©‹m±_´evious_İ”©iÚs
(
boŞ
 
»Œy_æash_fuÎ
)

437 ià(
m_n_³ndšg_wr™es
 == 0)

442 
ušt32_t
 
i
 = 0; i < 
PM_FLASH_BUFFERS
; i++)

444 ià((
m_wr™e_bufãr_»cÜds
[
i
].
¡Üe_busy
)

445 || (
m_wr™e_bufãr_»cÜds
[
i
].
¡Üe_æash_fuÎ
 && 
»Œy_æash_fuÎ
))

447 
boŞ
 
sucûss
 = 
	`wr™e_buf_¡Üe_š_ev’t
(&
m_wr™e_bufãr_»cÜds
[
i
]);

449 ià(!
sucûss
)

455 
	}
}

463 
	$pdb_pds_evt_hªdËr
(
pm_evt_t
 * 
p_ev’t
)

465 
pdb_bufãr_»cÜd_t
 * 
p_wr™e_bufãr_»cÜd
;

466 
boŞ
 
evt_£nd
 = 
Œue
;

467 
boŞ
 
»Œy_æash_fuÎ
 = 
çl£
;

469 
p_wr™e_bufãr_»cÜd
 = 
	`wr™e_bufãr_»cÜd_fšd_¡Üed
(
p_ev’t
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
tok’
);

471 
p_ev’t
->
evt_id
)

473 
PM_EVT_PEER_DATA_UPDATE_SUCCEEDED
:

474 iàĞ(
p_ev’t
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
aùiÚ
 =ğ
PM_PEER_DATA_OP_UPDATE
)

475 && (
p_wr™e_bufãr_»cÜd
 !ğ
NULL
))

478 
	`wr™e_bufãr_»cÜd_»Ëa£
(
p_wr™e_bufãr_»cÜd
);

482 
PM_EVT_PEER_DATA_UPDATE_FAILED
:

483 iàĞ(
p_ev’t
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
aùiÚ
 =ğ
PM_PEER_DATA_OP_UPDATE
)

484 && (
p_wr™e_bufãr_»cÜd
 !ğ
NULL
))

487 
m_n_³ndšg_wr™es
++;

488 
p_wr™e_bufãr_»cÜd
->
¡Üe_tok’
 = 
PM_STORE_TOKEN_INVALID
;

489 
p_wr™e_bufãr_»cÜd
->
¡Üe_busy
 = 
Œue
;

490 
evt_£nd
 = 
çl£
;

494 
PM_EVT_FLASH_GARBAGE_COLLECTED
:

495 
»Œy_æash_fuÎ
 = 
Œue
;

502 ià(
evt_£nd
)

505 
	`pdb_evt_£nd
(
p_ev’t
);

508 
	`»©‹m±_´evious_İ”©iÚs
(
»Œy_æash_fuÎ
);

509 
	}
}

512 
»t_code_t
 
	$pdb_š™
()

514 
»t_code_t
 
»t
;

516 
	`NRF_PM_DEBUG_CHECK
(!
m_moduË_š™Ÿlized
);

518 
	`š‹º®_¡©e_»£t
();

520 
	`PM_BUFFER_INIT
(&
m_wr™e_bufãr
, 
PM_FLASH_BUFFERS
, 
PDB_WRITE_BUF_SIZE
, 
»t
);

522 ià(
»t
 !ğ
NRF_SUCCESS
)

524  
NRF_ERROR_INTERNAL
;

527 
m_moduË_š™Ÿlized
 = 
Œue
;

529  
NRF_SUCCESS
;

530 
	}
}

533 
pm_³”_id_t
 
	$pdb_³”_®loÿ‹
()

535 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

536  
	`pds_³”_id_®loÿ‹
();

537 
	}
}

540 
»t_code_t
 
	$pdb_³”_ä“
(
pm_³”_id_t
 
³”_id
)

542 
»t_code_t
 
”r_code_š
 = 
NRF_SUCCESS
;

543 
»t_code_t
 
”r_code_out
 = 
NRF_SUCCESS
;

545 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

547 
ušt32_t
 
šdex
 = 0;

548 
pdb_bufãr_»cÜd_t
 * 
p_»cÜd
 = 
	`wr™e_bufãr_»cÜd_fšd_Ãxt
(
³”_id
, &
šdex
);

550 
p_»cÜd
 !ğ
NULL
)

552 
”r_code_š
 = 
	`pdb_wr™e_buf_»Ëa£
(
³”_id
, 
p_»cÜd
->
d©a_id
);

554 iàĞ(
”r_code_š
 !ğ
NRF_SUCCESS
)

555 && (
”r_code_š
 !ğ
NRF_ERROR_NOT_FOUND
))

557 
”r_code_out
 = 
NRF_ERROR_INTERNAL
;

560 
šdex
++;

561 
p_»cÜd
 = 
	`wr™e_bufãr_»cÜd_fšd_Ãxt
(
³”_id
, &
šdex
);

564 ià(
”r_code_out
 =ğ
NRF_SUCCESS
)

566 
”r_code_š
 = 
	`pds_³”_id_ä“
(
³”_id
);

568 ià(
”r_code_š
 =ğ
NRF_SUCCESS
)

572 ià(
”r_code_š
 =ğ
NRF_ERROR_INVALID_PARAM
)

574 
”r_code_out
 = 
NRF_ERROR_INVALID_PARAM
;

578 
”r_code_out
 = 
NRF_ERROR_INTERNAL
;

582  
”r_code_out
;

583 
	}
}

586 
»t_code_t
 
	$pdb_³”_d©a_±r_g‘
(
pm_³”_id_t
 
³”_id
,

587 
pm_³”_d©a_id_t
 
d©a_id
,

588 
pm_³”_d©a_æash_t
 * cÚ¡ 
p_³”_d©a
)

590 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

591 
	`NRF_PM_DEBUG_CHECK
(
p_³”_d©a
 !ğ
NULL
);

594  
	`pds_³”_d©a_»ad
(
³”_id
, 
d©a_id
, (
pm_³”_d©a_t
*)
p_³”_d©a
, 
NULL
);

595 
	}
}

599 
»t_code_t
 
	$pdb_wr™e_buf_g‘
(
pm_³”_id_t
 
³”_id
,

600 
pm_³”_d©a_id_t
 
d©a_id
,

601 
ušt32_t
 
n_bufs
,

602 
pm_³”_d©a_t
 * 
p_³”_d©a
)

604 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

606 
	`VERIFY_PARAM_NOT_NULL
(
p_³”_d©a
);

607 
	`VERIFY_DATA_ID_WRITE_BUF
(
d©a_id
);

609 iàĞ(
n_bufs
 == 0)

610 || (
n_bufs
 > 
PM_FLASH_BUFFERS
)

611 || !
	`pds_³”_id_is_®loÿ‹d
(
³”_id
))

613  
NRF_ERROR_INVALID_PARAM
;

616 
pdb_bufãr_»cÜd_t
 * 
p_wr™e_bufãr_»cÜd
;

617 
ušt8_t
 * 
p_bufãr_memÜy
;

618 
boŞ
 
Ãw_»cÜd
 = 
çl£
;

619 
boŞ
 
fšd_Ãw_bufãr
 = 
çl£
;

621 
p_wr™e_bufãr_»cÜd
 = 
	`wr™e_bufãr_»cÜd_fšd
(
³”_id
, 
d©a_id
);

623 ià(
p_wr™e_bufãr_»cÜd
 =ğ
NULL
)

625 
fšd_Ãw_bufãr
 = 
Œue
;

627 ià(
p_wr™e_bufãr_»cÜd
->
n_bufs
 <‚_bufs)

631 
ušt8_t
 
i
 = 0; i < 
p_wr™e_bufãr_»cÜd
->
n_bufs
; i++)

633 
	`pm_bufãr_»Ëa£
(&
m_wr™e_bufãr
, 
p_wr™e_bufãr_»cÜd
->
bufãr_block_id
 + 
i
);

635 
	`wr™e_bufãr_»cÜd_šv®id©e
(
p_wr™e_bufãr_»cÜd
);

636 
fšd_Ãw_bufãr
 = 
Œue
;

638 ià(
p_wr™e_bufãr_»cÜd
->
n_bufs
 >‚_bufs)

641 
ušt8_t
 
i
 = 
n_bufs
; i < 
p_wr™e_bufãr_»cÜd
->n_bufs; i++)

643 
	`pm_bufãr_»Ëa£
(&
m_wr™e_bufãr
, 
p_wr™e_bufãr_»cÜd
->
bufãr_block_id
 + 
i
);

651 ià(
fšd_Ãw_bufãr
)

654 
	`wr™e_bufãr_»cÜd_acquœe
(&
p_wr™e_bufãr_»cÜd
, 
³”_id
, 
d©a_id
);

655 ià(
p_wr™e_bufãr_»cÜd
 =ğ
NULL
)

657  
NRF_ERROR_BUSY
;

661 ià(
p_wr™e_bufãr_»cÜd
->
bufãr_block_id
 =ğ
PM_BUFFER_INVALID_ID
)

663 
p_wr™e_bufãr_»cÜd
->
bufãr_block_id
 = 
	`pm_bufãr_block_acquœe
(&
m_wr™e_bufãr
, 
n_bufs
);

665 ià(
p_wr™e_bufãr_»cÜd
->
bufãr_block_id
 =ğ
PM_BUFFER_INVALID_ID
)

667 
	`wr™e_bufãr_»cÜd_šv®id©e
(
p_wr™e_bufãr_»cÜd
);

668  
NRF_ERROR_BUSY
;

671 
Ãw_»cÜd
 = 
Œue
;

674 
p_wr™e_bufãr_»cÜd
->
n_bufs
 =‚_bufs;

676 
p_bufãr_memÜy
 = 
	`pm_bufãr_±r_g‘
(&
m_wr™e_bufãr
, 
p_wr™e_bufãr_»cÜd
->
bufãr_block_id
);

678 ià(
p_bufãr_memÜy
 =ğ
NULL
)

680  
NRF_ERROR_INTERNAL
;

683 
	`³”_d©a_pošt_to_bufãr
(
p_³”_d©a
, 
d©a_id
, 
p_bufãr_memÜy
, 
n_bufs
);

684 ià(
Ãw_»cÜd
 && (
d©a_id
 =ğ
PM_PEER_DATA_ID_GATT_LOCAL
))

686 
p_³”_d©a
->
p_loÿl_g©t_db
->
Ën
 = 
	`PM_LOCAL_DB_LEN
Õ_³”_d©a->
Ëngth_wÜds
);

689  
NRF_SUCCESS
;

690 
	}
}

693 
»t_code_t
 
	$pdb_wr™e_buf_»Ëa£
(
pm_³”_id_t
 
³”_id
, 
pm_³”_d©a_id_t
 
d©a_id
)

695 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

697 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

698 
pdb_bufãr_»cÜd_t
 * 
p_wr™e_bufãr_»cÜd
;

699 
p_wr™e_bufãr_»cÜd
 = 
	`wr™e_bufãr_»cÜd_fšd
(
³”_id
, 
d©a_id
);

701 ià(
p_wr™e_bufãr_»cÜd
 =ğ
NULL
)

703  
NRF_ERROR_NOT_FOUND
;

706 ià(
p_wr™e_bufãr_»cÜd
->
´•¬e_tok’
 !ğ
PDS_PREPARE_TOKEN_INVALID
)

708 
”r_code
 = 
	`pds_¥aû_»£rve_ÿnûl
(
p_wr™e_bufãr_»cÜd
->
´•¬e_tok’
);

709 ià(
”r_code
 !ğ
NRF_SUCCESS
)

711 
”r_code
 = 
NRF_ERROR_INTERNAL
;

715 
	`wr™e_bufãr_»cÜd_»Ëa£
(
p_wr™e_bufãr_»cÜd
);

717  
”r_code
;

718 
	}
}

721 
»t_code_t
 
	$pdb_wr™e_buf_¡Üe_´•¬e
(
pm_³”_id_t
 
³”_id
, 
pm_³”_d©a_id_t
 
d©a_id
)

723 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

725 
	`VERIFY_DATA_ID_WRITE_BUF
(
d©a_id
);

727 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

728 
pdb_bufãr_»cÜd_t
 * 
p_wr™e_bufãr_»cÜd
;

729 
p_wr™e_bufãr_»cÜd
 = 
	`wr™e_bufãr_»cÜd_fšd
(
³”_id
, 
d©a_id
);

731 ià(
p_wr™e_bufãr_»cÜd
 =ğ
NULL
)

733  
NRF_ERROR_NOT_FOUND
;

736 ià(
p_wr™e_bufãr_»cÜd
->
´•¬e_tok’
 =ğ
PDS_PREPARE_TOKEN_INVALID
)

738 
ušt8_t
 * 
p_bufãr_memÜy
 = 
	`pm_bufãr_±r_g‘
(&
m_wr™e_bufãr
,

739 
p_wr™e_bufãr_»cÜd
->
bufãr_block_id
);

740 
pm_³”_d©a_cÚ¡_t
 
³”_d©a
 = {.
d©a_id
 = data_id};

742 ià(
p_bufãr_memÜy
 =ğ
NULL
)

744  
NRF_ERROR_INTERNAL
;

747 
	`³”_d©a_cÚ¡_pošt_to_bufãr
(&
³”_d©a
, 
d©a_id
, 
p_bufãr_memÜy
, 
p_wr™e_bufãr_»cÜd
->
n_bufs
);

749 
	`wr™e_buf_Ëngth_wÜds_£t
(&
³”_d©a
);

751 
”r_code
 = 
	`pds_¥aû_»£rve
(&
³”_d©a
, &
p_wr™e_bufãr_»cÜd
->
´•¬e_tok’
);

752 ià(
”r_code
 =ğ
NRF_ERROR_INVALID_LENGTH
)

754  
NRF_ERROR_INTERNAL
;

758  
”r_code
;

759 
	}
}

762 
»t_code_t
 
	$pdb_wr™e_buf_¡Üe
(
pm_³”_id_t
 
³”_id
,

763 
pm_³”_d©a_id_t
 
d©a_id
,

764 
pm_³”_id_t
 
Ãw_³”_id
)

766 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

768 
	`VERIFY_DATA_ID_WRITE_BUF
(
d©a_id
);

770 
pdb_bufãr_»cÜd_t
 * 
p_wr™e_bufãr_»cÜd
 = 
	`wr™e_bufãr_»cÜd_fšd
(
³”_id
, 
d©a_id
);

772 ià(
p_wr™e_bufãr_»cÜd
 =ğ
NULL
)

774  
NRF_ERROR_NOT_FOUND
;

777 
p_wr™e_bufãr_»cÜd
->
³”_id
 = 
Ãw_³”_id
;

778 
p_wr™e_bufãr_»cÜd
->
d©a_id
 = data_id;

779  
	`wr™e_buf_¡Üe
(
p_wr™e_bufãr_»cÜd
);

780 
	}
}

783 
»t_code_t
 
	$pdb_ş—r
(
pm_³”_id_t
 
³”_id
, 
pm_³”_d©a_id_t
 
d©a_id
)

785 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

786  
	`pds_³”_d©a_d–‘e
(
³”_id
, 
d©a_id
);

787 
	}
}

790 
ušt32_t
 
	$pdb_n_³”s
()

792 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

793  
	`pds_³”_couÁ_g‘
();

794 
	}
}

797 
pm_³”_id_t
 
	$pdb_Ãxt_³”_id_g‘
(
pm_³”_id_t
 
´ev_³”_id
)

799 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

800  
	`pds_Ãxt_³”_id_g‘
(
´ev_³”_id
);

801 
	}
}

804 
pm_³”_id_t
 
	$pdb_Ãxt_d–‘ed_³”_id_g‘
(
pm_³”_id_t
 
´ev_³”_id
)

806 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

807  
	`pds_Ãxt_d–‘ed_³”_id_g‘
(
´ev_³”_id
);

808 
	}
}

811 
»t_code_t
 
	$pdb_³”_d©a_lßd
(
pm_³”_id_t
 
³”_id
,

812 
pm_³”_d©a_id_t
 
d©a_id
,

813 
pm_³”_d©a_t
 * cÚ¡ 
p_³”_d©a
)

815 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

816 
	`NRF_PM_DEBUG_CHECK
(
p_³”_d©a
 !ğ
NULL
);

819 
ušt32_t
 cÚ¡ 
d©a_Ën_by‹s
 = (
p_³”_d©a
->
Ëngth_wÜds
 * (uint32_t));

820  
	`pds_³”_d©a_»ad
(
³”_id
, 
d©a_id
, 
p_³”_d©a
, &
d©a_Ën_by‹s
);

821 
	}
}

824 
»t_code_t
 
	$pdb_¿w_¡Üe
(
pm_³”_id_t
 
³”_id
,

825 
pm_³”_d©a_cÚ¡_t
 * 
p_³”_d©a
,

826 
pm_¡Üe_tok’_t
 * 
p_¡Üe_tok’
)

828 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

829  
	`pds_³”_d©a_¡Üe
(
³”_id
, 
p_³”_d©a
, 
PDS_PREPARE_TOKEN_INVALID
, 
p_¡Üe_tok’
);

830 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\peer_id.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
PEER_MANAGER
)

42 
	~"³”_id.h
"

44 
	~<¡dšt.h
>

45 
	~<¡ršg.h
>

46 
	~"sdk_”rÜs.h
"

47 
	~"³”_mªag”_ty³s.h
"

48 
	~"pm_mu‹x.h
"

53 
ušt8_t
 
	mu£d_³”_ids
[
MUTEX_STORAGE_SIZE
(
PM_PEER_ID_N_AVAILABLE_IDS
)];

54 
ušt8_t
 
	md–‘ed_³”_ids
[
MUTEX_STORAGE_SIZE
(
PM_PEER_ID_N_AVAILABLE_IDS
)];

55 } 
	tpi_t
;

58 
pi_t
 
	gm_pi
 = {{0}, {0}};

61 
	$š‹º®_¡©e_»£t
(
pi_t
 * 
p_pi
)

63 
	`mem£t
(
p_pi
, 0, (
pi_t
));

64 
	}
}

67 
	$³”_id_š™
()

69 
	`š‹º®_¡©e_»£t
(&
m_pi
);

70 
	`pm_mu‹x_š™
(
m_pi
.
u£d_³”_ids
, 
PM_PEER_ID_N_AVAILABLE_IDS
);

71 
	`pm_mu‹x_š™
(
m_pi
.
d–‘ed_³”_ids
, 
PM_PEER_ID_N_AVAILABLE_IDS
);

72 
	}
}

75 
pm_³”_id_t
 
	$şaim
(
pm_³”_id_t
 
³”_id
, 
ušt8_t
 * 
mu‹x_group
)

77 
pm_³”_id_t
 
®loÿ‹d_³”_id
 = 
PM_PEER_ID_INVALID
;

78 ià(
³”_id
 =ğ
PM_PEER_ID_INVALID
)

80 
®loÿ‹d_³”_id
 = 
	`pm_mu‹x_lock_fœ¡_avaabË
(
mu‹x_group
, 
PM_PEER_ID_N_AVAILABLE_IDS
);

81 ià(
®loÿ‹d_³”_id
 =ğ
PM_PEER_ID_N_AVAILABLE_IDS
)

83 
®loÿ‹d_³”_id
 = 
PM_PEER_ID_INVALID
;

86 ià(
³”_id
 < 
PM_PEER_ID_N_AVAILABLE_IDS
)

88 
boŞ
 
lock_sucûss
 = 
	`pm_mu‹x_lock
(
mu‹x_group
, 
³”_id
);

89 
®loÿ‹d_³”_id
 = 
lock_sucûss
 ? 
³”_id
 : 
PM_PEER_ID_INVALID
;

91  
®loÿ‹d_³”_id
;

92 
	}
}

95 
	$»Ëa£
(
pm_³”_id_t
 
³”_id
, 
ušt8_t
 * 
mu‹x_group
)

97 ià(
³”_id
 < 
PM_PEER_ID_N_AVAILABLE_IDS
)

99 
	`pm_mu‹x_uÆock
(
mu‹x_group
, 
³”_id
);

101 
	}
}

104 
pm_³”_id_t
 
	$³”_id_®loÿ‹
(
pm_³”_id_t
 
³”_id
)

106  
	`şaim
(
³”_id
, 
m_pi
.
u£d_³”_ids
);

107 
	}
}

110 
boŞ
 
	$³”_id_d–‘e
(
pm_³”_id_t
 
³”_id
)

112 
pm_³”_id_t
 
d–‘ed_³”_id
;

114 ià(
³”_id
 =ğ
PM_PEER_ID_INVALID
)

116  
çl£
;

119 
d–‘ed_³”_id
 = 
	`şaim
(
³”_id
, 
m_pi
.
d–‘ed_³”_ids
);

121  (
d–‘ed_³”_id
 =ğ
³”_id
);

122 
	}
}

125 
	$³”_id_ä“
(
pm_³”_id_t
 
³”_id
)

127 
	`»Ëa£
(
³”_id
, 
m_pi
.
u£d_³”_ids
);

128 
	`»Ëa£
(
³”_id
, 
m_pi
.
d–‘ed_³”_ids
);

129 
	}
}

132 
boŞ
 
	$³”_id_is_®loÿ‹d
(
pm_³”_id_t
 
³”_id
)

134 ià(
³”_id
 < 
PM_PEER_ID_N_AVAILABLE_IDS
)

136  
	`pm_mu‹x_lock_¡©us_g‘
(
m_pi
.
u£d_³”_ids
, 
³”_id
);

138  
çl£
;

139 
	}
}

142 
boŞ
 
	$³”_id_is_d–‘ed
(
pm_³”_id_t
 
³”_id
)

144 ià(
³”_id
 < 
PM_PEER_ID_N_AVAILABLE_IDS
)

146  
	`pm_mu‹x_lock_¡©us_g‘
(
m_pi
.
d–‘ed_³”_ids
, 
³”_id
);

148  
çl£
;

149 
	}
}

152 
pm_³”_id_t
 
	$Ãxt_id_g‘
(
pm_³”_id_t
 
´ev_³”_id
, 
ušt8_t
 * 
mu‹x_group
)

154 
pm_³”_id_t
 
i
 = (
´ev_³”_id
 =ğ
PM_PEER_ID_INVALID
) ? 0 : (prev_peer_id + 1);

155 ; 
i
 < 
PM_PEER_ID_N_AVAILABLE_IDS
; i++)

157 ià(
	`pm_mu‹x_lock_¡©us_g‘
(
mu‹x_group
, 
i
))

159  
i
;

163  
PM_PEER_ID_INVALID
;

164 
	}
}

167 
pm_³”_id_t
 
	$³”_id_g‘_Ãxt_u£d
(
pm_³”_id_t
 
³”_id
)

169 
³”_id
 = 
	`Ãxt_id_g‘
Õ“r_id, 
m_pi
.
u£d_³”_ids
);

171 
³”_id
 !ğ
PM_PEER_ID_INVALID
)

173 ià(!
	`³”_id_is_d–‘ed
(
³”_id
))

175  
³”_id
;

178 
³”_id
 = 
	`Ãxt_id_g‘
Õ“r_id, 
m_pi
.
u£d_³”_ids
);

181  
³”_id
;

182 
	}
}

185 
pm_³”_id_t
 
	$³”_id_g‘_Ãxt_d–‘ed
(
pm_³”_id_t
 
´ev_³”_id
)

187  
	`Ãxt_id_g‘
(
´ev_³”_id
, 
m_pi
.
d–‘ed_³”_ids
);

188 
	}
}

191 
ušt32_t
 
	$³”_id_n_ids
()

193 
ušt32_t
 
n_ids
 = 0;

195 
pm_³”_id_t
 
i
 = 0; i < 
PM_PEER_ID_N_AVAILABLE_IDS
; i++)

197 
n_ids
 +ğ
	`pm_mu‹x_lock_¡©us_g‘
(
m_pi
.
u£d_³”_ids
, 
i
);

200  
n_ids
;

201 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\peer_manager.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
PEER_MANAGER
)

42 
	~"bË_”r.h
"

43 
	~"³”_mªag”.h
"

44 
	~<¡ršg.h
>

45 
	~"£cur™y_mªag”.h
"

46 
	~"£cur™y_di¥©ch”.h
"

47 
	~"g©t_ÿche_mªag”.h
"

48 
	~"g©ts_ÿche_mªag”.h
"

49 
	~"³”_d©aba£.h
"

50 
	~"³”_d©a_¡Üage.h
"

51 
	~"id_mªag”.h
"

52 
	~"bË_cÚn_¡©e.h
"

53 
	~"³”_mªag”_š‹º®.h
"

54 
	~"Äf_sdh_bË.h
"

57 
	#MODULE_INITIALIZED
 (
m_moduË_š™Ÿlized
è

	)

60 
boŞ
 
	gm_moduË_š™Ÿlized
;

61 
boŞ
 
	gm_³”_¿nk_š™Ÿlized
;

62 
boŞ
 
	gm_d–‘šg_®l
;

63 
pm_¡Üe_tok’_t
 
	gm_³”_¿nk_tok’
;

64 
ušt32_t
 
	gm_cu¼’t_highe¡_³”_¿nk
;

65 
pm_³”_id_t
 
	gm_highe¡_¿nked_³”
;

66 
pm_evt_hªdËr_t
 
	gm_evt_hªdËrs
[
PM_MAX_REGISTRANTS
];

67 
ušt8_t
 
	gm_n_»gi¡¿Ás
;

68 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_bÚded_æag_id
;

75 
	$evt_£nd
(
pm_evt_t
 cÚ¡ * 
p_pm_evt
)

77 
i
 = 0; i < 
m_n_»gi¡¿Ás
; i++)

79 
m_evt_hªdËrs
[
i
](
p_pm_evt
);

81 
	}
}

86 
	$¿nk_v¬s_upd©e
()

88 
»t_code_t
 
”r_code
 = 
	`pm_³”_¿nks_g‘
(&
m_highe¡_¿nked_³”
,

89 &
m_cu¼’t_highe¡_³”_¿nk
,

90 
NULL
,

91 
NULL
);

93 
m_³”_¿nk_š™Ÿlized
 = ((
”r_code
 =ğ
NRF_SUCCESS
è|| (”r_cod=ğ
NRF_ERROR_NOT_FOUND
));

94 
	}
}

102 
	$pm_pdb_evt_hªdËr
(
pm_evt_t
 * 
p_pdb_evt
)

104 
boŞ
 
£nd_evt
 = 
Œue
;

106 
p_pdb_evt
->
cÚn_hªdË
 = 
	`im_cÚn_hªdË_g‘
Õ_pdb_evt->
³”_id
);

108 
p_pdb_evt
->
evt_id
)

110 
PM_EVT_PEER_DATA_UPDATE_SUCCEEDED
:

111 ià(
p_pdb_evt
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
aùiÚ
 =ğ
PM_PEER_DATA_OP_UPDATE
)

113 iàĞ(
m_³”_¿nk_tok’
 !ğ
PM_STORE_TOKEN_INVALID
)

114 && (
m_³”_¿nk_tok’
 =ğ
p_pdb_evt
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
tok’
))

116 
m_³”_¿nk_tok’
 = 
PM_STORE_TOKEN_INVALID
;

117 
m_highe¡_¿nked_³”
 = 
p_pdb_evt
->
³”_id
;

119 
p_pdb_evt
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
tok’
 = 
PM_STORE_TOKEN_INVALID
;

121 iàĞ
m_³”_¿nk_š™Ÿlized


122 && (
p_pdb_evt
->
³”_id
 =ğ
m_highe¡_¿nked_³”
)

123 && (
p_pdb_evt
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
d©a_id


124 =ğ
PM_PEER_DATA_ID_PEER_RANK
))

127 
	`¿nk_v¬s_upd©e
();

130 ià(
p_pdb_evt
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
aùiÚ
 =ğ
PM_PEER_DATA_OP_DELETE
)

132 iàĞ
m_³”_¿nk_š™Ÿlized


133 && (
p_pdb_evt
->
³”_id
 =ğ
m_highe¡_¿nked_³”
)

134 && (
p_pdb_evt
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
d©a_id
 =ğ
PM_PEER_DATA_ID_PEER_RANK
))

137 
	`¿nk_v¬s_upd©e
();

142 
PM_EVT_PEER_DATA_UPDATE_FAILED
:

143 ià(
p_pdb_evt
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
aùiÚ
 =ğ
PM_PEER_DATA_OP_UPDATE
)

145 iàĞ(
m_³”_¿nk_tok’
 !ğ
PM_STORE_TOKEN_INVALID
)

146 && (
m_³”_¿nk_tok’
 =ğ
p_pdb_evt
->
·¿ms
.
³”_d©a_upd©e_çed
.
tok’
))

148 
m_³”_¿nk_tok’
 = 
PM_STORE_TOKEN_INVALID
;

149 
m_cu¼’t_highe¡_³”_¿nk
 -= 1;

151 
p_pdb_evt
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
tok’
 = 
PM_STORE_TOKEN_INVALID
;

156 
PM_EVT_PEER_DELETE_SUCCEEDED
:

158 ià(
m_d–‘šg_®l


159 && (
	`pdb_Ãxt_³”_id_g‘
(
PM_PEER_ID_INVALID
) == PM_PEER_ID_INVALID)

160 && (
	`pdb_Ãxt_d–‘ed_³”_id_g‘
(
PM_PEER_ID_INVALID
) == PM_PEER_ID_INVALID))

163 
m_d–‘šg_®l
 = 
çl£
;

165 
pm_evt_t
 
pm_d–‘e_®l_evt
;

166 
	`mem£t
(&
pm_d–‘e_®l_evt
, 0, (
pm_evt_t
));

167 
pm_d–‘e_®l_evt
.
evt_id
 = 
PM_EVT_PEERS_DELETE_SUCCEEDED
;

168 
pm_d–‘e_®l_evt
.
³”_id
 = 
PM_PEER_ID_INVALID
;

169 
pm_d–‘e_®l_evt
.
cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

171 
£nd_evt
 = 
çl£
;

174 
	`evt_£nd
(
p_pdb_evt
);

175 
	`evt_£nd
(&
pm_d–‘e_®l_evt
);

178 ià(
m_³”_¿nk_š™Ÿlized
 && (
p_pdb_evt
->
³”_id
 =ğ
m_highe¡_¿nked_³”
))

181 
	`¿nk_v¬s_upd©e
();

185 
PM_EVT_PEER_DELETE_FAILED
:

186 ià(
m_d–‘šg_®l
)

190 
m_d–‘šg_®l
 = 
çl£
;

192 
pm_evt_t
 
pm_d–‘e_®l_evt
;

193 
	`mem£t
(&
pm_d–‘e_®l_evt
, 0, (
pm_evt_t
));

194 
pm_d–‘e_®l_evt
.
evt_id
 = 
PM_EVT_PEERS_DELETE_FAILED
;

195 
pm_d–‘e_®l_evt
.
³”_id
 = 
PM_PEER_ID_INVALID
;

196 
pm_d–‘e_®l_evt
.
cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

197 
pm_d–‘e_®l_evt
.
·¿ms
.
³”s_d–‘e_çed_evt
.
”rÜ


198 ğ
p_pdb_evt
->
·¿ms
.
³”_d–‘e_çed
.
”rÜ
;

200 
£nd_evt
 = 
çl£
;

203 
	`evt_£nd
(
p_pdb_evt
);

204 
	`evt_£nd
(&
pm_d–‘e_®l_evt
);

213 ià(
£nd_evt
)

216 
	`evt_£nd
(
p_pdb_evt
);

218 
	}
}

226 
	$pm_sm_evt_hªdËr
(
pm_evt_t
 * 
p_sm_evt
)

228 
	`VERIFY_PARAM_NOT_NULL_VOID
(
p_sm_evt
);

230 
p_sm_evt
->
evt_id
)

232 
PM_EVT_CONN_SEC_SUCCEEDED
:

234 
boŞ
 
bÚded
 = 
p_sm_evt
->
·¿ms
.
cÚn_£c_sucûeded
.
´oûdu»


235 =ğ
PM_LINK_SECURED_PROCEDURE_BONDING
;

236 
	`bË_cÚn_¡©e_u£r_æag_£t
(
p_sm_evt
->
cÚn_hªdË
, 
m_bÚded_æag_id
, 
bÚded
);

246 
	`evt_£nd
(
p_sm_evt
);

247 
	}
}

255 
	$pm_gcm_evt_hªdËr
(
pm_evt_t
 * 
p_gcm_evt
)

258 
	`evt_£nd
(
p_gcm_evt
);

259 
	}
}

267 
	$pm_im_evt_hªdËr
(
pm_evt_t
 * 
p_im_evt
)

269 
p_im_evt
->
evt_id
)

271 
PM_EVT_BONDED_PEER_CONNECTED
:

272 
	`bË_cÚn_¡©e_u£r_æag_£t
(
p_im_evt
->
cÚn_hªdË
, 
m_bÚded_æag_id
, 
Œue
);

280 
	`evt_£nd
(
p_im_evt
);

281 
	}
}

289 
	$bË_evt_hªdËr
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
, * 
p_cÚ‹xt
)

291 
	`VERIFY_MODULE_INITIALIZED_VOID
();

293 
	`im_bË_evt_hªdËr
(
p_bË_evt
);

294 
	`sm_bË_evt_hªdËr
(
p_bË_evt
);

295 
	`gcm_bË_evt_hªdËr
(
p_bË_evt
);

296 
	}
}

298 
NRF_SDH_BLE_OBSERVER
(
m_bË_evt_ob£rv”
, 
PM_BLE_OBSERVER_PRIO
, 
bË_evt_hªdËr
, 
NULL
);

303 
	$š‹º®_¡©e_»£t
()

305 
m_highe¡_¿nked_³”
 = 
PM_PEER_ID_INVALID
;

306 
m_³”_¿nk_tok’
 = 
PM_STORE_TOKEN_INVALID
;

307 
m_bÚded_æag_id
 = 
BLE_CONN_STATE_USER_FLAG_INVALID
;

308 
	}
}

311 
»t_code_t
 
	$pm_š™
()

313 
»t_code_t
 
”r_code
;

315 
”r_code
 = 
	`pds_š™
();

316 ià(
”r_code
 !ğ
NRF_SUCCESS
)

318  
NRF_ERROR_INTERNAL
;

321 
”r_code
 = 
	`pdb_š™
();

322 ià(
”r_code
 !ğ
NRF_SUCCESS
)

324  
NRF_ERROR_INTERNAL
;

327 
”r_code
 = 
	`sm_š™
();

328 ià(
”r_code
 !ğ
NRF_SUCCESS
)

330  
NRF_ERROR_INTERNAL
;

333 
”r_code
 = 
	`smd_š™
();

334 ià(
”r_code
 !ğ
NRF_SUCCESS
)

336  
NRF_ERROR_INTERNAL
;

339 
”r_code
 = 
	`gcm_š™
();

340 ià(
”r_code
 !ğ
NRF_SUCCESS
)

342  
NRF_ERROR_INTERNAL
;

345 
”r_code
 = 
	`gscm_š™
();

346 ià(
”r_code
 !ğ
NRF_SUCCESS
)

348  
NRF_ERROR_INTERNAL
;

351 
”r_code
 = 
	`im_š™
();

352 ià(
”r_code
 !ğ
NRF_SUCCESS
)

354  
NRF_ERROR_INTERNAL
;

357 
	`š‹º®_¡©e_»£t
();

359 
m_bÚded_æag_id
 = 
	`bË_cÚn_¡©e_u£r_æag_acquœe
();

360 ià(
m_bÚded_æag_id
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
)

362  
NRF_ERROR_INTERNAL
;

365 
m_³”_¿nk_š™Ÿlized
 = 
çl£
;

366 
m_moduË_š™Ÿlized
 = 
Œue
;

368  
NRF_SUCCESS
;

369 
	}
}

372 
»t_code_t
 
	$pm_»gi¡”
(
pm_evt_hªdËr_t
 
ev’t_hªdËr
)

374 
	`VERIFY_MODULE_INITIALIZED
();

376 ià(
m_n_»gi¡¿Ás
 >ğ
PM_MAX_REGISTRANTS
)

378  
NRF_ERROR_NO_MEM
;

381 
m_evt_hªdËrs
[
m_n_»gi¡¿Ás
] = 
ev’t_hªdËr
;

382 
m_n_»gi¡¿Ás
 += 1;

384  
NRF_SUCCESS
;

385 
	}
}

388 
»t_code_t
 
	$pm_£c_·¿ms_£t
(
bË_g­_£c_·¿ms_t
 * 
p_£c_·¿ms
)

390 
	`VERIFY_MODULE_INITIALIZED
();

392 
»t_code_t
 
”r_code
;

394 
”r_code
 = 
	`sm_£c_·¿ms_£t
(
p_£c_·¿ms
);

398  
”r_code
;

399 
	}
}

402 
»t_code_t
 
	$pm_cÚn_£cu»
(
ušt16_t
 
cÚn_hªdË
, 
boŞ
 
fÜû_»·œšg
)

404 
	`VERIFY_MODULE_INITIALIZED
();

406 
»t_code_t
 
”r_code
;

408 
”r_code
 = 
	`sm_lšk_£cu»
(
cÚn_hªdË
, 
fÜû_»·œšg
);

410  
”r_code
;

411 
	}
}

414 
	$pm_cÚn_£c_cÚfig_»¶y
(
ušt16_t
 
cÚn_hªdË
, 
pm_cÚn_£c_cÚfig_t
 * 
p_cÚn_£c_cÚfig
)

416 ià(
p_cÚn_£c_cÚfig
 !ğ
NULL
)

418 
	`sm_cÚn_£c_cÚfig_»¶y
(
cÚn_hªdË
, 
p_cÚn_£c_cÚfig
);

420 
	}
}

423 
»t_code_t
 
	$pm_cÚn_£c_·¿ms_»¶y
(
ušt16_t
 
cÚn_hªdË
,

424 
bË_g­_£c_·¿ms_t
 * 
p_£c_·¿ms
,

425 cÚ¡ * 
p_cÚ‹xt
)

427 
	`VERIFY_MODULE_INITIALIZED
();

429  
	`sm_£c_·¿ms_»¶y
(
cÚn_hªdË
, 
p_£c_·¿ms
, 
p_cÚ‹xt
);

430 
	}
}

433 
	$pm_loÿl_d©aba£_has_chªged
()

435 
	`VERIFY_MODULE_INITIALIZED_VOID
();

436 
	`gcm_loÿl_d©aba£_has_chªged
();

437 
	}
}

440 
»t_code_t
 
	$pm_id_addr_£t
(
bË_g­_addr_t
 cÚ¡ * 
p_addr
)

442 
	`VERIFY_MODULE_INITIALIZED
();

443  
	`im_id_addr_£t
(
p_addr
);

444 
	}
}

447 
»t_code_t
 
	$pm_id_addr_g‘
(
bË_g­_addr_t
 * 
p_addr
)

449 
	`VERIFY_MODULE_INITIALIZED
();

450 
	`VERIFY_PARAM_NOT_NULL
(
p_addr
);

451  
	`im_id_addr_g‘
(
p_addr
);

452 
	}
}

455 
»t_code_t
 
	$pm_´ivacy_£t
(
pm_´ivacy_·¿ms_t
 cÚ¡ * 
p_´ivacy_·¿ms
)

457 
	`VERIFY_MODULE_INITIALIZED
();

458 
	`VERIFY_PARAM_NOT_NULL
(
p_´ivacy_·¿ms
);

459  
	`im_´ivacy_£t
(
p_´ivacy_·¿ms
);

460 
	}
}

463 
»t_code_t
 
	$pm_´ivacy_g‘
(
pm_´ivacy_·¿ms_t
 * 
p_´ivacy_·¿ms
)

465 
	`VERIFY_MODULE_INITIALIZED
();

466 
	`VERIFY_PARAM_NOT_NULL
(
p_´ivacy_·¿ms
);

467 
	`VERIFY_PARAM_NOT_NULL
(
p_´ivacy_·¿ms
->
p_deviû_œk
);

468  
	`im_´ivacy_g‘
(
p_´ivacy_·¿ms
);

469 
	}
}

472 
boŞ
 
	$pm_add»ss_»sŞve
(
bË_g­_addr_t
 cÚ¡ * 
p_addr
, 
bË_g­_œk_t
 cÚ¡ * 
p_œk
)

474 
	`VERIFY_MODULE_INITIALIZED
();

476 ià((
p_addr
 =ğ
NULL
è|| (
p_œk
 == NULL))

478  
çl£
;

482  
	`im_add»ss_»sŞve
(
p_addr
, 
p_œk
);

484 
	}
}

487 
»t_code_t
 
	$pm_wh™–i¡_£t
(
pm_³”_id_t
 cÚ¡ * 
p_³”s
,

488 
ušt32_t
 
³”_út
)

490 
	`VERIFY_MODULE_INITIALIZED
();

491  
	`im_wh™–i¡_£t
(
p_³”s
, 
³”_út
);

492 
	}
}

495 
»t_code_t
 
	$pm_wh™–i¡_g‘
(
bË_g­_addr_t
 * 
p_addrs
,

496 
ušt32_t
 * 
p_addr_út
,

497 
bË_g­_œk_t
 * 
p_œks
,

498 
ušt32_t
 * 
p_œk_út
)

500 
	`VERIFY_MODULE_INITIALIZED
();

502 ià(((
p_addrs
 =ğ
NULL
è&& (
p_œks
 == NULL)) ||

503 ((
p_addrs
 !ğ
NULL
è&& (
p_addr_út
 == NULL)) ||

504 ((
p_œks
 !ğ
NULL
è&& (
p_œk_út
 == NULL)))

507  
NRF_ERROR_NULL
;

510  
	`im_wh™–i¡_g‘
(
p_addrs
, 
p_addr_út
, 
p_œks
, 
p_œk_út
);

511 
	}
}

514 
»t_code_t
 
	$pm_deviû_id’t™›s_li¡_£t
(
pm_³”_id_t
 cÚ¡ * 
p_³”s
,

515 
ušt32_t
 
³”_út
)

517 
	`VERIFY_MODULE_INITIALIZED
();

518  
	`im_deviû_id’t™›s_li¡_£t
(
p_³”s
, 
³”_út
);

519 
	}
}

522 
»t_code_t
 
	$pm_cÚn_£c_¡©us_g‘
(
ušt16_t
 
cÚn_hªdË
, 
pm_cÚn_£c_¡©us_t
 * 
p_cÚn_£c_¡©us
)

524 
	`VERIFY_MODULE_INITIALIZED
();

525 
	`VERIFY_PARAM_NOT_NULL
(
p_cÚn_£c_¡©us
);

527 
bË_cÚn_¡©e_¡©us_t
 
¡©us
 = 
	`bË_cÚn_¡©e_¡©us
(
cÚn_hªdË
);

529 ià(
¡©us
 =ğ
BLE_CONN_STATUS_INVALID
)

531  
BLE_ERROR_INVALID_CONN_HANDLE
;

534 
p_cÚn_£c_¡©us
->
cÚÃùed
 = (
¡©us
 =ğ
BLE_CONN_STATUS_CONNECTED
);

535 
p_cÚn_£c_¡©us
->
bÚded
 = 
	`bË_cÚn_¡©e_u£r_æag_g‘
(
cÚn_hªdË
, 
m_bÚded_æag_id
);

536 
p_cÚn_£c_¡©us
->
’üy±ed
 = 
	`bË_cÚn_¡©e_’üy±ed
(
cÚn_hªdË
);

537 
p_cÚn_£c_¡©us
->
m™m_´Ùeùed
 = 
	`bË_cÚn_¡©e_m™m_´Ùeùed
(
cÚn_hªdË
);

538  
NRF_SUCCESS
;

539 
	}
}

542 
»t_code_t
 
	$pm_Ësc_public_key_£t
(
bË_g­_Ësc_p256_pk_t
 * 
p_public_key
)

544 
	`VERIFY_MODULE_INITIALIZED
();

545  
	`sm_Ësc_public_key_£t
(
p_public_key
);

546 
	}
}

549 
»t_code_t
 
	$pm_cÚn_hªdË_g‘
(
pm_³”_id_t
 
³”_id
, 
ušt16_t
 * 
p_cÚn_hªdË
)

551 
	`VERIFY_MODULE_INITIALIZED
();

552 
	`VERIFY_PARAM_NOT_NULL
(
p_cÚn_hªdË
);

553 *
p_cÚn_hªdË
 = 
	`im_cÚn_hªdË_g‘
(
³”_id
);

554  
NRF_SUCCESS
;

555 
	}
}

558 
»t_code_t
 
	$pm_³”_id_g‘
(
ušt16_t
 
cÚn_hªdË
, 
pm_³”_id_t
 * 
p_³”_id
)

560 
	`VERIFY_MODULE_INITIALIZED
();

561 
	`VERIFY_PARAM_NOT_NULL
(
p_³”_id
);

562 *
p_³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
(
cÚn_hªdË
);

563  
NRF_SUCCESS
;

564 
	}
}

567 
ušt32_t
 
	$pm_³”_couÁ
()

569 ià(!
MODULE_INITIALIZED
)

573  
	`pdb_n_³”s
();

574 
	}
}

577 
pm_³”_id_t
 
	$pm_Ãxt_³”_id_g‘
(
pm_³”_id_t
 
´ev_³”_id
)

579 ià(!
MODULE_INITIALIZED
)

581  
PM_PEER_ID_INVALID
;

583  
	`pdb_Ãxt_³”_id_g‘
(
´ev_³”_id
);

584 
	}
}

587 
»t_code_t
 
	$pm_³”_d©a_lßd
(
pm_³”_id_t
 
³”_id
,

588 
pm_³”_d©a_id_t
 
d©a_id
,

589 * 
p_d©a
,

590 
ušt16_t
 * 
p_Ëngth
)

592 
	`VERIFY_MODULE_INITIALIZED
();

593 
	`VERIFY_PARAM_NOT_NULL
(
p_d©a
);

594 
	`VERIFY_PARAM_NOT_NULL
(
p_Ëngth
);

595 ià(
	`ALIGN_NUM
(4, *
p_Ëngth
) != *p_length)

597  
NRF_ERROR_INVALID_PARAM
;

600 
pm_³”_d©a_t
 
³”_d©a
;

601 
	`mem£t
(&
³”_d©a
, 0, (peer_data));

602 
³”_d©a
.
Ëngth_wÜds
 = 
	`BYTES_TO_WORDS
(*
p_Ëngth
);

603 
³”_d©a
.
d©a_id
 = data_id;

604 
³”_d©a
.
p_®l_d©a
 = 
p_d©a
;

606 
»t_code_t
 
”r_code
 = 
	`pdb_³”_d©a_lßd
(
³”_id
, 
d©a_id
, &
³”_d©a
);

608 *
p_Ëngth
 = 
³”_d©a
.
Ëngth_wÜds
 * 
BYTES_PER_WORD
;

610  
”r_code
;

611 
	}
}

614 
»t_code_t
 
	$pm_³”_d©a_bÚdšg_lßd
(
pm_³”_id_t
 
³”_id
,

615 
pm_³”_d©a_bÚdšg_t
 * 
p_d©a
)

617 
ušt16_t
 
Ëngth
 = (
pm_³”_d©a_bÚdšg_t
);

618  
	`pm_³”_d©a_lßd
(
³”_id
,

619 
PM_PEER_DATA_ID_BONDING
,

620 
p_d©a
,

621 &
Ëngth
);

622 
	}
}

625 
»t_code_t
 
	$pm_³”_d©a_»mÙe_db_lßd
(
pm_³”_id_t
 
³”_id
,

626 
bË_g©t_db_¤v_t
 * 
p_d©a
,

627 
ušt16_t
 * 
p_Ëngth
)

629  
	`pm_³”_d©a_lßd
(
³”_id
,

630 
PM_PEER_DATA_ID_GATT_REMOTE
,

631 
p_d©a
,

632 
p_Ëngth
);

633 
	}
}

636 
»t_code_t
 
	$pm_³”_d©a_­p_d©a_lßd
(
pm_³”_id_t
 
³”_id
,

637 * 
p_d©a
,

638 
ušt16_t
 * 
p_Ëngth
)

640  
	`pm_³”_d©a_lßd
(
³”_id
,

641 
PM_PEER_DATA_ID_APPLICATION
,

642 
p_d©a
,

643 
p_Ëngth
);

644 
	}
}

647 
»t_code_t
 
	$pm_³”_d©a_¡Üe
(
pm_³”_id_t
 
³”_id
,

648 
pm_³”_d©a_id_t
 
d©a_id
,

649 cÚ¡ * 
p_d©a
,

650 
ušt16_t
 
Ëngth
,

651 
pm_¡Üe_tok’_t
 * 
p_tok’
)

653 
	`VERIFY_MODULE_INITIALIZED
();

654 
	`VERIFY_PARAM_NOT_NULL
(
p_d©a
);

655 ià(
	`ALIGN_NUM
(4, 
Ëngth
) !=†ength)

657  
NRF_ERROR_INVALID_PARAM
;

660 
pm_³”_d©a_æash_t
 
³”_d©a
;

661 
	`mem£t
(&
³”_d©a
, 0, (peer_data));

662 
³”_d©a
.
Ëngth_wÜds
 = 
	`BYTES_TO_WORDS
(
Ëngth
);

663 
³”_d©a
.
d©a_id
 = data_id;

664 
³”_d©a
.
p_®l_d©a
 = 
p_d©a
;

666  
	`pdb_¿w_¡Üe
(
³”_id
, &
³”_d©a
, 
p_tok’
);

667 
	}
}

670 
»t_code_t
 
	$pm_³”_d©a_bÚdšg_¡Üe
(
pm_³”_id_t
 
³”_id
,

671 
pm_³”_d©a_bÚdšg_t
 cÚ¡ * 
p_d©a
,

672 
pm_¡Üe_tok’_t
 * 
p_tok’
)

674  
	`pm_³”_d©a_¡Üe
(
³”_id
,

675 
PM_PEER_DATA_ID_BONDING
,

676 
p_d©a
,

677 
	`ALIGN_NUM
(4, (
pm_³”_d©a_bÚdšg_t
)),

678 
p_tok’
);

679 
	}
}

682 
»t_code_t
 
	$pm_³”_d©a_»mÙe_db_¡Üe
(
pm_³”_id_t
 
³”_id
,

683 
bË_g©t_db_¤v_t
 cÚ¡ * 
p_d©a
,

684 
ušt16_t
 
Ëngth
,

685 
pm_¡Üe_tok’_t
 * 
p_tok’
)

687  
	`pm_³”_d©a_¡Üe
(
³”_id
,

688 
PM_PEER_DATA_ID_GATT_REMOTE
,

689 
p_d©a
,

690 
Ëngth
,

691 
p_tok’
);

692 
	}
}

695 
»t_code_t
 
	$pm_³”_d©a_­p_d©a_¡Üe
(
pm_³”_id_t
 
³”_id
,

696 cÚ¡ * 
p_d©a
,

697 
ušt16_t
 
Ëngth
,

698 
pm_¡Üe_tok’_t
 * 
p_tok’
)

700  
	`pm_³”_d©a_¡Üe
(
³”_id
,

701 
PM_PEER_DATA_ID_APPLICATION
,

702 
p_d©a
,

703 
Ëngth
,

704 
p_tok’
);

705 
	}
}

708 
»t_code_t
 
	$pm_³”_d©a_d–‘e
(
pm_³”_id_t
 
³”_id
, 
pm_³”_d©a_id_t
 
d©a_id
)

710 
	`VERIFY_MODULE_INITIALIZED
();

712 ià(
d©a_id
 =ğ
PM_PEER_DATA_ID_BONDING
)

714  
NRF_ERROR_INVALID_PARAM
;

717  
	`pdb_ş—r
(
³”_id
, 
d©a_id
);

718 
	}
}

721 
»t_code_t
 
	$pm_³”_Ãw
(
pm_³”_id_t
 * 
p_Ãw_³”_id
,

722 
pm_³”_d©a_bÚdšg_t
 * 
p_bÚdšg_d©a
,

723 
pm_¡Üe_tok’_t
 * 
p_tok’
)

725 
»t_code_t
 
”r_code
;

726 
pm_³”_id_t
 
³”_id
;

727 
pm_³”_d©a_æash_t
 
³”_d©a
;

729 
	`VERIFY_MODULE_INITIALIZED
();

730 
	`VERIFY_PARAM_NOT_NULL
(
p_bÚdšg_d©a
);

731 
	`VERIFY_PARAM_NOT_NULL
(
p_Ãw_³”_id
);

733 
	`mem£t
(&
³”_d©a
, 0, (
pm_³”_d©a_æash_t
));

736 
	`pds_³”_d©a_™”©e_´•¬e
();

739 
	`pds_³”_d©a_™”©e
(
PM_PEER_DATA_ID_BONDING
, &
³”_id
, &
³”_d©a
))

741 ià(
	`im_is_du¶iÿ‹_bÚdšg_d©a
(
p_bÚdšg_d©a
, 
³”_d©a
.p_bonding_data))

743 *
p_Ãw_³”_id
 = 
³”_id
;

744  
NRF_SUCCESS
;

750 *
p_Ãw_³”_id
 = 
	`pdb_³”_®loÿ‹
();

752 ià(*
p_Ãw_³”_id
 =ğ
PM_PEER_ID_INVALID
)

754  
NRF_ERROR_NO_MEM
;

757 
	`mem£t
(&
³”_d©a
, 0, (
pm_³”_d©a_æash_t
));

759 
³”_d©a
.
d©a_id
 = 
PM_PEER_DATA_ID_BONDING
;

760 
³”_d©a
.
p_bÚdšg_d©a
 =…_bonding_data;

761 
³”_d©a
.
Ëngth_wÜds
 = 
	`BYTES_TO_WORDS
((
pm_³”_d©a_bÚdšg_t
));

763 
”r_code
 = 
	`pdb_¿w_¡Üe
(*
p_Ãw_³”_id
, &
³”_d©a
, 
p_tok’
);

765 ià(
”r_code
 !ğ
NRF_SUCCESS
)

767 ià(
	`im_³”_ä“
(*
p_Ãw_³”_id
è!ğ
NRF_SUCCESS
)

769  
NRF_ERROR_INTERNAL
;

775  
”r_code
;

778  
NRF_SUCCESS
;

779 
	}
}

782 
»t_code_t
 
	$pm_³”_d–‘e
(
pm_³”_id_t
 
³”_id
)

784 
	`VERIFY_MODULE_INITIALIZED
();

786  
	`im_³”_ä“
(
³”_id
);

787 
	}
}

790 
»t_code_t
 
	$pm_³”s_d–‘e
()

792 
	`VERIFY_MODULE_INITIALIZED
();

794 
m_d–‘šg_®l
 = 
Œue
;

796 
pm_³”_id_t
 
cu¼’t_³”_id
 = 
	`pdb_Ãxt_³”_id_g‘
(
PM_PEER_ID_INVALID
);

798 ià(
cu¼’t_³”_id
 =ğ
PM_PEER_ID_INVALID
)

801 
m_d–‘šg_®l
 = 
çl£
;

803 
pm_evt_t
 
pm_d–‘e_®l_evt
;

804 
	`mem£t
(&
pm_d–‘e_®l_evt
, 0, (
pm_evt_t
));

805 
pm_d–‘e_®l_evt
.
evt_id
 = 
PM_EVT_PEERS_DELETE_SUCCEEDED
;

806 
pm_d–‘e_®l_evt
.
³”_id
 = 
PM_PEER_ID_INVALID
;

807 
pm_d–‘e_®l_evt
.
cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

809 
	`evt_£nd
(&
pm_d–‘e_®l_evt
);

812 
cu¼’t_³”_id
 !ğ
PM_PEER_ID_INVALID
)

814 
»t_code_t
 
”r_code
 = 
	`pm_³”_d–‘e
(
cu¼’t_³”_id
);

815 ià(
”r_code
 !ğ
NRF_SUCCESS
)

817  
NRF_ERROR_INTERNAL
;

820 
cu¼’t_³”_id
 = 
	`pdb_Ãxt_³”_id_g‘
(current_peer_id);

823  
NRF_SUCCESS
;

824 
	}
}

827 
»t_code_t
 
	$pm_³”_¿nks_g‘
(
pm_³”_id_t
 * 
p_highe¡_¿nked_³”
,

828 
ušt32_t
 * 
p_highe¡_¿nk
,

829 
pm_³”_id_t
 * 
p_lowe¡_¿nked_³”
,

830 
ušt32_t
 * 
p_lowe¡_¿nk
)

832 
	`VERIFY_MODULE_INITIALIZED
();

834 
pm_³”_id_t
 
³”_id
 = 
	`pdb_Ãxt_³”_id_g‘
(
PM_PEER_ID_INVALID
);

835 
ušt32_t
 
³”_¿nk
 = 0;

837 
pm_³”_d©a_t
 
³”_d©a
 = {.
Ëngth_wÜds
 = 
	`BYTES_TO_WORDS
((
³”_¿nk
)),

838 .
p_³”_¿nk
 = &
³”_¿nk
};

840 
»t_code_t
 
”r_code
 = 
	`pdb_³”_d©a_lßd
(
³”_id
, 
PM_PEER_DATA_ID_PEER_RANK
, &
³”_d©a
);

841 
ušt32_t
 
highe¡_¿nk
 = 0;

842 
ušt32_t
 
lowe¡_¿nk
 = 0xFFFFFFFF;

843 
pm_³”_id_t
 
highe¡_¿nked_³”
 = 
PM_PEER_ID_INVALID
;

844 
pm_³”_id_t
 
lowe¡_¿nked_³”
 = 
PM_PEER_ID_INVALID
;

846 ià(
”r_code
 =ğ
NRF_ERROR_INVALID_PARAM
)

849  
NRF_ERROR_NOT_FOUND
;

852 (
”r_code
 =ğ
NRF_SUCCESS
è|| (”r_cod=ğ
NRF_ERROR_NOT_FOUND
))

854 ià(
”r_code
 =ğ
NRF_ERROR_NOT_FOUND
)

856 
³”_¿nk
 = 0;

858 ià(
³”_¿nk
 >ğ
highe¡_¿nk
)

860 
highe¡_¿nk
 = 
³”_¿nk
;

861 
highe¡_¿nked_³”
 = 
³”_id
;

863 ià(
³”_¿nk
 < 
lowe¡_¿nk
)

865 
lowe¡_¿nk
 = 
³”_¿nk
;

866 
lowe¡_¿nked_³”
 = 
³”_id
;

868 
³”_id
 = 
	`pdb_Ãxt_³”_id_g‘
(peer_id);

869 
”r_code
 = 
	`pdb_³”_d©a_lßd
(
³”_id
, 
PM_PEER_DATA_ID_PEER_RANK
, &
³”_d©a
);

871 ià(
³”_id
 =ğ
PM_PEER_ID_INVALID
)

873 
”r_code
 = 
NRF_SUCCESS
;

874 ià(
p_highe¡_¿nked_³”
 !ğ
NULL
)

876 *
p_highe¡_¿nked_³”
 = 
highe¡_¿nked_³”
;

878 ià(
p_highe¡_¿nk
 !ğ
NULL
)

880 *
p_highe¡_¿nk
 = 
highe¡_¿nk
;

882 ià(
p_lowe¡_¿nked_³”
 !ğ
NULL
)

884 *
p_lowe¡_¿nked_³”
 = 
lowe¡_¿nked_³”
;

886 ià(
p_lowe¡_¿nk
 !ğ
NULL
)

888 *
p_lowe¡_¿nk
 = 
lowe¡_¿nk
;

893 
”r_code
 = 
NRF_ERROR_INTERNAL
;

895  
”r_code
;

896 
	}
}

901 
	$¿nk_š™
()

903 
	`¿nk_v¬s_upd©e
();

904 
	}
}

907 
»t_code_t
 
	$pm_³”_¿nk_highe¡
(
pm_³”_id_t
 
³”_id
)

909 
	`VERIFY_MODULE_INITIALIZED
();

911 
»t_code_t
 
”r_code
;

913 
pm_³”_d©a_æash_t
 
³”_d©a
 = {.
Ëngth_wÜds
 = 
	`BYTES_TO_WORDS
((
m_cu¼’t_highe¡_³”_¿nk
)),

914 .
d©a_id
 = 
PM_PEER_DATA_ID_PEER_RANK
,

915 .
p_³”_¿nk
 = &
m_cu¼’t_highe¡_³”_¿nk
};

919 ià(!
m_³”_¿nk_š™Ÿlized
)

921 
	`¿nk_š™
();

924 ià(!
m_³”_¿nk_š™Ÿlized
 || (
m_³”_¿nk_tok’
 !ğ
PM_STORE_TOKEN_INVALID
))

926 
”r_code
 = 
NRF_ERROR_BUSY
;

930 ià((
³”_id
 =ğ
m_highe¡_¿nked_³”
è&& (
m_cu¼’t_highe¡_³”_¿nk
 > 0))

932 
pm_evt_t
 
pm_evt
;

935 
”r_code
 = 
NRF_SUCCESS
;

937 
	`mem£t
(&
pm_evt
, 0, (pm_evt));

938 
pm_evt
.
evt_id
 = 
PM_EVT_PEER_DATA_UPDATE_SUCCEEDED
;

939 
pm_evt
.
cÚn_hªdË
 = 
	`im_cÚn_hªdË_g‘
(
³”_id
);

940 
pm_evt
.
³”_id
 =…eer_id;

941 
pm_evt
.
·¿ms
.
³”_d©a_upd©e_sucûeded
.
d©a_id
 = 
PM_PEER_DATA_ID_PEER_RANK
;

942 
pm_evt
.
·¿ms
.
³”_d©a_upd©e_sucûeded
.
aùiÚ
 = 
PM_PEER_DATA_OP_UPDATE
;

943 
pm_evt
.
·¿ms
.
³”_d©a_upd©e_sucûeded
.
tok’
 = 
PM_STORE_TOKEN_INVALID
;

944 
pm_evt
.
·¿ms
.
³”_d©a_upd©e_sucûeded
.
æash_chªged
 = 
çl£
;

946 
	`evt_£nd
(&
pm_evt
);

950 
m_cu¼’t_highe¡_³”_¿nk
 += 1;

951 
”r_code
 = 
	`pdb_¿w_¡Üe
(
³”_id
, &
³”_d©a
, &
m_³”_¿nk_tok’
);

952 ià(
”r_code
 !ğ
NRF_SUCCESS
)

954 
m_³”_¿nk_tok’
 = 
PM_STORE_TOKEN_INVALID
;

955 
m_cu¼’t_highe¡_³”_¿nk
 -= 1;

957 ià((
”r_code
 !ğ
NRF_ERROR_BUSY
è&& (”r_cod!ğ
NRF_ERROR_STORAGE_FULL
))

958 
”r_code
 = 
NRF_ERROR_INTERNAL
;

963  
”r_code
;

964 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\pm_buffer.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
PEER_MANAGER
)

42 
	~"pm_bufãr.h
"

44 
	~<¡dboŞ.h
>

45 
	~<¡ršg.h
>

46 
	~"Äf_”rÜ.h
"

47 
	~"pm_mu‹x.h
"

50 
	#BUFFER_IS_VALID
(
p_bufãr
è(Õ_bufã¸!ğ
NULL
) \

51 && (
p_bufãr
->
p_memÜy
 !ğ
NULL
) \

52 && (
p_bufãr
->
p_mu‹x
 !ğ
NULL
))

	)

56 
»t_code_t
 
	$pm_bufãr_š™
(
pm_bufãr_t
 * 
p_bufãr
,

57 
ušt8_t
 * 
p_bufãr_memÜy
,

58 
ušt32_t
 
bufãr_memÜy_size
,

59 
ušt8_t
 * 
p_mu‹x_memÜy
,

60 
ušt32_t
 
mu‹x_memÜy_size
,

61 
ušt32_t
 
n_blocks
,

62 
ušt32_t
 
block_size
)

64 iàĞ(
p_bufãr
 !ğ
NULL
)

65 && (
p_bufãr_memÜy
 !ğ
NULL
)

66 && (
p_mu‹x_memÜy
 !ğ
NULL
)

67 && (
bufãr_memÜy_size
 >ğ(
n_blocks
 * 
block_size
))

68 && (
mu‹x_memÜy_size
 >ğ
	`MUTEX_STORAGE_SIZE
(
n_blocks
))

69 && (
n_blocks
 != 0)

70 && (
block_size
 != 0))

72 
p_bufãr
->
p_memÜy
 = 
p_bufãr_memÜy
;

73 
p_bufãr
->
p_mu‹x
 = 
p_mu‹x_memÜy
;

74 
p_bufãr
->
n_blocks
 =‚_blocks;

75 
p_bufãr
->
block_size
 = block_size;

76 
	`pm_mu‹x_š™
(
p_bufãr
->
p_mu‹x
, 
n_blocks
);

78  
NRF_SUCCESS
;

82  
NRF_ERROR_INVALID_PARAM
;

84 
	}
}

87 
ušt8_t
 
	$pm_bufãr_block_acquœe
(
pm_bufãr_t
 * 
p_bufãr
, 
ušt32_t
 
n_blocks
)

89 ià(!
	`BUFFER_IS_VALID
(
p_bufãr
))

91  ( 
PM_BUFFER_INVALID_ID
 );

94 
ušt8_t
 
fœ¡_locked_mu‹x
 = 
PM_BUFFER_INVALID_ID
;

96 
ušt8_t
 
i
 = 0; i < 
p_bufãr
->
n_blocks
; i++)

98 ià(
	`pm_mu‹x_lock
(
p_bufãr
->
p_mu‹x
, 
i
))

100 ià(
fœ¡_locked_mu‹x
 =ğ
PM_BUFFER_INVALID_ID
)

102 
fœ¡_locked_mu‹x
 = 
i
;

104 ià((
i
 - 
fœ¡_locked_mu‹x
 + 1è=ğ
n_blocks
)

106  
fœ¡_locked_mu‹x
;

109 ià(
fœ¡_locked_mu‹x
 !ğ
PM_BUFFER_INVALID_ID
)

111 
ušt8_t
 
j
 = 
fœ¡_locked_mu‹x
; j < 
i
; j++)

113 
	`pm_bufãr_»Ëa£
(
p_bufãr
, 
j
);

115 
fœ¡_locked_mu‹x
 = 
PM_BUFFER_INVALID_ID
;

119  ( 
PM_BUFFER_INVALID_ID
 );

120 
	}
}

123 
ušt8_t
 * 
	$pm_bufãr_±r_g‘
(
pm_bufãr_t
 * 
p_bufãr
, 
ušt8_t
 
id
)

125 ià(!
	`BUFFER_IS_VALID
(
p_bufãr
))

127  ( 
NULL
 );

130 iàĞ(
id
 !ğ
PM_BUFFER_INVALID_ID
)

131 && 
	`pm_mu‹x_lock_¡©us_g‘
(
p_bufãr
->
p_mu‹x
, 
id
) )

133  ( &
p_bufãr
->
p_memÜy
[
id
 *…_bufãr->
block_size
] );

137  ( 
NULL
 );

139 
	}
}

142 
	$pm_bufãr_»Ëa£
(
pm_bufãr_t
 * 
p_bufãr
, 
ušt8_t
 
id
)

144 iàĞ
	`BUFFER_IS_VALID
(
p_bufãr
)

145 && (
id
 !ğ
PM_BUFFER_INVALID_ID
)

146 && 
	`pm_mu‹x_lock_¡©us_g‘
(
p_bufãr
->
p_mu‹x
, 
id
))

148 
	`pm_mu‹x_uÆock
(
p_bufãr
->
p_mu‹x
, 
id
);

150 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\pm_mutex.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
PEER_MANAGER
)

42 
	~"pm_mu‹x.h
"

44 
	~<¡dboŞ.h
>

45 
	~<¡ršg.h
>

46 
	~"Äf_”rÜ.h
"

47 
	~"­p_ut_¶©fÜm.h
"

59 
boŞ
 
	$lock_by_mask
(
ušt8_t
 * 
p_mu‹x
, ušt8_ˆ
mu‹x_mask
)

61 
boŞ
 
sucûss
 = 
çl£
;

63 iàĞ(*
p_mu‹x
 & 
mu‹x_mask
) == 0 )

65 
	`CRITICAL_REGION_ENTER
();

66 iàĞ(*
p_mu‹x
 & 
mu‹x_mask
) == 0 )

68 *
p_mu‹x
 |ğ
mu‹x_mask
;

70 
sucûss
 = 
Œue
;

72 
	`CRITICAL_REGION_EXIT
();

75  ( 
sucûss
 );

76 
	}
}

79 
	$pm_mu‹x_š™
(
ušt8_t
 * 
p_mu‹x
, 
ušt16_t
 
mu‹x_size
)

81 ià(
p_mu‹x
 !ğ
NULL
)

83 
	`mem£t
(&
p_mu‹x
[0], 0, 
	`MUTEX_STORAGE_SIZE
(
mu‹x_size
));

85 
	}
}

88 
boŞ
 
	$pm_mu‹x_lock
(
ušt8_t
 * 
p_mu‹x
, 
ušt16_t
 
mu‹x_id
)

90 ià(
p_mu‹x
 !ğ
NULL
)

92  ( 
	`lock_by_mask
(&(
p_mu‹x
[
mu‹x_id
 >> 3]), (1 << (mutex_id & 0x07))) );

96  
çl£
;

98 
	}
}

101 
	$pm_mu‹x_uÆock
(
ušt8_t
 * 
p_mu‹x
, 
ušt16_t
 
mu‹x_id
)

103 
ušt8_t
 
mu‹x_ba£
 = 
mu‹x_id
 >> 3;

104 
ušt8_t
 
mu‹x_mask
 = (1 << (
mu‹x_id
 & 0x07));

106 ià((
p_mu‹x
 !ğ
NULL
)

107 && (
p_mu‹x
[
mu‹x_ba£
] & 
mu‹x_mask
))

109 
	`CRITICAL_REGION_ENTER
();

110 
p_mu‹x
[
mu‹x_ba£
] &ğ~
mu‹x_mask
;

111 
	`CRITICAL_REGION_EXIT
();

113 
	}
}

116 
ušt16_t
 
	$pm_mu‹x_lock_fœ¡_avaabË
(
ušt8_t
 * 
p_mu‹x
, 
ušt16_t
 
mu‹x_size
)

118 ià(
p_mu‹x
 !ğ
NULL
)

120  
ušt16_t
 
i
 = 0; i < 
mu‹x_size
; i++ )

122 iàĞ
	`lock_by_mask
(&(
p_mu‹x
[
i
 >> 3]), 1 << (i & 0x07)) )

124  ( 
i
 );

129  ( 
mu‹x_size
 );

130 
	}
}

133 
boŞ
 
	$pm_mu‹x_lock_¡©us_g‘
(
ušt8_t
 * 
p_mu‹x
, 
ušt16_t
 
mu‹x_id
)

135 ià(
p_mu‹x
 !ğ
NULL
)

137  ( (
p_mu‹x
[
mu‹x_id
 >> 3] & (1 << (mutex_id & 0x07))) );

141  
Œue
;

143 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\security_dispatcher.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
PEER_MANAGER
)

42 
	~"£cur™y_di¥©ch”.h
"

44 
	~<¡ršg.h
>

45 
	~"bË.h
"

46 
	~"bË_g­.h
"

47 
	~"bË_”r.h
"

48 
	~"bË_cÚn_¡©e.h
"

49 
	~"³”_mªag”_ty³s.h
"

50 
	~"³”_d©aba£.h
"

51 
	~"id_mªag”.h
"

53 #iâdeà
PM_CENTRAL_ENABLED


54 
	#PM_CENTRAL_ENABLED
 1

	)

58 
	#SMD_EVENT_HANDLERS_CNT
 ((
m_evt_hªdËrs
è/ (m_evt_hªdËrs[0]))

	)

60 
STATIC_ASSERT
((
NRF_SDH_BLE_CENTRAL_LINK_COUNT
 =ğ0è|| 
PM_CENTRAL_ENABLED
,

64 
sm_smd_evt_hªdËr
(
pm_evt_t
 * 
p_ev’t
);

68 
pm_evt_hªdËr_š‹º®_t
 cÚ¡ 
	gm_evt_hªdËrs
[] =

70 
sm_smd_evt_hªdËr


73 
boŞ
 
	gm_moduË_š™Ÿlized
;

75 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_£c_´oc
 = 
BLE_CONN_STATE_USER_FLAG_INVALID
;

76 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_£c_´oc_·œšg
 = 
BLE_CONN_STATE_USER_FLAG_INVALID
;

77 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_£c_´oc_bÚdšg
 = 
BLE_CONN_STATE_USER_FLAG_INVALID
;

78 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_£c_´oc_Ãw_³”
 = 
BLE_CONN_STATE_USER_FLAG_INVALID
;

79 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_®low_»·œšg
 = 
BLE_CONN_STATE_USER_FLAG_INVALID
;

81 
bË_g­_Ësc_p256_pk_t
 
	gm_³”_pk
;

84 
__INLINE
 
boŞ
 
	$£c_´oûdu»
(
ušt16_t
 
cÚn_hªdË
)

86  
	`bË_cÚn_¡©e_u£r_æag_g‘
(
cÚn_hªdË
, 
m_æag_£c_´oc
);

87 
	}
}

89 
__INLINE
 
boŞ
 
	$·œšg
(
ušt16_t
 
cÚn_hªdË
)

91  
	`bË_cÚn_¡©e_u£r_æag_g‘
(
cÚn_hªdË
, 
m_æag_£c_´oc_·œšg
);

92 
	}
}

94 
__INLINE
 
boŞ
 
	$bÚdšg
(
ušt16_t
 
cÚn_hªdË
)

96  
	`bË_cÚn_¡©e_u£r_æag_g‘
(
cÚn_hªdË
, 
m_æag_£c_´oc_bÚdšg
);

97 
	}
}

99 
__INLINE
 
boŞ
 
	$³”_ü—‹d
(
ušt16_t
 
cÚn_hªdË
)

101  
	`bË_cÚn_¡©e_u£r_æag_g‘
(
cÚn_hªdË
, 
m_æag_£c_´oc_Ãw_³”
);

102 
	}
}

104 
__INLINE
 
boŞ
 
	$®low_»·œšg
(
ušt16_t
 
cÚn_hªdË
)

106  
	`bË_cÚn_¡©e_u£r_æag_g‘
(
cÚn_hªdË
, 
m_æag_®low_»·œšg
);

107 
	}
}

114 
	$evt_£nd
(
pm_evt_t
 * 
p_ev’t
)

116 
p_ev’t
->
³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
Õ_ev’t->
cÚn_hªdË
);

118 
ušt32_t
 
i
 = 0; i < 
SMD_EVENT_HANDLERS_CNT
; i++)

120 
m_evt_hªdËrs
[
i
](
p_ev’t
);

122 
	}
}

130 
	$£c_¡¬t_£nd
(
ušt16_t
 
cÚn_hªdË
,

131 
pm_cÚn_£c_´oûdu»_t
 
´oûdu»
)

133 
pm_evt_t
 
evt
 =

135 .
evt_id
 = 
PM_EVT_CONN_SEC_START
,

136 .
cÚn_hªdË
 = conn_handle,

137 .
·¿ms
 = {.
cÚn_£c_¡¬t
 = {.
´oûdu»
 =…rocedure}}

139 
	`evt_£nd
(&
evt
);

140 
	}
}

148 
	$£nd_uÃx³ùed_”rÜ
(
ušt16_t
 
cÚn_hªdË
, 
»t_code_t
 
”r_code
)

150 
pm_evt_t
 
”rÜ_evt
 =

152 .
evt_id
 = 
PM_EVT_ERROR_UNEXPECTED
,

153 .
cÚn_hªdË
 = conn_handle,

154 .
·¿ms
 =

156 .
”rÜ_uÃx³ùed
 =

158 .
”rÜ
 = 
”r_code
,

162 
	`evt_£nd
(&
”rÜ_evt
);

163 
	}
}

173 
	$cÚn_£c_çu»
(
ušt16_t
 
cÚn_hªdË
,

174 
pm_cÚn_£c_´oûdu»_t
 
´oûdu»
,

175 
pm_£c_”rÜ_code_t
 
”rÜ
,

176 
ušt8_t
 
”rÜ_¤c
)

178 
pm_evt_t
 
evt
 =

180 .
evt_id
 = 
PM_EVT_CONN_SEC_FAILED
,

181 .
cÚn_hªdË
 = conn_handle,

182 .
·¿ms
 =

184 .
cÚn_£c_çed
 =

186 .
´oûdu»
 =…rocedure,

187 .
”rÜ
 =ƒrror,

188 .
”rÜ_¤c
 =ƒrror_src,

193 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_£c_´oc
, 
çl£
);

195 
	`evt_£nd
(&
evt
);

197 
	}
}

207 
	$·œšg_çu»
(
ušt16_t
 
cÚn_hªdË
,

208 
pm_£c_”rÜ_code_t
 
”rÜ
,

209 
ušt8_t
 
”rÜ_¤c
)

211 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

212 
pm_³”_id_t
 
³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
(
cÚn_hªdË
);

213 
pm_cÚn_£c_´oûdu»_t
 
´oûdu»
 = 
	`bÚdšg
(
cÚn_hªdË
è? 
PM_LINK_SECURED_PROCEDURE_BONDING


214 : 
PM_LINK_SECURED_PROCEDURE_PAIRING
;

216 ià(
	`³”_ü—‹d
(
cÚn_hªdË
))

220 
”r_code
 = 
	`im_³”_ä“
(
³”_id
);

221 
	`UNUSED_VARIABLE
(
”r_code
);

223 if(
³”_id
 !ğ
PM_PEER_ID_INVALID
)

225 
”r_code
 = 
	`pdb_wr™e_buf_»Ëa£
(
³”_id
, 
PM_PEER_DATA_ID_BONDING
);

226 ià((
”r_code
 !ğ
NRF_SUCCESS
è&& (”r_cod!ğ
NRF_ERROR_NOT_FOUND
 ))

228 
	`£nd_uÃx³ùed_”rÜ
(
cÚn_hªdË
, 
”r_code
);

232 
	`cÚn_£c_çu»
(
cÚn_hªdË
, 
´oûdu»
, 
”rÜ
, 
”rÜ_¤c
);

235 
	}
}

244 
__INLINE
 
	$’üy±iÚ_çu»
(
ušt16_t
 
cÚn_hªdË
,

245 
pm_£c_”rÜ_code_t
 
”rÜ
,

246 
ušt8_t
 
”rÜ_¤c
)

248 
	`cÚn_£c_çu»
(
cÚn_hªdË
, 
PM_LINK_SECURED_PROCEDURE_ENCRYPTION
, 
”rÜ
, 
”rÜ_¤c
);

251 
	}
}

260 
	$lšk_£cu»_çu»
(
ušt16_t
 
cÚn_hªdË
,

261 
pm_£c_”rÜ_code_t
 
”rÜ
,

262 
ušt8_t
 
”rÜ_¤c
)

264 ià(
	`£c_´oûdu»
(
cÚn_hªdË
))

266 ià(
	`·œšg
(
cÚn_hªdË
))

268 
	`·œšg_çu»
(
cÚn_hªdË
, 
”rÜ
, 
”rÜ_¤c
);

272 
	`’üy±iÚ_çu»
(
cÚn_hªdË
, 
”rÜ
, 
”rÜ_¤c
);

275 
	}
}

284 
	$£c_´oc_¡¬t
(
ušt16_t
 
cÚn_hªdË
,

285 
boŞ
 
sucûss
,

286 
pm_cÚn_£c_´oûdu»_t
 
´oûdu»
)

288 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_£c_´oc
, 
sucûss
);

289 ià(
sucûss
)

291 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
,

292 
m_æag_£c_´oc_·œšg
,

293 (
´oûdu»
 !ğ
PM_LINK_SECURED_PROCEDURE_ENCRYPTION
));

294 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
,

295 
m_æag_£c_´oc_bÚdšg
,

296 (
´oûdu»
 =ğ
PM_LINK_SECURED_PROCEDURE_BONDING
));

297 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_£c_´oc_Ãw_³”
, 
çl£
);

298 
	`£c_¡¬t_£nd
(
cÚn_hªdË
, 
´oûdu»
);

300 
	}
}

311 
	$£c_´oc_hou£k“pšg
(
ušt16_t
 
cÚn_hªdË
,

312 
pm_³”_id_t
 
³”_id
,

313 
boŞ
 
sucûss
,

314 
boŞ
 
Ãw_³”_ü—‹d
)

316 ià(
sucûss
)

318 ià(
Ãw_³”_ü—‹d
)

320 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_£c_´oc_Ãw_³”
, 
Œue
);

321 
	`im_Ãw_³”_id
(
cÚn_hªdË
, 
³”_id
);

326 ià(
Ãw_³”_ü—‹d
)

328 
»t_code_t
 
”r_code
 = 
	`im_³”_ä“
(
³”_id
);

329 
	`UNUSED_VARIABLE
(
”r_code
);

332 
	}
}

340 
	$£c_šfo_»que¡_´oûss
(
bË_g­_evt_t
 cÚ¡ * 
p_g­_evt
)

342 
»t_code_t
 
”r_code
;

343 
bË_g­_’c_šfo_t
 cÚ¡ * 
p_’c_šfo
 = 
NULL
;

344 
pm_³”_d©a_æash_t
 
³”_d©a
;

345 
pm_³”_id_t
 
³”_id
 = 
	`im_³”_id_g‘_by_ma¡”_id
(

346 &
p_g­_evt
->
·¿ms
.
£c_šfo_»que¡
.
ma¡”_id
);

348 ià(
³”_id
 =ğ
PM_PEER_ID_INVALID
)

350 
³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
(
p_g­_evt
->
cÚn_hªdË
);

356 
	`im_Ãw_³”_id
(
p_g­_evt
->
cÚn_hªdË
, 
³”_id
);

359 
	`£c_´oc_¡¬t
(
p_g­_evt
->
cÚn_hªdË
, 
Œue
, 
PM_LINK_SECURED_PROCEDURE_ENCRYPTION
);

361 ià(
³”_id
 !ğ
PM_PEER_ID_INVALID
)

363 
”r_code
 = 
	`pdb_³”_d©a_±r_g‘
(
³”_id
, 
PM_PEER_DATA_ID_BONDING
, &
³”_d©a
);

365 ià(
”r_code
 =ğ
NRF_SUCCESS
)

368 
bË_g­_’c_key_t
 cÚ¡ * 
p_exi¡šg_key
 = &
³”_d©a
.
p_bÚdšg_d©a
->
own_Ék
;

370 iàĞ
p_exi¡šg_key
->
’c_šfo
.
Ësc


371 || (
	`im_ma¡”_ids_com·»
(&
p_exi¡šg_key
->
ma¡”_id
,

372 &
p_g­_evt
->
·¿ms
.
£c_šfo_»que¡
.
ma¡”_id
)))

374 
p_’c_šfo
 = &
p_exi¡šg_key
->
’c_šfo
;

379 
”r_code
 = 
	`sd_bË_g­_£c_šfo_»¶y
(
p_g­_evt
->
cÚn_hªdË
, 
p_’c_šfo
, 
NULL
, NULL);

381 ià(
”r_code
 !ğ
NRF_SUCCESS
)

383 
	`£c_´oc_hou£k“pšg
(
p_g­_evt
->
cÚn_hªdË
, 
³”_id
, 
çl£
, false);

384 
	`£nd_uÃx³ùed_”rÜ
(
p_g­_evt
->
cÚn_hªdË
, 
”r_code
);

386 ià(
p_’c_šfo
 =ğ
NULL
)

388 
	`£c_´oc_hou£k“pšg
(
p_g­_evt
->
cÚn_hªdË
, 
³”_id
, 
çl£
, false);

389 
	`’üy±iÚ_çu»
(
p_g­_evt
->
cÚn_hªdË
,

390 
PM_CONN_SEC_ERROR_PIN_OR_KEY_MISSING
,

391 
BLE_GAP_SEC_STATUS_SOURCE_LOCAL
);

395 
	}
}

403 
	$£nd_cÚfig_»q
(
ušt16_t
 
cÚn_hªdË
)

405 
pm_evt_t
 
evt
;

406 
	`mem£t
(&
evt
, 0, (evt));

408 
evt
.
evt_id
 = 
PM_EVT_CONN_SEC_CONFIG_REQ
;

409 
evt
.
cÚn_hªdË
 = conn_handle;

411 
	`evt_£nd
(&
evt
);

412 
	}
}

415 
	$smd_cÚn_£c_cÚfig_»¶y
(
ušt16_t
 
cÚn_hªdË
, 
pm_cÚn_£c_cÚfig_t
 * 
p_cÚn_£c_cÚfig
)

417 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

418 
	`NRF_PM_DEBUG_CHECK
(
p_cÚn_£c_cÚfig
 !ğ
NULL
);

420 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
,

421 
m_æag_®low_»·œšg
,

422 
p_cÚn_£c_cÚfig
->
®low_»·œšg
);

423 
	}
}

430 
	$discÚÃù_´oûss
(
bË_g­_evt_t
 cÚ¡ * 
p_g­_evt
)

432 
pm_£c_”rÜ_code_t
 
”rÜ
 = (
p_g­_evt
->
·¿ms
.
discÚÃùed
.
»asÚ


433 =ğ
BLE_HCI_CONN_TERMINATED_DUE_TO_MIC_FAILURE
)

434 ? 
PM_CONN_SEC_ERROR_MIC_FAILURE
 : 
PM_CONN_SEC_ERROR_DISCONNECT
;

436 
	`lšk_£cu»_çu»
(
p_g­_evt
->
cÚn_hªdË
, 
”rÜ
, 
BLE_GAP_SEC_STATUS_SOURCE_LOCAL
);

437 
	}
}

446 
	$£nd_·¿ms_»q
(
ušt16_t
 
cÚn_hªdË
, 
bË_g­_£c_·¿ms_t
 cÚ¡ * 
p_³”_·¿ms
)

448 
pm_evt_t
 
evt
 =

450 .
evt_id
 = 
PM_EVT_CONN_SEC_PARAMS_REQ
,

451 .
cÚn_hªdË
 = conn_handle,

452 .
·¿ms
 =

454 .
cÚn_£c_·¿ms_»q
 =

456 .
p_³”_·¿ms
 =…_peer_params

461 
	`evt_£nd
(&
evt
);

462 
	}
}

469 
	$£c_·¿ms_»que¡_´oûss
(
bË_g­_evt_t
 cÚ¡ * 
p_g­_evt
)

471 ià(
	`bË_cÚn_¡©e_rŞe
(
p_g­_evt
->
cÚn_hªdË
è=ğ
BLE_GAP_ROLE_PERIPH
)

473 
	`£c_´oc_¡¬t
(
p_g­_evt
->
cÚn_hªdË
,

474 
Œue
,

475 
p_g­_evt
->
·¿ms
.
£c_·¿ms_»que¡
.
³”_·¿ms
.
bÚd


476 ? 
PM_LINK_SECURED_PROCEDURE_BONDING


477 : 
PM_LINK_SECURED_PROCEDURE_PAIRING
);

480 
	`£nd_·¿ms_»q
(
p_g­_evt
->
cÚn_hªdË
, &p_g­_evt->
·¿ms
.
£c_·¿ms_»que¡
.
³”_·¿ms
);

482 
	}
}

490 
	$auth_¡©us_sucûss_´oûss
(
bË_g­_evt_t
 cÚ¡ * 
p_g­_evt
)

492 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

493 
ušt16_t
 
cÚn_hªdË
 = 
p_g­_evt
->conn_handle;

494 
ušt8_t
 
rŞe
 = 
	`bË_cÚn_¡©e_rŞe
(
cÚn_hªdË
);

495 
pm_³”_id_t
 
³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
(
cÚn_hªdË
);

496 
pm_³”_id_t
 
Ãw_³”_id
 = 
³”_id
;

497 
pm_³”_d©a_t
 
³”_d©a
;

498 
boŞ
 
d©a_¡Üed
 = 
çl£
;

500 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_£c_´oc
, 
çl£
);

502 ià(
rŞe
 =ğ
BLE_GAP_ROLE_INVALID
)

508 ià(
p_g­_evt
->
·¿ms
.
auth_¡©us
.
bÚded
)

510 
pm_³”_id_t
 
du¶iÿ‹_³”_id
 = 
PM_PEER_ID_INVALID
;

511 
d©a_¡Üed
 = 
Œue
;

513 
”r_code
 = 
	`pdb_wr™e_buf_g‘
(
³”_id
, 
PM_PEER_DATA_ID_BONDING
, 1, &
³”_d©a
);

514 ià(
”r_code
 !ğ
NRF_SUCCESS
)

516 
	`£nd_uÃx³ùed_”rÜ
(
cÚn_hªdË
, 
”r_code
);

517 
d©a_¡Üed
 = 
çl£
;

521 
du¶iÿ‹_³”_id
 = 
	`im_fšd_du¶iÿ‹_bÚdšg_d©a
(
³”_d©a
.
p_bÚdšg_d©a
,

522 
PM_PEER_ID_INVALID
);

525 ià(
du¶iÿ‹_³”_id
 !ğ
PM_PEER_ID_INVALID
)

528 
Ãw_³”_id
 = 
du¶iÿ‹_³”_id
;

529 
	`im_Ãw_³”_id
(
cÚn_hªdË
, 
Ãw_³”_id
);

532 ià(!
	`®low_»·œšg
(
cÚn_hªdË
))

534 
	`£nd_cÚfig_»q
(
cÚn_hªdË
);

535 ià(!
	`®low_»·œšg
(
cÚn_hªdË
))

537 
d©a_¡Üed
 = 
çl£
;

542 ià(
d©a_¡Üed
)

544 
”r_code
 = 
	`pdb_wr™e_buf_¡Üe
(
³”_id
, 
PM_PEER_DATA_ID_BONDING
, 
Ãw_³”_id
);

545 ià(
”r_code
 !ğ
NRF_SUCCESS
)

548 
	`£nd_uÃx³ùed_”rÜ
(
cÚn_hªdË
, 
”r_code
);

549 
d©a_¡Üed
 = 
çl£
;

553 ià((
du¶iÿ‹_³”_id
 !ğ
PM_PEER_ID_INVALID
è&& 
	`³”_ü—‹d
(
cÚn_hªdË
))

557 
»t_code_t
 
”r_code_ä“
 = 
	`im_³”_ä“
(
³”_id
);

558 
	`UNUSED_VARIABLE
(
”r_code_ä“
);

561 ià(
	`³”_ü—‹d
(
cÚn_hªdË
))

563 
»t_code_t
 
”r_code_ä“
 = 
	`im_³”_ä“
(
³”_id
);

564 
	`UNUSED_VARIABLE
(
”r_code_ä“
);

571 
pm_evt_t
 
·œšg_sucûss_evt
;

573 
·œšg_sucûss_evt
.
evt_id
 = 
PM_EVT_CONN_SEC_SUCCEEDED
;

574 
·œšg_sucûss_evt
.
cÚn_hªdË
 = conn_handle;

575 
·œšg_sucûss_evt
.
·¿ms
.
cÚn_£c_sucûeded
.
´oûdu»
 = 
p_g­_evt
->·¿ms.
auth_¡©us
.
bÚded


576 ? 
PM_LINK_SECURED_PROCEDURE_BONDING


577 : 
PM_LINK_SECURED_PROCEDURE_PAIRING
;

578 
·œšg_sucûss_evt
.
·¿ms
.
cÚn_£c_sucûeded
.
d©a_¡Üed
 = data_stored;

580 
	`evt_£nd
(&
·œšg_sucûss_evt
);

583 
	}
}

591 
	$auth_¡©us_çu»_´oûss
(
bË_g­_evt_t
 cÚ¡ * 
p_g­_evt
)

593 
	`lšk_£cu»_çu»
(
p_g­_evt
->
cÚn_hªdË
,

594 
p_g­_evt
->
·¿ms
.
auth_¡©us
.auth_status,

595 
p_g­_evt
->
·¿ms
.
auth_¡©us
.
”rÜ_¤c
);

596 
	}
}

603 
	$auth_¡©us_´oûss
(
bË_g­_evt_t
 cÚ¡ * 
p_g­_evt
)

605 
p_g­_evt
->
·¿ms
.
auth_¡©us
.auth_status)

607 
BLE_GAP_SEC_STATUS_SUCCESS
:

608 
	`auth_¡©us_sucûss_´oûss
(
p_g­_evt
);

612 
	`auth_¡©us_çu»_´oûss
(
p_g­_evt
);

615 
	}
}

622 
	$cÚn_£c_upd©e_´oûss
(
bË_g­_evt_t
 cÚ¡ * 
p_g­_evt
)

624 ià(!
	`·œšg
(
p_g­_evt
->
cÚn_hªdË
))

628 ià(!
	`bË_cÚn_¡©e_’üy±ed
(
p_g­_evt
->
cÚn_hªdË
))

630 
	`’üy±iÚ_çu»
(
p_g­_evt
->
cÚn_hªdË
,

631 
PM_CONN_SEC_ERROR_PIN_OR_KEY_MISSING
,

632 
BLE_GAP_SEC_STATUS_SOURCE_REMOTE
);

636 
	`bË_cÚn_¡©e_u£r_æag_£t
(
p_g­_evt
->
cÚn_hªdË
, 
m_æag_£c_´oc
, 
çl£
);

638 
pm_evt_t
 
evt
;

640 
evt
.
evt_id
 = 
PM_EVT_CONN_SEC_SUCCEEDED
;

641 
evt
.
cÚn_hªdË
 = 
p_g­_evt
->conn_handle;

642 
evt
.
·¿ms
.
cÚn_£c_sucûeded
.
´oûdu»
 = 
PM_LINK_SECURED_PROCEDURE_ENCRYPTION
;

643 
evt
.
·¿ms
.
cÚn_£c_sucûeded
.
d©a_¡Üed
 = 
çl£
;

645 
	`evt_£nd
(&
evt
);

648 
	}
}

655 
	$æag_id_š™
(
bË_cÚn_¡©e_u£r_æag_id_t
 * 
p_æag_id
)

657 ià(*
p_æag_id
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
)

659 *
p_æag_id
 = 
	`bË_cÚn_¡©e_u£r_æag_acquœe
();

661 
	}
}

664 
»t_code_t
 
	$smd_š™
()

666 
	`NRF_PM_DEBUG_CHECK
(!
m_moduË_š™Ÿlized
);

668 
	`æag_id_š™
(&
m_æag_£c_´oc
);

669 
	`æag_id_š™
(&
m_æag_£c_´oc_·œšg
);

670 
	`æag_id_š™
(&
m_æag_£c_´oc_bÚdšg
);

671 
	`æag_id_š™
(&
m_æag_£c_´oc_Ãw_³”
);

672 
	`æag_id_š™
(&
m_æag_®low_»·œšg
);

674 ià((
m_æag_£c_´oc
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
) ||

675 (
m_æag_£c_´oc_·œšg
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
) ||

676 (
m_æag_£c_´oc_bÚdšg
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
) ||

677 (
m_æag_£c_´oc_Ãw_³”
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
) ||

678 (
m_æag_®low_»·œšg
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
))

680  
NRF_ERROR_INTERNAL
;

683 
m_moduË_š™Ÿlized
 = 
Œue
;

685  
NRF_SUCCESS
;

686 
	}
}

703 
»t_code_t
 
	$£c_key£t_fl
(
ušt16_t
 
cÚn_hªdË
,

704 
pm_³”_id_t
 
³”_id
,

705 
ušt8_t
 
rŞe
,

706 
bË_g­_Ësc_p256_pk_t
 * 
p_public_key
,

707 
bË_g­_£c_key£t_t
 * 
p_£c_key£t
)

709 
»t_code_t
 
”r_code
;

710 
pm_³”_d©a_t
 
³”_d©a
;

712 ià(
p_£c_key£t
 =ğ
NULL
)

714  
NRF_ERROR_INTERNAL
;

718 
”r_code
 = 
	`pdb_wr™e_buf_g‘
(
³”_id
, 
PM_PEER_DATA_ID_BONDING
, 1, &
³”_d©a
);

720 ià(
”r_code
 =ğ
NRF_ERROR_BUSY
)

724 ià(
”r_code
 !ğ
NRF_SUCCESS
)

726 
”r_code
 = 
NRF_ERROR_INTERNAL
;

730 
	`mem£t
(
³”_d©a
.
p_bÚdšg_d©a
, 0, (
pm_³”_d©a_bÚdšg_t
));

732 
³”_d©a
.
p_bÚdšg_d©a
->
own_rŞe
 = 
rŞe
;

734 
p_£c_key£t
->
keys_own
.
p_’c_key
 = &
³”_d©a
.
p_bÚdšg_d©a
->
own_Ék
;

735 
p_£c_key£t
->
keys_own
.
p_pk
 = 
p_public_key
;

736 
p_£c_key£t
->
keys_³”
.
p_’c_key
 = &
³”_d©a
.
p_bÚdšg_d©a
->
³”_Ék
;

737 
p_£c_key£t
->
keys_³”
.
p_id_key
 = &
³”_d©a
.
p_bÚdšg_d©a
->
³”_bË_id
;

738 
p_£c_key£t
->
keys_³”
.
p_pk
 = &
m_³”_pk
;

742 
”r_code
 = 
	`im_bË_addr_g‘
(
cÚn_hªdË
, &
³”_d©a
.
p_bÚdšg_d©a
->
³”_bË_id
.
id_addr_šfo
);

743 ià(
”r_code
 !ğ
NRF_SUCCESS
)

745  
NRF_ERROR_INTERNAL
;

749 
”r_code
 = 
	`pdb_wr™e_buf_¡Üe_´•¬e
(
³”_id
, 
PM_PEER_DATA_ID_BONDING
);

750 ià(
”r_code
 =ğ
NRF_ERROR_NOT_FOUND
)

752  
NRF_ERROR_INTERNAL
;

756  
”r_code
;

757 
	}
}

760 
»t_code_t
 
	$smd_·¿ms_»¶y
(
ušt16_t
 
cÚn_hªdË
,

761 
bË_g­_£c_·¿ms_t
 * 
p_£c_·¿ms
,

762 
bË_g­_Ësc_p256_pk_t
 * 
p_public_key
)

764 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

766 
ušt8_t
 
rŞe
 = 
	`bË_cÚn_¡©e_rŞe
(
cÚn_hªdË
);

767 
pm_³”_id_t
 
³”_id
 = 
PM_PEER_ID_INVALID
;

768 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

769 
ušt8_t
 
£c_¡©us
 = 
BLE_GAP_SEC_STATUS_SUCCESS
;

770 
boŞ
 
Ãw_³”_ü—‹d
 = 
	`³”_ü—‹d
(
cÚn_hªdË
);

771 
bË_g­_£c_key£t_t
 
£c_key£t
;

773 
	`mem£t
(&
£c_key£t
, 0, (
bË_g­_£c_key£t_t
));

774 ià(
rŞe
 =ğ
BLE_GAP_ROLE_PERIPH
)

777 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_®low_»·œšg
, 
çl£
);

780 ià(
rŞe
 =ğ
BLE_GAP_ROLE_INVALID
)

782  
BLE_ERROR_INVALID_CONN_HANDLE
;

785 ià(
p_£c_·¿ms
 =ğ
NULL
)

788 
£c_¡©us
 = 
BLE_GAP_SEC_STATUS_PAIRING_NOT_SUPP
;

790 ià(!
p_£c_·¿ms
->
bÚd
)

794 
£c_key£t
.
keys_own
.
p_pk
 = 
p_public_key
;

795 
£c_key£t
.
keys_³”
.
p_pk
 = &
m_³”_pk
;

801 
³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
(
cÚn_hªdË
);

803 ià(
³”_id
 =ğ
PM_PEER_ID_INVALID
)

806 
³”_id
 = 
	`pdb_³”_®loÿ‹
();

807 ià(
³”_id
 !ğ
PM_PEER_ID_INVALID
)

809 
Ãw_³”_ü—‹d
 = 
Œue
;

813 
”r_code
 = 
NRF_ERROR_INTERNAL
;

816 ià(
rŞe
 =ğ
BLE_GAP_ROLE_PERIPH
 && !
	`®low_»·œšg
(
cÚn_hªdË
))

820 
	`£nd_cÚfig_»q
(
cÚn_hªdË
);

821 ià(!
	`®low_»·œšg
(
cÚn_hªdË
))

824 
£c_¡©us
 = 
BLE_GAP_SEC_STATUS_PAIRING_NOT_SUPP
;

828 ià((
£c_¡©us
 !ğ
BLE_GAP_SEC_STATUS_PAIRING_NOT_SUPP
è&& (
”r_code
 =ğ
NRF_SUCCESS
))

830 
”r_code
 = 
	`£c_key£t_fl
(
cÚn_hªdË
, 
³”_id
, 
rŞe
, 
p_public_key
, &
£c_key£t
);

834 ià(
”r_code
 =ğ
NRF_SUCCESS
)

838 ià(
rŞe
 =ğ
BLE_GAP_ROLE_PERIPH
)

840 
”r_code
 = 
	`sd_bË_g­_£c_·¿ms_»¶y
(
cÚn_hªdË
, 
£c_¡©us
, 
p_£c_·¿ms
, &
£c_key£t
);

844 
”r_code
 = 
	`sd_bË_g­_£c_·¿ms_»¶y
(
cÚn_hªdË
, 
£c_¡©us
, 
NULL
, &
£c_key£t
);

848 
	`£c_´oc_hou£k“pšg
(
cÚn_hªdË
,

849 
³”_id
,

850 (
”r_code
 =ğ
NRF_SUCCESS
è&& (
£c_¡©us
 =ğ
BLE_GAP_SEC_STATUS_SUCCESS
),

851 
Ãw_³”_ü—‹d
);

853  
”r_code
;

854 
	}
}

857 #ià
PM_CENTRAL_ENABLED


860 
»t_code_t
 
	$lšk_£cu»_ûÁ¿l_’üy±iÚ
(
ušt16_t
 
cÚn_hªdË
,

861 
pm_³”_id_t
 
³”_id
)

863 
pm_³”_d©a_æash_t
 
³”_d©a
;

864 
»t_code_t
 
”r_code
;

865 
bË_g­_’c_key_t
 cÚ¡ * 
p_exi¡šg_key
 = 
NULL
;

866 
boŞ
 
Ësc
 = 
çl£
;

868 
”r_code
 = 
	`pdb_³”_d©a_±r_g‘
(
³”_id
, 
PM_PEER_DATA_ID_BONDING
, &
³”_d©a
);

870 ià(
”r_code
 =ğ
NRF_SUCCESS
)

873 
p_exi¡šg_key
 = &(
³”_d©a
.
p_bÚdšg_d©a
->
³”_Ék
);

875 
Ësc
 = 
³”_d©a
.
p_bÚdšg_d©a
->
own_Ék
.
’c_šfo
.lesc;

876 ià(
Ësc
)

879 
p_exi¡šg_key
 = &(
³”_d©a
.
p_bÚdšg_d©a
->
own_Ék
);

883 ià((
”r_code
 !ğ
NRF_SUCCESS
è&& (”r_cod!ğ
NRF_ERROR_NOT_FOUND
))

885 ià(
”r_code
 !ğ
NRF_ERROR_BUSY
)

888 
”r_code
 = 
NRF_ERROR_INTERNAL
;

891 ià(
p_exi¡šg_key
 =ğ
NULL
)

895 
”r_code
 = 
NRF_ERROR_BUSY
;

897 ià(!
Ësc
 && !
	`im_ma¡”_id_is_v®id
(&(
p_exi¡šg_key
->
ma¡”_id
)))

900 
”r_code
 = 
NRF_ERROR_INVALID_DATA
;

905 
”r_code
 = 
	`sd_bË_g­_’üy±
(
cÚn_hªdË
,

906 &(
p_exi¡šg_key
->
ma¡”_id
),

907 &(
p_exi¡šg_key
->
’c_šfo
));

910 
	`£c_´oc_¡¬t
(
cÚn_hªdË
, 
”r_code
 =ğ
NRF_SUCCESS
, 
PM_LINK_SECURED_PROCEDURE_ENCRYPTION
);

911 
	`£c_´oc_hou£k“pšg
(
cÚn_hªdË
, 
³”_id
, (
”r_code
 =ğ
NRF_SUCCESS
), 
çl£
);

913  
”r_code
;

914 
	}
}

919 
»t_code_t
 
	$lšk_£cu»_ûÁ¿l_·œšg
(
ušt16_t
 
cÚn_hªdË
,

920 
pm_³”_id_t
 
³”_id
,

921 
bË_g­_£c_·¿ms_t
 * 
p_£c_·¿ms
)

923 
pm_cÚn_£c_´oûdu»_t
 
´oûdu»
 = 
PM_LINK_SECURED_PROCEDURE_PAIRING
;

924 
boŞ
 
Ãw_³”_ü—‹d
 = 
çl£
;

925 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

926 
pm_³”_d©a_t
 
dummy_³”_d©a
;

928 ià(
p_£c_·¿ms
 =ğ
NULL
)

930 
”r_code
 = 
	`sd_bË_g­_auth’tiÿ‹
(
cÚn_hªdË
, 
NULL
);

934 ià(
p_£c_·¿ms
->
bÚd
)

936 
´oûdu»
 = 
PM_LINK_SECURED_PROCEDURE_BONDING
;

938 ià(
³”_id
 =ğ
PM_PEER_ID_INVALID
)

941 
³”_id
 = 
	`pdb_³”_®loÿ‹
();

942 
Ãw_³”_ü—‹d
 = 
Œue
;

945 ià(
³”_id
 =ğ
PM_PEER_ID_INVALID
)

947 
”r_code
 = 
NRF_ERROR_INTERNAL
;

951 
”r_code
 = 
	`pdb_wr™e_buf_g‘
(
³”_id
, 
PM_PEER_DATA_ID_BONDING
, 1, &
dummy_³”_d©a
);

952 ià(
”r_code
 =ğ
NRF_SUCCESS
)

954 
”r_code
 = 
	`pdb_wr™e_buf_¡Üe_´•¬e
(
³”_id
, 
PM_PEER_DATA_ID_BONDING
);

959 ià(
”r_code
 =ğ
NRF_SUCCESS
)

961 
”r_code
 = 
	`sd_bË_g­_auth’tiÿ‹
(
cÚn_hªdË
, 
p_£c_·¿ms
);

964 ià(
”r_code
 !ğ
NRF_SUCCESS
)

966 
»t_code_t
 
”r_code_ä“
 = 
	`pdb_wr™e_buf_»Ëa£
(
³”_id
, 
PM_PEER_DATA_ID_BONDING
);

967 ià((
”r_code_ä“
 !ğ
NRF_SUCCESS
è&& (”r_code_ä“ !ğ
NRF_ERROR_NOT_FOUND
))

969 
”r_code
 = 
NRF_ERROR_INTERNAL
;

974 ià(
”r_code
 =ğ
NRF_ERROR_NO_MEM
)

977 
”r_code
 = 
NRF_ERROR_BUSY
;

980 
	`£c_´oc_¡¬t
(
cÚn_hªdË
, 
”r_code
 =ğ
NRF_SUCCESS
, 
´oûdu»
);

981 
	`£c_´oc_hou£k“pšg
(
cÚn_hªdË
, 
³”_id
, (
”r_code
 =ğ
NRF_SUCCESS
), 
Ãw_³”_ü—‹d
);

983  
”r_code
;

984 
	}
}

990 
»t_code_t
 
	$lšk_£cu»_ûÁ¿l
(
ušt16_t
 
cÚn_hªdË
,

991 
bË_g­_£c_·¿ms_t
 * 
p_£c_·¿ms
,

992 
boŞ
 
fÜû_»·œšg
)

994 
»t_code_t
 
”r_code
;

995 
pm_³”_id_t
 
³”_id
;

997 ià(
p_£c_·¿ms
 =ğ
NULL
)

999  
	`sd_bË_g­_auth’tiÿ‹
(
cÚn_hªdË
, 
NULL
);

1003 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_®low_»·œšg
, 
fÜû_»·œšg
);

1005 
³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
(
cÚn_hªdË
);

1007 ià((
³”_id
 !ğ
PM_PEER_ID_INVALID
è&& !
fÜû_»·œšg
)

1011 
”r_code
 = 
	`lšk_£cu»_ûÁ¿l_’üy±iÚ
(
cÚn_hªdË
, 
³”_id
);

1017 
”r_code
 = 
	`lšk_£cu»_ûÁ¿l_·œšg
(
cÚn_hªdË
, 
³”_id
, 
p_£c_·¿ms
);

1020  
”r_code
;

1021 
	}
}

1028 
	$£c_»que¡_´oûss
(
bË_g­_evt_t
 cÚ¡ * 
p_g­_evt
)

1030 
pm_evt_t
 
evt
 =

1032 .
evt_id
 = 
PM_EVT_SLAVE_SECURITY_REQ
,

1033 .
cÚn_hªdË
 = 
p_g­_evt
->conn_handle,

1034 .
·¿ms
 =

1036 .
¦ave_£cur™y_»q
 =

1038 .
bÚd
 = 
p_g­_evt
->
·¿ms
.
£c_»que¡
.bond,

1039 .
m™m
 = 
p_g­_evt
->
·¿ms
.
£c_»que¡
.mitm,

1043 
	`evt_£nd
(&
evt
);

1045 
	}
}

1051 
»t_code_t
 
	$lšk_£cu»_³rh”®
(
ušt16_t
 
cÚn_hªdË
, 
bË_g­_£c_·¿ms_t
 * 
p_£c_·¿ms
)

1053 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

1055 ià(
p_£c_·¿ms
 !ğ
NULL
)

1057 
”r_code
 = 
	`sd_bË_g­_auth’tiÿ‹
(
cÚn_hªdË
, 
p_£c_·¿ms
);

1060  
”r_code
;

1061 
	}
}

1064 
»t_code_t
 
	$smd_lšk_£cu»
(
ušt16_t
 
cÚn_hªdË
,

1065 
bË_g­_£c_·¿ms_t
 * 
p_£c_·¿ms
,

1066 
boŞ
 
fÜû_»·œšg
)

1068 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

1070 
ušt8_t
 
rŞe
 = 
	`bË_cÚn_¡©e_rŞe
(
cÚn_hªdË
);

1072 
rŞe
)

1074 #ià
PM_CENTRAL_ENABLED


1075 
BLE_GAP_ROLE_CENTRAL
:

1076  
	`lšk_£cu»_ûÁ¿l
(
cÚn_hªdË
, 
p_£c_·¿ms
, 
fÜû_»·œšg
);

1079 
BLE_GAP_ROLE_PERIPH
:

1080  
	`lšk_£cu»_³rh”®
(
cÚn_hªdË
, 
p_£c_·¿ms
);

1083  
BLE_ERROR_INVALID_CONN_HANDLE
;

1085 
	}
}

1088 
	$smd_bË_evt_hªdËr
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

1090 
p_bË_evt
->
h—d”
.
evt_id
)

1092 
BLE_GAP_EVT_DISCONNECTED
:

1093 
	`discÚÃù_´oûss
(&(
p_bË_evt
->
evt
.
g­_evt
));

1096 
BLE_GAP_EVT_SEC_PARAMS_REQUEST
:

1097 
	`£c_·¿ms_»que¡_´oûss
(&(
p_bË_evt
->
evt
.
g­_evt
));

1100 
BLE_GAP_EVT_SEC_INFO_REQUEST
:

1101 
	`£c_šfo_»que¡_´oûss
(&(
p_bË_evt
->
evt
.
g­_evt
));

1104 #ià
PM_CENTRAL_ENABLED


1105 
BLE_GAP_EVT_SEC_REQUEST
:

1106 
	`£c_»que¡_´oûss
(&(
p_bË_evt
->
evt
.
g­_evt
));

1110 
BLE_GAP_EVT_AUTH_STATUS
:

1111 
	`auth_¡©us_´oûss
(&(
p_bË_evt
->
evt
.
g­_evt
));

1114 
BLE_GAP_EVT_CONN_SEC_UPDATE
:

1115 
	`cÚn_£c_upd©e_´oûss
(&(
p_bË_evt
->
evt
.
g­_evt
));

1118 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\security_manager.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
PEER_MANAGER
)

42 
	~"£cur™y_mªag”.h
"

44 
	~<¡ršg.h
>

45 
	~"bË_”r.h
"

46 
	~"£cur™y_di¥©ch”.h
"

47 
	~"³”_d©aba£.h
"

48 
	~"bË_cÚn_¡©e.h
"

49 
	~"id_mªag”.h
"

53 
	#SM_EVENT_HANDLERS_CNT
 ((
m_evt_hªdËrs
è/ (m_evt_hªdËrs[0]))

	)

57 
pm_sm_evt_hªdËr
(
pm_evt_t
 * 
p_sm_evt
);

61 
pm_evt_hªdËr_š‹º®_t
 cÚ¡ 
	gm_evt_hªdËrs
[] =

63 
pm_sm_evt_hªdËr


70 
bË_g­_£c_·¿ms_t
 * 
	mp_£c_·¿ms
;

71 
bË_g­_£c_·¿ms_t
 
	m£c_·¿ms_mem
;

72 
boŞ
 
	m·¿ms_»¶y_ÿÎed
;

73 } 
	t£c_·¿ms_»¶y_cÚ‹xt_t
;

75 
boŞ
 
	gm_moduË_š™Ÿlized
;

77 
bË_g­_£c_·¿ms_t
 
	gm_£c_·¿ms
;

78 
bË_g­_£c_·¿ms_t
 * 
	gmp_£c_·¿ms
 = 
NULL
;

79 
boŞ
 
	gm_£c_·¿ms_£t
 = 
çl£
;

81 
bË_g­_Ësc_p256_pk_t
 * 
	gm_p_public_key
;

83 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_lšk_£cu»_³ndšg_busy
 = 
BLE_CONN_STATE_USER_FLAG_INVALID
;

84 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_lšk_£cu»_³ndšg_æash_fuÎ
 = 
BLE_CONN_STATE_USER_FLAG_INVALID
;

85 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_lšk_£cu»_fÜû_»·œšg
 = 
BLE_CONN_STATE_USER_FLAG_INVALID
;

86 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_lšk_£cu»_nuÎ_·¿ms
 = 
BLE_CONN_STATE_USER_FLAG_INVALID
;

87 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_·¿ms_»¶y_³ndšg_busy
 = 
BLE_CONN_STATE_USER_FLAG_INVALID
;

88 
bË_cÚn_¡©e_u£r_æag_id_t
 
	gm_æag_·¿ms_»¶y_³ndšg_æash_fuÎ
 = 
BLE_CONN_STATE_USER_FLAG_INVALID
;

95 
	$evt_£nd
(
pm_evt_t
 * 
p_ev’t
)

97 
ušt32_t
 
i
 = 0; i < 
SM_EVENT_HANDLERS_CNT
; i++)

99 
m_evt_hªdËrs
[
i
](
p_ev’t
);

101 
	}
}

112 
	$æags_£t_äom_”r_code
(
ušt16_t
 
cÚn_hªdË
, 
»t_code_t
 
”r_code
, 
boŞ
 
·¿ms_»¶y
)

114 
boŞ
 
æag_v®ue_æash_fuÎ
 = 
çl£
;

115 
boŞ
 
æag_v®ue_busy
 = 
çl£
;

117 ià((
”r_code
 =ğ
NRF_ERROR_STORAGE_FULL
))

119 
æag_v®ue_busy
 = 
çl£
;

120 
æag_v®ue_æash_fuÎ
 = 
Œue
;

122 ià(
”r_code
 =ğ
NRF_ERROR_BUSY
)

124 
æag_v®ue_busy
 = 
Œue
;

125 
æag_v®ue_æash_fuÎ
 = 
çl£
;

129 
æag_v®ue_busy
 = 
çl£
;

130 
æag_v®ue_æash_fuÎ
 = 
çl£
;

133 ià(
·¿ms_»¶y
)

135 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
,

136 
m_æag_·¿ms_»¶y_³ndšg_æash_fuÎ
,

137 
æag_v®ue_æash_fuÎ
);

138 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
,

139 
m_æag_·¿ms_»¶y_³ndšg_busy
,

140 
æag_v®ue_busy
);

141 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
,

142 
m_æag_lšk_£cu»_³ndšg_æash_fuÎ
,

143 
çl£
);

144 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
,

145 
m_æag_lšk_£cu»_³ndšg_busy
,

146 
çl£
);

150 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
,

151 
m_æag_lšk_£cu»_³ndšg_æash_fuÎ
,

152 
æag_v®ue_æash_fuÎ
);

153 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
,

154 
m_æag_lšk_£cu»_³ndšg_busy
,

155 
æag_v®ue_busy
);

157 
	}
}

169 
	$ev’ts_£nd_äom_”r_code
(
ušt16_t
 
cÚn_hªdË
,

170 
»t_code_t
 
”r_code
,

171 
bË_g­_£c_·¿ms_t
 * 
p_£c_·¿ms
)

173 ià((
”r_code
 !ğ
NRF_SUCCESS
è&& (”r_cod!ğ
NRF_ERROR_BUSY
è&& (”r_cod!ğ
NRF_ERROR_INVALID_STATE
))

175 
pm_evt_t
 
evt
 =

177 .
cÚn_hªdË
 = conn_handle,

178 .
³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
(
cÚn_hªdË
),

180 ià(
”r_code
 =ğ
NRF_ERROR_TIMEOUT
)

182 
evt
.
evt_id
 = 
PM_EVT_CONN_SEC_FAILED
;

183 
evt
.
·¿ms
.
cÚn_£c_çed
.
´oûdu»
 = ((
p_£c_·¿ms
 !ğ
NULL
è&&…_£c_·¿ms->
bÚd
)

184 ? 
PM_LINK_SECURED_PROCEDURE_BONDING


185 : 
PM_LINK_SECURED_PROCEDURE_PAIRING
;

186 
evt
.
·¿ms
.
cÚn_£c_çed
.
”rÜ_¤c
 = 
BLE_GAP_SEC_STATUS_SOURCE_LOCAL
;

187 
evt
.
·¿ms
.
cÚn_£c_çed
.
”rÜ
 = 
PM_CONN_SEC_ERROR_SMP_TIMEOUT
;

189 ià(
”r_code
 =ğ
NRF_ERROR_STORAGE_FULL
)

191 
evt
.
evt_id
 = 
PM_EVT_STORAGE_FULL
;

195 
evt
.
evt_id
 = 
PM_EVT_ERROR_UNEXPECTED
;

196 
evt
.
·¿ms
.
”rÜ_uÃx³ùed
.
”rÜ
 = 
”r_code
;

198 
	`evt_£nd
(&
evt
);

200 
	}
}

210 
	$·¿ms_»q_£nd
(
ušt16_t
 
cÚn_hªdË
,

211 
bË_g­_£c_·¿ms_t
 cÚ¡ * 
p_³”_·¿ms
,

212 
£c_·¿ms_»¶y_cÚ‹xt_t
 * 
p_cÚ‹xt
)

214 
pm_evt_t
 
evt
;

215 
evt
.
evt_id
 = 
PM_EVT_CONN_SEC_PARAMS_REQ
;

216 
evt
.
cÚn_hªdË
 = conn_handle;

217 
evt
.
³”_id
 = 
	`im_³”_id_g‘_by_cÚn_hªdË
(
cÚn_hªdË
);

218 
evt
.
·¿ms
.
cÚn_£c_·¿ms_»q
.
p_³”_·¿ms
 =…_peer_params;

219 
evt
.
·¿ms
.
cÚn_£c_·¿ms_»q
.
p_cÚ‹xt
 =…_context;

221 
	`evt_£nd
(&
evt
);

222 
	}
}

229 
£c_·¿ms_»¶y_cÚ‹xt_t
 
	$Ãw_cÚ‹xt_g‘
()

231 
£c_·¿ms_»¶y_cÚ‹xt_t
 
Ãw_cÚ‹xt
 =

233 .
p_£c_·¿ms
 = 
mp_£c_·¿ms
,

234 .
·¿ms_»¶y_ÿÎed
 = 
çl£


236  
Ãw_cÚ‹xt
;

237 
	}
}

249 
»t_code_t
 
	$lšk_£cu»
(
ušt16_t
 
cÚn_hªdË
,

250 
boŞ
 
nuÎ_·¿ms
,

251 
boŞ
 
fÜû_»·œšg
,

252 
boŞ
 
£nd_ev’ts
)

254 
»t_code_t
 
”r_code
;

255 
»t_code_t
 
»tuº_”r_code
;

256 
bË_g­_£c_·¿ms_t
 * 
p_£c_·¿ms
;

258 ià(
nuÎ_·¿ms
)

260 
p_£c_·¿ms
 = 
NULL
;

264 
£c_·¿ms_»¶y_cÚ‹xt_t
 
cÚ‹xt
 = 
	`Ãw_cÚ‹xt_g‘
();

265 
	`·¿ms_»q_£nd
(
cÚn_hªdË
, 
NULL
, &
cÚ‹xt
);

266 
p_£c_·¿ms
 = 
cÚ‹xt
.p_sec_params;

268 ià(!
m_£c_·¿ms_£t
 && !
cÚ‹xt
.
·¿ms_»¶y_ÿÎed
)

271  
NRF_ERROR_NOT_FOUND
;

276 
”r_code
 = 
	`smd_lšk_£cu»
(
cÚn_hªdË
, 
p_£c_·¿ms
, 
fÜû_»·œšg
);

278 
	`æags_£t_äom_”r_code
(
cÚn_hªdË
, 
”r_code
, 
çl£
);

280 
”r_code
)

282 
NRF_ERROR_BUSY
:

283 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_lšk_£cu»_nuÎ_·¿ms
, 
nuÎ_·¿ms
);

284 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_lšk_£cu»_fÜû_»·œšg
, 
fÜû_»·œšg
);

285 
»tuº_”r_code
 = 
NRF_SUCCESS
;

287 
NRF_ERROR_STORAGE_FULL
:

288 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_lšk_£cu»_nuÎ_·¿ms
, 
nuÎ_·¿ms
);

289 
	`bË_cÚn_¡©e_u£r_æag_£t
(
cÚn_hªdË
, 
m_æag_lšk_£cu»_fÜû_»·œšg
, 
fÜû_»·œšg
);

291 
NRF_SUCCESS
:

292 
NRF_ERROR_TIMEOUT
:

293 
BLE_ERROR_INVALID_CONN_HANDLE
:

294 
NRF_ERROR_INVALID_STATE
:

295 
»tuº_”r_code
 = 
”r_code
;

298 
»tuº_”r_code
 = 
NRF_ERROR_INTERNAL
;

302 ià(
£nd_ev’ts
)

304 
	`ev’ts_£nd_äom_”r_code
(
cÚn_hªdË
, 
”r_code
, 
p_£c_·¿ms
);

307  
»tuº_”r_code
;

308 
	}
}

316 
	$smd_·¿ms_»¶y_³rfÜm
(
ušt16_t
 
cÚn_hªdË
, 
bË_g­_£c_·¿ms_t
 cÚ¡ * 
p_³”_·¿ms
)

318 
»t_code_t
 
”r_code
;

319 
£c_·¿ms_»¶y_cÚ‹xt_t
 
cÚ‹xt
 = 
	`Ãw_cÚ‹xt_g‘
();

321 
	`·¿ms_»q_£nd
(
cÚn_hªdË
, 
p_³”_·¿ms
, &
cÚ‹xt
);

323 
”r_code
 = 
	`smd_·¿ms_»¶y
(
cÚn_hªdË
, 
cÚ‹xt
.
p_£c_·¿ms
, 
m_p_public_key
);

325 
	`æags_£t_äom_”r_code
(
cÚn_hªdË
, 
”r_code
, 
Œue
);

326 
	`ev’ts_£nd_äom_”r_code
(
cÚn_hªdË
, 
”r_code
, 
cÚ‹xt
.
p_£c_·¿ms
);

327 
	}
}

334 
__INLINE
 
	$·¿ms_»q_´oûss
(
pm_evt_t
 cÚ¡ * 
p_ev’t
)

336 
	`smd_·¿ms_»¶y_³rfÜm
(
p_ev’t
->
cÚn_hªdË
,…_ev’t->
·¿ms
.
cÚn_£c_·¿ms_»q
.
p_³”_·¿ms
);

337 
	}
}

344 
	$£c_»q_´oûss
(
pm_evt_t
 cÚ¡ * 
p_ev’t
)

346 
boŞ
 
nuÎ_·¿ms
 = 
çl£
;

347 ià(
mp_£c_·¿ms
 =ğ
NULL
)

349 
nuÎ_·¿ms
 = 
Œue
;

351 ià((
boŞ
)
m_£c_·¿ms
.
bÚd
 < (boŞ)
p_ev’t
->
·¿ms
.
¦ave_£cur™y_»q
.bond)

353 
nuÎ_·¿ms
 = 
Œue
;

355 ià((
boŞ
)
m_£c_·¿ms
.
m™m
 < (boŞ)
p_ev’t
->
·¿ms
.
¦ave_£cur™y_»q
.mitm)

357 
nuÎ_·¿ms
 = 
Œue
;

363 
»t_code_t
 
”r_code
 = 
	`lšk_£cu»
(
p_ev’t
->
cÚn_hªdË
, 
nuÎ_·¿ms
, 
çl£
, 
Œue
);

364 
	`UNUSED_VARIABLE
(
”r_code
);

366 
	}
}

373 
	$evt_fÜw¬d
(
pm_evt_t
 * 
p_ev’t
)

375 
	`evt_£nd
(
p_ev’t
);

376 
	}
}

384 
	$sm_smd_evt_hªdËr
(
pm_evt_t
 * 
p_ev’t
)

386 
p_ev’t
->
evt_id
)

388 
PM_EVT_CONN_SEC_PARAMS_REQ
:

389 
	`·¿ms_»q_´oûss
(
p_ev’t
);

391 
PM_EVT_SLAVE_SECURITY_REQ
:

392 
	`£c_»q_´oûss
(
p_ev’t
);

396 
	`evt_fÜw¬d
(
p_ev’t
);

399 
	}
}

409 
	$lšk_£cu»_³ndšg_´oûss
(
bË_cÚn_¡©e_u£r_æag_id_t
 
æag_id
)

411 
sdk_m­³d_æags_t
 
æag_cŞËùiÚ
 = 
	`bË_cÚn_¡©e_u£r_æag_cŞËùiÚ
(
æag_id
);

412 ià(
	`sdk_m­³d_æags_ªy_£t
(
æag_cŞËùiÚ
))

414 
sdk_m­³d_æags_key_li¡_t
 
cÚn_hªdË_li¡
 = 
	`bË_cÚn_¡©e_cÚn_hªdËs
();

416 
ušt32_t
 
i
 = 0; i < 
cÚn_hªdË_li¡
.
Ën
; i++)

418 
boŞ
 
³ndšg
 = 
	`bË_cÚn_¡©e_u£r_æag_g‘
(
cÚn_hªdË_li¡
.
æag_keys
[
i
], 
æag_id
);

419 ià(
³ndšg
)

421 
boŞ
 
fÜû_»·œšg
 = 
	`bË_cÚn_¡©e_u£r_æag_g‘
(
cÚn_hªdË_li¡
.
æag_keys
[
i
], 
m_æag_lšk_£cu»_fÜû_»·œšg
);

422 
boŞ
 
nuÎ_·¿ms
 = 
	`bË_cÚn_¡©e_u£r_æag_g‘
(
cÚn_hªdË_li¡
.
æag_keys
[
i
], 
m_æag_lšk_£cu»_nuÎ_·¿ms
);

424 
»t_code_t
 
”r_code
 = 
	`lšk_£cu»
(
cÚn_hªdË_li¡
.
æag_keys
[
i
], 
nuÎ_·¿ms
, 
fÜû_»·œšg
, 
Œue
);

425 
	`UNUSED_VARIABLE
(
”r_code
);

429 
	}
}

439 
	$·¿ms_»¶y_³ndšg_´oûss
(
bË_cÚn_¡©e_u£r_æag_id_t
 
æag_id
)

441 
sdk_m­³d_æags_t
 
æag_cŞËùiÚ
 = 
	`bË_cÚn_¡©e_u£r_æag_cŞËùiÚ
(
æag_id
);

442 ià(
	`sdk_m­³d_æags_ªy_£t
(
æag_cŞËùiÚ
))

444 
sdk_m­³d_æags_key_li¡_t
 
cÚn_hªdË_li¡
 = 
	`bË_cÚn_¡©e_cÚn_hªdËs
();

446 
ušt32_t
 
i
 = 0; i < 
cÚn_hªdË_li¡
.
Ën
; i++)

448 
boŞ
 
³ndšg
 = 
	`bË_cÚn_¡©e_u£r_æag_g‘
(
cÚn_hªdË_li¡
.
æag_keys
[
i
], 
æag_id
);

449 ià(
³ndšg
)

451 
	`smd_·¿ms_»¶y_³rfÜm
(
cÚn_hªdË_li¡
.
æag_keys
[
i
], 
NULL
);

455 
	}
}

463 
	$sm_pdb_evt_hªdËr
(
pm_evt_t
 * 
p_ev’t
)

465 
p_ev’t
->
evt_id
)

467 
PM_EVT_FLASH_GARBAGE_COLLECTED
:

468 
	`·¿ms_»¶y_³ndšg_´oûss
(
m_æag_·¿ms_»¶y_³ndšg_æash_fuÎ
);

469 
	`lšk_£cu»_³ndšg_´oûss
(
m_æag_lšk_£cu»_³ndšg_æash_fuÎ
);

471 
PM_EVT_PEER_DATA_UPDATE_SUCCEEDED
:

472 
PM_EVT_PEER_DATA_UPDATE_FAILED
:

473 
PM_EVT_PEER_DELETE_SUCCEEDED
:

474 
PM_EVT_PEER_DELETE_FAILED
:

475 
	`·¿ms_»¶y_³ndšg_´oûss
(
m_æag_·¿ms_»¶y_³ndšg_busy
);

476 
	`lšk_£cu»_³ndšg_´oûss
(
m_æag_lšk_£cu»_³ndšg_busy
);

482 
	}
}

489 
	$æag_id_š™
(
bË_cÚn_¡©e_u£r_æag_id_t
 * 
p_æag_id
)

491 ià(*
p_æag_id
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
)

493 *
p_æag_id
 = 
	`bË_cÚn_¡©e_u£r_æag_acquœe
();

495 
	}
}

498 
»t_code_t
 
	$sm_š™
()

500 
	`NRF_PM_DEBUG_CHECK
(!
m_moduË_š™Ÿlized
);

502 
	`æag_id_š™
(&
m_æag_lšk_£cu»_³ndšg_busy
);

503 
	`æag_id_š™
(&
m_æag_lšk_£cu»_³ndšg_æash_fuÎ
);

504 
	`æag_id_š™
(&
m_æag_lšk_£cu»_fÜû_»·œšg
);

505 
	`æag_id_š™
(&
m_æag_lšk_£cu»_nuÎ_·¿ms
);

506 
	`æag_id_š™
(&
m_æag_·¿ms_»¶y_³ndšg_busy
);

507 
	`æag_id_š™
(&
m_æag_·¿ms_»¶y_³ndšg_æash_fuÎ
);

509 ià(
m_æag_·¿ms_»¶y_³ndšg_æash_fuÎ
 =ğ
BLE_CONN_STATE_USER_FLAG_INVALID
)

511  
NRF_ERROR_INTERNAL
;

514 
m_moduË_š™Ÿlized
 = 
Œue
;

516  
NRF_SUCCESS
;

517 
	}
}

520 
	$sm_bË_evt_hªdËr
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
)

522 
	`NRF_PM_DEBUG_CHECK
(
p_bË_evt
 !ğ
NULL
);

524 
	`smd_bË_evt_hªdËr
(
p_bË_evt
);

525 
	`lšk_£cu»_³ndšg_´oûss
(
m_æag_lšk_£cu»_³ndšg_busy
);

526 
	}
}

535 
boŞ
 
	$£c_·¿ms_v”ify
(
bË_g­_£c_·¿ms_t
 * 
p_£c_·¿ms
)

538 ià(
p_£c_·¿ms
 =ğ
NULL
)

540  
çl£
;

544 ià(!
p_£c_·¿ms
->
m™m
 &&…_£c_·¿ms->
oob
)

546  
çl£
;

550 ià(
p_£c_·¿ms
->
io_ÿps
 > 
BLE_GAP_IO_CAPS_KEYBOARD_DISPLAY
)

552  
çl£
;

556 ià(
p_£c_·¿ms
->
m™m
 && (p_£c_·¿ms->
io_ÿps
 =ğ
BLE_GAP_IO_CAPS_NONE
è&& !p_£c_·¿ms->
oob
)

558  
çl£
;

562 ià(
p_£c_·¿ms
->
mš_key_size
 >…_£c_·¿ms->
max_key_size
)

564  
çl£
;

568 ià(
p_£c_·¿ms
->
mš_key_size
 < 7)

570  
çl£
;

574 ià(
p_£c_·¿ms
->
max_key_size
 > 16)

576  
çl£
;

580 ià(
p_£c_·¿ms
->
kdi¡_own
.
sign
 ||…_£c_·¿ms->
kdi¡_³”
.sign)

582  
çl£
;

586 ià(
p_£c_·¿ms
->
kdi¡_own
.
lšk
 ||…_£c_·¿ms->
kdi¡_³”
.link)

588  
çl£
;

592 ià(!
p_£c_·¿ms
->
bÚd
 && (…_£c_·¿ms->
kdi¡_own
.
’c


593 || 
p_£c_·¿ms
->
kdi¡_own
.
id


594 || 
p_£c_·¿ms
->
kdi¡_³”
.
’c


595 || 
p_£c_·¿ms
->
kdi¡_³”
.
id
))

597  
çl£
;

601 iàĞ
p_£c_·¿ms
->
bÚd


602 && !
p_£c_·¿ms
->
kdi¡_own
.
’c


603 && !
p_£c_·¿ms
->
kdi¡_own
.
id


604 && !
p_£c_·¿ms
->
kdi¡_³”
.
’c


605 && !
p_£c_·¿ms
->
kdi¡_³”
.
id
)

607  
çl£
;

610  
Œue
;

611 
	}
}

614 
»t_code_t
 
	$sm_£c_·¿ms_£t
(
bË_g­_£c_·¿ms_t
 * 
p_£c_·¿ms
)

616 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

618 ià(
p_£c_·¿ms
 =ğ
NULL
)

620 
mp_£c_·¿ms
 = 
NULL
;

621 
m_£c_·¿ms_£t
 = 
Œue
;

622  
NRF_SUCCESS
;

624 ià(
	`£c_·¿ms_v”ify
(
p_£c_·¿ms
))

626 
m_£c_·¿ms
 = *
p_£c_·¿ms
;

627 
mp_£c_·¿ms
 = &
m_£c_·¿ms
;

628 
m_£c_·¿ms_£t
 = 
Œue
;

629  
NRF_SUCCESS
;

633  
NRF_ERROR_INVALID_PARAM
;

635 
	}
}

638 
	$sm_cÚn_£c_cÚfig_»¶y
(
ušt16_t
 
cÚn_hªdË
, 
pm_cÚn_£c_cÚfig_t
 * 
p_cÚn_£c_cÚfig
)

640 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

641 
	`NRF_PM_DEBUG_CHECK
(
p_cÚn_£c_cÚfig
 !ğ
NULL
);

643 
	`smd_cÚn_£c_cÚfig_»¶y
(
cÚn_hªdË
, 
p_cÚn_£c_cÚfig
);

644 
	}
}

647 
»t_code_t
 
	$sm_£c_·¿ms_»¶y
(
ušt16_t
 
cÚn_hªdË
,

648 
bË_g­_£c_·¿ms_t
 * 
p_£c_·¿ms
,

649 cÚ¡ * 
p_cÚ‹xt
)

651 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

652 
	`VERIFY_PARAM_NOT_NULL
(
p_cÚ‹xt
);

654 
£c_·¿ms_»¶y_cÚ‹xt_t
 * 
p_£c_·¿ms_»¶y_cÚ‹xt
 = (£c_·¿ms_»¶y_cÚ‹xt_ˆ*)
p_cÚ‹xt
;

655 ià(
p_£c_·¿ms
 =ğ
NULL
)

658 
p_£c_·¿ms_»¶y_cÚ‹xt
->
p_£c_·¿ms
 = 
NULL
;

660 ià(
	`£c_·¿ms_v”ify
(
p_£c_·¿ms
))

663 
p_£c_·¿ms_»¶y_cÚ‹xt
->
£c_·¿ms_mem
 = *
p_£c_·¿ms
;

664 
p_£c_·¿ms_»¶y_cÚ‹xt
->
p_£c_·¿ms
 = &p_£c_·¿ms_»¶y_cÚ‹xt->
£c_·¿ms_mem
;

668  
NRF_ERROR_INVALID_PARAM
;

670 
p_£c_·¿ms_»¶y_cÚ‹xt
->
·¿ms_»¶y_ÿÎed
 = 
Œue
;

672  
NRF_SUCCESS
;

673 
	}
}

676 
»t_code_t
 
	$sm_Ësc_public_key_£t
(
bË_g­_Ësc_p256_pk_t
 * 
p_public_key
)

678 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

680 
m_p_public_key
 = 
p_public_key
;

682  
NRF_SUCCESS
;

683 
	}
}

686 
»t_code_t
 
	$sm_lšk_£cu»
(
ušt16_t
 
cÚn_hªdË
, 
boŞ
 
fÜû_»·œšg
)

688 
»t_code_t
 
»t
;

690 
	`NRF_PM_DEBUG_CHECK
(
m_moduË_š™Ÿlized
);

692 
»t
 = 
	`lšk_£cu»
(
cÚn_hªdË
, 
çl£
, 
fÜû_»·œšg
, false);

693  
»t
;

694 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\boards\boards.c

40 
	~"bßrds.h
"

41 
	~<¡dšt.h
>

42 
	~<¡dboŞ.h
>

44 #ià
LEDS_NUMBER
 > 0

45 cÚ¡ 
ušt8_t
 
	gm_bßrd_Ëd_li¡
[
LEDS_NUMBER
] = 
LEDS_LIST
;

48 #ià
BUTTONS_NUMBER
 > 0

49 cÚ¡ 
ušt8_t
 
	gm_bßrd_bŠ_li¡
[
BUTTONS_NUMBER
] = 
BUTTONS_LIST
;

52 #ià
LEDS_NUMBER
 > 0

53 
boŞ
 
	$b¥_bßrd_Ëd_¡©e_g‘
(
ušt32_t
 
Ëd_idx
)

55 
	`ASSERT
(
Ëd_idx
 < 
LEDS_NUMBER
);

56 
boŞ
 
pš_£t
 = 
	`Äf_gpio_pš_out_»ad
(
m_bßrd_Ëd_li¡
[
Ëd_idx
]è? 
Œue
 : 
çl£
;

57  (
pš_£t
 =ğ(
LEDS_ACTIVE_STATE
 ? 
Œue
 : 
çl£
));

58 
	}
}

60 
	$b¥_bßrd_Ëd_Ú
(
ušt32_t
 
Ëd_idx
)

62 
	`ASSERT
(
Ëd_idx
 < 
LEDS_NUMBER
);

63 
	`Äf_gpio_pš_wr™e
(
m_bßrd_Ëd_li¡
[
Ëd_idx
], 
LEDS_ACTIVE_STATE
 ? 1 : 0);

64 
	}
}

66 
	$b¥_bßrd_Ëd_off
(
ušt32_t
 
Ëd_idx
)

68 
	`ASSERT
(
Ëd_idx
 < 
LEDS_NUMBER
);

69 
	`Äf_gpio_pš_wr™e
(
m_bßrd_Ëd_li¡
[
Ëd_idx
], 
LEDS_ACTIVE_STATE
 ? 0 : 1);

70 
	}
}

72 
	$b¥_bßrd_Ëds_off
()

74 
ušt32_t
 
i
;

75 
i
 = 0; i < 
LEDS_NUMBER
; ++i)

77 
	`b¥_bßrd_Ëd_off
(
i
);

79 
	}
}

81 
	$b¥_bßrd_Ëds_Ú
()

83 
ušt32_t
 
i
;

84 
i
 = 0; i < 
LEDS_NUMBER
; ++i)

86 
	`b¥_bßrd_Ëd_Ú
(
i
);

88 
	}
}

90 
	$b¥_bßrd_Ëd_šv”t
(
ušt32_t
 
Ëd_idx
)

92 
	`ASSERT
(
Ëd_idx
 < 
LEDS_NUMBER
);

93 
	`Äf_gpio_pš_toggË
(
m_bßrd_Ëd_li¡
[
Ëd_idx
]);

94 
	}
}

96 
	$b¥_bßrd_Ëds_š™
()

98 
ušt32_t
 
i
;

99 
i
 = 0; i < 
LEDS_NUMBER
; ++i)

101 
	`Äf_gpio_cfg_ouut
(
m_bßrd_Ëd_li¡
[
i
]);

103 
	`b¥_bßrd_Ëds_off
();

104 
	}
}

106 
ušt32_t
 
	$b¥_bßrd_Ëd_idx_to_pš
(
ušt32_t
 
Ëd_idx
)

108 
	`ASSERT
(
Ëd_idx
 < 
LEDS_NUMBER
);

109  
m_bßrd_Ëd_li¡
[
Ëd_idx
];

110 
	}
}

112 
ušt32_t
 
	$b¥_bßrd_pš_to_Ëd_idx
(
ušt32_t
 
pš_numb”
)

114 
ušt32_t
 
»t
 = 0xFFFFFFFF;

115 
ušt32_t
 
i
;

116 
i
 = 0; i < 
LEDS_NUMBER
; ++i)

118 ià(
m_bßrd_Ëd_li¡
[
i
] =ğ
pš_numb”
)

120 
»t
 = 
i
;

124  
»t
;

125 
	}
}

128 #ià
BUTTONS_NUMBER
 > 0

129 
boŞ
 
	$b¥_bßrd_bu‰Ú_¡©e_g‘
(
ušt32_t
 
bu‰Ú_idx
)

131 
	`ASSERT
(
bu‰Ú_idx
 < 
BUTTONS_NUMBER
);

132 
boŞ
 
pš_£t
 = 
	`Äf_gpio_pš_»ad
(
m_bßrd_bŠ_li¡
[
bu‰Ú_idx
]è? 
Œue
 : 
çl£
;

133  (
pš_£t
 =ğ(
BUTTONS_ACTIVE_STATE
 ? 
Œue
 : 
çl£
));

134 
	}
}

136 
	$b¥_bßrd_bu‰Ús_š™
()

138 
ušt32_t
 
i
;

139 
i
 = 0; i < 
BUTTONS_NUMBER
; ++i)

141 
	`Äf_gpio_cfg_šput
(
m_bßrd_bŠ_li¡
[
i
], 
BUTTON_PULL
);

143 
	}
}

145 
ušt32_t
 
	$b¥_bßrd_pš_to_bu‰Ú_idx
(
ušt32_t
 
pš_numb”
)

147 
ušt32_t
 
i
;

148 
ušt32_t
 
»t
 = 0xFFFFFFFF;

149 
i
 = 0; i < 
BUTTONS_NUMBER
; ++i)

151 ià(
m_bßrd_bŠ_li¡
[
i
] =ğ
pš_numb”
)

153 
»t
 = 
i
;

157  
»t
;

158 
	}
}

160 
ušt32_t
 
	$b¥_bßrd_bu‰Ú_idx_to_pš
(
ušt32_t
 
bu‰Ú_idx
)

162 
	`ASSERT
(
bu‰Ú_idx
 < 
BUTTONS_NUMBER
);

163  
m_bßrd_bŠ_li¡
[
bu‰Ú_idx
];

164 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\drivers_nrf\clock\nrf_drv_clock.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
CLOCK
)

43 
	~"Äf_drv_şock.h
"

44 
	~"Äf_”rÜ.h
"

45 
	~"­p_ut_¶©fÜm.h
"

46 #ifdeà
SOFTDEVICE_PRESENT


47 
	~"Äf_sdh.h
"

48 
	~"Äf_sdh_soc.h
"

51 
	#NRF_LOG_MODULE_NAME
 
şock


	)

53 #ià
CLOCK_CONFIG_LOG_ENABLED


54 
	#NRF_LOG_LEVEL
 
CLOCK_CONFIG_LOG_LEVEL


	)

55 
	#NRF_LOG_INFO_COLOR
 
CLOCK_CONFIG_INFO_COLOR


	)

56 
	#NRF_LOG_DEBUG_COLOR
 
CLOCK_CONFIG_DEBUG_COLOR


	)

57 
	#EVT_TO_STR
(
ev’t
èÓv’ˆ=ğ
NRF_CLOCK_EVENT_HFCLKSTARTED
 ? "NRF_CLOCK_EVENT_HFCLKSTARTED" : \

58 (
ev’t
 =ğ
NRF_CLOCK_EVENT_LFCLKSTARTED
 ? "NRF_CLOCK_EVENT_LFCLKSTARTED" : \

59 (
ev’t
 =ğ
NRF_CLOCK_EVENT_DONE
 ? "NRF_CLOCK_EVENT_DONE" : \

60 (
ev’t
 =ğ
NRF_CLOCK_EVENT_CTTO
 ? "NRF_CLOCK_EVENT_CTTO" : "UNKNOWN EVENT"))))

	)

62 
	#EVT_TO_STR
(
ev’t
è""

	)

63 
	#NRF_LOG_LEVEL
 0

	)

65 
	~"Äf_log.h
"

66 
NRF_LOG_MODULE_REGISTER
();

69 
INTERRUPT_PRIORITY_VALIDATION
(
CLOCK_CONFIG_IRQ_PRIORITY
);

72 
	#NRF_CLOCK_LFCLK_RC
 
CLOCK_LFCLKSRC_SRC_RC


	)

73 
	#NRF_CLOCK_LFCLK_Xl
 
CLOCK_LFCLKSRC_SRC_Xl


	)

74 
	#NRF_CLOCK_LFCLK_SyÁh
 
CLOCK_LFCLKSRC_SRC_SyÁh


	)

77 #ià(
CLOCK_CONFIG_LF_SRC
 =ğ
NRF_CLOCK_LFCLK_RC
è&& !
defšed
(
SOFTDEVICE_PRESENT
)

78 
	#CALIBRATION_SUPPORT
 1

	)

80 
	#CALIBRATION_SUPPORT
 0

	)

84 
	mCAL_STATE_IDLE
,

85 
	mCAL_STATE_CT
,

86 
	mCAL_STATE_HFCLK_REQ
,

87 
	mCAL_STATE_CAL
,

88 
	mCAL_STATE_ABORT
,

89 } 
	tÄf_drv_şock_ÿl_¡©e_t
;

94 
boŞ
 
	mmoduË_š™Ÿlized
;

95 vŞ©
boŞ
 
	mhfşk_Ú
;

96 vŞ©
boŞ
 
	mlfşk_Ú
;

97 vŞ©
ušt32_t
 
	mhfşk_»que¡s
;

98 vŞ©
Äf_drv_şock_hªdËr_™em_t
 * 
	mp_hf_h—d
;

99 vŞ©
ušt32_t
 
	mlfşk_»que¡s
;

100 vŞ©
Äf_drv_şock_hªdËr_™em_t
 * 
	mp_lf_h—d
;

101 #ià
CALIBRATION_SUPPORT


102 
Äf_drv_şock_hªdËr_™em_t
 
	mÿl_hfşk_¡¬‹d_hªdËr_™em
;

103 
Äf_drv_şock_ev’t_hªdËr_t
 
	mÿl_dÚe_hªdËr
;

104 vŞ©
Äf_drv_şock_ÿl_¡©e_t
 
	mÿl_¡©e
;

106 } 
	tÄf_drv_şock_cb_t
;

108 
Äf_drv_şock_cb_t
 
	gm_şock_cb
;

113 
	$lfşk_¡¬t
()

115 
	`Äf_şock_ev’t_ş—r
(
NRF_CLOCK_EVENT_LFCLKSTARTED
);

116 
	`Äf_şock_št_’abË
(
NRF_CLOCK_INT_LF_STARTED_MASK
);

117 
	`Äf_şock_sk_Œigg”
(
NRF_CLOCK_TASK_LFCLKSTART
);

118 
	}
}

122 
	$lfşk_¡İ
()

124 #ià
CALIBRATION_SUPPORT


125 ()
	`Äf_drv_şock_ÿlib¿tiÚ_abÜt
();

128 #ifdeà
SOFTDEVICE_PRESENT


132 
	`ASSERT
(!
	`Äf_sdh_is_’abËd
());

135 
	`Äf_şock_sk_Œigg”
(
NRF_CLOCK_TASK_LFCLKSTOP
);

136 
	`Äf_şock_lf_is_ruÂšg
())

138 
m_şock_cb
.
lfşk_Ú
 = 
çl£
;

139 
	}
}

141 
	$hfşk_¡¬t
()

143 #ifdeà
SOFTDEVICE_PRESENT


144 ià(
	`Äf_sdh_is_’abËd
())

146 ()
	`sd_şock_hfşk_»que¡
();

151 
	`Äf_şock_ev’t_ş—r
(
NRF_CLOCK_EVENT_HFCLKSTARTED
);

152 
	`Äf_şock_št_’abË
(
NRF_CLOCK_INT_HF_STARTED_MASK
);

153 
	`Äf_şock_sk_Œigg”
(
NRF_CLOCK_TASK_HFCLKSTART
);

154 
	}
}

156 
	$hfşk_¡İ
()

158 #ifdeà
SOFTDEVICE_PRESENT


159 ià(
	`Äf_sdh_is_’abËd
())

161 ()
	`sd_şock_hfşk_»Ëa£
();

166 
	`Äf_şock_sk_Œigg”
(
NRF_CLOCK_TASK_HFCLKSTOP
);

167 
	`Äf_şock_hf_is_ruÂšg
(
NRF_CLOCK_HFCLK_HIGH_ACCURACY
))

169 
m_şock_cb
.
hfşk_Ú
 = 
çl£
;

170 
	}
}

172 
boŞ
 
	$Äf_drv_şock_š™_check
()

174  
m_şock_cb
.
moduË_š™Ÿlized
;

175 
	}
}

177 
»t_code_t
 
	$Äf_drv_şock_š™
()

179 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

180 ià(
m_şock_cb
.
moduË_š™Ÿlized
)

182 
”r_code
 = 
NRF_ERROR_MODULE_ALREADY_INITIALIZED
;

186 
m_şock_cb
.
p_hf_h—d
 = 
NULL
;

187 
m_şock_cb
.
hfşk_»que¡s
 = 0;

188 
m_şock_cb
.
p_lf_h—d
 = 
NULL
;

189 
m_şock_cb
.
lfşk_»que¡s
 = 0;

190 
	`Äf_drv_commÚ_pow”_şock_œq_š™
();

191 #ifdeà
SOFTDEVICE_PRESENT


192 ià(!
	`Äf_sdh_is_’abËd
())

195 
	`Äf_şock_lf_¤c_£t
((
Äf_şock_lfşk_t
)
CLOCK_CONFIG_LF_SRC
);

198 #ià
CALIBRATION_SUPPORT


199 
m_şock_cb
.
ÿl_¡©e
 = 
CAL_STATE_IDLE
;

202 
m_şock_cb
.
moduË_š™Ÿlized
 = 
Œue
;

205 
	`NRF_LOG_INFO
("Function: %s,ƒrror code: %s.",

206 (
ušt32_t
)
__func__
, (ušt32_t)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

207  
”r_code
;

208 
	}
}

210 
	$Äf_drv_şock_unš™
()

212 
	`ASSERT
(
m_şock_cb
.
moduË_š™Ÿlized
);

213 
	`Äf_drv_commÚ_şock_œq_di§bË
();

214 
	`Äf_şock_št_di§bË
(0xFFFFFFFF);

216 
	`lfşk_¡İ
();

217 
	`hfşk_¡İ
();

218 
m_şock_cb
.
moduË_š™Ÿlized
 = 
çl£
;

219 
	`NRF_LOG_INFO
("Uninitialized.");

220 
	}
}

222 
	$™em_’queue
(
Äf_drv_şock_hªdËr_™em_t
 ** 
p_h—d
,

223 
Äf_drv_şock_hªdËr_™em_t
 * 
p_™em
)

225 
Äf_drv_şock_hªdËr_™em_t
 * 
p_Ãxt
 = *
p_h—d
;

226 
p_Ãxt
)

228 ià(
p_Ãxt
 =ğ
p_™em
)

232 
p_Ãxt
 =…_next->p_next;

235 
p_™em
->
p_Ãxt
 = (*
p_h—d
 ? *p_h—d : 
NULL
);

236 *
p_h—d
 = 
p_™em
;

237 
	}
}

239 
Äf_drv_şock_hªdËr_™em_t
 * 
	$™em_dequeue
(
Äf_drv_şock_hªdËr_™em_t
 ** 
p_h—d
)

241 
Äf_drv_şock_hªdËr_™em_t
 * 
p_™em
 = *
p_h—d
;

242 ià(
p_™em
)

244 *
p_h—d
 = 
p_™em
->
p_Ãxt
;

246  
p_™em
;

247 
	}
}

249 
	$Äf_drv_şock_lfşk_»que¡
(
Äf_drv_şock_hªdËr_™em_t
 * 
p_hªdËr_™em
)

251 
	`ASSERT
(
m_şock_cb
.
moduË_š™Ÿlized
);

253 ià(
m_şock_cb
.
lfşk_Ú
)

255 ià(
p_hªdËr_™em
)

257 
p_hªdËr_™em
->
	`ev’t_hªdËr
(
NRF_DRV_CLOCK_EVT_LFCLK_STARTED
);

259 
	`CRITICAL_REGION_ENTER
();

260 ++(
m_şock_cb
.
lfşk_»que¡s
);

261 
	`CRITICAL_REGION_EXIT
();

265 
	`CRITICAL_REGION_ENTER
();

266 ià(
p_hªdËr_™em
)

268 
	`™em_’queue
((
Äf_drv_şock_hªdËr_™em_t
 **)&
m_şock_cb
.
p_lf_h—d
,

269 
p_hªdËr_™em
);

271 ià(
m_şock_cb
.
lfşk_»que¡s
 == 0)

273 
	`lfşk_¡¬t
();

275 ++(
m_şock_cb
.
lfşk_»que¡s
);

276 
	`CRITICAL_REGION_EXIT
();

279 
	`ASSERT
(
m_şock_cb
.
lfşk_»que¡s
 > 0);

280 
	}
}

282 
	$Äf_drv_şock_lfşk_»Ëa£
()

284 
	`ASSERT
(
m_şock_cb
.
moduË_š™Ÿlized
);

285 
	`ASSERT
(
m_şock_cb
.
lfşk_»que¡s
 > 0);

287 
	`CRITICAL_REGION_ENTER
();

288 --(
m_şock_cb
.
lfşk_»que¡s
);

289 ià(
m_şock_cb
.
lfşk_»que¡s
 == 0)

291 
	`lfşk_¡İ
();

293 
	`CRITICAL_REGION_EXIT
();

294 
	}
}

296 
boŞ
 
	$Äf_drv_şock_lfşk_is_ruÂšg
()

298 
	`ASSERT
(
m_şock_cb
.
moduË_š™Ÿlized
);

300 #ifdeà
SOFTDEVICE_PRESENT


301 ià(
	`Äf_sdh_is_’abËd
())

303  
Œue
;

307  
	`Äf_şock_lf_is_ruÂšg
();

308 
	}
}

310 
	$Äf_drv_şock_hfşk_»que¡
(
Äf_drv_şock_hªdËr_™em_t
 * 
p_hªdËr_™em
)

312 
	`ASSERT
(
m_şock_cb
.
moduË_š™Ÿlized
);

314 ià(
m_şock_cb
.
hfşk_Ú
)

316 ià(
p_hªdËr_™em
)

318 
p_hªdËr_™em
->
	`ev’t_hªdËr
(
NRF_DRV_CLOCK_EVT_HFCLK_STARTED
);

320 
	`CRITICAL_REGION_ENTER
();

321 ++(
m_şock_cb
.
hfşk_»que¡s
);

322 
	`CRITICAL_REGION_EXIT
();

326 
	`CRITICAL_REGION_ENTER
();

327 ià(
p_hªdËr_™em
)

329 
	`™em_’queue
((
Äf_drv_şock_hªdËr_™em_t
 **)&
m_şock_cb
.
p_hf_h—d
,

330 
p_hªdËr_™em
);

332 ià(
m_şock_cb
.
hfşk_»que¡s
 == 0)

334 
	`hfşk_¡¬t
();

336 ++(
m_şock_cb
.
hfşk_»que¡s
);

337 
	`CRITICAL_REGION_EXIT
();

340 
	`ASSERT
(
m_şock_cb
.
hfşk_»que¡s
 > 0);

341 
	}
}

343 
	$Äf_drv_şock_hfşk_»Ëa£
()

345 
	`ASSERT
(
m_şock_cb
.
moduË_š™Ÿlized
);

346 
	`ASSERT
(
m_şock_cb
.
hfşk_»que¡s
 > 0);

348 
	`CRITICAL_REGION_ENTER
();

349 --(
m_şock_cb
.
hfşk_»que¡s
);

350 ià(
m_şock_cb
.
hfşk_»que¡s
 == 0)

352 
	`hfşk_¡İ
();

354 
	`CRITICAL_REGION_EXIT
();

355 
	}
}

357 
boŞ
 
	$Äf_drv_şock_hfşk_is_ruÂšg
()

359 
	`ASSERT
(
m_şock_cb
.
moduË_š™Ÿlized
);

361 #ifdeà
SOFTDEVICE_PRESENT


362 ià(
	`Äf_sdh_is_’abËd
())

364 
ušt32_t
 
is_ruÂšg
;

365 
	`UNUSED_VARIABLE
(
	`sd_şock_hfşk_is_ruÂšg
(&
is_ruÂšg
));

366  (
is_ruÂšg
 ? 
Œue
 : 
çl£
);

370  
	`Äf_şock_hf_is_ruÂšg
(
NRF_CLOCK_HFCLK_HIGH_ACCURACY
);

371 
	}
}

373 #ià
CALIBRATION_SUPPORT


374 
	$şock_ÿlib¿tiÚ_hf_¡¬‹d
(
Äf_drv_şock_evt_ty³_t
 
ev’t
)

376 ià(
m_şock_cb
.
ÿl_¡©e
 =ğ
CAL_STATE_ABORT
)

378 
	`Äf_drv_şock_hfşk_»Ëa£
();

379 
m_şock_cb
.
ÿl_¡©e
 = 
CAL_STATE_IDLE
;

380 ià(
m_şock_cb
.
ÿl_dÚe_hªdËr
)

382 
m_şock_cb
.
	`ÿl_dÚe_hªdËr
(
NRF_DRV_CLOCK_EVT_CAL_ABORTED
);

387 
	`Äf_şock_ev’t_ş—r
(
NRF_CLOCK_EVENT_DONE
);

388 
	`Äf_şock_št_’abË
(
NRF_CLOCK_INT_DONE_MASK
);

389 
m_şock_cb
.
ÿl_¡©e
 = 
CAL_STATE_CAL
;

390 
	`Äf_şock_sk_Œigg”
(
NRF_CLOCK_TASK_CAL
);

392 
	}
}

395 
»t_code_t
 
	$Äf_drv_şock_ÿlib¿tiÚ_¡¬t
(
ušt8_t
 
š‹rv®
, 
Äf_drv_şock_ev’t_hªdËr_t
 
hªdËr
)

397 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

398 #ià
CALIBRATION_SUPPORT


399 
	`ASSERT
(
m_şock_cb
.
ÿl_¡©e
 =ğ
CAL_STATE_IDLE
);

400 ià(
m_şock_cb
.
lfşk_Ú
 =ğ
çl£
)

402 
”r_code
 = 
NRF_ERROR_INVALID_STATE
;

404 ià(
m_şock_cb
.
ÿl_¡©e
 =ğ
CAL_STATE_IDLE
)

406 
m_şock_cb
.
ÿl_dÚe_hªdËr
 = 
hªdËr
;

407 
m_şock_cb
.
ÿl_hfşk_¡¬‹d_hªdËr_™em
.
ev’t_hªdËr
 = 
şock_ÿlib¿tiÚ_hf_¡¬‹d
;

408 ià(
š‹rv®
 == 0)

410 
m_şock_cb
.
ÿl_¡©e
 = 
CAL_STATE_HFCLK_REQ
;

411 
	`Äf_drv_şock_hfşk_»que¡
(&
m_şock_cb
.
ÿl_hfşk_¡¬‹d_hªdËr_™em
);

415 
m_şock_cb
.
ÿl_¡©e
 = 
CAL_STATE_CT
;

416 
	`Äf_şock_ÿl_tim”_timeout_£t
(
š‹rv®
);

417 
	`Äf_şock_ev’t_ş—r
(
NRF_CLOCK_EVENT_CTTO
);

418 
	`Äf_şock_št_’abË
(
NRF_CLOCK_INT_CTTO_MASK
);

419 
	`Äf_şock_sk_Œigg”
(
NRF_CLOCK_TASK_CTSTART
);

424 
”r_code
 = 
NRF_ERROR_BUSY
;

426 
	`NRF_LOG_WARNING
("FunùiÚ: %s,ƒ¼Ü code: %s.", (
ušt32_t
)
__func__
, (ušt32_t)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

427  
”r_code
;

429 
”r_code
 = 
NRF_ERROR_FORBIDDEN
;

430 
	`NRF_LOG_WARNING
("FunùiÚ: %s,ƒ¼Ü code: %s.", (
ušt32_t
)
__func__
, (ušt32_t)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

431  
”r_code
;

433 
	}
}

435 
»t_code_t
 
	$Äf_drv_şock_ÿlib¿tiÚ_abÜt
()

437 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

438 #ià
CALIBRATION_SUPPORT


439 
	`CRITICAL_REGION_ENTER
();

440 
m_şock_cb
.
ÿl_¡©e
)

442 
CAL_STATE_CT
:

443 
	`Äf_şock_št_di§bË
(
NRF_CLOCK_INT_CTTO_MASK
);

444 
	`Äf_şock_sk_Œigg”
(
NRF_CLOCK_TASK_CTSTOP
);

445 
m_şock_cb
.
ÿl_¡©e
 = 
CAL_STATE_IDLE
;

446 ià(
m_şock_cb
.
ÿl_dÚe_hªdËr
)

448 
m_şock_cb
.
	`ÿl_dÚe_hªdËr
(
NRF_DRV_CLOCK_EVT_CAL_ABORTED
);

451 
CAL_STATE_HFCLK_REQ
:

453 
CAL_STATE_CAL
:

454 
m_şock_cb
.
ÿl_¡©e
 = 
CAL_STATE_ABORT
;

459 
	`CRITICAL_REGION_EXIT
();

461 
	`NRF_LOG_INFO
("FunùiÚ: %s,ƒ¼Ü code: %s.", (
ušt32_t
)
__func__
, (ušt32_t)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

462  
”r_code
;

464 
”r_code
 = 
NRF_ERROR_FORBIDDEN
;

465 
	`NRF_LOG_WARNING
("FunùiÚ: %s,ƒ¼Ü code: %s.", (
ušt32_t
)
__func__
, (ušt32_t)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

466  
”r_code
;

468 
	}
}

470 
»t_code_t
 
	$Äf_drv_şock_is_ÿlib¿tšg
(
boŞ
 * 
p_is_ÿlib¿tšg
)

472 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

473 #ià
CALIBRATION_SUPPORT


474 
	`ASSERT
(
m_şock_cb
.
moduË_š™Ÿlized
);

475 *
p_is_ÿlib¿tšg
 = (
m_şock_cb
.
ÿl_¡©e
 !ğ
CAL_STATE_IDLE
);

476 
	`NRF_LOG_INFO
("FunùiÚ: %s,ƒ¼Ü code: %s.", (
ušt32_t
)
__func__
, (ušt32_t)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

477  
”r_code
;

479 
”r_code
 = 
NRF_ERROR_FORBIDDEN
;

480 
	`NRF_LOG_WARNING
("FunùiÚ: %s,ƒ¼Ü code: %s.", (
ušt32_t
)
__func__
, (ušt32_t)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

481  
”r_code
;

483 
	}
}

485 
__STATIC_INLINE
 
	$şock_şk_¡¬‹d_nÙify
(
Äf_drv_şock_evt_ty³_t
 
evt_ty³
)

487 
Äf_drv_şock_hªdËr_™em_t
 **
p_h—d
;

488 ià(
evt_ty³
 =ğ
NRF_DRV_CLOCK_EVT_HFCLK_STARTED
)

490 
p_h—d
 = (
Äf_drv_şock_hªdËr_™em_t
 **)&
m_şock_cb
.
p_hf_h—d
;

494 
p_h—d
 = (
Äf_drv_şock_hªdËr_™em_t
 **)&
m_şock_cb
.
p_lf_h—d
;

499 
Äf_drv_şock_hªdËr_™em_t
 * 
p_™em
 = 
	`™em_dequeue
(
p_h—d
);

500 ià(!
p_™em
)

505 
p_™em
->
	`ev’t_hªdËr
(
evt_ty³
);

507 
	}
}

509 #ià
NRF_DRV_COMMON_POWER_CLOCK_ISR


510 
	$Äf_drv_şock_ÚIRQ
()

512 
	$POWER_CLOCK_IRQHªdËr
()

515 ià(
	`Äf_şock_ev’t_check
(
NRF_CLOCK_EVENT_HFCLKSTARTED
))

517 
	`Äf_şock_ev’t_ş—r
(
NRF_CLOCK_EVENT_HFCLKSTARTED
);

518 
	`NRF_LOG_DEBUG
("Ev’t: %s.", (
ušt32_t
)
	`EVT_TO_STR
(
NRF_CLOCK_EVENT_HFCLKSTARTED
));

519 
	`Äf_şock_št_di§bË
(
NRF_CLOCK_INT_HF_STARTED_MASK
);

520 
m_şock_cb
.
hfşk_Ú
 = 
Œue
;

521 
	`şock_şk_¡¬‹d_nÙify
(
NRF_DRV_CLOCK_EVT_HFCLK_STARTED
);

523 ià(
	`Äf_şock_ev’t_check
(
NRF_CLOCK_EVENT_LFCLKSTARTED
))

525 
	`Äf_şock_ev’t_ş—r
(
NRF_CLOCK_EVENT_LFCLKSTARTED
);

526 
	`NRF_LOG_DEBUG
("Ev’t: %s.", (
ušt32_t
)
	`EVT_TO_STR
(
NRF_CLOCK_EVENT_LFCLKSTARTED
));

527 
	`Äf_şock_št_di§bË
(
NRF_CLOCK_INT_LF_STARTED_MASK
);

528 
m_şock_cb
.
lfşk_Ú
 = 
Œue
;

529 
	`şock_şk_¡¬‹d_nÙify
(
NRF_DRV_CLOCK_EVT_LFCLK_STARTED
);

531 #ià
CALIBRATION_SUPPORT


532 ià(
	`Äf_şock_ev’t_check
(
NRF_CLOCK_EVENT_CTTO
))

534 
	`Äf_şock_ev’t_ş—r
(
NRF_CLOCK_EVENT_CTTO
);

535 
	`NRF_LOG_DEBUG
("Ev’t: %s.", (
ušt32_t
)
	`EVT_TO_STR
(
NRF_CLOCK_EVENT_CTTO
));

536 
	`Äf_şock_št_di§bË
(
NRF_CLOCK_INT_CTTO_MASK
);

537 
	`Äf_drv_şock_hfşk_»que¡
(&
m_şock_cb
.
ÿl_hfşk_¡¬‹d_hªdËr_™em
);

540 ià(
	`Äf_şock_ev’t_check
(
NRF_CLOCK_EVENT_DONE
))

542 
	`Äf_şock_ev’t_ş—r
(
NRF_CLOCK_EVENT_DONE
);

543 
	`NRF_LOG_DEBUG
("Ev’t: %s.", (
ušt32_t
)
	`EVT_TO_STR
(
NRF_CLOCK_EVENT_DONE
));

544 
	`Äf_şock_št_di§bË
(
NRF_CLOCK_INT_DONE_MASK
);

545 
	`Äf_drv_şock_hfşk_»Ëa£
();

546 
boŞ
 
abÜ‹d
 = (
m_şock_cb
.
ÿl_¡©e
 =ğ
CAL_STATE_ABORT
);

547 
m_şock_cb
.
ÿl_¡©e
 = 
CAL_STATE_IDLE
;

548 ià(
m_şock_cb
.
ÿl_dÚe_hªdËr
)

550 
m_şock_cb
.
	`ÿl_dÚe_hªdËr
(
abÜ‹d
 ?

551 
NRF_DRV_CLOCK_EVT_CAL_ABORTED
 : 
NRF_DRV_CLOCK_EVT_CAL_DONE
);

555 
	}
}

557 #ifdeà
SOFTDEVICE_PRESENT


564 
	$soc_evt_hªdËr
(
ušt32_t
 
evt_id
, * 
p_cÚ‹xt
)

566 ià(
evt_id
 =ğ
NRF_EVT_HFCLKSTARTED
)

568 
	`şock_şk_¡¬‹d_nÙify
(
NRF_DRV_CLOCK_EVT_HFCLK_STARTED
);

570 
	}
}

572 
NRF_SDH_SOC_OBSERVER
(
m_soc_evt_ob£rv”
, 
CLOCK_CONFIG_SOC_OBSERVER_PRIO
, 
soc_evt_hªdËr
, 
NULL
);

580 
	$sd_¡©e_evt_hªdËr
(
Äf_sdh_¡©e_evt_t
 
¡©e
, * 
p_cÚ‹xt
)

582 
¡©e
)

584 
NRF_SDH_EVT_STATE_ENABLE_PREPARE
:

585 
	`NVIC_Di§bËIRQ
(
POWER_CLOCK_IRQn
);

588 
NRF_SDH_EVT_STATE_ENABLED
:

589 
	`CRITICAL_REGION_ENTER
();

591 ià(!
m_şock_cb
.
moduË_š™Ÿlized
)

593 ()
	`Äf_drv_şock_š™
();

596 ++(
m_şock_cb
.
lfşk_»que¡s
);

597 
m_şock_cb
.
lfşk_Ú
 = 
Œue
;

598 
	`CRITICAL_REGION_EXIT
();

601 
NRF_SDH_EVT_STATE_DISABLED
:

603 
	`ASSERT
(
m_şock_cb
.
moduË_š™Ÿlized
);

604 
	`Äf_drv_commÚ_œq_’abË
(
POWER_CLOCK_IRQn
, 
CLOCK_CONFIG_IRQ_PRIORITY
);

607 
	`Äf_drv_şock_lfşk_»Ëa£
();

613 
	}
}

615 
NRF_SDH_STATE_OBSERVER
(
m_sd_¡©e_ob£rv”
, 
CLOCK_CONFIG_STATE_OBSERVER_PRIO
) =

617 .
hªdËr
 = 
sd_¡©e_evt_hªdËr
,

618 .
	gp_cÚ‹xt
 = 
NULL
,

623 #undeà
NRF_CLOCK_LFCLK_RC


624 #undeà
NRF_CLOCK_LFCLK_Xl


625 #undeà
NRF_CLOCK_LFCLK_SyÁh


	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\drivers_nrf\common\nrf_drv_common.c

40 
	~<¡ddef.h
>

41 
	~"Äf_drv_commÚ.h
"

42 
	~"Äf_as£¹.h
"

43 
	~"­p_ut_¶©fÜm.h
"

44 
	~"Äf_³rh”®s.h
"

46 #ià
NRF_DRV_COMMON_POWER_CLOCK_ISR


47 
	~"Äf_drv_pow”.h
"

48 
	~"Äf_drv_şock.h
"

50 #ifdeà
SOFTDEVICE_PRESENT


51 
	~"Äf_soc.h
"

54 #ià
NRF_MODULE_ENABLED
(
PERIPHERAL_RESOURCE_SHARING
)

56 
	#NRF_LOG_MODULE_NAME
 
commÚ


	)

58 #ià
COMMON_CONFIG_LOG_ENABLED


59 
	#NRF_LOG_LEVEL
 
COMMON_CONFIG_LOG_LEVEL


	)

60 
	#NRF_LOG_INFO_COLOR
 
COMMON_CONFIG_INFO_COLOR


	)

61 
	#NRF_LOG_DEBUG_COLOR
 
COMMON_CONFIG_DEBUG_COLOR


	)

63 
	#NRF_LOG_LEVEL
 0

	)

65 
	~"Äf_log.h
"

66 
NRF_LOG_MODULE_REGISTER
();

70 
Äf_drv_œq_hªdËr_t
 
	mhªdËr
;

71 
boŞ
 
	macquœed
;

72 } 
	tsh¬ed_»sourû_t
;

75 #ià(
NRF_MODULE_ENABLED
(
SPI0
è|| NRF_MODULE_ENABLED(
SPIS0
è|| NRF_MODULE_ENABLED(
TWI0
è|| NRF_MODULE_ENABLED(
TWIS0
))

76 
	#SERIAL_BOX_0_IN_USE


	)

78 #iâdeà
IS_SERIAL_BOX_0


79 
	#IS_SERIAL_BOX_0
(
p_³r_ba£
èÕ_³r_ba£ =ğ
NRF_SPI0
)

	)

82 
sh¬ed_»sourû_t
 
	gm_£rŸl_box_0
 = { .
acquœed
 = 
çl£
 };

83 
	$SPI0_TWI0_IRQHªdËr
()

85 
	`ASSERT
(
m_£rŸl_box_0
.
hªdËr
);

86 
m_£rŸl_box_0
.
	`hªdËr
();

87 
	}
}

91 #ià(
NRF_MODULE_ENABLED
(
SPI1
è|| NRF_MODULE_ENABLED(
SPIS1
è|| NRF_MODULE_ENABLED(
TWI1
è|| NRF_MODULE_ENABLED(
TWIS1
))

92 
	#SERIAL_BOX_1_IN_USE


	)

94 #iâdeà
IS_SERIAL_BOX_1


95 
	#IS_SERIAL_BOX_1
(
p_³r_ba£
èÕ_³r_ba£ =ğ
NRF_SPI1
)

	)

98 
sh¬ed_»sourû_t
 
	gm_£rŸl_box_1
 = { .
acquœed
 = 
çl£
 };

99 #ifdeà
TWIM_PRESENT


100 
	$SPIM1_SPIS1_TWIM1_TWIS1_SPI1_TWI1_IRQHªdËr
()

102 
	$SPI1_TWI1_IRQHªdËr
()

105 
	`ASSERT
(
m_£rŸl_box_1
.
hªdËr
);

106 
m_£rŸl_box_1
.
	`hªdËr
();

107 
	}
}

111 #ià(
NRF_MODULE_ENABLED
(
SPI2
è|| NRF_MODULE_ENABLED(
SPIS2
))

112 
	#SERIAL_BOX_2_IN_USE


	)

114 #iâdeà
IS_SERIAL_BOX_2


115 
	#IS_SERIAL_BOX_2
(
p_³r_ba£
èÕ_³r_ba£ =ğ
NRF_SPI2
)

	)

118 
sh¬ed_»sourû_t
 
	gm_£rŸl_box_2
 = { .
acquœed
 = 
çl£
 };

119 
	$SPIM2_SPIS2_SPI2_IRQHªdËr
()

121 
	`ASSERT
(
m_£rŸl_box_2
.
hªdËr
);

122 
m_£rŸl_box_2
.
	`hªdËr
();

123 
	}
}

127 #ià(
NRF_MODULE_ENABLED
(
COMP
è|| NRF_MODULE_ENABLED(
LPCOMP
))

128 
	#COMP_LPCOMP_IN_USE


	)

130 #iâdeà
IS_COMP_LPCOMP


131 
	#IS_COMP_LPCOMP
(
p_³r_ba£
è(Õ_³r_ba£è=ğ
NRF_LPCOMP
)

	)

134 
sh¬ed_»sourû_t
 
	gm_comp_Ícomp
 = { .
acquœed
 = 
çl£
 };

135 
	$LPCOMP_IRQHªdËr
()

137 
	`ASSERT
(
m_comp_Ícomp
.
hªdËr
);

138 
m_comp_Ícomp
.
	`hªdËr
();

139 
	}
}

142 #ià
defšed
(
SERIAL_BOX_0_IN_USE
) || \

143 
defšed
(
SERIAL_BOX_1_IN_USE
) || \

144 
defšed
(
SERIAL_BOX_2_IN_USE
) || \

145 
	$defšed
(
COMP_LPCOMP_IN_USE
)

146 
»t_code_t
 
	$acquœe_sh¬ed_»sourû
(
sh¬ed_»sourû_t
 * 
p_»sourû
,

147 
Äf_drv_œq_hªdËr_t
 
hªdËr
)

149 
»t_code_t
 
”r_code
;

151 
boŞ
 
busy
 = 
çl£
;

153 
	`CRITICAL_REGION_ENTER
();

154 ià(
p_»sourû
->
acquœed
)

156 
busy
 = 
Œue
;

160 
p_»sourû
->
acquœed
 = 
Œue
;

162 
	`CRITICAL_REGION_EXIT
();

164 ià(
busy
)

166 
”r_code
 = 
NRF_ERROR_BUSY
;

167 
	`NRF_LOG_WARNING
("FunùiÚ: %s,ƒ¼Ü code: %s.", (
ušt32_t
)
__func__
, (ušt32_t)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

168  
”r_code
;

171 
p_»sourû
->
hªdËr
 = handler;

172 
”r_code
 = 
NRF_SUCCESS
;

173 
	`NRF_LOG_INFO
("FunùiÚ: %s,ƒ¼Ü code: %s.", (
ušt32_t
)
__func__
, (ušt32_t)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

174  
”r_code
;

175 
	}
}

178 
»t_code_t
 
	$Äf_drv_commÚ_³r_»s_acquœe
(cÚ¡ * 
p_³r_ba£
,

179 
Äf_drv_œq_hªdËr_t
 
hªdËr
)

181 #ifdeà
SERIAL_BOX_0_IN_USE


182 ià(
	`IS_SERIAL_BOX_0
(
p_³r_ba£
))

184  
	`acquœe_sh¬ed_»sourû
(&
m_£rŸl_box_0
, 
hªdËr
);

188 #ifdeà
SERIAL_BOX_1_IN_USE


189 ià(
	`IS_SERIAL_BOX_1
(
p_³r_ba£
))

191  
	`acquœe_sh¬ed_»sourû
(&
m_£rŸl_box_1
, 
hªdËr
);

195 #ifdeà
SERIAL_BOX_2_IN_USE


196 ià(
	`IS_SERIAL_BOX_2
(
p_³r_ba£
))

198  
	`acquœe_sh¬ed_»sourû
(&
m_£rŸl_box_2
, 
hªdËr
);

202 #ifdeà
COMP_LPCOMP_IN_USE


203 ià(
	`IS_COMP_LPCOMP
(
p_³r_ba£
))

205  
	`acquœe_sh¬ed_»sourû
(&
m_comp_Ícomp
, 
hªdËr
);

208 
»t_code_t
 
”r_code
;

210 
”r_code
 = 
NRF_ERROR_INVALID_PARAM
;

211 
	`NRF_LOG_WARNING
("FunùiÚ: %s,ƒ¼Ü code: %s.", (
ušt32_t
)
__func__
, (ušt32_t)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

212  
”r_code
;

213 
	}
}

215 
	$Äf_drv_commÚ_³r_»s_»Ëa£
(cÚ¡ * 
p_³r_ba£
)

217 #ifdeà
SERIAL_BOX_0_IN_USE


218 ià(
	`IS_SERIAL_BOX_0
(
p_³r_ba£
))

220 
m_£rŸl_box_0
.
acquœed
 = 
çl£
;

225 #ifdeà
SERIAL_BOX_1_IN_USE


226 ià(
	`IS_SERIAL_BOX_1
(
p_³r_ba£
))

228 
m_£rŸl_box_1
.
acquœed
 = 
çl£
;

233 #ifdeà
SERIAL_BOX_2_IN_USE


234 ià(
	`IS_SERIAL_BOX_2
(
p_³r_ba£
))

236 
m_£rŸl_box_2
.
acquœed
 = 
çl£
;

241 #ifdeà
COMP_LPCOMP_IN_USE


242 ià(
	`IS_COMP_LPCOMP
(
p_³r_ba£
))

244 
m_comp_Ícomp
.
acquœed
 = 
çl£
;

250 
	}
}

254 #ià
NRF_MODULE_ENABLED
(
POWER
)

255 
	$Äf_drv_commÚ_pow”_œq_di§bË
()

257 #ià
NRF_DRV_COMMON_POWER_CLOCK_ISR


258 ià(!
	`Äf_drv_şock_š™_check
())

261 
	`Äf_drv_commÚ_œq_di§bË
(
POWER_CLOCK_IRQn
);

263 
	}
}

266 #ià
NRF_MODULE_ENABLED
(
CLOCK
)

267 
	$Äf_drv_commÚ_şock_œq_di§bË
()

269 #ià
NRF_DRV_COMMON_POWER_CLOCK_ISR


270 ià(!
	`Äf_drv_pow”_š™_check
())

273 
	`Äf_drv_commÚ_œq_di§bË
(
POWER_CLOCK_IRQn
);

275 
	}
}

278 #ià
NRF_DRV_COMMON_POWER_CLOCK_ISR


279 
	$POWER_CLOCK_IRQHªdËr
()

281 
	`Äf_drv_şock_ÚIRQ
();

282 
	`Äf_drv_pow”_ÚIRQ
();

284 
	`Äf_drv_şock_ÚIRQ
();

285 
	`Äf_drv_pow”_ÚIRQ
();

286 
	}
}

290 
	$Äf_drv_commÚ_œq_’abË
(
IRQn_Ty³
 
IRQn
, 
ušt8_t
 
´iÜ™y
)

292 
	`INTERRUPT_PRIORITY_ASSERT
(
´iÜ™y
);

294 
	`NVIC_S‘PriÜ™y
(
IRQn
, 
´iÜ™y
);

295 
	`NVIC_CË¬P’dšgIRQ
(
IRQn
);

296 
	`NVIC_EÇbËIRQ
(
IRQn
);

297 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\drivers_nrf\gpiote\nrf_drv_gpiote.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
GPIOTE
)

42 
	~"Äf_drv_gpiÙe.h
"

43 
	~"Äf_drv_commÚ.h
"

44 
	~"­p_ut_¶©fÜm.h
"

45 
	~"Äf_as£¹.h
"

46 
	~"Äf_b™mask.h
"

47 
	~<¡ršg.h
>

49 
	#NRF_LOG_MODULE_NAME
 
gpiÙe


	)

51 #ià
GPIOTE_CONFIG_LOG_ENABLED


52 
	#NRF_LOG_LEVEL
 
GPIOTE_CONFIG_LOG_LEVEL


	)

53 
	#NRF_LOG_INFO_COLOR
 
GPIOTE_CONFIG_INFO_COLOR


	)

54 
	#NRF_LOG_DEBUG_COLOR
 
GPIOTE_CONFIG_DEBUG_COLOR


	)

56 
	#NRF_LOG_LEVEL
 0

	)

58 
	~"Äf_log.h
"

59 
NRF_LOG_MODULE_REGISTER
();

62 
INTERRUPT_PRIORITY_VALIDATION
(
GPIOTE_CONFIG_IRQ_PRIORITY
);

64 
	#FORBIDDEN_HANDLER_ADDRESS
 ((
Äf_drv_gpiÙe_evt_hªdËr_t
)
UINT32_MAX
)

	)

65 
	#PIN_NOT_USED
 (-1)

	)

66 
	#PIN_USED
 (-2)

	)

67 
	#NO_CHANNELS
 (-1)

	)

68 
	#SENSE_FIELD_POS
 (6)

	)

69 
	#SENSE_FIELD_MASK
 (0xC0)

	)

76 
	#TE_IDX_TO_EVENT_ADDR
(
idx
è(
Äf_gpiÙe_ev’ts_t
)((
ušt32_t
)
NRF_GPIOTE_EVENTS_IN_0
 + \

77 ((
ušt32_t
è* (
idx
)))

	)

84 
	#TE_OUT_IDX_TO_TASK_ADDR
(
idx
è(
Äf_gpiÙe_sks_t
)((
ušt32_t
)
NRF_GPIOTE_TASKS_OUT_0
 + \

85 ((
ušt32_t
è* (
idx
)))

	)

87 #ià
defšed
(
GPIOTE_FEATURE_SET_PRESENT
è|| defšed(
__SDK_DOXYGEN__
)

93 
	#TE_SET_IDX_TO_TASK_ADDR
(
idx
è(
Äf_gpiÙe_sks_t
)((
ušt32_t
)
NRF_GPIOTE_TASKS_SET_0
 + \

94 ((
ušt32_t
è* (
idx
)))

	)

98 #ià
defšed
(
GPIOTE_FEATURE_CLR_PRESENT
è|| defšed(
__SDK_DOXYGEN__
)

104 
	#TE_CLR_IDX_TO_TASK_ADDR
(
idx
è(
Äf_gpiÙe_sks_t
)((
ušt32_t
)
NRF_GPIOTE_TASKS_CLR_0
 + \

105 ((
ušt32_t
è* (
idx
)))

	)

112 
Äf_drv_gpiÙe_evt_hªdËr_t
 
	mhªdËrs
[
GPIOTE_CH_NUM
 + 
GPIOTE_CONFIG_NUM_OF_LOW_POWER_EVENTS
];

113 
št8_t
 
	mpš_assignm’ts
[
NUMBER_OF_PINS
];

114 
št8_t
 
	mpÜt_hªdËrs_pšs
[
GPIOTE_CONFIG_NUM_OF_LOW_POWER_EVENTS
];

115 
Äf_drv_¡©e_t
 
	m¡©e
;

116 } 
	tgpiÙe_cÚŒŞ_block_t
;

118 
gpiÙe_cÚŒŞ_block_t
 
	gm_cb
;

120 
__STATIC_INLINE
 
boŞ
 
	$pš_š_u£
(
ušt32_t
 
pš
)

122  (
m_cb
.
pš_assignm’ts
[
pš
] !ğ
PIN_NOT_USED
);

123 
	}
}

126 
__STATIC_INLINE
 
boŞ
 
	$pš_š_u£_as_nÚ_sk_out
(
ušt32_t
 
pš
)

128  (
m_cb
.
pš_assignm’ts
[
pš
] =ğ
PIN_USED
);

129 
	}
}

132 
__STATIC_INLINE
 
boŞ
 
	$pš_š_u£_by_‹
(
ušt32_t
 
pš
)

134  (
m_cb
.
pš_assignm’ts
[
pš
] >= 0 && m_cb.pin_assignments[pin] <

135 
GPIOTE_CH_NUM
è? 
Œue
 : 
çl£
;

136 
	}
}

139 
__STATIC_INLINE
 
boŞ
 
	$pš_š_u£_by_pÜt
(
ušt32_t
 
pš
)

141  (
m_cb
.
pš_assignm’ts
[
pš
] >ğ
GPIOTE_CH_NUM
);

142 
	}
}

145 
__STATIC_INLINE
 
boŞ
 
	$pš_š_u£_by_gpiÙe
(
ušt32_t
 
pš
)

147  (
m_cb
.
pš_assignm’ts
[
pš
] >= 0);

148 
	}
}

151 
__STATIC_INLINE
 
	$pš_š_u£_by_‹_£t
(
ušt32_t
 
pš
,

152 
ušt32_t
 
chªÃl_id
,

153 
Äf_drv_gpiÙe_evt_hªdËr_t
 
hªdËr
,

154 
boŞ
 
is_chªÃl
)

156 
m_cb
.
pš_assignm’ts
[
pš
] = 
chªÃl_id
;

157 
m_cb
.
hªdËrs
[
chªÃl_id
] = 
hªdËr
;

158 ià(!
is_chªÃl
)

160 
m_cb
.
pÜt_hªdËrs_pšs
[
chªÃl_id
 - 
GPIOTE_CH_NUM
] = (
št8_t
)
pš
;

162 
	}
}

165 
__STATIC_INLINE
 
	$pš_š_u£_£t
(
ušt32_t
 
pš
)

167 
m_cb
.
pš_assignm’ts
[
pš
] = 
PIN_USED
;

168 
	}
}

171 
__STATIC_INLINE
 
	$pš_š_u£_ş—r
(
ušt32_t
 
pš
)

173 
m_cb
.
pš_assignm’ts
[
pš
] = 
PIN_NOT_USED
;

174 
	}
}

177 
__STATIC_INLINE
 
št8_t
 
	$chªÃl_pÜt_g‘
(
ušt32_t
 
pš
)

179  
m_cb
.
pš_assignm’ts
[
pš
];

180 
	}
}

183 
__STATIC_INLINE
 
Äf_drv_gpiÙe_evt_hªdËr_t
 
	$chªÃl_hªdËr_g‘
(
ušt32_t
 
chªÃl
)

185  
m_cb
.
hªdËrs
[
chªÃl
];

186 
	}
}

189 
št8_t
 
	$chªÃl_pÜt_®loc
(
ušt32_t
 
pš
, 
Äf_drv_gpiÙe_evt_hªdËr_t
 
hªdËr
, 
boŞ
 
chªÃl
)

191 
št8_t
 
chªÃl_id
 = 
NO_CHANNELS
;

192 
ušt32_t
 
i
;

194 
ušt32_t
 
¡¬t_idx
 = 
chªÃl
 ? 0 : 
GPIOTE_CH_NUM
;

195 
ušt32_t
 
’d_idx
 =

196 
chªÃl
 ? 
GPIOTE_CH_NUM
 : (GPIOTE_CH_NUM + 
GPIOTE_CONFIG_NUM_OF_LOW_POWER_EVENTS
);

200 
i
 = 
¡¬t_idx
; i < 
’d_idx
; i++)

202 ià(
m_cb
.
hªdËrs
[
i
] =ğ
FORBIDDEN_HANDLER_ADDRESS
)

204 
	`pš_š_u£_by_‹_£t
(
pš
, 
i
, 
hªdËr
, 
chªÃl
);

205 
chªÃl_id
 = 
i
;

210  
chªÃl_id
;

211 
	}
}

214 
	$chªÃl_ä“
(
ušt8_t
 
chªÃl_id
)

216 
m_cb
.
hªdËrs
[
chªÃl_id
] = 
FORBIDDEN_HANDLER_ADDRESS
;

217 ià(
chªÃl_id
 >ğ
GPIOTE_CH_NUM
)

219 
m_cb
.
pÜt_hªdËrs_pšs
[
chªÃl_id
 - 
GPIOTE_CH_NUM
] = (
št8_t
)
PIN_NOT_USED
;

221 
	}
}

224 
»t_code_t
 
	$Äf_drv_gpiÙe_š™
()

226 
»t_code_t
 
”r_code
;

228 ià(
m_cb
.
¡©e
 !ğ
NRF_DRV_STATE_UNINITIALIZED
)

230 
”r_code
 = 
NRF_ERROR_INVALID_STATE
;

231 
	`NRF_LOG_WARNING
("Function: %s,ƒrror code: %s.",

232 (
ušt32_t
)
__func__
,

233 (
ušt32_t
)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

234  
”r_code
;

237 
ušt8_t
 
i
;

239 
i
 = 0; i < 
NUMBER_OF_PINS
; i++)

241 
	`pš_š_u£_ş—r
(
i
);

244 
i
 = 0; i < (
GPIOTE_CH_NUM
 + 
GPIOTE_CONFIG_NUM_OF_LOW_POWER_EVENTS
); i++)

246 
	`chªÃl_ä“
(
i
);

249 
	`Äf_drv_commÚ_œq_’abË
(
GPIOTE_IRQn
, 
GPIOTE_CONFIG_IRQ_PRIORITY
);

250 
	`Äf_gpiÙe_ev’t_ş—r
(
NRF_GPIOTE_EVENTS_PORT
);

251 
	`Äf_gpiÙe_št_’abË
(
GPIOTE_INTENSET_PORT_Msk
);

252 
m_cb
.
¡©e
 = 
NRF_DRV_STATE_INITIALIZED
;

254 
”r_code
 = 
NRF_SUCCESS
;

255 
	`NRF_LOG_INFO
("FunùiÚ: %s,ƒ¼Ü code: %s.", (
ušt32_t
)
__func__
,

256 (
ušt32_t
)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

257  
”r_code
;

258 
	}
}

261 
boŞ
 
	$Äf_drv_gpiÙe_is_š™
()

263  (
m_cb
.
¡©e
 !ğ
NRF_DRV_STATE_UNINITIALIZED
è? 
Œue
 : 
çl£
;

264 
	}
}

267 
	$Äf_drv_gpiÙe_unš™
()

269 
	`ASSERT
(
m_cb
.
¡©e
 !ğ
NRF_DRV_STATE_UNINITIALIZED
);

271 
ušt32_t
 
i
;

273 
i
 = 0; i < 
NUMBER_OF_PINS
; i++)

275 ià(
	`pš_š_u£_as_nÚ_sk_out
(
i
))

277 
	`Äf_drv_gpiÙe_out_unš™
(
i
);

279 iàĞ
	`pš_š_u£_by_gpiÙe
(
i
))

284 
	`Äf_drv_gpiÙe_š_unš™
(
i
);

287 
m_cb
.
¡©e
 = 
NRF_DRV_STATE_UNINITIALIZED
;

288 
	`NRF_LOG_INFO
("Uninitialized.");

289 
	}
}

292 
»t_code_t
 
	$Äf_drv_gpiÙe_out_š™
(
Äf_drv_gpiÙe_pš_t
 
pš
,

293 
Äf_drv_gpiÙe_out_cÚfig_t
 cÚ¡ * 
p_cÚfig
)

295 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

296 
	`ASSERT
(
m_cb
.
¡©e
 =ğ
NRF_DRV_STATE_INITIALIZED
);

297 
	`ASSERT
(
p_cÚfig
);

299 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

301 ià(
	`pš_š_u£
(
pš
))

303 
”r_code
 = 
NRF_ERROR_INVALID_STATE
;

307 ià(
p_cÚfig
->
sk_pš
)

309 
št8_t
 
chªÃl
 = 
	`chªÃl_pÜt_®loc
(
pš
, 
NULL
, 
Œue
);

311 ià(
chªÃl
 !ğ
NO_CHANNELS
)

313 
	`Äf_gpiÙe_sk_cÚfigu»
(
chªÃl
, 
pš
, 
p_cÚfig
->
aùiÚ
,…_cÚfig->
š™_¡©e
);

317 
”r_code
 = 
NRF_ERROR_NO_MEM
;

322 
	`pš_š_u£_£t
(
pš
);

325 ià(
”r_code
 =ğ
NRF_SUCCESS
)

327 ià(
p_cÚfig
->
š™_¡©e
 =ğ
NRF_GPIOTE_INITIAL_VALUE_HIGH
)

329 
	`Äf_gpio_pš_£t
(
pš
);

333 
	`Äf_gpio_pš_ş—r
(
pš
);

336 
	`Äf_gpio_cfg_ouut
(
pš
);

340 
	`NRF_LOG_INFO
("FunùiÚ: %s,ƒ¼Ü code: %s.", (
ušt32_t
)
__func__
,

341 (
ušt32_t
)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

342  
”r_code
;

343 
	}
}

346 
	$Äf_drv_gpiÙe_out_unš™
(
Äf_drv_gpiÙe_pš_t
 
pš
)

348 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

349 
	`ASSERT
(
	`pš_š_u£
(
pš
));

351 ià(
	`pš_š_u£_by_‹
(
pš
))

353 
	`chªÃl_ä“
((
ušt8_t
)
	`chªÃl_pÜt_g‘
(
pš
));

354 
	`Äf_gpiÙe_‹_deçuÉ
(
	`chªÃl_pÜt_g‘
(
pš
));

356 
	`pš_š_u£_ş—r
(
pš
);

358 
	`Äf_gpio_cfg_deçuÉ
(
pš
);

359 
	}
}

362 
	$Äf_drv_gpiÙe_out_£t
(
Äf_drv_gpiÙe_pš_t
 
pš
)

364 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

365 
	`ASSERT
(
	`pš_š_u£
(
pš
));

366 
	`ASSERT
(!
	`pš_š_u£_by_‹
(
pš
))

368 
	`Äf_gpio_pš_£t
(
pš
);

369 
	}
}

372 
	$Äf_drv_gpiÙe_out_ş—r
(
Äf_drv_gpiÙe_pš_t
 
pš
)

374 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

375 
	`ASSERT
(
	`pš_š_u£
(
pš
));

376 
	`ASSERT
(!
	`pš_š_u£_by_‹
(
pš
))

378 
	`Äf_gpio_pš_ş—r
(
pš
);

379 
	}
}

382 
	$Äf_drv_gpiÙe_out_toggË
(
Äf_drv_gpiÙe_pš_t
 
pš
)

384 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

385 
	`ASSERT
(
	`pš_š_u£
(
pš
));

386 
	`ASSERT
(!
	`pš_š_u£_by_‹
(
pš
))

388 
	`Äf_gpio_pš_toggË
(
pš
);

389 
	}
}

392 
	$Äf_drv_gpiÙe_out_sk_’abË
(
Äf_drv_gpiÙe_pš_t
 
pš
)

394 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

395 
	`ASSERT
(
	`pš_š_u£
(
pš
));

396 
	`ASSERT
(
	`pš_š_u£_by_‹
(
pš
))

398 
	`Äf_gpiÙe_sk_’abË
(
m_cb
.
pš_assignm’ts
[
pš
]);

399 
	}
}

402 
	$Äf_drv_gpiÙe_out_sk_di§bË
(
Äf_drv_gpiÙe_pš_t
 
pš
)

404 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

405 
	`ASSERT
(
	`pš_š_u£
(
pš
));

406 
	`ASSERT
(
	`pš_š_u£_by_‹
(
pš
))

408 
	`Äf_gpiÙe_sk_di§bË
(
m_cb
.
pš_assignm’ts
[
pš
]);

409 
	}
}

412 
ušt32_t
 
	$Äf_drv_gpiÙe_out_sk_addr_g‘
(
Äf_drv_gpiÙe_pš_t
 
pš
)

414 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

415 
	`ASSERT
(
	`pš_š_u£_by_‹
(
pš
));

417 
Äf_gpiÙe_sks_t
 
sk
 = 
	`TE_OUT_IDX_TO_TASK_ADDR
(
	`chªÃl_pÜt_g‘
(
pš
));

418  
	`Äf_gpiÙe_sk_addr_g‘
(
sk
);

419 
	}
}

422 #ià
defšed
(
GPIOTE_FEATURE_SET_PRESENT
)

423 
ušt32_t
 
	$Äf_drv_gpiÙe_£t_sk_addr_g‘
(
Äf_drv_gpiÙe_pš_t
 
pš
)

425 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

426 
	`ASSERT
(
	`pš_š_u£_by_‹
(
pš
));

428 
Äf_gpiÙe_sks_t
 
sk
 = 
	`TE_SET_IDX_TO_TASK_ADDR
(
	`chªÃl_pÜt_g‘
(
pš
));

429  
	`Äf_gpiÙe_sk_addr_g‘
(
sk
);

430 
	}
}

435 #ià
defšed
(
GPIOTE_FEATURE_CLR_PRESENT
)

436 
ušt32_t
 
	$Äf_drv_gpiÙe_şr_sk_addr_g‘
(
Äf_drv_gpiÙe_pš_t
 
pš
)

438 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

439 
	`ASSERT
(
	`pš_š_u£_by_‹
(
pš
));

441 
Äf_gpiÙe_sks_t
 
sk
 = 
	`TE_CLR_IDX_TO_TASK_ADDR
(
	`chªÃl_pÜt_g‘
(
pš
));

442  
	`Äf_gpiÙe_sk_addr_g‘
(
sk
);

443 
	}
}

448 
	$Äf_drv_gpiÙe_out_sk_fÜû
(
Äf_drv_gpiÙe_pš_t
 
pš
, 
ušt8_t
 
¡©e
)

450 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

451 
	`ASSERT
(
	`pš_š_u£
(
pš
));

452 
	`ASSERT
(
	`pš_š_u£_by_‹
(
pš
));

454 
Äf_gpiÙe_outš™_t
 
š™_v®
 =

455 
¡©e
 ? 
NRF_GPIOTE_INITIAL_VALUE_HIGH
 : 
NRF_GPIOTE_INITIAL_VALUE_LOW
;

456 
	`Äf_gpiÙe_sk_fÜû
(
m_cb
.
pš_assignm’ts
[
pš
], 
š™_v®
);

457 
	}
}

460 
	$Äf_drv_gpiÙe_out_sk_Œigg”
(
Äf_drv_gpiÙe_pš_t
 
pš
)

462 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

463 
	`ASSERT
(
	`pš_š_u£
(
pš
));

464 
	`ASSERT
(
	`pš_š_u£_by_‹
(
pš
));

466 
Äf_gpiÙe_sks_t
 
sk
 = 
	`TE_OUT_IDX_TO_TASK_ADDR
(
	`chªÃl_pÜt_g‘
(
pš
));

467 
	`Äf_gpiÙe_sk_£t
(
sk
);

468 
	}
}

471 #ià
defšed
(
GPIOTE_FEATURE_SET_PRESENT
)

472 
	$Äf_drv_gpiÙe_£t_sk_Œigg”
(
Äf_drv_gpiÙe_pš_t
 
pš
)

474 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

475 
	`ASSERT
(
	`pš_š_u£
(
pš
));

476 
	`ASSERT
(
	`pš_š_u£_by_‹
(
pš
));

478 
Äf_gpiÙe_sks_t
 
sk
 = 
	`TE_SET_IDX_TO_TASK_ADDR
(
	`chªÃl_pÜt_g‘
(
pš
));

479 
	`Äf_gpiÙe_sk_£t
(
sk
);

480 
	}
}

485 #ià 
defšed
(
GPIOTE_FEATURE_CLR_PRESENT
)

486 
	$Äf_drv_gpiÙe_şr_sk_Œigg”
(
Äf_drv_gpiÙe_pš_t
 
pš
)

488 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

489 
	`ASSERT
(
	`pš_š_u£
(
pš
));

490 
	`ASSERT
(
	`pš_š_u£_by_‹
(
pš
));

492 
Äf_gpiÙe_sks_t
 
sk
 = 
	`TE_CLR_IDX_TO_TASK_ADDR
(
	`chªÃl_pÜt_g‘
(
pš
));

493 
	`Äf_gpiÙe_sk_£t
(
sk
);

494 
	}
}

499 
»t_code_t
 
	$Äf_drv_gpiÙe_š_š™
(
Äf_drv_gpiÙe_pš_t
 
pš
,

500 
Äf_drv_gpiÙe_š_cÚfig_t
 cÚ¡ * 
p_cÚfig
,

501 
Äf_drv_gpiÙe_evt_hªdËr_t
 
evt_hªdËr
)

503 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

504 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

507 ià(
	`pš_š_u£_by_gpiÙe
(
pš
))

509 
”r_code
 = 
NRF_ERROR_INVALID_STATE
;

513 
št8_t
 
chªÃl
 = 
	`chªÃl_pÜt_®loc
(
pš
, 
evt_hªdËr
, 
p_cÚfig
->
hi_accu¿cy
);

514 ià(
chªÃl
 !ğ
NO_CHANNELS
)

516 ià(
p_cÚfig
->
is_w©ch”
)

518 
	`Äf_gpio_cfg_w©ch”
(
pš
);

522 
	`Äf_gpio_cfg_šput
(
pš
, 
p_cÚfig
->
puÎ
);

525 ià(
p_cÚfig
->
hi_accu¿cy
)

527 
	`Äf_gpiÙe_ev’t_cÚfigu»
(
chªÃl
, 
pš
, 
p_cÚfig
->
£n£
);

531 
m_cb
.
pÜt_hªdËrs_pšs
[
chªÃl
 -

532 
GPIOTE_CH_NUM
] |ğ(
p_cÚfig
->
£n£
è<< 
SENSE_FIELD_POS
;

537 
”r_code
 = 
NRF_ERROR_NO_MEM
;

541 
	`NRF_LOG_INFO
("FunùiÚ: %s,ƒ¼Ü code: %s.", (
ušt32_t
)
__func__
,

542 (
ušt32_t
)
	`NRF_LOG_ERROR_STRING_GET
(
”r_code
));

543  
”r_code
;

544 
	}
}

547 
	$Äf_drv_gpiÙe_š_ev’t_’abË
(
Äf_drv_gpiÙe_pš_t
 
pš
, 
boŞ
 
št_’abË
)

549 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

550 
	`ASSERT
(
	`pš_š_u£_by_gpiÙe
(
pš
));

551 ià(
	`pš_š_u£_by_pÜt
(
pš
))

553 
ušt8_t
 
pš_ªd_£n£
 =

554 
m_cb
.
pÜt_hªdËrs_pšs
[
	`chªÃl_pÜt_g‘
(
pš
è- 
GPIOTE_CH_NUM
];

555 
Äf_gpiÙe_pŞ¬™y_t
 
pŞ¬™y
 =

556 (
Äf_gpiÙe_pŞ¬™y_t
)(
pš_ªd_£n£
 >> 
SENSE_FIELD_POS
);

557 
Äf_gpio_pš_£n£_t
 
£n£
;

558 ià(
pŞ¬™y
 =ğ
NRF_GPIOTE_POLARITY_TOGGLE
)

561 
£n£
 = (
	`Äf_gpio_pš_»ad
(
pš
)) ?

562 
NRF_GPIO_PIN_SENSE_LOW
 : 
NRF_GPIO_PIN_SENSE_HIGH
;

566 
£n£
 = (
pŞ¬™y
 =ğ
NRF_GPIOTE_POLARITY_LOTOHI
) ?

567 
NRF_GPIO_PIN_SENSE_HIGH
 : 
NRF_GPIO_PIN_SENSE_LOW
;

569 
	`Äf_gpio_cfg_£n£_£t
(
pš
, 
£n£
);

571 ià(
	`pš_š_u£_by_‹
(
pš
))

573 
št32_t
 
chªÃl
 = (št32_t)
	`chªÃl_pÜt_g‘
(
pš
);

574 
Äf_gpiÙe_ev’ts_t
 
ev’t
 = 
	`TE_IDX_TO_EVENT_ADDR
(
chªÃl
);

576 
	`Äf_gpiÙe_ev’t_’abË
(
chªÃl
);

578 
	`Äf_gpiÙe_ev’t_ş—r
(
ev’t
);

579 ià(
št_’abË
)

581 
Äf_drv_gpiÙe_evt_hªdËr_t
 
hªdËr
 = 
	`chªÃl_hªdËr_g‘
(
	`chªÃl_pÜt_g‘
(
pš
));

583 ià(
hªdËr
)

585 
	`Äf_gpiÙe_št_’abË
(1 << 
chªÃl
);

589 
	}
}

592 
	$Äf_drv_gpiÙe_š_ev’t_di§bË
(
Äf_drv_gpiÙe_pš_t
 
pš
)

594 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

595 
	`ASSERT
(
	`pš_š_u£_by_gpiÙe
(
pš
));

596 ià(
	`pš_š_u£_by_pÜt
(
pš
))

598 
	`Äf_gpio_cfg_£n£_£t
(
pš
, 
NRF_GPIO_PIN_NOSENSE
);

600 ià(
	`pš_š_u£_by_‹
(
pš
))

602 
št32_t
 
chªÃl
 = (št32_t)
	`chªÃl_pÜt_g‘
(
pš
);

603 
	`Äf_gpiÙe_ev’t_di§bË
(
chªÃl
);

604 
	`Äf_gpiÙe_št_di§bË
(1 << 
chªÃl
);

606 
	}
}

609 
	$Äf_drv_gpiÙe_š_unš™
(
Äf_drv_gpiÙe_pš_t
 
pš
)

611 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

612 
	`ASSERT
(
	`pš_š_u£_by_gpiÙe
(
pš
));

613 
	`Äf_drv_gpiÙe_š_ev’t_di§bË
(
pš
);

614 ià(
	`pš_š_u£_by_‹
(
pš
))

616 
	`Äf_gpiÙe_‹_deçuÉ
(
	`chªÃl_pÜt_g‘
(
pš
));

618 
	`Äf_gpio_cfg_deçuÉ
(
pš
);

619 
	`chªÃl_ä“
((
ušt8_t
)
	`chªÃl_pÜt_g‘
(
pš
));

620 
	`pš_š_u£_ş—r
(
pš
);

621 
	}
}

624 
boŞ
 
	$Äf_drv_gpiÙe_š_is_£t
(
Äf_drv_gpiÙe_pš_t
 
pš
)

626 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

627  
	`Äf_gpio_pš_»ad
(
pš
è? 
Œue
 : 
çl£
;

628 
	}
}

631 
ušt32_t
 
	$Äf_drv_gpiÙe_š_ev’t_addr_g‘
(
Äf_drv_gpiÙe_pš_t
 
pš
)

633 
	`ASSERT
(
pš
 < 
NUMBER_OF_PINS
);

634 
	`ASSERT
(
	`pš_š_u£_by_pÜt
(
pš
è|| 
	`pš_š_u£_by_‹
(pin));

636 
Äf_gpiÙe_ev’ts_t
 
ev’t
 = 
NRF_GPIOTE_EVENTS_PORT
;

638 ià(
	`pš_š_u£_by_‹
(
pš
))

640 
ev’t
 = 
	`TE_IDX_TO_EVENT_ADDR
(
	`chªÃl_pÜt_g‘
(
pš
));

642  
	`Äf_gpiÙe_ev’t_addr_g‘
(
ev’t
);

643 
	}
}

646 
	$GPIOTE_IRQHªdËr
()

648 
ušt32_t
 
¡©us
 = 0;

649 
ušt32_t
 
šput
[
GPIO_COUNT
] = {0};

652 
ušt32_t
 
i
;

653 
Äf_gpiÙe_ev’ts_t
 
ev’t
 = 
NRF_GPIOTE_EVENTS_IN_0
;

654 
ušt32_t
 
mask
 = (ušt32_t)
NRF_GPIOTE_INT_IN0_MASK
;

656 
i
 = 0; i < 
GPIOTE_CH_NUM
; i++)

658 ià(
	`Äf_gpiÙe_ev’t_is_£t
(
ev’t
è&& 
	`Äf_gpiÙe_št_is_’abËd
(
mask
))

660 
	`Äf_gpiÙe_ev’t_ş—r
(
ev’t
);

661 
¡©us
 |ğ
mask
;

663 
mask
 <<= 1;

666 
ev’t
 = (
Äf_gpiÙe_ev’ts_t
)((
ušt32_t
)event + (uint32_t));

671 ià(
	`Äf_gpiÙe_ev’t_is_£t
(
NRF_GPIOTE_EVENTS_PORT
))

673 
	`Äf_gpiÙe_ev’t_ş—r
(
NRF_GPIOTE_EVENTS_PORT
);

674 
¡©us
 |ğ(
ušt32_t
)
NRF_GPIOTE_INT_PORT_MASK
;

675 
	`Äf_gpio_pÜts_»ad
(0, 
GPIO_COUNT
, 
šput
);

679 ià(
¡©us
 & 
NRF_GPIOTE_INT_IN_MASK
)

681 
mask
 = (
ušt32_t
)
NRF_GPIOTE_INT_IN0_MASK
;

683 
i
 = 0; i < 
GPIOTE_CH_NUM
; i++)

685 ià(
mask
 & 
¡©us
)

687 
Äf_drv_gpiÙe_pš_t
 
pš
 = 
	`Äf_gpiÙe_ev’t_pš_g‘
(
i
);

688 
	`NRF_LOG_DEBUG
("Ev’ˆš‚umb”: %d.", 
i
);

689 
Äf_gpiÙe_pŞ¬™y_t
 
pŞ¬™y
 = 
	`Äf_gpiÙe_ev’t_pŞ¬™y_g‘
(
i
);

690 
Äf_drv_gpiÙe_evt_hªdËr_t
 
hªdËr
 = 
	`chªÃl_hªdËr_g‘
(
i
);

691 
	`NRF_LOG_DEBUG
("Pš: %d,…Ş¬™y: %d.", 
pš
, 
pŞ¬™y
);

692 ià(
hªdËr
)

694 
	`hªdËr
(
pš
, 
pŞ¬™y
);

697 
mask
 <<= 1;

701 ià(
¡©us
 & (
ušt32_t
)
NRF_GPIOTE_INT_PORT_MASK
)

704 
ušt32_t
 
pÜt_idx
;

705 
ušt8_t
 
»³©
 = 0;

706 
ušt32_t
 
toggË_mask
[
GPIO_COUNT
] = {0};

707 
ušt32_t
 
pšs_to_check
[
GPIO_COUNT
];

710 
pÜt_idx
 = 0;…Üt_idx < 
GPIO_COUNT
;…ort_idx++)

712 
pšs_to_check
[
pÜt_idx
] = 0xFFFFFFFF;

717 
»³©
 = 0;

719 
i
 = 0; i < 
GPIOTE_CONFIG_NUM_OF_LOW_POWER_EVENTS
; i++)

721 
ušt8_t
 
pš_ªd_£n£
 = 
m_cb
.
pÜt_hªdËrs_pšs
[
i
];

722 
Äf_drv_gpiÙe_pš_t
 
pš
 = (
pš_ªd_£n£
 & ~
SENSE_FIELD_MASK
);

724 ià((
m_cb
.
pÜt_hªdËrs_pšs
[
i
] !ğ
PIN_NOT_USED
)

725 && 
	`Äf_b™mask_b™_is_£t
(
pš
, 
pšs_to_check
))

727 
Äf_gpiÙe_pŞ¬™y_t
 
pŞ¬™y
 =

728 (
Äf_gpiÙe_pŞ¬™y_t
)((
pš_ªd_£n£
 &

729 
SENSE_FIELD_MASK
è>> 
SENSE_FIELD_POS
);

730 
Äf_drv_gpiÙe_evt_hªdËr_t
 
hªdËr
 =

731 
	`chªÃl_hªdËr_g‘
(
	`chªÃl_pÜt_g‘
(
pš
));

732 ià(
hªdËr
 || (
pŞ¬™y
 =ğ
NRF_GPIOTE_POLARITY_TOGGLE
))

734 ià(
pŞ¬™y
 =ğ
NRF_GPIOTE_POLARITY_TOGGLE
)

736 
	`Äf_b™mask_b™_£t
(
pš
, 
toggË_mask
);

738 
Äf_gpio_pš_£n£_t
 
£n£
 = 
	`Äf_gpio_pš_£n£_g‘
(
pš
);

739 
ušt32_t
 
pš_¡©e
 = 
	`Äf_b™mask_b™_is_£t
(
pš
, 
šput
);

740 ià((
pš_¡©e
 && (
£n£
 =ğ
NRF_GPIO_PIN_SENSE_HIGH
)) ||

741 (!
pš_¡©e
 && (
£n£
 =ğ
NRF_GPIO_PIN_SENSE_LOW
)) )

743 
	`NRF_LOG_DEBUG
("PORTƒv’ˆfÜ…š: %d,…Ş¬™y: %d.", 
pš
,

744 
pŞ¬™y
);

745 ià(
pŞ¬™y
 =ğ
NRF_GPIOTE_POLARITY_TOGGLE
)

747 
Äf_gpio_pš_£n£_t
 
Ãxt_£n£
 =

748 (
£n£
 =ğ
NRF_GPIO_PIN_SENSE_HIGH
) ?

749 
NRF_GPIO_PIN_SENSE_LOW
 :

750 
NRF_GPIO_PIN_SENSE_HIGH
;

751 
	`Äf_gpio_cfg_£n£_£t
(
pš
, 
Ãxt_£n£
);

752 ++
»³©
;

755 ià(
hªdËr
)

757 
	`hªdËr
(
pš
, 
pŞ¬™y
);

764 ià(
»³©
)

772 
ušt32_t
 
Ãw_šput
[
GPIO_COUNT
];

773 
boŞ
 
šput_unchªged
 = 
Œue
;

774 
	`Äf_gpio_pÜts_»ad
(0, 
GPIO_COUNT
, 
Ãw_šput
);

777 
pÜt_idx
 = 0;…Üt_idx < 
GPIO_COUNT
;…ort_idx++)

779 ià(
Ãw_šput
[
pÜt_idx
] !ğ
šput
[port_idx])

781 
šput_unchªged
 = 
çl£
;

786 ià(
šput_unchªged
)

789 
»³©
 = 0;

794 
pÜt_idx
 = 0;…Üt_idx < 
GPIO_COUNT
;…ort_idx++)

796 
šput
[
pÜt_idx
] = 
Ãw_šput
[port_idx];

797 
pšs_to_check
[
pÜt_idx
] = 
toggË_mask
[port_idx];

802 
»³©
);

804 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\drivers_nrf\uart\nrf_drv_uart.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
UART
)

42 
	~"Äf_drv_u¬t.h
"

43 
	~"Äf_as£¹.h
"

44 
	~"Äf_drv_commÚ.h
"

45 
	~"Äf_gpio.h
"

46 
	~"­p_ut_¶©fÜm.h
"

48 
	#NRF_LOG_MODULE_NAME
 
u¬t


	)

50 #ià
UART_CONFIG_LOG_ENABLED


51 
	#NRF_LOG_LEVEL
 
UART_CONFIG_LOG_LEVEL


	)

52 
	#NRF_LOG_INFO_COLOR
 
UART_CONFIG_INFO_COLOR


	)

53 
	#NRF_LOG_DEBUG_COLOR
 
UART_CONFIG_DEBUG_COLOR


	)

54 
	#EVT_TO_STR
(
ev’t
èÓv’ˆ=ğ
NRF_UART_EVENT_ERROR
 ? "NRF_UART_EVENT_ERROR" : "UNKNOWN EVENT")

	)

56 
	#EVT_TO_STR
(
ev’t
è""

	)

57 
	#NRF_LOG_LEVEL
 0

	)

59 
	~"Äf_log.h
"

60 
NRF_LOG_MODULE_REGISTER
();

62 #ià(
defšed
(
UARTE_IN_USE
è&& defšed(
UART_IN_USE
))

64 
	#CODE_FOR_UARTE
(
code
èià(
m_cb
[
p_š¡ªû
->
drv_š¡_idx
].
u£_—sy_dma
è{ cod}

	)

65 
	#CODE_FOR_UARTE_INT
(
idx
, 
code
èià(
m_cb
[idx].
u£_—sy_dma
è{ cod}

	)

66 
	#CODE_FOR_UART
(
code
è{ cod}

	)

67 #–ià(
defšed
(
UARTE_IN_USE
è&& !defšed(
UART_IN_USE
))

69 
	#CODE_FOR_UARTE
(
code
è{ cod}

	)

70 
	#CODE_FOR_UARTE_INT
(
idx
, 
code
è{ cod}

	)

71 
	#CODE_FOR_UART
(
code
)

	)

72 #–ià(!
defšed
(
UARTE_IN_USE
è&& defšed(
UART_IN_USE
))

74 
	#CODE_FOR_UARTE
(
code
)

	)

75 
	#CODE_FOR_UARTE_INT
(
idx
, 
code
)

	)

76 
	#CODE_FOR_UART
(
code
è{ cod}

	)

81 
	#TX_COUNTER_ABORT_REQ_VALUE
 256

	)

85 * 
	mp_cÚ‹xt
;

86 
Äf_u¬t_ev’t_hªdËr_t
 
	mhªdËr
;

87 
ušt8_t
 cÚ¡ * 
	mp_tx_bufãr
;

88 
ušt8_t
 * 
	mp_rx_bufãr
;

89 
ušt8_t
 * 
	mp_rx_£cÚd¬y_bufãr
;

90 vŞ©
ušt16_t
 
	mtx_couÁ”
;

91 
ušt8_t
 
	mtx_bufãr_Ëngth
;

92 
ušt8_t
 
	mrx_bufãr_Ëngth
;

93 
ušt8_t
 
	mrx_£cÚd¬y_bufãr_Ëngth
;

94 vŞ©
ušt8_t
 
	mrx_couÁ”
;

95 
boŞ
 
	mrx_’abËd
;

96 
Äf_drv_¡©e_t
 
	m¡©e
;

97 #ià(
defšed
(
UARTE_IN_USE
è&& defšed(
UART_IN_USE
))

98 
boŞ
 
	mu£_—sy_dma
;

100 } 
	tu¬t_cÚŒŞ_block_t
;

102 
u¬t_cÚŒŞ_block_t
 
	gm_cb
[
UART_ENABLED_COUNT
];

104 #ifdeà
NRF52810_XXAA


105 
	#IRQ_HANDLER
(
n
è
UARTE
##n##
	`_IRQHªdËr
()

	)

107 
	#IRQ_HANDLER
(
n
è
UART
##n##
	`_IRQHªdËr
()

	)

110 
__STATIC_INLINE
 
	$­¶y_cÚfig
(
Äf_drv_u¬t_t
 cÚ¡ * 
p_š¡ªû
, 
Äf_drv_u¬t_cÚfig_t
 cÚ¡ * 
p_cÚfig
)

112 ià(
p_cÚfig
->
p£Éxd
 !ğ
NRF_UART_PSEL_DISCONNECTED
)

114 
	`Äf_gpio_pš_£t
(
p_cÚfig
->
p£Éxd
);

115 
	`Äf_gpio_cfg_ouut
(
p_cÚfig
->
p£Éxd
);

117 ià(
p_cÚfig
->
p£Ìxd
 !ğ
NRF_UART_PSEL_DISCONNECTED
)

119 
	`Äf_gpio_cfg_šput
(
p_cÚfig
->
p£Ìxd
, 
NRF_GPIO_PIN_NOPULL
);

122 
CODE_FOR_UARTE


124 
	`Äf_u¬‹_baud¿‹_£t
(
p_š¡ªû
->
»g
.
p_u¬‹
, (
Äf_u¬‹_baud¿‹_t
)
p_cÚfig
->
baud¿‹
);

125 
	`Äf_u¬‹_cÚfigu»
(
p_š¡ªû
->
»g
.
p_u¬‹
, (
Äf_u¬‹_·r™y_t
)
p_cÚfig
->
·r™y
,

126 (
Äf_u¬‹_hwfc_t
)
p_cÚfig
->
hwfc
);

127 
	`Äf_u¬‹_txrx_pšs_£t
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
p_cÚfig
->
p£Éxd
,…_cÚfig->
p£Ìxd
);

128 ià(
p_cÚfig
->
hwfc
 =ğ
NRF_UART_HWFC_ENABLED
)

130 ià(
p_cÚfig
->
p£lùs
 !ğ
NRF_UART_PSEL_DISCONNECTED
)

132 
	`Äf_gpio_cfg_šput
(
p_cÚfig
->
p£lùs
, 
NRF_GPIO_PIN_NOPULL
);

134 ià(
p_cÚfig
->
p£Ìts
 !ğ
NRF_UART_PSEL_DISCONNECTED
)

136 
	`Äf_gpio_pš_£t
(
p_cÚfig
->
p£Ìts
);

137 
	`Äf_gpio_cfg_ouut
(
p_cÚfig
->
p£Ìts
);

139 
	`Äf_u¬‹_hwfc_pšs_£t
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
p_cÚfig
->
p£Ìts
,…_cÚfig->
p£lùs
);

142 
CODE_FOR_UART


144 
	`Äf_u¬t_baud¿‹_£t
(
p_š¡ªû
->
»g
.
p_u¬t
, 
p_cÚfig
->
baud¿‹
);

145 
	`Äf_u¬t_cÚfigu»
(
p_š¡ªû
->
»g
.
p_u¬t
, 
p_cÚfig
->
·r™y
,…_cÚfig->
hwfc
);

146 
	`Äf_u¬t_txrx_pšs_£t
(
p_š¡ªû
->
»g
.
p_u¬t
, 
p_cÚfig
->
p£Éxd
,…_cÚfig->
p£Ìxd
);

147 ià(
p_cÚfig
->
hwfc
 =ğ
NRF_UART_HWFC_ENABLED
)

149 ià(
p_cÚfig
->
p£lùs
 !ğ
NRF_UART_PSEL_DISCONNECTED
)

151 
	`Äf_gpio_cfg_šput
(
p_cÚfig
->
p£lùs
, 
NRF_GPIO_PIN_NOPULL
);

153 ià(
p_cÚfig
->
p£Ìts
 !ğ
NRF_UART_PSEL_DISCONNECTED
)

155 
	`Äf_gpio_pš_£t
(
p_cÚfig
->
p£Ìts
);

156 
	`Äf_gpio_cfg_ouut
(
p_cÚfig
->
p£Ìts
);

158 
	`Äf_u¬t_hwfc_pšs_£t
(
p_š¡ªû
->
»g
.
p_u¬t
, 
p_cÚfig
->
p£Ìts
,…_cÚfig->
p£lùs
);

161 
	}
}

163 
__STATIC_INLINE
 
	$š‹¼u±s_’abË
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
, 
ušt8_t
 
š‹¼u±_´iÜ™y
)

165 
CODE_FOR_UARTE


167 
	`Äf_u¬‹_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_ENDRX
);

168 
	`Äf_u¬‹_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_ENDTX
);

169 
	`Äf_u¬‹_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_ERROR
);

170 
	`Äf_u¬‹_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_RXTO
);

171 
	`Äf_u¬‹_št_’abË
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_INT_ENDRX_MASK
 |

172 
NRF_UARTE_INT_ENDTX_MASK
 |

173 
NRF_UARTE_INT_ERROR_MASK
 |

174 
NRF_UARTE_INT_RXTO_MASK
);

175 
	`Äf_drv_commÚ_œq_’abË
(
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_u¬‹
), 
š‹¼u±_´iÜ™y
);

177 
CODE_FOR_UART


179 
	`Äf_u¬t_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_EVENT_TXDRDY
);

180 
	`Äf_u¬t_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_EVENT_RXTO
);

181 
	`Äf_u¬t_št_’abË
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_INT_MASK_TXDRDY
 |

182 
NRF_UART_INT_MASK_RXTO
);

183 
	`Äf_drv_commÚ_œq_’abË
(
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_u¬t
), 
š‹¼u±_´iÜ™y
);

185 
	}
}

187 
__STATIC_INLINE
 
	$š‹¼u±s_di§bË
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

189 
CODE_FOR_UARTE


191 
	`Äf_u¬‹_št_di§bË
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_INT_ENDRX_MASK
 |

192 
NRF_UARTE_INT_ENDTX_MASK
 |

193 
NRF_UARTE_INT_ERROR_MASK
 |

194 
NRF_UARTE_INT_RXTO_MASK
);

195 
	`Äf_drv_commÚ_œq_di§bË
(
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_u¬‹
));

197 
CODE_FOR_UART


199 
	`Äf_u¬t_št_di§bË
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_INT_MASK_RXDRDY
 |

200 
NRF_UART_INT_MASK_TXDRDY
 |

201 
NRF_UART_INT_MASK_ERROR
 |

202 
NRF_UART_INT_MASK_RXTO
);

203 
	`Äf_drv_commÚ_œq_di§bË
(
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_u¬t
));

206 
	}
}

208 
__STATIC_INLINE
 
	$pšs_to_deçuÉ
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

211 
ušt32_t
 
txd
;

212 
ušt32_t
 
rxd
;

213 
ušt32_t
 
¹s
;

214 
ušt32_t
 
ùs
;

216 
CODE_FOR_UARTE


218 
txd
 = 
	`Äf_u¬‹_tx_pš_g‘
(
p_š¡ªû
->
»g
.
p_u¬‹
);

219 
rxd
 = 
	`Äf_u¬‹_rx_pš_g‘
(
p_š¡ªû
->
»g
.
p_u¬‹
);

220 
¹s
 = 
	`Äf_u¬‹_¹s_pš_g‘
(
p_š¡ªû
->
»g
.
p_u¬‹
);

221 
ùs
 = 
	`Äf_u¬‹_ùs_pš_g‘
(
p_š¡ªû
->
»g
.
p_u¬‹
);

222 
	`Äf_u¬‹_txrx_pšs_discÚÃù
(
p_š¡ªû
->
»g
.
p_u¬‹
);

223 
	`Äf_u¬‹_hwfc_pšs_discÚÃù
(
p_š¡ªû
->
»g
.
p_u¬‹
);

225 
CODE_FOR_UART


227 
txd
 = 
	`Äf_u¬t_tx_pš_g‘
(
p_š¡ªû
->
»g
.
p_u¬t
);

228 
rxd
 = 
	`Äf_u¬t_rx_pš_g‘
(
p_š¡ªû
->
»g
.
p_u¬t
);

229 
¹s
 = 
	`Äf_u¬t_¹s_pš_g‘
(
p_š¡ªû
->
»g
.
p_u¬t
);

230 
ùs
 = 
	`Äf_u¬t_ùs_pš_g‘
(
p_š¡ªû
->
»g
.
p_u¬t
);

231 
	`Äf_u¬t_txrx_pšs_discÚÃù
(
p_š¡ªû
->
»g
.
p_u¬t
);

232 
	`Äf_u¬t_hwfc_pšs_discÚÃù
(
p_š¡ªû
->
»g
.
p_u¬t
);

235 ià(
txd
 !ğ
NRF_UART_PSEL_DISCONNECTED
)

237 
	`Äf_gpio_cfg_deçuÉ
(
txd
);

240 ià(
rxd
 !ğ
NRF_UART_PSEL_DISCONNECTED
)

242 
	`Äf_gpio_cfg_deçuÉ
(
rxd
);

245 ià(
ùs
 !ğ
NRF_UART_PSEL_DISCONNECTED
)

247 
	`Äf_gpio_cfg_deçuÉ
(
ùs
);

250 ià(
¹s
 !ğ
NRF_UART_PSEL_DISCONNECTED
)

252 
	`Äf_gpio_cfg_deçuÉ
(
¹s
);

255 
	}
}

257 
__STATIC_INLINE
 
	$u¬t_’abË
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

259 
	`CODE_FOR_UARTE
(
	`Äf_u¬‹_’abË
(
p_š¡ªû
->
»g
.
p_u¬‹
);)

260 
	`CODE_FOR_UART
(
	`Äf_u¬t_’abË
(
p_š¡ªû
->
»g
.
p_u¬t
););

261 
	}
}

263 
__STATIC_INLINE
 
	$u¬t_di§bË
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

265 
	`CODE_FOR_UARTE
(
	`Äf_u¬‹_di§bË
(
p_š¡ªû
->
»g
.
p_u¬‹
);)

266 
	`CODE_FOR_UART
(
	`Äf_u¬t_di§bË
(
p_š¡ªû
->
»g
.
p_u¬t
););

267 
	}
}

269 
»t_code_t
 
	$Äf_drv_u¬t_š™
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
, 
Äf_drv_u¬t_cÚfig_t
 cÚ¡ * 
p_cÚfig
,

270 
Äf_u¬t_ev’t_hªdËr_t
 
ev’t_hªdËr
)

272 
	`ASSERT
(
p_cÚfig
);

273 
u¬t_cÚŒŞ_block_t
 * 
p_cb
 = &
m_cb
[
p_š¡ªû
->
drv_š¡_idx
];

274 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

276 ià(
p_cb
->
¡©e
 !ğ
NRF_DRV_STATE_UNINITIALIZED
)

278 
”r_code
 = 
NRF_ERROR_INVALID_STATE
;

279 
	`NRF_LOG_ERROR
("In™ faed. id:%d iÀwrÚg s‹", 
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_»g
));

280  
”r_code
;

283 #ià(
	`defšed
(
UARTE_IN_USE
è&& defšed(
UART_IN_USE
))

284 
p_cb
->
u£_—sy_dma
 = 
p_cÚfig
->use_easy_dma;

286 
	`­¶y_cÚfig
(
p_š¡ªû
, 
p_cÚfig
);

288 
p_cb
->
hªdËr
 = 
ev’t_hªdËr
;

289 
p_cb
->
p_cÚ‹xt
 = 
p_cÚfig
->p_context;

291 ià(
p_cb
->
hªdËr
)

293 
	`š‹¼u±s_’abË
(
p_š¡ªû
, 
p_cÚfig
->
š‹¼u±_´iÜ™y
);

296 
	`u¬t_’abË
(
p_š¡ªû
);

297 
p_cb
->
rx_bufãr_Ëngth
 = 0;

298 
p_cb
->
rx_£cÚd¬y_bufãr_Ëngth
 = 0;

299 
p_cb
->
tx_bufãr_Ëngth
 = 0;

300 
p_cb
->
¡©e
 = 
NRF_DRV_STATE_INITIALIZED
;

301 
p_cb
->
rx_’abËd
 = 
çl£
;

302  
”r_code
;

303 
	}
}

305 
	$Äf_drv_u¬t_unš™
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

307 
u¬t_cÚŒŞ_block_t
 * 
p_cb
 = &
m_cb
[
p_š¡ªû
->
drv_š¡_idx
];

309 
	`u¬t_di§bË
(
p_š¡ªû
);

311 ià(
p_cb
->
hªdËr
)

313 
	`š‹¼u±s_di§bË
(
p_š¡ªû
);

316 
	`pšs_to_deçuÉ
(
p_š¡ªû
);

318 
p_cb
->
¡©e
 = 
NRF_DRV_STATE_UNINITIALIZED
;

319 
p_cb
->
hªdËr
 = 
NULL
;

320 
	`NRF_LOG_INFO
("Unš™ id: %d.", 
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_»g
));

321 
	}
}

323 #ià
defšed
(
UART_IN_USE
)

324 
__STATIC_INLINE
 
	$tx_by‹
(
NRF_UART_Ty³
 * 
p_u¬t
, 
u¬t_cÚŒŞ_block_t
 * 
p_cb
)

326 
	`Äf_u¬t_ev’t_ş—r
(
p_u¬t
, 
NRF_UART_EVENT_TXDRDY
);

327 
ušt8_t
 
txd
 = 
p_cb
->
p_tx_bufãr
[p_cb->
tx_couÁ”
];

328 
p_cb
->
tx_couÁ”
++;

329 
	`Äf_u¬t_txd_£t
(
p_u¬t
, 
txd
);

330 
	}
}

332 
__STATIC_INLINE
 
»t_code_t
 
	$Äf_drv_u¬t_tx_fÜ_u¬t
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

334 
u¬t_cÚŒŞ_block_t
 * 
p_cb
 = &
m_cb
[
p_š¡ªû
->
drv_š¡_idx
];

335 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

337 
	`Äf_u¬t_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_EVENT_TXDRDY
);

338 
	`Äf_u¬t_sk_Œigg”
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_TASK_STARTTX
);

340 
	`tx_by‹
(
p_š¡ªû
->
»g
.
p_u¬t
, 
p_cb
);

342 ià(
p_cb
->
hªdËr
 =ğ
NULL
)

344 
p_cb
->
tx_couÁ”
 < (
ušt16_t
èp_cb->
tx_bufãr_Ëngth
)

346 !
	`Äf_u¬t_ev’t_check
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_EVENT_TXDRDY
) &&

347 
p_cb
->
tx_couÁ”
 !ğ
TX_COUNTER_ABORT_REQ_VALUE
)

350 ià(
p_cb
->
tx_couÁ”
 !ğ
TX_COUNTER_ABORT_REQ_VALUE
)

352 
	`tx_by‹
(
p_š¡ªû
->
»g
.
p_u¬t
, 
p_cb
);

356 ià(
p_cb
->
tx_couÁ”
 =ğ
TX_COUNTER_ABORT_REQ_VALUE
)

358 
”r_code
 = 
NRF_ERROR_FORBIDDEN
;

362 !
	`Äf_u¬t_ev’t_check
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_EVENT_TXDRDY
))

365 
	`Äf_u¬t_sk_Œigg”
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_TASK_STOPTX
);

367 
p_cb
->
tx_bufãr_Ëngth
 = 0;

369  
”r_code
;

370 
	}
}

373 #ià
defšed
(
UARTE_IN_USE
)

374 
__STATIC_INLINE
 
»t_code_t
 
	$Äf_drv_u¬t_tx_fÜ_u¬‹
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

376 
u¬t_cÚŒŞ_block_t
 * 
p_cb
 = &
m_cb
[
p_š¡ªû
->
drv_š¡_idx
];

377 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

379 
	`Äf_u¬‹_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_ENDTX
);

380 
	`Äf_u¬‹_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_TXSTOPPED
);

381 
	`Äf_u¬‹_tx_bufãr_£t
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
p_cb
->
p_tx_bufãr
,…_cb->
tx_bufãr_Ëngth
);

382 
	`Äf_u¬‹_sk_Œigg”
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_TASK_STARTTX
);

384 ià(
p_cb
->
hªdËr
 =ğ
NULL
)

386 
boŞ
 
’dtx
;

387 
boŞ
 
tx¡İ³d
;

390 
’dtx
 = 
	`Äf_u¬‹_ev’t_check
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_ENDTX
);

391 
tx¡İ³d
 = 
	`Äf_u¬‹_ev’t_check
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_TXSTOPPED
);

393 (!
’dtx
è&& (!
tx¡İ³d
));

395 ià(
tx¡İ³d
)

397 
”r_code
 = 
NRF_ERROR_FORBIDDEN
;

399 
p_cb
->
tx_bufãr_Ëngth
 = 0;

401  
”r_code
;

402 
	}
}

405 
»t_code_t
 
	$Äf_drv_u¬t_tx
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
, 
ušt8_t
 cÚ¡ * cÚ¡ 
p_d©a
, ušt8_ˆ
Ëngth
)

407 
u¬t_cÚŒŞ_block_t
 * 
p_cb
 = &
m_cb
[
p_š¡ªû
->
drv_š¡_idx
];

408 
	`ASSERT
(
p_cb
->
¡©e
 =ğ
NRF_DRV_STATE_INITIALIZED
);

409 
	`ASSERT
(
Ëngth
>0);

410 
	`ASSERT
(
p_d©a
);

412 
»t_code_t
 
”r_code
;

414 
CODE_FOR_UARTE


418 ià(!
	`Äf_drv_is_š_RAM
(
p_d©a
))

420 
”r_code
 = 
NRF_ERROR_INVALID_ADDR
;

421 
	`NRF_LOG_ERROR
("Id:%d, Easy-DMA buffer‚ot in RAM: %08x",

422 
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_»g
), 
p_d©a
);

423  
”r_code
;

427 ià(
	`Äf_drv_u¬t_tx_š_´og»ss
(
p_š¡ªû
))

429 
”r_code
 = 
NRF_ERROR_BUSY
;

430 
	`NRF_LOG_WARNING
("Id:%d busy",
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_»g
));

431  
”r_code
;

433 
p_cb
->
tx_bufãr_Ëngth
 = 
Ëngth
;

434 
p_cb
->
p_tx_bufãr
 = 
p_d©a
;

435 
p_cb
->
tx_couÁ”
 = 0;

437 
	`NRF_LOG_INFO
("TX„eq id:%d†ength: %d.",

438 
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_»g
),

439 
p_cb
->
tx_bufãr_Ëngth
);

440 
	`NRF_LOG_DEBUG
("Tx data:");

441 
	`NRF_LOG_HEXDUMP_DEBUG
((
ušt8_t
 *)
p_cb
->
p_tx_bufãr
,

442 
p_cb
->
tx_bufãr_Ëngth
 * Õ_cb->
p_tx_bufãr
[0]));

444 
CODE_FOR_UARTE


446  
	`Äf_drv_u¬t_tx_fÜ_u¬‹
(
p_š¡ªû
);

448 
CODE_FOR_UART


450  
	`Äf_drv_u¬t_tx_fÜ_u¬t
(
p_š¡ªû
);

452 
	}
}

454 
boŞ
 
	$Äf_drv_u¬t_tx_š_´og»ss
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

456  (
m_cb
[
p_š¡ªû
->
drv_š¡_idx
].
tx_bufãr_Ëngth
 != 0);

457 
	}
}

459 #ià
defšed
(
UART_IN_USE
)

460 
__STATIC_INLINE
 
	$rx_’abË
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

462 
	`Äf_u¬t_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_EVENT_ERROR
);

463 
	`Äf_u¬t_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_EVENT_RXDRDY
);

464 
	`Äf_u¬t_sk_Œigg”
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_TASK_STARTRX
);

465 
	}
}

467 
__STATIC_INLINE
 
	$rx_by‹
(
NRF_UART_Ty³
 * 
p_u¬t
, 
u¬t_cÚŒŞ_block_t
 * 
p_cb
)

469 ià(!
p_cb
->
rx_bufãr_Ëngth
)

471 
	`Äf_u¬t_ev’t_ş—r
(
p_u¬t
, 
NRF_UART_EVENT_RXDRDY
);

473 (è
	`Äf_u¬t_rxd_g‘
(
p_u¬t
);

476 
	`Äf_u¬t_ev’t_ş—r
(
p_u¬t
, 
NRF_UART_EVENT_RXDRDY
);

477 
p_cb
->
p_rx_bufãr
[p_cb->
rx_couÁ”
] = 
	`Äf_u¬t_rxd_g‘
(
p_u¬t
);

478 
p_cb
->
rx_couÁ”
++;

479 
	}
}

481 
__STATIC_INLINE
 
»t_code_t
 
	$Äf_drv_u¬t_rx_fÜ_u¬t
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
, 
ušt8_t
 * 
p_d©a
, ušt8_ˆ
Ëngth
, 
boŞ
 
£cÚd_bufãr
)

483 
»t_code_t
 
”r_code
;

485 
u¬t_cÚŒŞ_block_t
 * 
p_cb
 = &
m_cb
[
p_š¡ªû
->
drv_š¡_idx
];

487 ià((!
p_cb
->
rx_’abËd
è&& (!
£cÚd_bufãr
))

489 
	`rx_’abË
(
p_š¡ªû
);

492 ià(
p_cb
->
hªdËr
 =ğ
NULL
)

494 
	`Äf_u¬t_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_EVENT_RXTO
);

496 
boŞ
 
rxrdy
;

497 
boŞ
 
rxto
;

498 
boŞ
 
”rÜ
;

503 
”rÜ
 = 
	`Äf_u¬t_ev’t_check
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_EVENT_ERROR
);

504 
rxrdy
 = 
	`Äf_u¬t_ev’t_check
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_EVENT_RXDRDY
);

505 
rxto
 = 
	`Äf_u¬t_ev’t_check
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_EVENT_RXTO
);

506 } (!
rxrdy
è&& (!
rxto
è&& (!
”rÜ
));

508 ià(
”rÜ
 || 
rxto
)

512 
	`rx_by‹
(
p_š¡ªû
->
»g
.
p_u¬t
, 
p_cb
);

513 } 
p_cb
->
rx_bufãr_Ëngth
 >…_cb->
rx_couÁ”
);

515 
p_cb
->
rx_bufãr_Ëngth
 = 0;

516 ià(
”rÜ
)

518 
”r_code
 = 
NRF_ERROR_INTERNAL
;

519 
	`NRF_LOG_WARNING
("RX Id: %d,¿nsã¸”rÜ.", 
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_»g
));

520  
”r_code
;

523 ià(
rxto
)

525 
	`NRF_LOG_WARNING
("RX Id: %d,‡bÜ‹d.", 
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_»g
));

526 
”r_code
 = 
NRF_ERROR_FORBIDDEN
;

527  
”r_code
;

530 ià(
p_cb
->
rx_’abËd
)

532 
	`Äf_u¬t_sk_Œigg”
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_TASK_STARTRX
);

537 
	`Äf_u¬t_sk_Œigg”
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_TASK_STOPRX
);

542 
	`Äf_u¬t_št_’abË
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_INT_MASK_RXDRDY
 | 
NRF_UART_INT_MASK_ERROR
);

544 
”r_code
 = 
NRF_SUCCESS
;

545  
”r_code
;

546 
	}
}

549 #ià
defšed
(
UARTE_IN_USE
)

550 
__STATIC_INLINE
 
»t_code_t
 
	$Äf_drv_u¬t_rx_fÜ_u¬‹
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
, 
ušt8_t
 * 
p_d©a
, ušt8_ˆ
Ëngth
, 
boŞ
 
£cÚd_bufãr
)

552 
»t_code_t
 
”r_code
 = 
NRF_SUCCESS
;

553 
	`Äf_u¬‹_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_ENDRX
);

554 
	`Äf_u¬‹_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_RXTO
);

555 
	`Äf_u¬‹_rx_bufãr_£t
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
p_d©a
, 
Ëngth
);

556 ià(!
£cÚd_bufãr
)

558 
	`Äf_u¬‹_sk_Œigg”
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_TASK_STARTRX
);

562 
	`Äf_u¬‹_shÜts_’abË
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_SHORT_ENDRX_STARTRX
);

565 ià(
m_cb
[
p_š¡ªû
->
drv_š¡_idx
].
hªdËr
 =ğ
NULL
)

567 
boŞ
 
’drx
;

568 
boŞ
 
rxto
;

569 
boŞ
 
”rÜ
;

571 
’drx
 = 
	`Äf_u¬‹_ev’t_check
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_ENDRX
);

572 
rxto
 = 
	`Äf_u¬‹_ev’t_check
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_RXTO
);

573 
”rÜ
 = 
	`Äf_u¬‹_ev’t_check
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_ERROR
);

574 }(!
’drx
è&& (!
rxto
è&& (!
”rÜ
));

576 
m_cb
[
p_š¡ªû
->
drv_š¡_idx
].
rx_bufãr_Ëngth
 = 0;

578 ià(
”rÜ
)

580 
”r_code
 = 
NRF_ERROR_INTERNAL
;

583 ià(
rxto
)

585 
”r_code
 = 
NRF_ERROR_FORBIDDEN
;

590 
	`Äf_u¬‹_št_’abË
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_INT_ERROR_MASK
 | 
NRF_UARTE_INT_ENDRX_MASK
);

592  
”r_code
;

593 
	}
}

596 
»t_code_t
 
	$Äf_drv_u¬t_rx
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
, 
ušt8_t
 * 
p_d©a
, ušt8_ˆ
Ëngth
)

598 
u¬t_cÚŒŞ_block_t
 * 
p_cb
 = &
m_cb
[
p_š¡ªû
->
drv_š¡_idx
];

600 
	`ASSERT
(
m_cb
[
p_š¡ªû
->
drv_š¡_idx
].
¡©e
 =ğ
NRF_DRV_STATE_INITIALIZED
);

601 
	`ASSERT
(
Ëngth
>0);

603 
»t_code_t
 
”r_code
;

605 
CODE_FOR_UARTE


609 ià(!
	`Äf_drv_is_š_RAM
(
p_d©a
))

611 
”r_code
 = 
NRF_ERROR_INVALID_ADDR
;

612 
	`NRF_LOG_ERROR
("Id:%d, Easy-DMA buffer‚ot in RAM: %08x",

613 
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_»g
), 
p_d©a
);

614  
”r_code
;

618 
boŞ
 
£cÚd_bufãr
 = 
çl£
;

620 ià(
p_cb
->
hªdËr
)

622 
CODE_FOR_UARTE


624 
	`Äf_u¬‹_št_di§bË
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_INT_ERROR_MASK
 | 
NRF_UARTE_INT_ENDRX_MASK
);

626 
CODE_FOR_UART


628 
	`Äf_u¬t_št_di§bË
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_INT_MASK_RXDRDY
 | 
NRF_UART_INT_MASK_ERROR
);

631 ià(
p_cb
->
rx_bufãr_Ëngth
 != 0)

633 ià(
p_cb
->
rx_£cÚd¬y_bufãr_Ëngth
 != 0)

635 ià(
p_cb
->
hªdËr
)

637 
CODE_FOR_UARTE


639 
	`Äf_u¬‹_št_’abË
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_INT_ERROR_MASK
 | 
NRF_UARTE_INT_ENDRX_MASK
);

641 
CODE_FOR_UART


643 
	`Äf_u¬t_št_’abË
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_INT_MASK_RXDRDY
 | 
NRF_UART_INT_MASK_ERROR
);

646 
”r_code
 = 
NRF_ERROR_BUSY
;

647 
	`NRF_LOG_WARNING
("RX Id:%d, busy", 
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_»g
));

648  
”r_code
;

650 
£cÚd_bufãr
 = 
Œue
;

653 ià(!
£cÚd_bufãr
)

655 
p_cb
->
rx_bufãr_Ëngth
 = 
Ëngth
;

656 
p_cb
->
p_rx_bufãr
 = 
p_d©a
;

657 
p_cb
->
rx_couÁ”
 = 0;

658 
p_cb
->
rx_£cÚd¬y_bufãr_Ëngth
 = 0;

662 
p_cb
->
p_rx_£cÚd¬y_bufãr
 = 
p_d©a
;

663 
p_cb
->
rx_£cÚd¬y_bufãr_Ëngth
 = 
Ëngth
;

666 
	`NRF_LOG_INFO
("RX Id:%d†’:%d", 
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_»g
), 
Ëngth
);

668 
CODE_FOR_UARTE


670  
	`Äf_drv_u¬t_rx_fÜ_u¬‹
(
p_š¡ªû
, 
p_d©a
, 
Ëngth
, 
£cÚd_bufãr
);

672 
CODE_FOR_UART


674  
	`Äf_drv_u¬t_rx_fÜ_u¬t
(
p_š¡ªû
, 
p_d©a
, 
Ëngth
, 
£cÚd_bufãr
);

676 
	}
}

678 
boŞ
 
	$Äf_drv_u¬t_rx_»ady
(
Äf_drv_u¬t_t
 cÚ¡ * 
p_š¡ªû
)

680 
CODE_FOR_UARTE


682  
	`Äf_u¬‹_ev’t_check
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_ENDRX
);

684 
CODE_FOR_UART


686  
	`Äf_u¬t_ev’t_check
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_EVENT_RXDRDY
);

688 
	}
}

690 
	$Äf_drv_u¬t_rx_’abË
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

693 
CODE_FOR_UARTE


695 
	`ASSERT
(
çl£
);

697 
CODE_FOR_UART


699 ià(!
m_cb
[
p_š¡ªû
->
drv_š¡_idx
].
rx_’abËd
)

701 
	`rx_’abË
(
p_š¡ªû
);

702 
m_cb
[
p_š¡ªû
->
drv_š¡_idx
].
rx_’abËd
 = 
Œue
;

705 
	}
}

707 
	$Äf_drv_u¬t_rx_di§bË
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

710 
CODE_FOR_UARTE


712 
	`ASSERT
(
çl£
);

714 
CODE_FOR_UART


716 
	`Äf_u¬t_sk_Œigg”
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_TASK_STOPRX
);

717 
m_cb
[
p_š¡ªû
->
drv_š¡_idx
].
rx_’abËd
 = 
çl£
;

719 
	}
}

721 
ušt32_t
 
	$Äf_drv_u¬t_”rÜ¤c_g‘
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

723 
ušt32_t
 
”r¤c
;

724 
CODE_FOR_UARTE


726 
	`Äf_u¬‹_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_ERROR
);

727 
”r¤c
 = 
	`Äf_u¬‹_”rÜ¤c_g‘_ªd_ş—r
(
p_š¡ªû
->
»g
.
p_u¬‹
);

729 
CODE_FOR_UART


731 
	`Äf_u¬t_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_EVENT_ERROR
);

732 
”r¤c
 = 
	`Äf_u¬t_”rÜ¤c_g‘_ªd_ş—r
(
p_š¡ªû
->
»g
.
p_u¬t
);

734  
”r¤c
;

735 
	}
}

737 
__STATIC_INLINE
 
	$rx_dÚe_ev’t
(
u¬t_cÚŒŞ_block_t
 * 
p_cb
, 
ušt8_t
 
by‹s
, ušt8_ˆ* 
p_d©a
)

739 
Äf_drv_u¬t_ev’t_t
 
ev’t
;

741 
ev’t
.
ty³
 = 
NRF_DRV_UART_EVT_RX_DONE
;

742 
ev’t
.
d©a
.
rxtx
.
by‹s
 = bytes;

743 
ev’t
.
d©a
.
rxtx
.
p_d©a
 =…_data;

745 
p_cb
->
	`hªdËr
(&
ev’t
,…_cb->
p_cÚ‹xt
);

746 
	}
}

748 
__STATIC_INLINE
 
	$tx_dÚe_ev’t
(
u¬t_cÚŒŞ_block_t
 * 
p_cb
, 
ušt8_t
 
by‹s
)

750 
Äf_drv_u¬t_ev’t_t
 
ev’t
;

752 
ev’t
.
ty³
 = 
NRF_DRV_UART_EVT_TX_DONE
;

753 
ev’t
.
d©a
.
rxtx
.
by‹s
 = bytes;

754 
ev’t
.
d©a
.
rxtx
.
p_d©a
 = (
ušt8_t
 *)
p_cb
->
p_tx_bufãr
;

756 
p_cb
->
tx_bufãr_Ëngth
 = 0;

758 
	`NRF_LOG_INFO
("TX dÚËn:%d", 
by‹s
);

759 
p_cb
->
	`hªdËr
(&
ev’t
,…_cb->
p_cÚ‹xt
);

760 
	}
}

762 
	$Äf_drv_u¬t_tx_abÜt
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

764 
u¬t_cÚŒŞ_block_t
 * 
p_cb
 = &
m_cb
[
p_š¡ªû
->
drv_š¡_idx
];

766 
CODE_FOR_UARTE


768 
	`Äf_u¬‹_ev’t_ş—r
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_TXSTOPPED
);

769 
	`Äf_u¬‹_sk_Œigg”
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_TASK_STOPTX
);

770 ià(
p_cb
->
hªdËr
 =ğ
NULL
)

772 !
	`Äf_u¬‹_ev’t_check
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_EVENT_TXSTOPPED
));

775 
CODE_FOR_UART


777 
	`Äf_u¬t_sk_Œigg”
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_TASK_STOPTX
);

778 ià(
p_cb
->
hªdËr
)

780 
	`tx_dÚe_ev’t
(
p_cb
,…_cb->
tx_couÁ”
);

784 
p_cb
->
tx_couÁ”
 = 
TX_COUNTER_ABORT_REQ_VALUE
;

787 
	`NRF_LOG_INFO
("TX‡bÜˆId:%d", 
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_»g
));

788 
	}
}

790 
	$Äf_drv_u¬t_rx_abÜt
(cÚ¡ 
Äf_drv_u¬t_t
 * 
p_š¡ªû
)

792 
CODE_FOR_UARTE


794 
	`Äf_u¬‹_sk_Œigg”
(
p_š¡ªû
->
»g
.
p_u¬‹
, 
NRF_UARTE_TASK_STOPRX
);

796 
CODE_FOR_UART


798 
	`Äf_u¬t_št_di§bË
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_INT_MASK_RXDRDY
 | 
NRF_UART_INT_MASK_ERROR
);

799 
	`Äf_u¬t_sk_Œigg”
(
p_š¡ªû
->
»g
.
p_u¬t
, 
NRF_UART_TASK_STOPRX
);

801 
	`NRF_LOG_INFO
("RX‡bÜˆId:%d", 
	`Äf_drv_g‘_IRQn
((*)
p_š¡ªû
->
»g
.
p_»g
));

802 
	}
}

805 #ià
defšed
(
UART_IN_USE
)

806 
__STATIC_INLINE
 
	$u¬t_œq_hªdËr
(
NRF_UART_Ty³
 * 
p_u¬t
, 
u¬t_cÚŒŞ_block_t
 * 
p_cb
)

808 ià(
	`Äf_u¬t_št_’abË_check
(
p_u¬t
, 
NRF_UART_INT_MASK_ERROR
) &&

809 
	`Äf_u¬t_ev’t_check
(
p_u¬t
, 
NRF_UART_EVENT_ERROR
))

811 
Äf_drv_u¬t_ev’t_t
 
ev’t
;

812 
	`Äf_u¬t_ev’t_ş—r
(
p_u¬t
, 
NRF_UART_EVENT_ERROR
);

813 
	`Äf_u¬t_št_di§bË
(
p_u¬t
, 
NRF_UART_INT_MASK_RXDRDY
 | 
NRF_UART_INT_MASK_ERROR
);

814 ià(!
p_cb
->
rx_’abËd
)

816 
	`Äf_u¬t_sk_Œigg”
(
p_u¬t
, 
NRF_UART_TASK_STOPRX
);

818 
ev’t
.
ty³
 = 
NRF_DRV_UART_EVT_ERROR
;

819 
ev’t
.
d©a
.
”rÜ
.
”rÜ_mask
 = 
	`Äf_u¬t_”rÜ¤c_g‘_ªd_ş—r
(
p_u¬t
);

820 
ev’t
.
d©a
.
”rÜ
.
rxtx
.
by‹s
 = 
p_cb
->
rx_bufãr_Ëngth
;

821 
ev’t
.
d©a
.
”rÜ
.
rxtx
.
p_d©a
 = 
p_cb
->
p_rx_bufãr
;

824 
p_cb
->
rx_bufãr_Ëngth
 = 0;

825 
p_cb
->
rx_£cÚd¬y_bufãr_Ëngth
 = 0;

827 
p_cb
->
	`hªdËr
(&
ev’t
,p_cb->
p_cÚ‹xt
);

829 ià(
	`Äf_u¬t_št_’abË_check
(
p_u¬t
, 
NRF_UART_INT_MASK_RXDRDY
) &&

830 
	`Äf_u¬t_ev’t_check
(
p_u¬t
, 
NRF_UART_EVENT_RXDRDY
))

832 
	`rx_by‹
(
p_u¬t
, 
p_cb
);

833 ià(
p_cb
->
rx_bufãr_Ëngth
 =ğp_cb->
rx_couÁ”
)

835 ià(
p_cb
->
rx_£cÚd¬y_bufãr_Ëngth
)

837 
ušt8_t
 * 
p_d©a
 = 
p_cb
->
p_rx_bufãr
;

838 
ušt8_t
 
rx_couÁ”
 = 
p_cb
->rx_counter;

841 
p_cb
->
rx_bufãr_Ëngth
 =…_cb->
rx_£cÚd¬y_bufãr_Ëngth
;

842 
p_cb
->
p_rx_bufãr
 =…_cb->
p_rx_£cÚd¬y_bufãr
;

843 
p_cb
->
rx_£cÚd¬y_bufãr_Ëngth
 = 0;

844 
p_cb
->
rx_couÁ”
 = 0;

845 
	`rx_dÚe_ev’t
(
p_cb
, 
rx_couÁ”
, 
p_d©a
);

849 ià(!
p_cb
->
rx_’abËd
)

851 
	`Äf_u¬t_sk_Œigg”
(
p_u¬t
, 
NRF_UART_TASK_STOPRX
);

853 
	`Äf_u¬t_št_di§bË
(
p_u¬t
, 
NRF_UART_INT_MASK_RXDRDY
 | 
NRF_UART_INT_MASK_ERROR
);

854 
p_cb
->
rx_bufãr_Ëngth
 = 0;

855 
	`rx_dÚe_ev’t
(
p_cb
,…_cb->
rx_couÁ”
,…_cb->
p_rx_bufãr
);

860 ià(
	`Äf_u¬t_ev’t_check
(
p_u¬t
, 
NRF_UART_EVENT_TXDRDY
))

862 ià(
p_cb
->
tx_couÁ”
 < (
ušt16_t
èp_cb->
tx_bufãr_Ëngth
)

864 
	`tx_by‹
(
p_u¬t
, 
p_cb
);

868 
	`Äf_u¬t_ev’t_ş—r
(
p_u¬t
, 
NRF_UART_EVENT_TXDRDY
);

869 ià(
p_cb
->
tx_bufãr_Ëngth
)

871 
	`tx_dÚe_ev’t
(
p_cb
,…_cb->
tx_bufãr_Ëngth
);

876 ià(
	`Äf_u¬t_ev’t_check
(
p_u¬t
, 
NRF_UART_EVENT_RXTO
))

878 
	`Äf_u¬t_ev’t_ş—r
(
p_u¬t
, 
NRF_UART_EVENT_RXTO
);

881 ià(
p_cb
->
rx_’abËd
)

883 
	`Äf_u¬t_sk_Œigg”
(
p_u¬t
, 
NRF_UART_TASK_STARTRX
);

885 ià(
p_cb
->
rx_bufãr_Ëngth
)

887 
p_cb
->
rx_bufãr_Ëngth
 = 0;

888 
	`rx_dÚe_ev’t
(
p_cb
,…_cb->
rx_couÁ”
,…_cb->
p_rx_bufãr
);

891 
	}
}

894 #ià
defšed
(
UARTE_IN_USE
)

895 
__STATIC_INLINE
 
	$u¬‹_œq_hªdËr
(
NRF_UARTE_Ty³
 * 
p_u¬‹
, 
u¬t_cÚŒŞ_block_t
 * 
p_cb
)

897 ià(
	`Äf_u¬‹_ev’t_check
(
p_u¬‹
, 
NRF_UARTE_EVENT_ERROR
))

899 
Äf_drv_u¬t_ev’t_t
 
ev’t
;

901 
	`Äf_u¬‹_ev’t_ş—r
(
p_u¬‹
, 
NRF_UARTE_EVENT_ERROR
);

903 
ev’t
.
ty³
 = 
NRF_DRV_UART_EVT_ERROR
;

904 
ev’t
.
d©a
.
”rÜ
.
”rÜ_mask
 = 
	`Äf_u¬‹_”rÜ¤c_g‘_ªd_ş—r
(
p_u¬‹
);

905 
ev’t
.
d©a
.
”rÜ
.
rxtx
.
by‹s
 = 
	`Äf_u¬‹_rx_amouÁ_g‘
(
p_u¬‹
);

906 
ev’t
.
d©a
.
”rÜ
.
rxtx
.
p_d©a
 = 
p_cb
->
p_rx_bufãr
;

909 
p_cb
->
rx_bufãr_Ëngth
 = 0;

910 
p_cb
->
rx_£cÚd¬y_bufãr_Ëngth
 = 0;

912 
p_cb
->
	`hªdËr
(&
ev’t
,…_cb->
p_cÚ‹xt
);

914 ià(
	`Äf_u¬‹_ev’t_check
(
p_u¬‹
, 
NRF_UARTE_EVENT_ENDRX
))

916 
	`Äf_u¬‹_ev’t_ş—r
(
p_u¬‹
, 
NRF_UARTE_EVENT_ENDRX
);

917 
ušt8_t
 
amouÁ
 = 
	`Äf_u¬‹_rx_amouÁ_g‘
(
p_u¬‹
);

920 ià(
amouÁ
 =ğ
p_cb
->
rx_bufãr_Ëngth
)

922 ià(
p_cb
->
rx_£cÚd¬y_bufãr_Ëngth
)

924 
ušt8_t
 * 
p_d©a
 = 
p_cb
->
p_rx_bufãr
;

925 
	`Äf_u¬‹_shÜts_di§bË
(
p_u¬‹
, 
NRF_UARTE_SHORT_ENDRX_STARTRX
);

926 
p_cb
->
rx_bufãr_Ëngth
 =…_cb->
rx_£cÚd¬y_bufãr_Ëngth
;

927 
p_cb
->
p_rx_bufãr
 =…_cb->
p_rx_£cÚd¬y_bufãr
;

928 
p_cb
->
rx_£cÚd¬y_bufãr_Ëngth
 = 0;

929 
	`rx_dÚe_ev’t
(
p_cb
, 
amouÁ
, 
p_d©a
);

933 
p_cb
->
rx_bufãr_Ëngth
 = 0;

934 
	`rx_dÚe_ev’t
(
p_cb
, 
amouÁ
,…_cb->
p_rx_bufãr
);

939 ià(
	`Äf_u¬‹_ev’t_check
(
p_u¬‹
, 
NRF_UARTE_EVENT_RXTO
))

941 
	`Äf_u¬‹_ev’t_ş—r
(
p_u¬‹
, 
NRF_UARTE_EVENT_RXTO
);

942 ià(
p_cb
->
rx_bufãr_Ëngth
)

944 
p_cb
->
rx_bufãr_Ëngth
 = 0;

945 
	`rx_dÚe_ev’t
(
p_cb
, 
	`Äf_u¬‹_rx_amouÁ_g‘
(
p_u¬‹
),…_cb->
p_rx_bufãr
);

949 ià(
	`Äf_u¬‹_ev’t_check
(
p_u¬‹
, 
NRF_UARTE_EVENT_ENDTX
))

951 
	`Äf_u¬‹_ev’t_ş—r
(
p_u¬‹
, 
NRF_UARTE_EVENT_ENDTX
);

952 ià(
p_cb
->
tx_bufãr_Ëngth
)

954 
	`tx_dÚe_ev’t
(
p_cb
, 
	`Äf_u¬‹_tx_amouÁ_g‘
(
p_u¬‹
));

957 
	}
}

960 #ià
UART0_ENABLED


961 
	$IRQ_HANDLER
(0)

963 
CODE_FOR_UARTE_INT


965 
UART0_INSTANCE_INDEX
,

966 
	`u¬‹_œq_hªdËr
(
NRF_UARTE0
, &
m_cb
[
UART0_INSTANCE_INDEX
]);

968 
CODE_FOR_UART


970 
	`u¬t_œq_hªdËr
(
NRF_UART0
, &
m_cb
[
UART0_INSTANCE_INDEX
]);

972 
	}
}

975 #ià
UART1_ENABLED


976 
	$UARTE1_IRQHªdËr
()

978 
CODE_FOR_UARTE_INT


980 
UART1_INSTANCE_INDEX
,

981 
	`u¬‹_œq_hªdËr
(
NRF_UARTE1
, &
m_cb
[
UART1_INSTANCE_INDEX
]);

983 
CODE_FOR_UART


985 
	`u¬t_œq_hªdËr
(
NRF_UART1
, &
m_cb
[
UART1_INSTANCE_INDEX
]);

987 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\atomic_fifo\nrf_atfifo.c

41 
	~<¡ršg.h
>

42 
	~"­p_ut.h
"

43 
	~"Äf_©fifo.h
"

44 
	~"Äf_©fifo_š‹º®.h
"

48 
STATIC_ASSERT
((
Äf_©fifo_po¡ag_t
è=ğ(
ušt32_t
));

51 
»t_code_t
 
	$Äf_©fifo_š™
(
Äf_©fifo_t
 * cÚ¡ 
p_fifo
, * 
p_buf
, 
ušt16_t
 
buf_size
, ušt16_ˆ
™em_size
)

53 ià(
NULL
 =ğ
p_buf
)

55  
NRF_ERROR_NULL
;

57 ià(0 !ğ(
buf_size
 % 
™em_size
))

59  
NRF_ERROR_INVALID_LENGTH
;

62 
p_fifo
->
p_buf
 =…_buf;

63 
p_fifo
->

.
g
 = 0;

64 
p_fifo
->
h—d
.
g
 = 0;

65 
p_fifo
->
buf_size
 = buf_size;

66 
p_fifo
->
™em_size
 = item_size;

68  
NRF_SUCCESS
;

69 
	}
}

72 
»t_code_t
 
	$Äf_©fifo_ş—r
(
Äf_©fifo_t
 * cÚ¡ 
p_fifo
)

74 
boŞ
 
»Ëa£d
 = 
	`Äf_©fifo_¥aû_ş—r
(
p_fifo
);

75  
»Ëa£d
 ? 
NRF_SUCCESS
 : 
NRF_ERROR_BUSY
;

76 
	}
}

79 
»t_code_t
 
	$Äf_©fifo_®loc_put
(
Äf_©fifo_t
 * cÚ¡ 
p_fifo
, cÚ¡ * 
p_v¬
, 
size_t
 
size
, 
boŞ
 * cÚ¡ 
p_visibË
)

81 
Äf_©fifo_™em_put_t
 
cÚ‹xt
;

82 
boŞ
 
visibË
;

83 * 
p_d©a
 = 
	`Äf_©fifo_™em_®loc
(
p_fifo
, &
cÚ‹xt
);

84 ià(
NULL
 =ğ
p_d©a
)

86  
NRF_ERROR_NO_MEM
;

89 
	`memıy
(
p_d©a
, 
p_v¬
, 
size
);

91 
visibË
 = 
	`Äf_©fifo_™em_put
(
p_fifo
, &
cÚ‹xt
);

92 ià(
NULL
 !ğ
p_visibË
)

94 *
p_visibË
 = 
visibË
;

96  
NRF_SUCCESS
;

97 
	}
}

100 * 
	$Äf_©fifo_™em_®loc
(
Äf_©fifo_t
 * cÚ¡ 
p_fifo
, 
Äf_©fifo_™em_put_t
 * 
p_cÚ‹xt
)

102 ià(
	`Äf_©fifo_w¥aû_»q
(
p_fifo
, &(
p_cÚ‹xt
->
Ï¡_
)))

104  ((
ušt8_t
*)(
p_fifo
->
p_buf
)è+ 
p_cÚ‹xt
->
Ï¡_
.
pos
.
wr
;

106  
NULL
;

107 
	}
}

110 
boŞ
 
	$Äf_©fifo_™em_put
(
Äf_©fifo_t
 * cÚ¡ 
p_fifo
, 
Äf_©fifo_™em_put_t
 * 
p_cÚ‹xt
)

112 ià((
p_cÚ‹xt
->
Ï¡_
.
pos
.
wr
è=ğÕ_cÚ‹xt->Ï¡_.pos.
rd
))

114 
	`Äf_©fifo_w¥aû_şo£
(
p_fifo
);

115  
Œue
;

117  
çl£
;

118 
	}
}

121 
»t_code_t
 
	$Äf_©fifo_g‘_ä“
(
Äf_©fifo_t
 * cÚ¡ 
p_fifo
, * cÚ¡ 
p_v¬
, 
size_t
 
size
, 
boŞ
 * 
p_»Ëa£d
)

123 
Äf_©fifo_™em_g‘_t
 
cÚ‹xt
;

124 
boŞ
 
»Ëa£d
;

125 cÚ¡ * 
p_s
 = 
	`Äf_©fifo_™em_g‘
(
p_fifo
, &
cÚ‹xt
);

126 ià(
NULL
 =ğ
p_s
)

128  
NRF_ERROR_NOT_FOUND
;

131 
	`memıy
(
p_v¬
, 
p_s
, 
size
);

133 
»Ëa£d
 = 
	`Äf_©fifo_™em_ä“
(
p_fifo
, &
cÚ‹xt
);

134 ià(
NULL
 !ğ
p_»Ëa£d
)

136 *
p_»Ëa£d
 = 
»Ëa£d
;

138  
NRF_SUCCESS
;

139 
	}
}

142 * 
	$Äf_©fifo_™em_g‘
(
Äf_©fifo_t
 * cÚ¡ 
p_fifo
, 
Äf_©fifo_™em_g‘_t
 * 
p_cÚ‹xt
)

144 ià(
	`Äf_©fifo_r¥aû_»q
(
p_fifo
, &(
p_cÚ‹xt
->
Ï¡_h—d
)))

146  ((
ušt8_t
*)(
p_fifo
->
p_buf
)è+ 
p_cÚ‹xt
->
Ï¡_h—d
.
pos
.
rd
;

148  
NULL
;

149 
	}
}

152 
boŞ
 
	$Äf_©fifo_™em_ä“
(
Äf_©fifo_t
 * cÚ¡ 
p_fifo
, 
Äf_©fifo_™em_g‘_t
 * 
p_cÚ‹xt
)

154 ià((
p_cÚ‹xt
->
Ï¡_h—d
.
pos
.
wr
è=ğÕ_cÚ‹xt->Ï¡_h—d.pos.
rd
))

156 
	`Äf_©fifo_r¥aû_şo£
(
p_fifo
);

157  
Œue
;

159  
çl£
;

160 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\balloc\nrf_balloc.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
NRF_BALLOC
)

43 
	~"Äf_b®loc.h
"

44 
	~"­p_ut_¶©fÜm.h
"

46 
	#NRF_LOG_MODULE_NAME
 
b®loc


	)

47 #ià
NRF_BALLOC_CONFIG_LOG_ENABLED


48 
	#NRF_LOG_LEVEL
 
NRF_BALLOC_CONFIG_LOG_LEVEL


	)

49 
	#NRF_LOG_INFO_COLOR
 
NRF_BALLOC_CONFIG_INFO_COLOR


	)

50 
	#NRF_LOG_DEBUG_COLOR
 
NRF_BALLOC_CONFIG_DEBUG_COLOR


	)

52 
	#NRF_LOG_LEVEL
 0

	)

54 
	~"Äf_log.h
"

55 
NRF_LOG_MODULE_REGISTER
();

57 
	#HEAD_GUARD_FILL
 0xBAADF00D

	)

58 
	#TAIL_GUARD_FILL
 0xBAADCAFE

	)

59 
	#FREE_MEM_FILL
 0xBAADBAAD

	)

61 #ià
NRF_BALLOC_CONFIG_DEBUG_ENABLED


62 
	#POOL_ID
(
_p_poŞ
è_p_poŞ->
p_Çme


	)

63 
	#POOL_MARKER
 "%s"

	)

65 
	#POOL_ID
(
_p_poŞ
è
	)
_p_pool

66 
	#POOL_MARKER
 "0x%08X"

	)

69 #ià
NRF_BALLOC_CONFIG_DEBUG_ENABLED


78 
__STATIC_INLINE
 * 
	$Äf_b®loc_block_unw¿p
(
Äf_b®loc_t
 cÚ¡ * 
p_poŞ
, * 
p_h—d
)

80 
	`ASSERT
((
p_poŞ
 !ğ
NULL
è&& (Õ_poŞ->
block_size
 % (
ušt32_t
)) == 0));

81 
	`ASSERT
((
p_h—d
 !ğ
NULL
è&& (((
ušt32_t
)(p_head) % (uint32_t)) == 0));

83 
ušt32_t
 
h—d_wÜds
 = 
	`NRF_BALLOC_DEBUG_HEAD_GUARD_WORDS_GET
(
p_poŞ
->
debug_æags
);

84 
ušt32_t
 
_wÜds
 = 
	`NRF_BALLOC_DEBUG_TAIL_GUARD_WORDS_GET
(
p_poŞ
->
debug_æags
);

86 
ušt32_t
 * 
p_
 = (ušt32_ˆ*)((
size_t
)(
p_h—d
è+ 
p_poŞ
->
block_size
);

87 
ušt32_t
 * 
p_–em’t
 = (ušt32_ˆ*)
p_h—d
 + 
h—d_wÜds
;

89 ià(
	`NRF_BALLOC_DEBUG_DATA_TRASHING_CHECK_GET
(
p_poŞ
->
debug_æags
))

91 
ušt32_t
 * 
±r
 = 
p_h—d
;…Œ < 
p_
;…tr++)

93 ià(*
±r
 !ğ
FREE_MEM_FILL
)

95 
	`NRF_LOG_ERROR
("D‘eùed f»memÜy cÜru±iÚ‡ˆ0x%08X (0x%08X !ğ0x%08X,…oŞ: '" 
POOL_MARKER
 "')",

96 
±r
, *±r, 
FREE_MEM_FILL
, 
	`POOL_ID
(
p_poŞ
));

97 
	`APP_ERROR_CHECK_BOOL
(
çl£
);

102 
ušt32_t
 * 
±r
 = 
p_h—d
;…Œ < 
p_–em’t
;…tr++)

104 *
±r
 = 
HEAD_GUARD_FILL
;

107 
ušt32_t
 * 
±r
 = ( 
p_
 - 
_wÜds
);…tr <…_tail;…tr++)

109 *
±r
 = 
TAIL_GUARD_FILL
;

112  
p_–em’t
;

113 
	}
}

122 
__STATIC_INLINE
 * 
	$Äf_b®loc_–em’t_w¿p
(
Äf_b®loc_t
 cÚ¡ * 
p_poŞ
, * 
p_–em’t
)

124 
	`ASSERT
((
p_poŞ
 !ğ
NULL
è&& (Õ_poŞ->
block_size
 % (
ušt32_t
)) == 0));

125 
	`ASSERT
((
p_–em’t
 !ğ
NULL
è&& (((
ušt32_t
)(p_element) % (uint32_t)) == 0));

127 
ušt32_t
 
h—d_wÜds
 = 
	`NRF_BALLOC_DEBUG_HEAD_GUARD_WORDS_GET
(
p_poŞ
->
debug_æags
);

128 
ušt32_t
 
_wÜds
 = 
	`NRF_BALLOC_DEBUG_TAIL_GUARD_WORDS_GET
(
p_poŞ
->
debug_æags
);

130 
ušt32_t
 * 
p_h—d
 = (ušt32_ˆ*)
p_–em’t
 - 
h—d_wÜds
;

131 
ušt32_t
 * 
p_
 = (ušt32_ˆ*)((
size_t
)(
p_h—d
è+ 
p_poŞ
->
block_size
);

133 
ušt32_t
 * 
±r
 = 
p_h—d
;…Œ < (ušt32_ˆ*)
p_–em’t
;…tr++)

135 ià(*
±r
 !ğ
HEAD_GUARD_FILL
)

137 
	`NRF_LOG_ERROR
("D‘eùed H—d Gu¬d cÜru±iÚ‡ˆ0x%08X (0x%08X !ğ0x%08X,…oŞ: '" 
POOL_MARKER
 "')",

138 
±r
, *±r, 
HEAD_GUARD_FILL
, 
	`POOL_ID
(
p_poŞ
));

139 
	`APP_ERROR_CHECK_BOOL
(
çl£
);

143 
ušt32_t
 * 
±r
 = ( 
p_
 - 
_wÜds
);…tr <…_tail;…tr++)

145 ià(*
±r
 !ğ
TAIL_GUARD_FILL
)

147 
	`NRF_LOG_ERROR
("D‘eùed Ta Gu¬d cÜru±iÚ‡ˆ0x%08X (0x%08X !ğ0x%08X,…oŞ: '" 
POOL_MARKER
 "')",

148 
±r
, *±r, 
TAIL_GUARD_FILL
, 
	`POOL_ID
(
p_poŞ
));

149 
	`APP_ERROR_CHECK_BOOL
(
çl£
);

153 ià(
	`NRF_BALLOC_DEBUG_DATA_TRASHING_CHECK_GET
(
p_poŞ
->
debug_æags
))

155 
ušt32_t
 * 
±r
 = 
p_h—d
;…Œ < 
p_
;…tr++)

157 *
±r
 = 
FREE_MEM_FILL
;

161  
p_h—d
;

162 
	}
}

173 * 
	$Äf_b®loc_idx2block
(
Äf_b®loc_t
 cÚ¡ * 
p_poŞ
, 
ušt8_t
 
idx
)

175 
	`ASSERT
(
p_poŞ
 !ğ
NULL
);

176  (
ušt8_t
 *)(
p_poŞ
->
p_memÜy_begš
è+ ((
size_t
)(
idx
è*…_poŞ->
block_size
);

177 
	}
}

186 
ušt8_t
 
	$Äf_b®loc_block2idx
(
Äf_b®loc_t
 cÚ¡ * 
p_poŞ
, cÚ¡ * 
p_block
)

188 
	`ASSERT
(
p_poŞ
 !ğ
NULL
);

189  ((
size_t
)(
p_block
è- (size_t)(
p_poŞ
->
p_memÜy_begš
)è/…_poŞ->
block_size
;

190 
	}
}

192 
»t_code_t
 
	$Äf_b®loc_š™
(
Äf_b®loc_t
 cÚ¡ * 
p_poŞ
)

194 
ušt8_t
 
poŞ_size
;

196 
	`VERIFY_PARAM_NOT_NULL
(
p_poŞ
);

198 
	`ASSERT
(
p_poŞ
->
p_cb
);

199 
	`ASSERT
(
p_poŞ
->
p_¡ack_ba£
);

200 
	`ASSERT
(
p_poŞ
->
p_¡ack_lim™
);

201 
	`ASSERT
(
p_poŞ
->
p_memÜy_begš
);

202 
	`ASSERT
(
p_poŞ
->
block_size
);

204 
poŞ_size
 = 
p_poŞ
->
p_¡ack_lim™
 -…_poŞ->
p_¡ack_ba£
;

206 #ià
NRF_BALLOC_CONFIG_DEBUG_ENABLED


207 *
p_memÜy_’d
 = (
ušt8_t
 *)(
p_poŞ
->
p_memÜy_begš
è+ (
poŞ_size
 *…_poŞ->
block_size
);

208 ià(
	`NRF_BALLOC_DEBUG_DATA_TRASHING_CHECK_GET
(
p_poŞ
->
debug_æags
))

210 
ušt32_t
 * 
±r
 = 
p_poŞ
->
p_memÜy_begš
;…Œ < (ušt32_ˆ*)(
p_memÜy_’d
);…tr++)

212 *
±r
 = 
FREE_MEM_FILL
;

217 
	`NRF_LOG_INFO
("PoŞ '" 
POOL_MARKER
 "' initialized (size: %u x %u = %u bytes)",

218 
	`POOL_ID
(
p_poŞ
),

219 
poŞ_size
,

220 
p_poŞ
->
block_size
,

221 
poŞ_size
 * 
p_poŞ
->
block_size
);

223 
p_poŞ
->
p_cb
->
p_¡ack_poš‹r
 =…_poŞ->
p_¡ack_ba£
;

224 
poŞ_size
--)

226 *(
p_poŞ
->
p_cb
->
p_¡ack_poš‹r
)++ = 
poŞ_size
;

229 
p_poŞ
->
p_cb
->
max_utiz©iÚ
 = 0;

231  
NRF_SUCCESS
;

232 
	}
}

234 * 
	$Äf_b®loc_®loc
(
Äf_b®loc_t
 cÚ¡ * 
p_poŞ
)

236 
	`ASSERT
(
p_poŞ
 !ğ
NULL
);

238 * 
p_block
 = 
NULL
;

240 
	`CRITICAL_REGION_ENTER
();

242 ià(
p_poŞ
->
p_cb
->
p_¡ack_poš‹r
 >…_poŞ->
p_¡ack_ba£
)

245 
p_block
 = 
	`Äf_b®loc_idx2block
(
p_poŞ
, *--Õ_poŞ->
p_cb
->
p_¡ack_poš‹r
));

248 
ušt8_t
 
utiz©iÚ
 = 
p_poŞ
->
p_¡ack_lim™
 -…_poŞ->
p_cb
->
p_¡ack_poš‹r
;

249 ià(
p_poŞ
->
p_cb
->
max_utiz©iÚ
 < 
utiz©iÚ
)

251 
p_poŞ
->
p_cb
->
max_utiz©iÚ
 = 
utiz©iÚ
;

255 
	`CRITICAL_REGION_EXIT
();

257 #ià
NRF_BALLOC_CONFIG_DEBUG_ENABLED


258 ià(
p_block
 !ğ
NULL
)

260 
p_block
 = 
	`Äf_b®loc_block_unw¿p
(
p_poŞ
,…_block);

264 
	`NRF_LOG_DEBUG
("Äf_b®loc_®locÕoŞ: '" 
POOL_MARKER
 "',ƒlement: 0x%08X)",

265 
	`POOL_ID
(
p_poŞ
), 
p_block
);

267  
p_block
;

268 
	}
}

270 
	$Äf_b®loc_ä“
(
Äf_b®loc_t
 cÚ¡ * 
p_poŞ
, * 
p_–em’t
)

272 
	`ASSERT
(
p_poŞ
 !ğ
NULL
);

273 
	`ASSERT
(
p_–em’t
 !ğ
NULL
)

275 
	`NRF_LOG_DEBUG
("Äf_b®loc_ä“ÕoŞ: '" 
POOL_MARKER
 "',ƒlement: 0x%08X)",

276 
	`POOL_ID
(
p_poŞ
), 
p_–em’t
);

278 #ià
NRF_BALLOC_CONFIG_DEBUG_ENABLED


279 * 
p_block
 = 
	`Äf_b®loc_–em’t_w¿p
(
p_poŞ
, 
p_–em’t
);

282 ià(
	`NRF_BALLOC_DEBUG_BASIC_CHECKS_GET
(
p_poŞ
->
debug_æags
))

284 
ušt8_t
 
poŞ_size
 = 
p_poŞ
->
p_¡ack_lim™
 -…_poŞ->
p_¡ack_ba£
;

285 *
p_memÜy_’d
 = (
ušt8_t
 *)(
p_poŞ
->
p_memÜy_begš
è+ (
poŞ_size
 *…_poŞ->
block_size
);

288 ià((
p_block
 < 
p_poŞ
->
p_memÜy_begš
è|| (p_block >ğ
p_memÜy_’d
))

290 
	`NRF_LOG_ERROR
("A‰em±edØä“ƒËm’ˆth© dÛ b–ÚgØthpoŞ (poŞ: '" 
POOL_MARKER
 "',ƒlement: 0x%08X)",

291 
	`POOL_ID
(
p_poŞ
), 
p_–em’t
);

292 
	`APP_ERROR_CHECK_BOOL
(
çl£
);

296 ià((((
size_t
)(
p_block
è- (size_t)(
p_poŞ
->
p_memÜy_begš
)è%…_poŞ->
block_size
) != 0)

298 
	`NRF_LOG_ERROR
("A‹m±edØä“ cÜru±edƒËm’ˆadd»s ÕoŞ: '" 
POOL_MARKER
 "',ƒlement: 0x%08X)",

299 
	`POOL_ID
(
p_poŞ
), 
p_–em’t
);

300 
	`APP_ERROR_CHECK_BOOL
(
çl£
);

304 * 
p_block
 = 
p_–em’t
;

307 
	`CRITICAL_REGION_ENTER
();

309 #ià
NRF_BALLOC_CONFIG_DEBUG_ENABLED


311 ià(
	`NRF_BALLOC_DEBUG_BASIC_CHECKS_GET
(
p_poŞ
->
debug_æags
))

314 ià(
p_poŞ
->
p_cb
->
p_¡ack_poš‹r
 >ğp_poŞ->
p_¡ack_lim™
)

316 
	`NRF_LOG_ERROR
("A‰em±edØä“‡À–em’ˆwhthpoŞ i fuÎ (poŞ: '" 
POOL_MARKER
 "',ƒlement: 0x%08X)",

317 
	`POOL_ID
(
p_poŞ
), 
p_–em’t
);

318 
	`APP_ERROR_CHECK_BOOL
(
çl£
);

322 ià(
	`NRF_BALLOC_DEBUG_DOUBLE_FREE_CHECK_GET
(
p_poŞ
->
debug_æags
))

325 
ušt8_t
 * 
p_idx
 = 
p_poŞ
->
p_¡ack_ba£
;…_idx <…_poŞ->
p_cb
->
p_¡ack_poš‹r
;…_idx++)

327 ià(
	`Äf_b®loc_idx2block
(
p_poŞ
, *
p_idx
è=ğ
p_block
)

329 
	`NRF_LOG_ERROR
("A‰em±edØdoubË-ä“‡À–em’ˆÕoŞ: '" 
POOL_MARKER
 "',ƒlement: 0x%08X)",

330 
	`POOL_ID
(
p_poŞ
), 
p_–em’t
);

331 
	`APP_ERROR_CHECK_BOOL
(
çl£
);

338 *(
p_poŞ
->
p_cb
->
p_¡ack_poš‹r
)++ = 
	`Äf_b®loc_block2idx
Õ_poŞ, 
p_block
);

340 
	`CRITICAL_REGION_EXIT
();

341 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\bsp\bsp.c

40 
	~"b¥.h
"

41 
	~<¡ddef.h
>

42 
	~<¡dio.h
>

43 
	~"nÜdic_commÚ.h
"

44 
	~"Äf.h
"

45 
	~"Äf_gpio.h
"

46 
	~"Äf_”rÜ.h
"

47 
	~"b¥_cÚfig.h
"

48 
	~"bßrds.h
"

50 #iâdeà
BSP_SIMPLE


51 
	~"­p_tim”.h
"

52 
	~"­p_bu‰Ú.h
"

55 #ià
LEDS_NUMBER
 > 0 && !(
defšed
 
BSP_SIMPLE
)

56 
b¥_šdiÿtiÚ_t
 
	gm_¡abË_¡©e
 = 
BSP_INDICATE_IDLE
;

57 
boŞ
 
	gm_Ëds_ş—r
 = 
çl£
;

58 
ušt32_t
 
	gm_šdiÿtiÚ_ty³
 = 0;

59 
boŞ
 
	gm_®”t_Ú
 = 
çl£
;

60 
APP_TIMER_DEF
(
m_Ëds_tim”_id
);

61 
APP_TIMER_DEF
(
m_®”t_tim”_id
);

64 #ià
BUTTONS_NUMBER
 > 0

65 #iâdeà
BSP_SIMPLE


66 
b¥_ev’t_ÿÎback_t
 
	gm_»gi¡”ed_ÿÎback
 = 
NULL
;

67 
b¥_bu‰Ú_ev’t_cfg_t
 
	gm_ev’ts_li¡
[
BUTTONS_NUMBER
] = {{
BSP_EVENT_NOTHING
, BSP_EVENT_NOTHING}};

68 
APP_TIMER_DEF
(
m_bu‰Ú_tim”_id
);

69 
b¥_bu‰Ú_ev’t_hªdËr
(
ušt8_t
 
pš_no
, ušt8_ˆ
bu‰Ú_aùiÚ
);

72 #iâdeà
BSP_SIMPLE


73 cÚ¡ 
­p_bu‰Ú_cfg_t
 
	g­p_bu‰Ús
[
BUTTONS_NUMBER
] =

75 #ifdeà
BSP_BUTTON_0


76 {
BSP_BUTTON_0
, 
çl£
, 
BUTTON_PULL
, 
b¥_bu‰Ú_ev’t_hªdËr
},

79 #ifdeà
BSP_BUTTON_1


80 {
BSP_BUTTON_1
, 
çl£
, 
BUTTON_PULL
, 
b¥_bu‰Ú_ev’t_hªdËr
},

83 #ifdeà
BSP_BUTTON_2


84 {
BSP_BUTTON_2
, 
çl£
, 
BUTTON_PULL
, 
b¥_bu‰Ú_ev’t_hªdËr
},

87 #ifdeà
BSP_BUTTON_3


88 {
BSP_BUTTON_3
, 
çl£
, 
BUTTON_PULL
, 
b¥_bu‰Ú_ev’t_hªdËr
},

91 #ifdeà
BSP_BUTTON_4


92 {
BSP_BUTTON_4
, 
çl£
, 
BUTTON_PULL
, 
b¥_bu‰Ú_ev’t_hªdËr
},

95 #ifdeà
BSP_BUTTON_5


96 {
BSP_BUTTON_5
, 
çl£
, 
BUTTON_PULL
, 
b¥_bu‰Ú_ev’t_hªdËr
},

99 #ifdeà
BSP_BUTTON_6


100 {
BSP_BUTTON_6
, 
çl£
, 
BUTTON_PULL
, 
b¥_bu‰Ú_ev’t_hªdËr
},

103 #ifdeà
BSP_BUTTON_7


104 {
BSP_BUTTON_7
, 
çl£
, 
BUTTON_PULL
, 
b¥_bu‰Ú_ev’t_hªdËr
},

111 #ià(
BUTTONS_NUMBER
 > 0)

112 
boŞ
 
	$b¥_bu‰Ú_is_´es£d
(
ušt32_t
 
bu‰Ú
)

114  
	`b¥_bßrd_bu‰Ú_¡©e_g‘
(
bu‰Ú
);

115 
	}
}

118 #ià(
BUTTONS_NUMBER
 > 0è&& !(
defšed
 
BSP_SIMPLE
)

124 
	$b¥_bu‰Ú_ev’t_hªdËr
(
ušt8_t
 
pš_no
, ušt8_ˆ
bu‰Ú_aùiÚ
)

126 
b¥_ev’t_t
 
ev’t
 = 
BSP_EVENT_NOTHING
;

127 
ušt32_t
 
bu‰Ú
 = 0;

128 
ušt32_t
 
”r_code
;

129 
ušt8_t
 
cu¼’t_lÚg_push_pš_no
;

130 
b¥_ev’t_t
 
»Ëa£_ev’t_©_push
[
BUTTONS_NUMBER
];

132 
bu‰Ú
 = 
	`b¥_bßrd_pš_to_bu‰Ú_idx
(
pš_no
);

134 ià(
bu‰Ú
 < 
BUTTONS_NUMBER
)

136 
bu‰Ú_aùiÚ
)

138 
APP_BUTTON_PUSH
:

139 
ev’t
 = 
m_ev’ts_li¡
[
bu‰Ú
].
push_ev’t
;

140 ià(
m_ev’ts_li¡
[
bu‰Ú
].
lÚg_push_ev’t
 !ğ
BSP_EVENT_NOTHING
)

142 
”r_code
 = 
	`­p_tim”_¡¬t
(
m_bu‰Ú_tim”_id
, 
	`APP_TIMER_TICKS
(
BSP_LONG_PUSH_TIMEOUT_MS
), (*)&
cu¼’t_lÚg_push_pš_no
);

143 ià(
”r_code
 =ğ
NRF_SUCCESS
)

145 
cu¼’t_lÚg_push_pš_no
 = 
pš_no
;

148 
»Ëa£_ev’t_©_push
[
bu‰Ú
] = 
m_ev’ts_li¡
[bu‰Ú].
»Ëa£_ev’t
;

150 
APP_BUTTON_RELEASE
:

151 ()
	`­p_tim”_¡İ
(
m_bu‰Ú_tim”_id
);

152 ià(
»Ëa£_ev’t_©_push
[
bu‰Ú
] =ğ
m_ev’ts_li¡
[bu‰Ú].
»Ëa£_ev’t
)

154 
ev’t
 = 
m_ev’ts_li¡
[
bu‰Ú
].
»Ëa£_ev’t
;

157 
BSP_BUTTON_ACTION_LONG_PUSH
:

158 
ev’t
 = 
m_ev’ts_li¡
[
bu‰Ú
].
lÚg_push_ev’t
;

162 ià((
ev’t
 !ğ
BSP_EVENT_NOTHING
è&& (
m_»gi¡”ed_ÿÎback
 !ğ
NULL
))

164 
	`m_»gi¡”ed_ÿÎback
(
ev’t
);

166 
	}
}

172 
	$bu‰Ú_tim”_hªdËr
(* 
p_cÚ‹xt
)

174 
	`b¥_bu‰Ú_ev’t_hªdËr
(*(
ušt8_t
 *)
p_cÚ‹xt
, 
BSP_BUTTON_ACTION_LONG_PUSH
);

175 
	}
}

181 #ià
LEDS_NUMBER
 > 0 && !(
defšed
 
BSP_SIMPLE
)

182 
	$Ëds_off
()

184 ià(
m_®”t_Ú
)

186 
ušt32_t
 
i
;

187 
i
 = 0; i < 
LEDS_NUMBER
; i++)

189 ià(
i
 !ğ
BSP_LED_ALERT
)

191 
	`b¥_bßrd_Ëd_off
(
i
);

197 
	`b¥_bßrd_Ëds_off
();

199 
	}
}

205 
ušt32_t
 
	$b¥_Ëd_šdiÿtiÚ
(
b¥_šdiÿtiÚ_t
 
šdiÿ‹
)

207 
ušt32_t
 
”r_code
 = 
NRF_SUCCESS
;

208 
ušt32_t
 
Ãxt_d–ay
 = 0;

210 ià(
m_Ëds_ş—r
)

212 
m_Ëds_ş—r
 = 
çl£
;

213 
	`Ëds_off
();

216 
šdiÿ‹
)

218 
BSP_INDICATE_IDLE
:

219 
	`Ëds_off
();

220 
m_¡abË_¡©e
 = 
šdiÿ‹
;

223 
BSP_INDICATE_SCANNING
:

224 
BSP_INDICATE_ADVERTISING
:

226 ià(
	`b¥_bßrd_Ëd_¡©e_g‘
(
BSP_LED_INDICATE_INDICATE_ADVERTISING
))

228 
	`b¥_bßrd_Ëd_off
(
BSP_LED_INDICATE_INDICATE_ADVERTISING
);

229 
Ãxt_d–ay
 = 
šdiÿ‹
 ==

230 
BSP_INDICATE_ADVERTISING
 ? 
ADVERTISING_LED_OFF_INTERVAL
 :

231 
ADVERTISING_SLOW_LED_OFF_INTERVAL
;

235 
	`b¥_bßrd_Ëd_Ú
(
BSP_LED_INDICATE_INDICATE_ADVERTISING
);

236 
Ãxt_d–ay
 = 
šdiÿ‹
 ==

237 
BSP_INDICATE_ADVERTISING
 ? 
ADVERTISING_LED_ON_INTERVAL
 :

238 
ADVERTISING_SLOW_LED_ON_INTERVAL
;

241 
m_¡abË_¡©e
 = 
šdiÿ‹
;

242 
”r_code
 = 
	`­p_tim”_¡¬t
(
m_Ëds_tim”_id
, 
	`APP_TIMER_TICKS
(
Ãxt_d–ay
), 
NULL
);

245 
BSP_INDICATE_ADVERTISING_WHITELIST
:

247 ià(
	`b¥_bßrd_Ëd_¡©e_g‘
(
BSP_LED_INDICATE_ADVERTISING_WHITELIST
))

249 
	`b¥_bßrd_Ëd_off
(
BSP_LED_INDICATE_ADVERTISING_WHITELIST
);

250 
Ãxt_d–ay
 = 
šdiÿ‹
 ==

251 
BSP_INDICATE_ADVERTISING_WHITELIST
 ?

252 
ADVERTISING_WHITELIST_LED_OFF_INTERVAL
 :

253 
ADVERTISING_SLOW_LED_OFF_INTERVAL
;

257 
	`b¥_bßrd_Ëd_Ú
(
BSP_LED_INDICATE_ADVERTISING_WHITELIST
);

258 
Ãxt_d–ay
 = 
šdiÿ‹
 ==

259 
BSP_INDICATE_ADVERTISING_WHITELIST
 ?

260 
ADVERTISING_WHITELIST_LED_ON_INTERVAL
 :

261 
ADVERTISING_SLOW_LED_ON_INTERVAL
;

263 
m_¡abË_¡©e
 = 
šdiÿ‹
;

264 
”r_code
 = 
	`­p_tim”_¡¬t
(
m_Ëds_tim”_id
, 
	`APP_TIMER_TICKS
(
Ãxt_d–ay
), 
NULL
);

267 
BSP_INDICATE_ADVERTISING_SLOW
:

269 ià(
	`b¥_bßrd_Ëd_¡©e_g‘
(
BSP_LED_INDICATE_ADVERTISING_SLOW
))

271 
	`b¥_bßrd_Ëd_off
(
BSP_LED_INDICATE_ADVERTISING_SLOW
);

272 
Ãxt_d–ay
 = 
šdiÿ‹
 ==

273 
BSP_INDICATE_ADVERTISING_SLOW
 ? 
ADVERTISING_SLOW_LED_OFF_INTERVAL
 :

274 
ADVERTISING_SLOW_LED_OFF_INTERVAL
;

278 
	`b¥_bßrd_Ëd_Ú
(
BSP_LED_INDICATE_ADVERTISING_SLOW
);

279 
Ãxt_d–ay
 = 
šdiÿ‹
 ==

280 
BSP_INDICATE_ADVERTISING_SLOW
 ? 
ADVERTISING_SLOW_LED_ON_INTERVAL
 :

281 
ADVERTISING_SLOW_LED_ON_INTERVAL
;

283 
m_¡abË_¡©e
 = 
šdiÿ‹
;

284 
”r_code
 = 
	`­p_tim”_¡¬t
(
m_Ëds_tim”_id
, 
	`APP_TIMER_TICKS
(
Ãxt_d–ay
), 
NULL
);

287 
BSP_INDICATE_ADVERTISING_DIRECTED
:

289 ià(
	`b¥_bßrd_Ëd_¡©e_g‘
(
BSP_LED_INDICATE_ADVERTISING_DIRECTED
))

291 
	`b¥_bßrd_Ëd_off
(
BSP_LED_INDICATE_ADVERTISING_DIRECTED
);

292 
Ãxt_d–ay
 = 
šdiÿ‹
 ==

293 
BSP_INDICATE_ADVERTISING_DIRECTED
 ?

294 
ADVERTISING_DIRECTED_LED_OFF_INTERVAL
 :

295 
ADVERTISING_SLOW_LED_OFF_INTERVAL
;

299 
	`b¥_bßrd_Ëd_Ú
(
BSP_LED_INDICATE_ADVERTISING_DIRECTED
);

300 
Ãxt_d–ay
 = 
šdiÿ‹
 ==

301 
BSP_INDICATE_ADVERTISING_DIRECTED
 ?

302 
ADVERTISING_DIRECTED_LED_ON_INTERVAL
 :

303 
ADVERTISING_SLOW_LED_ON_INTERVAL
;

305 
m_¡abË_¡©e
 = 
šdiÿ‹
;

306 
”r_code
 = 
	`­p_tim”_¡¬t
(
m_Ëds_tim”_id
, 
	`APP_TIMER_TICKS
(
Ãxt_d–ay
), 
NULL
);

309 
BSP_INDICATE_BONDING
:

311 
	`b¥_bßrd_Ëd_šv”t
(
BSP_LED_INDICATE_BONDING
);

313 
m_¡abË_¡©e
 = 
šdiÿ‹
;

314 
”r_code
 =

315 
	`­p_tim”_¡¬t
(
m_Ëds_tim”_id
, 
	`APP_TIMER_TICKS
(
BONDING_INTERVAL
), 
NULL
);

318 
BSP_INDICATE_CONNECTED
:

319 
	`b¥_bßrd_Ëd_Ú
(
BSP_LED_INDICATE_CONNECTED
);

320 
m_¡abË_¡©e
 = 
šdiÿ‹
;

323 
BSP_INDICATE_SENT_OK
:

325 
m_Ëds_ş—r
 = 
Œue
;

326 
	`b¥_bßrd_Ëd_šv”t
(
BSP_LED_INDICATE_SENT_OK
);

327 
”r_code
 = 
	`­p_tim”_¡¬t
(
m_Ëds_tim”_id
, 
	`APP_TIMER_TICKS
(
SENT_OK_INTERVAL
), 
NULL
);

330 
BSP_INDICATE_SEND_ERROR
:

332 
m_Ëds_ş—r
 = 
Œue
;

333 
	`b¥_bßrd_Ëd_šv”t
(
BSP_LED_INDICATE_SEND_ERROR
);

334 
”r_code
 = 
	`­p_tim”_¡¬t
(
m_Ëds_tim”_id
, 
	`APP_TIMER_TICKS
(
SEND_ERROR_INTERVAL
), 
NULL
);

337 
BSP_INDICATE_RCV_OK
:

339 
m_Ëds_ş—r
 = 
Œue
;

340 
	`b¥_bßrd_Ëd_šv”t
(
BSP_LED_INDICATE_RCV_OK
);

341 
”r_code
 = 
	`­p_tim”_¡¬t
(
m_Ëds_tim”_id
, 
	`APP_TIMER_TICKS
(
RCV_OK_INTERVAL
), 
NULL
);

344 
BSP_INDICATE_RCV_ERROR
:

346 
m_Ëds_ş—r
 = 
Œue
;

347 
	`b¥_bßrd_Ëd_šv”t
(
BSP_LED_INDICATE_RCV_ERROR
);

348 
”r_code
 = 
	`­p_tim”_¡¬t
(
m_Ëds_tim”_id
, 
	`APP_TIMER_TICKS
(
RCV_ERROR_INTERVAL
), 
NULL
);

351 
BSP_INDICATE_FATAL_ERROR
:

353 
	`b¥_bßrd_Ëds_Ú
();

354 
m_¡abË_¡©e
 = 
šdiÿ‹
;

357 
BSP_INDICATE_ALERT_0
:

358 
BSP_INDICATE_ALERT_1
:

359 
BSP_INDICATE_ALERT_2
:

360 
BSP_INDICATE_ALERT_3
:

361 
BSP_INDICATE_ALERT_OFF
:

362 
”r_code
 = 
	`­p_tim”_¡İ
(
m_®”t_tim”_id
);

363 
Ãxt_d–ay
 = (
ušt32_t
)
BSP_INDICATE_ALERT_OFF
 - (ušt32_t)
šdiÿ‹
;

366 ià(
Ãxt_d–ay
 && (
”r_code
 =ğ
NRF_SUCCESS
))

368 ià(
Ãxt_d–ay
 > 1)

370 
”r_code
 = 
	`­p_tim”_¡¬t
(
m_®”t_tim”_id
,

371 
	`APP_TIMER_TICKS
(((
ušt16_t
)
Ãxt_d–ay
 * 
ALERT_INTERVAL
)),

372 
NULL
);

374 
	`b¥_bßrd_Ëd_Ú
(
BSP_LED_ALERT
);

375 
m_®”t_Ú
 = 
Œue
;

379 
	`b¥_bßrd_Ëd_off
(
BSP_LED_ALERT
);

380 
m_®”t_Ú
 = 
çl£
;

385 
BSP_INDICATE_USER_STATE_OFF
:

386 
	`Ëds_off
();

387 
m_¡abË_¡©e
 = 
šdiÿ‹
;

390 
BSP_INDICATE_USER_STATE_0
:

391 
	`Ëds_off
();

392 
	`b¥_bßrd_Ëd_Ú
(
BSP_LED_INDICATE_USER_LED1
);

393 
m_¡abË_¡©e
 = 
šdiÿ‹
;

396 
BSP_INDICATE_USER_STATE_1
:

397 
	`Ëds_off
();

398 
	`b¥_bßrd_Ëd_Ú
(
BSP_LED_INDICATE_USER_LED2
);

399 
m_¡abË_¡©e
 = 
šdiÿ‹
;

402 
BSP_INDICATE_USER_STATE_2
:

403 
	`Ëds_off
();

404 
	`b¥_bßrd_Ëd_Ú
(
BSP_LED_INDICATE_USER_LED1
);

405 
	`b¥_bßrd_Ëd_Ú
(
BSP_LED_INDICATE_USER_LED2
);

406 
m_¡abË_¡©e
 = 
šdiÿ‹
;

409 
BSP_INDICATE_USER_STATE_3
:

411 
BSP_INDICATE_USER_STATE_ON
:

412 
	`b¥_bßrd_Ëds_Ú
();

413 
m_¡abË_¡©e
 = 
šdiÿ‹
;

420  
”r_code
;

421 
	}
}

431 
	$Ëds_tim”_hªdËr
(* 
p_cÚ‹xt
)

433 
	`UNUSED_PARAMETER
(
p_cÚ‹xt
);

435 ià(
m_šdiÿtiÚ_ty³
 & 
BSP_INIT_LED
)

437 
	`UNUSED_VARIABLE
(
	`b¥_Ëd_šdiÿtiÚ
(
m_¡abË_¡©e
));

439 
	}
}

446 
	$®”t_tim”_hªdËr
(* 
p_cÚ‹xt
)

448 
	`UNUSED_PARAMETER
(
p_cÚ‹xt
);

449 
	`b¥_bßrd_Ëd_šv”t
(
BSP_LED_ALERT
);

450 
	}
}

456 
ušt32_t
 
	$b¥_šdiÿtiÚ_£t
(
b¥_šdiÿtiÚ_t
 
šdiÿ‹
)

458 
ušt32_t
 
”r_code
 = 
NRF_SUCCESS
;

460 #ià
LEDS_NUMBER
 > 0 && !(
defšed
 
BSP_SIMPLE
)

462 ià(
m_šdiÿtiÚ_ty³
 & 
BSP_INIT_LED
)

464 
”r_code
 = 
	`b¥_Ëd_šdiÿtiÚ
(
šdiÿ‹
);

468  
”r_code
;

469 
	}
}

472 
ušt32_t
 
	$b¥_š™
(
ušt32_t
 
ty³
, 
b¥_ev’t_ÿÎback_t
 
ÿÎback
)

474 
ušt32_t
 
”r_code
 = 
NRF_SUCCESS
;

476 #ià
LEDS_NUMBER
 > 0 && !(
defšed
 
BSP_SIMPLE
)

477 
m_šdiÿtiÚ_ty³
 = 
ty³
;

480 #ià(
BUTTONS_NUMBER
 > 0è&& !(
defšed
 
BSP_SIMPLE
)

481 
m_»gi¡”ed_ÿÎback
 = 
ÿÎback
;

484 ià(
ty³
 & 
BSP_INIT_BUTTONS
)

486 
ušt32_t
 
num
;

488 
num
 = 0; (Òum < 
BUTTONS_NUMBER
è&& (
”r_code
 =ğ
NRF_SUCCESS
));‚um++)

490 
”r_code
 = 
	`b¥_ev’t_to_bu‰Ú_aùiÚ_assign
(
num
, 
BSP_BUTTON_ACTION_PUSH
, 
BSP_EVENT_DEFAULT
);

493 ià(
”r_code
 =ğ
NRF_SUCCESS
)

495 
”r_code
 = 
	`­p_bu‰Ú_š™
((
­p_bu‰Ú_cfg_t
 *)
­p_bu‰Ús
,

496 
BUTTONS_NUMBER
,

497 
	`APP_TIMER_TICKS
(50));

500 ià(
”r_code
 =ğ
NRF_SUCCESS
)

502 
”r_code
 = 
	`­p_bu‰Ú_’abË
();

505 ià(
”r_code
 =ğ
NRF_SUCCESS
)

507 
”r_code
 = 
	`­p_tim”_ü—‹
(&
m_bu‰Ú_tim”_id
,

508 
APP_TIMER_MODE_SINGLE_SHOT
,

509 
bu‰Ú_tim”_hªdËr
);

512 #–ià(
BUTTONS_NUMBER
 > 0è&& (
defšed
 
BSP_SIMPLE
)

514 ià(
ty³
 & 
BSP_INIT_BUTTONS
)

516 
	`b¥_bßrd_bu‰Ús_š™
();

520 #ià
LEDS_NUMBER
 > 0 && !(
defšed
 
BSP_SIMPLE
)

522 ià(
ty³
 & 
BSP_INIT_LED
)

524 
	`b¥_bßrd_Ëds_š™
();

528 ià(
”r_code
 =ğ
NRF_SUCCESS
)

530 
”r_code
 =

531 
	`­p_tim”_ü—‹
(&
m_Ëds_tim”_id
, 
APP_TIMER_MODE_SINGLE_SHOT
, 
Ëds_tim”_hªdËr
);

534 ià(
”r_code
 =ğ
NRF_SUCCESS
)

536 
”r_code
 =

537 
	`­p_tim”_ü—‹
(&
m_®”t_tim”_id
, 
APP_TIMER_MODE_REPEATED
, 
®”t_tim”_hªdËr
);

541  
”r_code
;

542 
	}
}

545 #iâdeà
BSP_SIMPLE


548 
ušt32_t
 
	$b¥_ev’t_to_bu‰Ú_aùiÚ_assign
(
ušt32_t
 
bu‰Ú
, 
b¥_bu‰Ú_aùiÚ_t
 
aùiÚ
, 
b¥_ev’t_t
 
ev’t
)

550 
ušt32_t
 
”r_code
 = 
NRF_SUCCESS
;

552 #ià
BUTTONS_NUMBER
 > 0

553 ià(
bu‰Ú
 < 
BUTTONS_NUMBER
)

555 ià(
ev’t
 =ğ
BSP_EVENT_DEFAULT
)

558 
ev’t
 = (
aùiÚ
 =ğ
BSP_BUTTON_ACTION_PUSH
è? (
b¥_ev’t_t
)(
BSP_EVENT_KEY_0
 + 
bu‰Ú
è: 
BSP_EVENT_NOTHING
;

560 
aùiÚ
)

562 
BSP_BUTTON_ACTION_PUSH
:

563 
m_ev’ts_li¡
[
bu‰Ú
].
push_ev’t
 = 
ev’t
;

565 
BSP_BUTTON_ACTION_LONG_PUSH
:

566 
m_ev’ts_li¡
[
bu‰Ú
].
lÚg_push_ev’t
 = 
ev’t
;

568 
BSP_BUTTON_ACTION_RELEASE
:

569 
m_ev’ts_li¡
[
bu‰Ú
].
»Ëa£_ev’t
 = 
ev’t
;

572 
”r_code
 = 
NRF_ERROR_INVALID_PARAM
;

578 
”r_code
 = 
NRF_ERROR_INVALID_PARAM
;

581 
”r_code
 = 
NRF_ERROR_INVALID_PARAM
;

584  
”r_code
;

585 
	}
}

590 
ušt32_t
 
	$b¥_bu‰Ús_’abË
()

592 #ià(
BUTTONS_NUMBER
 > 0è&& !
	`defšed
(
BSP_SIMPLE
)

593  
	`­p_bu‰Ú_’abË
();

595  
NRF_ERROR_NOT_SUPPORTED
;

597 
	}
}

599 
ušt32_t
 
	$b¥_bu‰Ús_di§bË
()

601 #ià(
BUTTONS_NUMBER
 > 0è&& !
	`defšed
(
BSP_SIMPLE
)

602  
	`­p_bu‰Ú_di§bË
();

604  
NRF_ERROR_NOT_SUPPORTED
;

606 
	}
}

608 
ušt32_t
 
	$b¥_wakeup_bu‰Ú_’abË
(
ušt32_t
 
bu‰Ú_idx
)

610 #ià(
BUTTONS_NUMBER
 > 0è&& !
	`defšed
(
BSP_SIMPLE
)

611 
	`Äf_gpio_cfg_£n£_£t
(
	`b¥_bßrd_bu‰Ú_idx_to_pš
(
bu‰Ú_idx
),

612 
BUTTONS_ACTIVE_STATE
 ? 
NRF_GPIO_PIN_SENSE_HIGH
 :
NRF_GPIO_PIN_SENSE_LOW
);

613  
NRF_SUCCESS
;

615 
	`UNUSED_PARAMETER
(
bu‰Ú_idx
);

616  
NRF_ERROR_NOT_SUPPORTED
;

618 
	}
}

620 
ušt32_t
 
	$b¥_wakeup_bu‰Ú_di§bË
(
ušt32_t
 
bu‰Ú_idx
)

622 #ià(
BUTTONS_NUMBER
 > 0è&& !
	`defšed
(
BSP_SIMPLE
)

623 
	`Äf_gpio_cfg_£n£_£t
(
	`b¥_bßrd_bu‰Ú_idx_to_pš
(
bu‰Ú_idx
),

624 
NRF_GPIO_PIN_NOSENSE
);

625  
NRF_SUCCESS
;

627 
	`UNUSED_PARAMETER
(
bu‰Ú_idx
);

628  
NRF_ERROR_NOT_SUPPORTED
;

630 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\bsp\bsp_btn_ble.c

40 
	~"b¥_bŠ_bË.h
"

41 
	~"Äf_sdh_bË.h
"

42 
	~"b¥.h
"

44 
	#BTN_ID_WAKEUP
 0

	)

45 
	#BTN_ID_SLEEP
 0

	)

46 
	#BTN_ID_DISCONNECT
 0

	)

47 
	#BTN_ID_WAKEUP_BOND_DELETE
 1

	)

48 
	#BTN_ID_WHITELIST_OFF
 1

	)

50 
	#BTN_ACTION_SLEEP
 
BSP_BUTTON_ACTION_RELEASE


	)

51 
	#BTN_ACTION_DISCONNECT
 
BSP_BUTTON_ACTION_LONG_PUSH


	)

52 
	#BTN_ACTION_WHITELIST_OFF
 
BSP_BUTTON_ACTION_LONG_PUSH


	)

57 
	#RETURN_ON_ERROR_NOT_INVALID_PARAM
(
”r_code
) \

60 ià(((
”r_code
è!ğ
NRF_SUCCESS
è&& (Ó¼_codeè!ğ
NRF_ERROR_INVALID_PARAM
)) \

62  
”r_code
; \

65 0)

	)

71 
	#RETURN_ON_ERROR_NOT_NOT_SUPPORTED
(
”r_code
) \

74 ià(((
”r_code
è!ğ
NRF_SUCCESS
è&& (Ó¼_codeè!ğ
NRF_ERROR_NOT_SUPPORTED
)) \

76  
”r_code
; \

79 0)

	)

85 
	#CALL_HANDLER_ON_ERROR
(
”r_code
) \

88 ià(((
”r_code
è!ğ
NRF_SUCCESS
è&& (
m_”rÜ_hªdËr
 !ğ
NULL
)) \

90 
	`m_”rÜ_hªdËr
(
”r_code
); \

93 0)

	)

96 
b¥_bŠ_bË_”rÜ_hªdËr_t
 
	gm_”rÜ_hªdËr
 = 
NULL
;

97 
ušt32_t
 
	gm_num_cÚÃùiÚs
 = 0;

105 
ušt32_t
 
	$cÚÃùiÚ_bu‰Ús_cÚfigu»
()

107 
ušt32_t
 
”r_code
;

109 
”r_code
 = 
	`b¥_ev’t_to_bu‰Ú_aùiÚ_assign
(
BTN_ID_SLEEP
,

110 
BTN_ACTION_SLEEP
,

111 
BSP_EVENT_DEFAULT
);

112 
	`RETURN_ON_ERROR_NOT_INVALID_PARAM
(
”r_code
);

114 
”r_code
 = 
	`b¥_ev’t_to_bu‰Ú_aùiÚ_assign
(
BTN_ID_WHITELIST_OFF
,

115 
BTN_ACTION_WHITELIST_OFF
,

116 
BSP_EVENT_WHITELIST_OFF
);

117 
	`RETURN_ON_ERROR_NOT_INVALID_PARAM
(
”r_code
);

119 
”r_code
 = 
	`b¥_ev’t_to_bu‰Ú_aùiÚ_assign
(
BTN_ID_DISCONNECT
,

120 
BTN_ACTION_DISCONNECT
,

121 
BSP_EVENT_DISCONNECT
);

122 
	`RETURN_ON_ERROR_NOT_INVALID_PARAM
(
”r_code
);

124  
NRF_SUCCESS
;

125 
	}
}

133 
ušt32_t
 
	$adv”tisšg_bu‰Ús_cÚfigu»
()

135 
ušt32_t
 
”r_code
;

137 
”r_code
 = 
	`b¥_ev’t_to_bu‰Ú_aùiÚ_assign
(
BTN_ID_DISCONNECT
,

138 
BTN_ACTION_DISCONNECT
,

139 
BSP_EVENT_DEFAULT
);

140 
	`RETURN_ON_ERROR_NOT_INVALID_PARAM
(
”r_code
);

142 
”r_code
 = 
	`b¥_ev’t_to_bu‰Ú_aùiÚ_assign
(
BTN_ID_WHITELIST_OFF
,

143 
BTN_ACTION_WHITELIST_OFF
,

144 
BSP_EVENT_WHITELIST_OFF
);

145 
	`RETURN_ON_ERROR_NOT_INVALID_PARAM
(
”r_code
);

147 
”r_code
 = 
	`b¥_ev’t_to_bu‰Ú_aùiÚ_assign
(
BTN_ID_SLEEP
,

148 
BTN_ACTION_SLEEP
,

149 
BSP_EVENT_SLEEP
);

150 
	`RETURN_ON_ERROR_NOT_INVALID_PARAM
(
”r_code
);

152  
NRF_SUCCESS
;

153 
	}
}

164 
	$¡¬tup_ev’t_exŒaù
(
b¥_ev’t_t
 * 
p_¡¬tup_ev’t
)

167 ià(
	`b¥_bu‰Ú_is_´es£d
(
BTN_ID_WAKEUP_BOND_DELETE
))

169 *
p_¡¬tup_ev’t
 = 
BSP_EVENT_CLEAR_BONDING_DATA
;

171 ià(
	`b¥_bu‰Ú_is_´es£d
(
BTN_ID_WAKEUP
))

173 *
p_¡¬tup_ev’t
 = 
BSP_EVENT_WAKEUP
;

177 *
p_¡¬tup_ev’t
 = 
BSP_EVENT_NOTHING
;

179 
	}
}

182 
ušt32_t
 
	$b¥_bŠ_bË_¦“p_mode_´•¬e
()

184 
ušt32_t
 
”r_code
 = 
	`b¥_wakeup_bu‰Ú_’abË
(
BTN_ID_WAKEUP
);

185 
	`RETURN_ON_ERROR_NOT_NOT_SUPPORTED
(
”r_code
);

187 
”r_code
 = 
	`b¥_wakeup_bu‰Ú_’abË
(
BTN_ID_WAKEUP_BOND_DELETE
);

188 
	`RETURN_ON_ERROR_NOT_NOT_SUPPORTED
(
”r_code
);

190  
NRF_SUCCESS
;

191 
	}
}

200 
	$bË_evt_hªdËr
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
, * 
p_cÚ‹xt
)

202 
ušt32_t
 
”r_code
;

204 
p_bË_evt
->
h—d”
.
evt_id
)

206 
BLE_GAP_EVT_CONNECTED
:

207 ià(
m_num_cÚÃùiÚs
 == 0)

209 
”r_code
 = 
	`cÚÃùiÚ_bu‰Ús_cÚfigu»
();

210 
	`CALL_HANDLER_ON_ERROR
(
”r_code
);

213 
m_num_cÚÃùiÚs
++;

216 
BLE_GAP_EVT_DISCONNECTED
:

217 
m_num_cÚÃùiÚs
--;

219 ià(
m_num_cÚÃùiÚs
 == 0)

221 
”r_code
 = 
	`adv”tisšg_bu‰Ús_cÚfigu»
();

222 
	`CALL_HANDLER_ON_ERROR
(
”r_code
);

229 
	}
}

231 
NRF_SDH_BLE_OBSERVER
(
m_bË_ob£rv”
, 
BSP_BTN_BLE_OBSERVER_PRIO
, 
bË_evt_hªdËr
, 
NULL
);

234 
ušt32_t
 
	$b¥_bŠ_bË_š™
(
b¥_bŠ_bË_”rÜ_hªdËr_t
 
”rÜ_hªdËr
, 
b¥_ev’t_t
 * 
p_¡¬tup_b¥_evt
)

236 
ušt32_t
 
”r_code
 = 
NRF_SUCCESS
;

238 
m_”rÜ_hªdËr
 = 
”rÜ_hªdËr
;

240 ià(
p_¡¬tup_b¥_evt
 !ğ
NULL
)

242 
	`¡¬tup_ev’t_exŒaù
(
p_¡¬tup_b¥_evt
);

245 ià(
m_num_cÚÃùiÚs
 == 0)

247 
”r_code
 = 
	`adv”tisšg_bu‰Ús_cÚfigu»
();

250  
”r_code
;

251 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\bsp\bsp_nfc.c

40 
	~"b¥_nfc.h
"

41 
	~"b¥.h
"

42 
	~"Äf.h
"

43 
	~"­p_ut_¶©fÜm.h
"

45 #iâdeà
BSP_SIMPLE


46 
	#BTN_ACTION_SLEEP
 
BSP_BUTTON_ACTION_RELEASE


	)

48 
»t_code_t
 
	$b¥_nfc_bŠ_š™
(
ušt32_t
 
¦“p_bu‰Ú
)

50 
ušt32_t
 
”r_code
 = 
	`b¥_ev’t_to_bu‰Ú_aùiÚ_assign
(
¦“p_bu‰Ú
,

51 
BTN_ACTION_SLEEP
,

52 
BSP_EVENT_SLEEP
);

53  
”r_code
;

54 
	}
}

56 
»t_code_t
 
	$b¥_nfc_bŠ_deš™
(
ušt32_t
 
¦“p_bu‰Ú
)

58 
ušt32_t
 
”r_code
 = 
	`b¥_ev’t_to_bu‰Ú_aùiÚ_assign
(
¦“p_bu‰Ú
,

59 
BTN_ACTION_SLEEP
,

60 
BSP_EVENT_DEFAULT
);

61  
”r_code
;

62 
	}
}

64 
»t_code_t
 
	$b¥_nfc_¦“p_mode_´•¬e
()

66 #ià
	`defšed
(
NFCT_PRESENT
)

68 
	`CRITICAL_REGION_ENTER
();

69 #ifdeà
NRF52832_XXAA


70 ià((*(
ušt32_t
 *)0x40005410 & 0x07) == 0)

72 ià((
NRF_NFCT
->
NFCTAGSTATE
 & 
NFCT_NFCTAGSTATE_NFCTAGSTATE_Msk
)

73 =ğ
NFCT_NFCTAGSTATE_NFCTAGSTATE_Di§bËd
)

76 
NRF_NFCT
->
TASKS_SENSE
 = 1;

78 
	`CRITICAL_REGION_EXIT
();

79  
NRF_SUCCESS
;

81  
NRF_ERROR_NOT_SUPPORTED
;

83 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\button\app_button.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
BUTTON
)

42 
	~"­p_bu‰Ú.h
"

43 
	~"­p_tim”.h
"

44 
	~"­p_”rÜ.h
"

45 
	~"Äf_drv_gpiÙe.h
"

46 
	~"Äf_as£¹.h
"

49 
­p_bu‰Ú_cfg_t
 cÚ¡ * 
	gmp_bu‰Ús
 = 
NULL
;

50 
ušt8_t
 
	gm_bu‰Ú_couÁ
;

51 
ušt32_t
 
	gm_d‘eùiÚ_d–ay
;

52 
APP_TIMER_DEF
(
m_d‘eùiÚ_d–ay_tim”_id
);

55 
ušt32_t
 
	gm_pš_¡©e
;

56 
ušt32_t
 
	gm_pš_Œªs™iÚ
;

70 
	$d‘eùiÚ_d–ay_timeout_hªdËr
(* 
p_cÚ‹xt
)

72 
ušt8_t
 
i
;

75 
i
 = 0; i < 
m_bu‰Ú_couÁ
; i++)

77 
­p_bu‰Ú_cfg_t
 cÚ¡ * 
p_bŠ
 = &
mp_bu‰Ús
[
i
];

78 
ušt32_t
 
bŠ_mask
 = 1 << 
p_bŠ
->
pš_no
;

79 ià(
bŠ_mask
 & 
m_pš_Œªs™iÚ
)

81 
m_pš_Œªs™iÚ
 &ğ~
bŠ_mask
;

82 
boŞ
 
pš_is_£t
 = 
	`Äf_drv_gpiÙe_š_is_£t
(
p_bŠ
->
pš_no
);

83 ià((
m_pš_¡©e
 & (1 << 
p_bŠ
->
pš_no
)è=ğ(
pš_is_£t
 <<…_btn->pin_no))

85 
ušt32_t
 
Œªs™iÚ
 = !(
pš_is_£t
 ^ (
p_bŠ
->
aùive_¡©e
 =ğ
APP_BUTTON_ACTIVE_HIGH
));

87 ià(
p_bŠ
->
bu‰Ú_hªdËr
)

89 
p_bŠ
->
	`bu‰Ú_hªdËr
Õ_bŠ->
pš_no
, 
Œªs™iÚ
);

94 
	}
}

96 
	$gpiÙe_ev’t_hªdËr
(
Äf_drv_gpiÙe_pš_t
 
pš
, 
Äf_gpiÙe_pŞ¬™y_t
 
aùiÚ
)

98 
ušt32_t
 
”r_code
;

99 
ušt32_t
 
pš_mask
 = 1 << 
pš
;

105 
”r_code
 = 
	`­p_tim”_¡İ
(
m_d‘eùiÚ_d–ay_tim”_id
);

106 ià(
”r_code
 !ğ
NRF_SUCCESS
)

113 ià(!(
m_pš_Œªs™iÚ
 & 
pš_mask
))

115 ià(
	`Äf_drv_gpiÙe_š_is_£t
(
pš
))

117 
m_pš_¡©e
 |ğ
pš_mask
;

121 
m_pš_¡©e
 &ğ~(
pš_mask
);

123 
m_pš_Œªs™iÚ
 |ğ(
pš_mask
);

125 
”r_code
 = 
	`­p_tim”_¡¬t
(
m_d‘eùiÚ_d–ay_tim”_id
, 
m_d‘eùiÚ_d–ay
, 
NULL
);

126 ià(
”r_code
 !ğ
NRF_SUCCESS
)

134 
m_pš_Œªs™iÚ
 &ğ~
pš_mask
;

136 
	}
}

138 
ušt32_t
 
	$­p_bu‰Ú_š™
(
­p_bu‰Ú_cfg_t
 cÚ¡ * 
p_bu‰Ús
,

139 
ušt8_t
 
bu‰Ú_couÁ
,

140 
ušt32_t
 
d‘eùiÚ_d–ay
)

142 
ušt32_t
 
”r_code
;

144 ià(
d‘eùiÚ_d–ay
 < 
APP_TIMER_MIN_TIMEOUT_TICKS
)

146  
NRF_ERROR_INVALID_PARAM
;

149 ià(!
	`Äf_drv_gpiÙe_is_š™
())

151 
”r_code
 = 
	`Äf_drv_gpiÙe_š™
();

152 
	`VERIFY_SUCCESS
(
”r_code
);

156 
mp_bu‰Ús
 = 
p_bu‰Ús
;

157 
m_bu‰Ú_couÁ
 = 
bu‰Ú_couÁ
;

158 
m_d‘eùiÚ_d–ay
 = 
d‘eùiÚ_d–ay
;

160 
m_pš_¡©e
 = 0;

161 
m_pš_Œªs™iÚ
 = 0;

163 
bu‰Ú_couÁ
--)

165 
­p_bu‰Ú_cfg_t
 cÚ¡ * 
p_bŠ
 = &
p_bu‰Ús
[
bu‰Ú_couÁ
];

167 
Äf_drv_gpiÙe_š_cÚfig_t
 
cÚfig
 = 
	`GPIOTE_CONFIG_IN_SENSE_TOGGLE
(
çl£
);

168 
cÚfig
.
puÎ
 = 
p_bŠ
->
puÎ_cfg
;

170 
”r_code
 = 
	`Äf_drv_gpiÙe_š_š™
(
p_bŠ
->
pš_no
, &
cÚfig
, 
gpiÙe_ev’t_hªdËr
);

171 
	`VERIFY_SUCCESS
(
”r_code
);

175  
	`­p_tim”_ü—‹
(&
m_d‘eùiÚ_d–ay_tim”_id
,

176 
APP_TIMER_MODE_SINGLE_SHOT
,

177 
d‘eùiÚ_d–ay_timeout_hªdËr
);

178 
	}
}

180 
ušt32_t
 
	$­p_bu‰Ú_’abË
()

182 
	`ASSERT
(
mp_bu‰Ús
);

184 
ušt32_t
 
i
;

185 
i
 = 0; i < 
m_bu‰Ú_couÁ
; i++)

187 
	`Äf_drv_gpiÙe_š_ev’t_’abË
(
mp_bu‰Ús
[
i
].
pš_no
, 
Œue
);

190  
NRF_SUCCESS
;

191 
	}
}

194 
ušt32_t
 
	$­p_bu‰Ú_di§bË
()

196 
	`ASSERT
(
mp_bu‰Ús
);

198 
ušt32_t
 
i
;

199 
i
 = 0; i < 
m_bu‰Ú_couÁ
; i++)

201 
	`Äf_drv_gpiÙe_š_ev’t_di§bË
(
mp_bu‰Ús
[
i
].
pš_no
);

205  
	`­p_tim”_¡İ
(
m_d‘eùiÚ_d–ay_tim”_id
);

206 
	}
}

209 
boŞ
 
	$­p_bu‰Ú_is_pushed
(
ušt8_t
 
bu‰Ú_id
)

211 
	`ASSERT
(
bu‰Ú_id
 <ğ
m_bu‰Ú_couÁ
);

212 
	`ASSERT
(
mp_bu‰Ús
 !ğ
NULL
);

214 
­p_bu‰Ú_cfg_t
 cÚ¡ * 
p_bŠ
 = &
mp_bu‰Ús
[
bu‰Ú_id
];

215 
boŞ
 
is_£t
 = 
	`Äf_drv_gpiÙe_š_is_£t
(
p_bŠ
->
pš_no
);

217  !(
is_£t
 ^ (
p_bŠ
->
aùive_¡©e
 =ğ
APP_BUTTON_ACTIVE_HIGH
));

218 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\crc16\crc16.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
CRC16
)

42 
	~"üc16.h
"

44 
	~<¡dlib.h
>

46 
ušt16_t
 
	$üc16_compu‹
(
ušt8_t
 cÚ¡ * 
p_d©a
, 
ušt32_t
 
size
, 
ušt16_t
 cÚ¡ * 
p_üc
)

48 
ušt16_t
 
üc
 = (
p_üc
 =ğ
NULL
) ? 0xFFFF : *p_crc;

50 
ušt32_t
 
i
 = 0; i < 
size
; i++)

52 
üc
 = (
ušt8_t
)(crc >> 8) | (crc << 8);

53 
üc
 ^ğ
p_d©a
[
i
];

54 
üc
 ^ğ(
ušt8_t
)(crc & 0xFF) >> 4;

55 
üc
 ^= (crc << 8) << 4;

56 
üc
 ^= ((crc & 0xFF) << 4) << 1;

59  
üc
;

60 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_log\src\nrf_log_backend_rtt.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
NRF_LOG
è&& NRF_MODULE_ENABLED(
NRF_LOG_BACKEND_RTT
)

42 
	~"Äf_log_back’d_¹t.h
"

43 
	~"Äf_log_back’d_£rŸl.h
"

44 
	~"Äf_log_¡r_fÜm©‹r.h
"

45 
	~"Äf_log_š‹º®.h
"

46 
	~<SEGGER_RTT_CÚf.h
>

47 
	~<SEGGER_RTT.h
>

49 
ušt8_t
 
	gm_¡ršg_buff
[
NRF_LOG_BACKEND_RTT_TEMP_BUFFER_SIZE
];

51 
	$Äf_log_back’d_¹t_š™
()

53 
	`SEGGER_RTT_In™
();

54 
	}
}

56 
	$£rŸl_tx
(cÚ¡ * 
p_cÚ‹xt
, cÚ¡ * 
bufãr
, 
size_t
 
Ën
)

58 ià(
Ën
)

60 
ušt32_t
 
idx
 = 0;

61 
ušt32_t
 
´oûs£d
;

62 
ušt32_t
 
w©chdog_couÁ”
 = 10;

65 
´oûs£d
 = 
	`SEGGER_RTT_Wr™eNoLock
(0, &
bufãr
[
idx
], 
Ën
);

66 
idx
 +ğ
´oûs£d
;

67 
Ën
 -ğ
´oûs£d
;

68 ià(
´oûs£d
 == 0)

71 
w©chdog_couÁ”
--;

72 ià(
w©chdog_couÁ”
 == 0)

77 } 
Ën
);

79 
	}
}

80 
	$Äf_log_back’d_¹t_put
(
Äf_log_back’d_t
 cÚ¡ * 
p_back’d
,

81 
Äf_log_’Œy_t
 * 
p_msg
)

83 
	`Äf_log_back’d_£rŸl_put
(
p_back’d
, 
p_msg
, 
m_¡ršg_buff
, 
NRF_LOG_BACKEND_RTT_TEMP_BUFFER_SIZE
, 
£rŸl_tx
);

84 
	}
}

86 
	$Äf_log_back’d_¹t_æush
(
Äf_log_back’d_t
 cÚ¡ * 
p_back’d
)

89 
	}
}

91 
	$Äf_log_back’d_¹t_·nic_£t
(
Äf_log_back’d_t
 cÚ¡ * 
p_back’d
)

94 
	}
}

96 cÚ¡ 
Äf_log_back’d_­i_t
 
	gÄf_log_back’d_¹t_­i
 = {

97 .
put
 = 
Äf_log_back’d_¹t_put
,

98 .
	gæush
 = 
Äf_log_back’d_¹t_æush
,

99 .
	g·nic_£t
 = 
Äf_log_back’d_¹t_·nic_£t
,

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_log\src\nrf_log_backend_serial.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
NRF_LOG
)

42 
	~"Äf_log_back’d_£rŸl.h
"

43 
	~"Äf_log_¡r_fÜm©‹r.h
"

44 
	~"Äf_log_š‹º®.h
"

46 
	$Äf_log_back’d_£rŸl_put
(
Äf_log_back’d_t
 cÚ¡ * 
p_back’d
,

47 
Äf_log_’Œy_t
 * 
p_msg
,

48 
ušt8_t
 * 
p_bufãr
,

49 
ušt32_t
 
Ëngth
,

50 
Äf_årštf_fwr™e
 
tx_func
)

52 
	`Äf_memobj_g‘
(
p_msg
);

54 
Äf_årštf_ùx_t
 
årštf_ùx
 = {

55 .
p_io_bufãr
 = (*)
p_bufãr
,

56 .
io_bufãr_size
 = 
Ëngth
,

57 .
io_bufãr_út
 = 0,

58 .
auto_æush
 = 
çl£
,

59 .
p_u£r_ùx
 = 
NULL
,

60 .
fwr™e
 = 
tx_func


63 
Äf_log_¡r_fÜm©‹r_’Œy_·¿ms_t
 
·¿ms
;

65 
Äf_log_h—d”_t
 
h—d”
;

66 
ušt32_t
 
memobj_off£t
 = 0;

67 
	`Äf_memobj_»ad
(
p_msg
, &
h—d”
, 
HEADER_SIZE
*(
ušt32_t
), 
memobj_off£t
);

68 
memobj_off£t
 = 
HEADER_SIZE
*(
ušt32_t
);

70 
·¿ms
.
time¡amp
 = 
h—d”
.timestamp;

71 
·¿ms
.
moduË_id
 = 
h—d”
.module_id;

72 
·¿ms
.
u£_cŞÜs
 = 
NRF_LOG_USES_COLORS
;

75 ià(
h—d”
.
ba£
.
g’”ic
.
ty³
 =ğ
HEADER_TYPE_STD
)

77 cÚ¡ * 
p_log_¡r
 = (cÚ¡ *)((
ušt32_t
)
h—d”
.
ba£
.
¡d
.
addr
);

78 
·¿ms
.
£v”™y
 = (
Äf_log_£v”™y_t
)
h—d”
.
ba£
.
¡d
.severity;

79 
·¿ms
.
¿w
 = 
h—d”
.
ba£
.
¡d
.raw;

80 
ušt32_t
 
Çrgs
 = 
h—d”
.
ba£
.
¡d
.nargs;

81 
ušt32_t
 
¬gs
[
NRF_LOG_MAX_NUM_OF_ARGS
];

83 
	`Äf_memobj_»ad
(
p_msg
, 
¬gs
, 
Çrgs
*(
ušt32_t
), 
memobj_off£t
);

84 
memobj_off£t
 +ğ(
Çrgs
*(
ušt32_t
));

86 
	`Äf_log_¡d_’Œy_´oûss
(
p_log_¡r
,

87 
¬gs
,

88 
Çrgs
,

89 &
·¿ms
,

90 &
årštf_ùx
);

93 ià(
h—d”
.
ba£
.
g’”ic
.
ty³
 =ğ
HEADER_TYPE_HEXDUMP
)

95 
ušt32_t
 
d©a_Ën
 = 
h—d”
.
ba£
.
hexdump
.
Ën
;

96 
·¿ms
.
£v”™y
 = (
Äf_log_£v”™y_t
)
h—d”
.
ba£
.
hexdump
.severity;

97 
·¿ms
.
¿w
 = 
h—d”
.
ba£
.
hexdump
.raw;

98 
ušt8_t
 
d©a_buf
[8];

99 
ušt32_t
 
chunk_Ën
;

102 
chunk_Ën
 = (
d©a_buf
è> 
d©a_Ën
 ? data_len : (data_buf);

103 
	`Äf_memobj_»ad
(
p_msg
, 
d©a_buf
, 
chunk_Ën
, 
memobj_off£t
);

104 
memobj_off£t
 +ğ
chunk_Ën
;

105 
d©a_Ën
 -ğ
chunk_Ën
;

107 
	`Äf_log_hexdump_’Œy_´oûss
(
d©a_buf
,

108 
chunk_Ën
,

109 &
·¿ms
,

110 &
årštf_ùx
);

111 } 
d©a_Ën
 > 0);

113 
	`Äf_memobj_put
(
p_msg
);

115 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_log\src\nrf_log_backend_uart.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
NRF_LOG
è&& NRF_MODULE_ENABLED(
NRF_LOG_BACKEND_UART
)

42 
	~"Äf_log_back’d_u¬t.h
"

43 
	~"Äf_log_back’d_£rŸl.h
"

44 
	~"Äf_log_š‹º®.h
"

45 
	~"Äf_drv_u¬t.h
"

46 
	~"­p_”rÜ.h
"

48 
Äf_drv_u¬t_t
 
	gm_u¬t
 = 
NRF_DRV_UART_INSTANCE
(0);

50 
ušt8_t
 
	gm_¡ršg_buff
[
NRF_LOG_BACKEND_UART_TEMP_BUFFER_SIZE
];

51 vŞ©
boŞ
 
	gm_xãr_dÚe
;

52 
boŞ
 
	gm_async_mode
;

53 
	$u¬t_evt_hªdËr
(
Äf_drv_u¬t_ev’t_t
 * 
p_ev’t
, * 
p_cÚ‹xt
)

55 
m_xãr_dÚe
 = 
Œue
;

56 
	}
}

58 
	$u¬t_š™
(
boŞ
 
async_mode
)

60 
Äf_drv_u¬t_cÚfig_t
 
cÚfig
 = 
NRF_DRV_UART_DEFAULT_CONFIG
;

61 
cÚfig
.
p£Éxd
 = 
NRF_LOG_BACKEND_UART_TX_PIN
;

62 
cÚfig
.
p£Ìxd
 = 
NRF_UART_PSEL_DISCONNECTED
;

63 
cÚfig
.
p£lùs
 = 
NRF_UART_PSEL_DISCONNECTED
;

64 
cÚfig
.
p£Ìts
 = 
NRF_UART_PSEL_DISCONNECTED
;

65 
cÚfig
.
baud¿‹
 = (
Äf_u¬t_baud¿‹_t
)
NRF_LOG_BACKEND_UART_BAUDRATE
;

66 
»t_code_t
 
”r_code
 = 
	`Äf_drv_u¬t_š™
(&
m_u¬t
, &
cÚfig
, 
async_mode
 ? 
u¬t_evt_hªdËr
 : 
NULL
);

67 
	`APP_ERROR_CHECK
(
”r_code
);

69 
m_async_mode
 = 
async_mode
;

70 
	}
}

72 
	$Äf_log_back’d_u¬t_š™
()

74 
boŞ
 
async_mode
 = 
NRF_LOG_DEFERRED
 ? 
Œue
 : 
çl£
;

75 
	`u¬t_š™
(
async_mode
);

76 
	}
}

78 
	$£rŸl_tx
(cÚ¡ * 
p_cÚ‹xt
, cÚ¡ * 
p_bufãr
, 
size_t
 
Ën
)

80 
ušt8_t
 
Ën8
 = (ušt8_t)(
Ën
 & 0x000000FF);

81 
m_xãr_dÚe
 = 
çl£
;

82 
»t_code_t
 
”r_code
 = 
	`Äf_drv_u¬t_tx
(&
m_u¬t
, (
ušt8_t
 *)
p_bufãr
, 
Ën8
);

83 
	`APP_ERROR_CHECK
(
”r_code
);

85 
m_async_mode
 && (
m_xãr_dÚe
 =ğ
çl£
))

90 
	}
}

92 
	$Äf_log_back’d_u¬t_put
(
Äf_log_back’d_t
 cÚ¡ * 
p_back’d
,

93 
Äf_log_’Œy_t
 * 
p_msg
)

95 
	`Äf_log_back’d_£rŸl_put
(
p_back’d
, 
p_msg
, 
m_¡ršg_buff
,

96 
NRF_LOG_BACKEND_UART_TEMP_BUFFER_SIZE
, 
£rŸl_tx
);

97 
	}
}

99 
	$Äf_log_back’d_u¬t_æush
(
Äf_log_back’d_t
 cÚ¡ * 
p_back’d
)

102 
	}
}

104 
	$Äf_log_back’d_u¬t_·nic_£t
(
Äf_log_back’d_t
 cÚ¡ * 
p_back’d
)

106 
	`Äf_drv_u¬t_unš™
(&
m_u¬t
);

108 
	`u¬t_š™
(
çl£
);

109 
	}
}

111 cÚ¡ 
Äf_log_back’d_­i_t
 
	gÄf_log_back’d_u¬t_­i
 = {

112 .
put
 = 
Äf_log_back’d_u¬t_put
,

113 .
	gæush
 = 
Äf_log_back’d_u¬t_æush
,

114 .
	g·nic_£t
 = 
Äf_log_back’d_u¬t_·nic_£t
,

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_log\src\nrf_log_default_backends.c

41 
	~"sdk_commÚ.h
"

42 #ià
NRF_MODULE_ENABLED
(
NRF_LOG
)

43 
	~"Äf_log_deçuÉ_back’ds.h
"

44 
	~"Äf_log_ù¾.h
"

45 
	~"Äf_log_š‹º®.h
"

46 
	~"Äf_as£¹.h
"

48 #ià
defšed
(
NRF_LOG_BACKEND_RTT_ENABLED
) && NRF_LOG_BACKEND_RTT_ENABLED

49 
	~"Äf_log_back’d_¹t.h
"

50 
NRF_LOG_BACKEND_RTT_DEF
(
¹t_log_back’d
);

53 #ià
defšed
(
NRF_LOG_BACKEND_UART_ENABLED
) && NRF_LOG_BACKEND_UART_ENABLED

54 
	~"Äf_log_back’d_u¬t.h
"

55 
NRF_LOG_BACKEND_UART_DEF
(
u¬t_log_back’d
);

58 
	$Äf_log_deçuÉ_back’ds_š™
()

60 
št32_t
 
back’d_id
 = -1;

61 ()
back’d_id
;

62 #ià
	`defšed
(
NRF_LOG_BACKEND_RTT_ENABLED
) && NRF_LOG_BACKEND_RTT_ENABLED

63 
	`Äf_log_back’d_¹t_š™
();

64 
back’d_id
 = 
	`Äf_log_back’d_add
(&
¹t_log_back’d
.
back’d
, 
NRF_LOG_SEVERITY_DEBUG
);

65 
	`ASSERT
(
back’d_id
 >= 0);

66 
	`Äf_log_back’d_’abË
(&
¹t_log_back’d
.
back’d
);

69 #ià
	`defšed
(
NRF_LOG_BACKEND_UART_ENABLED
) && NRF_LOG_BACKEND_UART_ENABLED

70 
	`Äf_log_back’d_u¬t_š™
();

71 
back’d_id
 = 
	`Äf_log_back’d_add
(&
u¬t_log_back’d
.
back’d
, 
NRF_LOG_SEVERITY_DEBUG
);

72 
	`ASSERT
(
back’d_id
 >= 0);

73 
	`Äf_log_back’d_’abË
(&
u¬t_log_back’d
.
back’d
);

75 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_log\src\nrf_log_frontend.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
NRF_LOG
)

42 
	~"­p_ut.h
"

43 
	~"­p_ut_¶©fÜm.h
"

44 
	~"Äf_log.h
"

45 
	~"Äf_log_š‹º®.h
"

46 
	~"Äf_log_ù¾.h
"

47 
	~"Äf_£ùiÚ.h
"

48 
	~"Äf_memobj.h
"

49 
	~"Äf_©omic.h
"

50 
	~<¡ršg.h
>

52 
STATIC_ASSERT
((
NRF_LOG_BUFSIZE
 % 4) == 0);

53 
STATIC_ASSERT
(
IS_POWER_OF_TWO
(
NRF_LOG_BUFSIZE
));

55 
	#NRF_LOG_BUF_WORDS
 (
NRF_LOG_BUFSIZE
/4)

	)

57 #ià
NRF_LOG_BUF_WORDS
 < 32

61 
NRF_MEMOBJ_POOL_DEF
(
mempoŞ
, 
NRF_LOG_MSGPOOL_ELEMENT_SIZE
, 
NRF_LOG_MSGPOOL_ELEMENT_COUNT
);

63 
	#NRF_LOG_BACKENDS_FULL
 0xFF

	)

64 
	#NRF_LOG_FILTER_BITS_PER_BACKEND
 3

	)

65 
	#NRF_LOG_MAX_BACKENDS
 (32/
NRF_LOG_FILTER_BITS_PER_BACKEND
)

	)

66 
	#NRF_LOG_MAX_HEXDUMP
 (
NRF_LOG_MSGPOOL_ELEMENT_SIZE
*
NRF_LOG_MSGPOOL_ELEMENT_COUNT
/2)

	)

78 
ušt32_t
 
	mwr_idx
;

79 
ušt32_t
 
	mrd_idx
;

80 
ušt32_t
 
	mmask
;

81 
ušt32_t
 
	mbufãr
[
NRF_LOG_BUF_WORDS
];

82 
Äf_log_time¡amp_func_t
 
	mtime¡amp_func
;

83 
Äf_log_back’d_t
 * 
	mp_back’d_h—d
;

84 
Äf_©omic_æag_t
 
	mlog_skpšg
;

85 
Äf_©omic_æag_t
 
	mlog_sk³d
;

86 
boŞ
 
	mautoæush
;

87 } 
	tlog_d©a_t
;

89 
log_d©a_t
 
	gm_log_d©a
;

90 cÚ¡ * 
	gm_ov”æow_šfo
 = "Overflow";

92 
NRF_SECTION_DEF
(
log_dyÇmic_d©a
, 
Äf_log_moduË_dyÇmic_d©a_t
);

93 
NRF_SECTION_DEF
(
log_cÚ¡_d©a
, 
Äf_log_moduË_cÚ¡_d©a_t
);

95 
NRF_LOG_MODULE_REGISTER
();

97 
	#NRF_LOG_DYNAMIC_SECTION_VARS_GET
(
i
è
	`NRF_SECTION_ITEM_GET
(
log_dyÇmic_d©a
, 
Äf_log_moduË_dyÇmic_d©a_t
, (i))

	)

99 
	#NRF_LOG_CONST_SECTION_VARS_GET
(
i
è
	`NRF_SECTION_ITEM_GET
(
log_cÚ¡_d©a
, 
Äf_log_moduË_cÚ¡_d©a_t
, (i))

	)

100 
	#NRF_LOG_CONST_SECTION_VARS_COUNT
 
	`NRF_SECTION_ITEM_COUNT
(
log_cÚ¡_d©a
, 
Äf_log_moduË_cÚ¡_d©a_t
)

	)

102 
	#PUSHED_HEADER_FILL
(
P_HDR
, 
OFFSET
, 
LENGTH
) \

103 (
P_HDR
)->
ba£
.
pushed
.
ty³
 = 
HEADER_TYPE_PUSHED
; \

104 (
P_HDR
)->
ba£
.
pushed
.
off£t
 = 
OFFSET
; \

105 (
P_HDR
)->
ba£
.
pushed
.
Ën
 = 
LENGTH


	)

108 
»t_code_t
 
	$Äf_log_š™
(
Äf_log_time¡amp_func_t
 
time¡amp_func
)

110 ià(
NRF_LOG_USES_TIMESTAMP
 && (
time¡amp_func
 =ğ
NULL
))

112  
NRF_ERROR_INVALID_PARAM
;

115 
m_log_d©a
.
mask
 = 
NRF_LOG_BUF_WORDS
 - 1;

116 
m_log_d©a
.
wr_idx
 = 0;

117 
m_log_d©a
.
rd_idx
 = 0;

118 
m_log_d©a
.
log_sk³d
 = 0;

119 
m_log_d©a
.
log_skpšg
 = 0;

120 
m_log_d©a
.
autoæush
 = 
NRF_LOG_DEFERRED
 ? 
çl£
 : 
Œue
;

121 ià(
NRF_LOG_USES_TIMESTAMP
)

123 
m_log_d©a
.
time¡amp_func
 =imestamp_func;

126 
»t_code_t
 
”r_code
 = 
	`Äf_memobj_poŞ_š™
(&
mempoŞ
);

127 ià(
”r_code
 !ğ
NRF_SUCCESS
)

129  
”r_code
;

132 
ušt32_t
 
moduËs_út
 = 
NRF_LOG_CONST_SECTION_VARS_COUNT
;

133 
ušt32_t
 
i
;

134 ià(
NRF_LOG_FILTERS_ENABLED
)

136 
ušt32_t
 
j
;

138 
i
 = 0; i < 
moduËs_út
; i++)

140 
ušt32_t
 
idx
 = 0;

142 
j
 = 0; j < 
moduËs_út
; j++)

144 ià(
i
 !ğ
j
)

146 cÚ¡ * 
p_Çme0
 = 
	`NRF_LOG_CONST_SECTION_VARS_GET
(
i
)->
p_moduË_Çme
;

147 cÚ¡ * 
p_Çme1
 = 
	`NRF_LOG_CONST_SECTION_VARS_GET
(
j
)->
p_moduË_Çme
;

148 ià(
	`¡ºcmp
(
p_Çme0
, 
p_Çme1
, 20) > 0)

150 
idx
++;

155 
Äf_log_moduË_dyÇmic_d©a_t
 * 
p_moduË_dd©a
 = 
	`NRF_LOG_DYNAMIC_SECTION_VARS_GET
(
i
);

156 
p_moduË_dd©a
->
f‹r
 = 0;

157 
p_moduË_dd©a
->
moduË_id
 = 
i
;

158 
p_moduË_dd©a
->
Üd”_idx
 = 
idx
;

163 
i
 = 0; i < 
moduËs_út
; i++)

165 
Äf_log_moduË_dyÇmic_d©a_t
 * 
p_moduË_dd©a
 = 
	`NRF_LOG_DYNAMIC_SECTION_VARS_GET
(
i
);

166 
p_moduË_dd©a
->
moduË_id
 = 
i
;

170  
NRF_SUCCESS
;

171 
	}
}

173 
ušt32_t
 
	$Äf_log_moduË_út_g‘
()

175  
NRF_LOG_CONST_SECTION_VARS_COUNT
;

176 
	}
}

178 
»t_code_t
 
	$moduË_idx_g‘
(
ušt32_t
 * 
p_idx
, 
boŞ
 
Üd”ed_idx
)

180 ià(
Üd”ed_idx
)

182 
ušt32_t
 
moduË_út
 = 
	`Äf_log_moduË_út_g‘
();

183 
ušt32_t
 
i
;

184 
i
 = 0; i < 
moduË_út
; i++)

186 
Äf_log_moduË_dyÇmic_d©a_t
 * 
p_moduË_d©a
 = 
	`NRF_LOG_DYNAMIC_SECTION_VARS_GET
(
i
);

187 ià(
p_moduË_d©a
->
Üd”_idx
 =ğ*
p_idx
)

189 *
p_idx
 = 
i
;

190  
NRF_SUCCESS
;

193  
NRF_ERROR_NOT_FOUND
;

197  
NRF_SUCCESS
;

199 
	}
}

200 cÚ¡ * 
	$Äf_log_moduË_Çme_g‘
(
ušt32_t
 
moduË_id
, 
boŞ
 
Üd”ed_idx
)

202 ià(
	`moduË_idx_g‘
(&
moduË_id
, 
Üd”ed_idx
è=ğ
NRF_SUCCESS
)

204 
Äf_log_moduË_cÚ¡_d©a_t
 * 
p_moduË_d©a
 = 
	`NRF_LOG_CONST_SECTION_VARS_GET
(
moduË_id
);

205  
p_moduË_d©a
->
p_moduË_Çme
;

209  
NULL
;

211 
	}
}

213 
ušt8_t
 
	$Äf_log_cŞÜ_id_g‘
(
ušt32_t
 
moduË_id
, 
Äf_log_£v”™y_t
 
£v”™y
)

215 
Äf_log_moduË_cÚ¡_d©a_t
 * 
p_moduË_d©a
 = 
	`NRF_LOG_CONST_SECTION_VARS_GET
(
moduË_id
);

216 
ušt8_t
 
cŞÜ_id
;

217 
£v”™y
)

219 
NRF_LOG_SEVERITY_ERROR
:

220 
cŞÜ_id
 = 
NRF_LOG_ERROR_COLOR
;

222 
NRF_LOG_SEVERITY_WARNING
:

223 
cŞÜ_id
 = 
NRF_LOG_WARNING_COLOR
;

225 
NRF_LOG_SEVERITY_INFO
:

226 
cŞÜ_id
 = 
p_moduË_d©a
->
šfo_cŞÜ_id
;

228 
NRF_LOG_SEVERITY_DEBUG
:

229 
cŞÜ_id
 = 
p_moduË_d©a
->
debug_cŞÜ_id
;

232 
cŞÜ_id
 = 0;

235  
cŞÜ_id
;

236 
	}
}

238 
ušt32_t
 
	$high”_lvl_g‘
(
ušt32_t
 
lvls
)

240 
ušt32_t
 
tİ_lvl
 = 0;

241 
ušt32_t
 
tmp_lvl
;

242 
ušt32_t
 
i
;

245 
i
 = 0; i < (32/
NRF_LOG_LEVEL_BITS
); i+=NRF_LOG_LEVEL_BITS)

247 
tmp_lvl
 = 
	`BF_GET
(
lvls
,
NRF_LOG_LEVEL_BITS
, 
i
);

248 ià(
tmp_lvl
 > 
tİ_lvl
)

250 
tİ_lvl
 = 
tmp_lvl
;

253  
tİ_lvl
;

254 
	}
}

256 
	$Äf_log_moduË_f‹r_£t
(
ušt32_t
 
back’d_id
, ušt32_ˆ
moduË_id
, 
Äf_log_£v”™y_t
 
£v”™y
)

258 ià(
NRF_LOG_FILTERS_ENABLED
)

260 
Äf_log_moduË_dyÇmic_d©a_t
 * 
p_moduË_f‹r
 = 
	`NRF_LOG_DYNAMIC_SECTION_VARS_GET
(
moduË_id
);

261 
p_moduË_f‹r
->
f‹r_lvls
 &ğ~(
NRF_LOG_LEVEL_MASK
 << (
NRF_LOG_LEVEL_BITS
 * 
back’d_id
));

262 
p_moduË_f‹r
->
f‹r_lvls
 |ğ(
£v”™y
 & 
NRF_LOG_LEVEL_MASK
è<< (
NRF_LOG_LEVEL_BITS
 * 
back’d_id
);

263 
p_moduË_f‹r
->
f‹r
 = 
	`high”_lvl_g‘
Õ_moduË_f‹r->
f‹r_lvls
);

265 
	}
}

267 
Äf_log_£v”™y_t
 
	$Äf_log_moduË_f‹r_g‘
(
ušt32_t
 
back’d_id
,

268 
ušt32_t
 
moduË_id
,

269 
boŞ
 
Üd”ed_idx
,

270 
boŞ
 
dyÇmic
)

272 
Äf_log_£v”™y_t
 
£v”™y
 = 
NRF_LOG_SEVERITY_NONE
;

273 ià(
NRF_LOG_FILTERS_ENABLED
 && 
dyÇmic
)

275 ià(
	`moduË_idx_g‘
(&
moduË_id
, 
Üd”ed_idx
è=ğ
NRF_SUCCESS
)

277 
Äf_log_moduË_dyÇmic_d©a_t
 * 
p_moduË_f‹r
 =

278 
	`NRF_LOG_DYNAMIC_SECTION_VARS_GET
(
moduË_id
);

279 
£v”™y
 = (
Äf_log_£v”™y_t
)((
p_moduË_f‹r
->
f‹r_lvls
 >> (
NRF_LOG_LEVEL_BITS
 * 
back’d_id
)) &

280 
NRF_LOG_LEVEL_MASK
);

283 ià(!
dyÇmic
)

285 ià(
	`moduË_idx_g‘
(&
moduË_id
, 
Üd”ed_idx
è=ğ
NRF_SUCCESS
)

287 
Äf_log_moduË_cÚ¡_d©a_t
 * 
p_moduË_d©a
 =

288 
	`NRF_LOG_CONST_SECTION_VARS_GET
(
moduË_id
);

289 
£v”™y
 = (
Äf_log_£v”™y_t
)
p_moduË_d©a
->
comped_lvl
;

292  
£v”™y
;

293 
	}
}

300 
	$log_sk
()

302 ()
	`Äf_©omic_æag_£t
(&
m_log_d©a
.
log_sk³d
);

303 ()
	`Äf_©omic_æag_£t
(&
m_log_d©a
.
log_skpšg
);

305 
ušt32_t
 
rd_idx
 = 
m_log_d©a
.rd_idx;

306 
ušt32_t
 
mask
 = 
m_log_d©a
.mask;

307 
Äf_log_h—d”_t
 * 
p_h—d”
 = (Äf_log_h—d”_ˆ*)&
m_log_d©a
.
bufãr
[
rd_idx
 & 
mask
];

308 
Äf_log_h—d”_t
 
h—d”
;

311 
p_h—d”
->
ba£
.
g’”ic
.
ty³
 =ğ
HEADER_TYPE_PUSHED
)

313 
rd_idx
 +ğ
PUSHED_HEADER_SIZE
;

314 
rd_idx
 +ğ(
p_h—d”
->
ba£
.
pushed
.
Ën
 +…_h—d”->ba£.pushed.
off£t
);

315 
p_h—d”
 = (
Äf_log_h—d”_t
 *)&
m_log_d©a
.
bufãr
[
rd_idx
 & 
mask
];

318 
ušt32_t
 
i
;

319 
i
 = 0; i < 
HEADER_SIZE
; i++)

321 ((
ušt32_t
*)&
h—d”
)[
i
] = 
m_log_d©a
.
bufãr
[
rd_idx
++ & 
mask
];

324 
h—d”
.
ba£
.
g’”ic
.
ty³
)

326 
HEADER_TYPE_HEXDUMP
:

327 
rd_idx
 +ğ
	`CEIL_DIV
(
h—d”
.
ba£
.
hexdump
.
Ën
, (
ušt32_t
));

329 
HEADER_TYPE_STD
:

330 
rd_idx
 +ğ
h—d”
.
ba£
.
¡d
.
Çrgs
;

333 
	`ASSERT
(
çl£
);

337 
ušt32_t
 
log_skpšg_tmp
 = 
	`Äf_©omic_æag_ş—r_ãtch
(&
m_log_d©a
.
log_skpšg
);

339 ià(
log_skpšg_tmp
)

341 
m_log_d©a
.
rd_idx
 =„d_idx;

343 
	}
}

346 
šlše
 
	$¡d_h—d”_£t
(
ušt32_t
 
£v”™y_mid
,

347 cÚ¡ * cÚ¡ 
p_¡r
,

348 
ušt32_t
 
Çrgs
,

349 
ušt32_t
 
wr_idx
,

350 
ušt32_t
 
mask
)

355 
ušt16_t
 
moduË_id
 = 
£v”™y_mid
 >> 
NRF_LOG_MODULE_ID_POS
;

356 
	`ASSERT
(
moduË_id
 < 
	`Äf_log_moduË_út_g‘
());

357 
m_log_d©a
.
bufãr
[(
wr_idx
 + 1è& 
mask
] = 
moduË_id
;

359 ià(
NRF_LOG_USES_TIMESTAMP
)

361 
m_log_d©a
.
bufãr
[(
wr_idx
 + 2è& 
mask
] = m_log_d©a.
	`time¡amp_func
();

364 
Äf_log_h—d”_t
 * 
p_h—d”
 = (Äf_log_h—d”_ˆ*)&
m_log_d©a
.
bufãr
[
wr_idx
 & 
mask
];

365 
p_h—d”
->
ba£
.
¡d
.
¿w
 = (
£v”™y_mid
 & 
NRF_LOG_RAW
) ? 1 : 0;

366 
p_h—d”
->
ba£
.
¡d
.
£v”™y
 = 
£v”™y_mid
 & 
NRF_LOG_LEVEL_MASK
;

367 
p_h—d”
->
ba£
.
¡d
.
Çrgs
 =‚args;

368 
p_h—d”
->
ba£
.
¡d
.
addr
 = ((
ušt32_t
)(
p_¡r
è& 
STD_ADDR_MASK
);

369 
p_h—d”
->
ba£
.
¡d
.
ty³
 = 
HEADER_TYPE_STD
;

370 
	}
}

383 
šlše
 
boŞ
 
	$buf_´—Îoc
(
ušt32_t
 
cÚ‹Á_Ën
, ušt32_ˆ* 
p_wr_idx
)

385 
ušt32_t
 
»q_Ën
 = 
cÚ‹Á_Ën
 + 
HEADER_SIZE
;

386 
ušt32_t
 
ovæw_g_size
 = 
HEADER_SIZE
;

387 
boŞ
 
»t
 = 
Œue
;

388 
	`CRITICAL_REGION_ENTER
();

389 *
p_wr_idx
 = 
m_log_d©a
.
wr_idx
;

390 
ušt32_t
 
avaabË_wÜds
 = (
m_log_d©a
.
mask
 + 1è- (m_log_d©a.
wr_idx
 - m_log_d©a.
rd_idx
);

391 
ušt32_t
 
»quœed_wÜds
 = 
»q_Ën
 + 
ovæw_g_size
;

392 
»quœed_wÜds
 > 
avaabË_wÜds
)

394 ià(
NRF_LOG_ALLOW_OVERFLOW
)

396 
	`log_sk
();

397 
avaabË_wÜds
 = (
m_log_d©a
.
mask
 + 1è- (m_log_d©a.
wr_idx
 - m_log_d©a.
rd_idx
);

401 ià(
avaabË_wÜds
 >ğ
HEADER_SIZE
)

404 
	`¡d_h—d”_£t
(
NRF_LOG_LEVEL_WARNING
, 
m_ov”æow_šfo
, 0, 
m_log_d©a
.
wr_idx
, m_log_d©a.
mask
);

405 
»q_Ën
 = 
HEADER_SIZE
;

410 
»q_Ën
 = 0;

412 
»t
 = 
çl£
;

418 
Äf_log_g’”ic_h—d”_t
 * 
p_h—d”
 = (Äf_log_g’”ic_h—d”_ˆ*)&
m_log_d©a
.
bufãr
[m_log_d©a.
wr_idx
 & m_log_d©a.
mask
];

419 
p_h—d”
->
ty³
 = 
HEADER_TYPE_INVALID
;

421 
m_log_d©a
.
wr_idx
 +ğ
»q_Ën
;

423 
	`CRITICAL_REGION_EXIT
();

424  
»t
;

425 
	}
}

442 
šlše
 
ušt32_t
 * 
	$cÚt_buf_´—Îoc
(
ušt32_t
 
Ën32
,

443 
ušt32_t
 * 
p_off£t
,

444 
ušt32_t
 * 
p_wr_idx
)

446 
ušt32_t
 * 
p_buf
 = 
NULL
;

448 
Ën32
 +ğ
PUSHED_HEADER_SIZE
;

450 
	`CRITICAL_REGION_ENTER
();

451 *
p_wr_idx
 = 
m_log_d©a
.
wr_idx
;

452 
ušt32_t
 
avaabË_wÜds
 = (
m_log_d©a
.
mask
 + 1) -

453 (
m_log_d©a
.
wr_idx
 - m_log_d©a.
rd_idx
);

454 ià(
Ën32
 <ğ
avaabË_wÜds
)

457 
p_buf
 = &
m_log_d©a
.
bufãr
[(m_log_d©a.
wr_idx
 + 1è& m_log_d©a.
mask
];

458 
m_log_d©a
.
wr_idx
 +ğ
Ën32
;

459 *
p_off£t
 = 0;

461 ià(
Ën32
 < (
m_log_d©a
.
rd_idx
 & m_log_d©a.
mask
))

464 
m_log_d©a
.
wr_idx
 +ğ(
Ën32
 + 
avaabË_wÜds
 - 1);

465 *
p_off£t
 = 
avaabË_wÜds
 - 1;

466 
p_buf
 = 
m_log_d©a
.
bufãr
;

468 
avaabË_wÜds
 = (
m_log_d©a
.
mask
 + 1è- (m_log_d©a.
wr_idx
 - m_log_d©a.
rd_idx
);

470 ià(
avaabË_wÜds
 < 
HEADER_SIZE
)

472 
p_buf
 = 
NULL
;

474 
	`CRITICAL_REGION_EXIT
();

476  
p_buf
;

477 
	}
}

480 
ušt32_t
 
	$Äf_log_push
(* cÚ¡ 
p_¡r
)

482 ià((
m_log_d©a
.
autoæush
è|| (
p_¡r
 =ğ
NULL
))

484  (
ušt32_t
)
p_¡r
;

487 
ušt32_t
 
mask
 = 
m_log_d©a
.mask;

488 
ušt32_t
 
¦’
 = 
	`¡¾’
(
p_¡r
) + 1;

489 
ušt32_t
 
buæ’
 = 
	`CEIL_DIV
(
¦’
, (uint32_t));

490 
ušt32_t
 
off£t
 = 0;

491 
ušt32_t
 
wr_idx
;

492 * 
p_d¡_¡r
 = (*)
	`cÚt_buf_´—Îoc
(
buæ’
, &
off£t
, &
wr_idx
);

493 ià(
p_d¡_¡r
)

495 
Äf_log_h—d”_t
 * 
p_h—d”
 = (Äf_log_h—d”_ˆ*)&
m_log_d©a
.
bufãr
[
wr_idx
 & 
mask
];

496 
	`PUSHED_HEADER_FILL
(
p_h—d”
, 
off£t
, 
buæ’
);

497 
	`memıy
(
p_d¡_¡r
, 
p_¡r
, 
¦’
);

499  (
ušt32_t
)
p_d¡_¡r
;

500 
	}
}

502 
šlše
 
	$¡d_n
(
ušt32_t
 
£v”™y_mid
, cÚ¡ * cÚ¡ 
p_¡r
, ušt32_ˆcÚ¡ * 
¬gs
, ušt32_ˆ
Çrgs
)

504 
ušt32_t
 
mask
 = 
m_log_d©a
.mask;

505 
ušt32_t
 
wr_idx
;

507 ià(
	`buf_´—Îoc
(
Çrgs
, &
wr_idx
))

511 
ušt32_t
 
d©a_idx
 = 
wr_idx
 + 
HEADER_SIZE
;

512 
ušt32_t
 
i
;

513 
i
 = 0; i < 
Çrgs
; i++)

515 
m_log_d©a
.
bufãr
[
d©a_idx
++ & 
mask
] =
¬gs
[
i
];

517 
	`¡d_h—d”_£t
(
£v”™y_mid
, 
p_¡r
, 
Çrgs
, 
wr_idx
, 
mask
);

519 ià(
m_log_d©a
.
autoæush
)

521 
	`NRF_LOG_FLUSH
();

524 
	}
}

526 
	$Äf_log_äÚ‹nd_¡d_0
(
ušt32_t
 
£v”™y_mid
, cÚ¡ * cÚ¡ 
p_¡r
)

528 
	`¡d_n
(
£v”™y_mid
, 
p_¡r
, 
NULL
, 0);

529 
	}
}

532 
	$Äf_log_äÚ‹nd_¡d_1
(
ušt32_t
 
£v”™y_mid
,

533 cÚ¡ * cÚ¡ 
p_¡r
,

534 
ušt32_t
 
v®0
)

536 
ušt32_t
 
¬gs
[] = {
v®0
};

537 
	`¡d_n
(
£v”™y_mid
, 
p_¡r
, 
¬gs
, 
	`ARRAY_SIZE
(args));

538 
	}
}

541 
	$Äf_log_äÚ‹nd_¡d_2
(
ušt32_t
 
£v”™y_mid
,

542 cÚ¡ * cÚ¡ 
p_¡r
,

543 
ušt32_t
 
v®0
,

544 
ušt32_t
 
v®1
)

546 
ušt32_t
 
¬gs
[] = {
v®0
, 
v®1
};

547 
	`¡d_n
(
£v”™y_mid
, 
p_¡r
, 
¬gs
, 
	`ARRAY_SIZE
(args));

548 
	}
}

551 
	$Äf_log_äÚ‹nd_¡d_3
(
ušt32_t
 
£v”™y_mid
,

552 cÚ¡ * cÚ¡ 
p_¡r
,

553 
ušt32_t
 
v®0
,

554 
ušt32_t
 
v®1
,

555 
ušt32_t
 
v®2
)

557 
ušt32_t
 
¬gs
[] = {
v®0
, 
v®1
, 
v®2
};

558 
	`¡d_n
(
£v”™y_mid
, 
p_¡r
, 
¬gs
, 
	`ARRAY_SIZE
(args));

559 
	}
}

562 
	$Äf_log_äÚ‹nd_¡d_4
(
ušt32_t
 
£v”™y_mid
,

563 cÚ¡ * cÚ¡ 
p_¡r
,

564 
ušt32_t
 
v®0
,

565 
ušt32_t
 
v®1
,

566 
ušt32_t
 
v®2
,

567 
ušt32_t
 
v®3
)

569 
ušt32_t
 
¬gs
[] = {
v®0
, 
v®1
, 
v®2
, 
v®3
};

570 
	`¡d_n
(
£v”™y_mid
, 
p_¡r
, 
¬gs
, 
	`ARRAY_SIZE
(args));

571 
	}
}

574 
	$Äf_log_äÚ‹nd_¡d_5
(
ušt32_t
 
£v”™y_mid
,

575 cÚ¡ * cÚ¡ 
p_¡r
,

576 
ušt32_t
 
v®0
,

577 
ušt32_t
 
v®1
,

578 
ušt32_t
 
v®2
,

579 
ušt32_t
 
v®3
,

580 
ušt32_t
 
v®4
)

582 
ušt32_t
 
¬gs
[] = {
v®0
, 
v®1
, 
v®2
, 
v®3
, 
v®4
};

583 
	`¡d_n
(
£v”™y_mid
, 
p_¡r
, 
¬gs
, 
	`ARRAY_SIZE
(args));

584 
	}
}

587 
	$Äf_log_äÚ‹nd_¡d_6
(
ušt32_t
 
£v”™y_mid
,

588 cÚ¡ * cÚ¡ 
p_¡r
,

589 
ušt32_t
 
v®0
,

590 
ušt32_t
 
v®1
,

591 
ušt32_t
 
v®2
,

592 
ušt32_t
 
v®3
,

593 
ušt32_t
 
v®4
,

594 
ušt32_t
 
v®5
)

596 
ušt32_t
 
¬gs
[] = {
v®0
, 
v®1
, 
v®2
, 
v®3
, 
v®4
, 
v®5
};

597 
	`¡d_n
(
£v”™y_mid
, 
p_¡r
, 
¬gs
, 
	`ARRAY_SIZE
(args));

598 
	}
}

601 
	$Äf_log_äÚ‹nd_hexdump
(
ušt32_t
 
£v”™y_mid
,

602 cÚ¡ * cÚ¡ 
p_d©a
,

603 
ušt16_t
 
Ëngth
)

605 
ušt32_t
 
mask
 = 
m_log_d©a
.mask;

607 
ušt32_t
 
wr_idx
;

608 ià(
	`buf_´—Îoc
(
	`CEIL_DIV
(
Ëngth
, (
ušt32_t
)), &
wr_idx
))

610 
ušt32_t
 
h—d”_wr_idx
 = 
wr_idx
;

611 
wr_idx
 +ğ
HEADER_SIZE
;

613 
ušt32_t
 
¥aû0
 = (ušt32_tè* (
m_log_d©a
.
mask
 + 1 - (
wr_idx
 & mask));

614 ià(
Ëngth
 <ğ
¥aû0
)

616 
	`memıy
(&
m_log_d©a
.
bufãr
[
wr_idx
 & 
mask
], 
p_d©a
, 
Ëngth
);

620 
	`memıy
(&
m_log_d©a
.
bufãr
[
wr_idx
 & 
mask
], 
p_d©a
, 
¥aû0
);

621 
Ëngth
 -ğ
¥aû0
;

622 
	`memıy
(&
m_log_d©a
.
bufãr
[0], &((
ušt8_t
 *)
p_d©a
)[
¥aû0
], 
Ëngth
);

626 ià(
NRF_LOG_USES_TIMESTAMP
)

628 
m_log_d©a
.
bufãr
[(
h—d”_wr_idx
 + 2è& 
mask
] = m_log_d©a.
	`time¡amp_func
();

631 
m_log_d©a
.
bufãr
[(
h—d”_wr_idx
 + 1è& 
mask
] = 
£v”™y_mid
 >> 
NRF_LOG_MODULE_ID_POS
;

633 
Äf_log_h—d”_t
 * 
p_h—d”
 = (Äf_log_h—d”_ˆ*)&
m_log_d©a
.
bufãr
[
h—d”_wr_idx
 & 
mask
];

634 
p_h—d”
->
ba£
.
hexdump
.
¿w
 = (
£v”™y_mid
 & 
NRF_LOG_RAW
) ? 1 : 0;

635 
p_h—d”
->
ba£
.
hexdump
.
£v”™y
 = 
£v”™y_mid
 & 
NRF_LOG_LEVEL_MASK
;

636 
p_h—d”
->
ba£
.
hexdump
.
off£t
 = 0;

637 
p_h—d”
->
ba£
.
hexdump
.
Ën
 = 
Ëngth
;

638 
p_h—d”
->
ba£
.
hexdump
.
ty³
 = 
HEADER_TYPE_HEXDUMP
;

644 ià(
m_log_d©a
.
autoæush
)

646 
	`NRF_LOG_FLUSH
();

648 
	}
}

651 
boŞ
 
	$bufãr_is_em±y
()

653  (
m_log_d©a
.
rd_idx
 =ğm_log_d©a.
wr_idx
);

654 
	}
}

657 
boŞ
 
	$Äf_log_äÚ‹nd_dequeue
()

659 ià(
	`bufãr_is_em±y
())

661  
çl£
;

663 
m_log_d©a
.
log_sk³d
 = 0;

665 
	`__DSB
();

666 
ušt32_t
 
rd_idx
 = 
m_log_d©a
.rd_idx;

667 
ušt32_t
 
mask
 = 
m_log_d©a
.mask;

668 
Äf_log_h—d”_t
 * 
p_h—d”
 = (Äf_log_h—d”_ˆ*)&
m_log_d©a
.
bufãr
[
rd_idx
 & 
mask
];

669 
Äf_log_h—d”_t
 
h—d”
;

670 
Äf_memobj_t
 * 
p_msg_buf
 = 
NULL
;

671 
ušt32_t
 
memobj_off£t
 = 0;

672 
ušt32_t
 
£v”™y
 = 0;

675 
p_h—d”
->
ba£
.
g’”ic
.
ty³
 =ğ
HEADER_TYPE_PUSHED
)

677 
rd_idx
 +ğ
PUSHED_HEADER_SIZE
;

678 
rd_idx
 +ğ(
p_h—d”
->
ba£
.
pushed
.
Ën
 +…_h—d”->ba£.pushed.
off£t
);

679 
p_h—d”
 = (
Äf_log_h—d”_t
 *)&
m_log_d©a
.
bufãr
[
rd_idx
 & 
mask
];

682 
ušt32_t
 
i
;

683 
i
 = 0; i < 
HEADER_SIZE
; i++)

685 ((
ušt32_t
*)&
h—d”
)[
i
] = 
m_log_d©a
.
bufãr
[
rd_idx
++ & 
mask
];

688 ià(
h—d”
.
ba£
.
g’”ic
.
ty³
 =ğ
HEADER_TYPE_HEXDUMP
)

690 
ušt32_t
 
Üig_d©a_Ën
 = 
h—d”
.
ba£
.
hexdump
.
Ën
;

691 
ušt32_t
 
d©a_Ën
 = 
	`MIN
(
h—d”
.
ba£
.
hexdump
.
Ën
, 
NRF_LOG_MAX_HEXDUMP
);

692 
h—d”
.
ba£
.
hexdump
.
Ën
 = 
d©a_Ën
;

693 
ušt32_t
 
msg_buf_size8
 = (ušt32_t)*
HEADER_SIZE
 + 
d©a_Ën
;

694 
£v”™y
 = 
h—d”
.
ba£
.
hexdump
.severity;

695 
p_msg_buf
 = 
	`Äf_memobj_®loc
(&
mempoŞ
, 
msg_buf_size8
);

697 ià(
p_msg_buf
)

699 
	`Äf_memobj_g‘
(
p_msg_buf
);

700 
	`Äf_memobj_wr™e
(
p_msg_buf
, &
h—d”
, 
HEADER_SIZE
*(
ušt32_t
), 
memobj_off£t
);

701 
memobj_off£t
 +ğ
HEADER_SIZE
*(
ušt32_t
);

703 
ušt32_t
 
¥aû0
 = (ušt32_tè* (
mask
 + 1 - (
rd_idx
 & mask));

704 ià(
d©a_Ën
 > 
¥aû0
)

706 
ušt8_t
 * 
±r0
 = 
¥aû0
 ?

707 (
ušt8_t
 *)&
m_log_d©a
.
bufãr
[
rd_idx
 & 
mask
] :

708 (
ušt8_t
 *)&
m_log_d©a
.
bufãr
[0];

709 
ušt8_t
 
Ën0
 = 
¥aû0
 ? s·û0 : 
d©a_Ën
;

710 
ušt8_t
 * 
±r1
 = 
¥aû0
 ?

711 (
ušt8_t
 *)&
m_log_d©a
.
bufãr
[0] : 
NULL
;

712 
ušt8_t
 
Ën1
 = 
¥aû0
 ? 
d©a_Ën
 - space0 : 0;

714 
	`Äf_memobj_wr™e
(
p_msg_buf
, 
±r0
, 
Ën0
, 
memobj_off£t
);

715 
memobj_off£t
 +ğ
Ën0
;

716 ià(
±r1
)

718 
	`Äf_memobj_wr™e
(
p_msg_buf
, 
±r1
, 
Ën1
, 
memobj_off£t
);

723 
ušt8_t
 * 
p_d©a
 = (ušt8_ˆ*)&
m_log_d©a
.
bufãr
[
rd_idx
 & 
mask
];

724 
	`Äf_memobj_wr™e
(
p_msg_buf
, 
p_d©a
, 
d©a_Ën
, 
memobj_off£t
);

726 
rd_idx
 +ğ
	`CEIL_DIV
(
Üig_d©a_Ën
, 4);

729 ià(
h—d”
.
ba£
.
g’”ic
.
ty³
 =ğ
HEADER_TYPE_STD
)

731 
h—d”
.
ba£
.
¡d
.
Çrgs
 = 
	`MIN
(h—d”.ba£.¡d.Çrgs, 
NRF_LOG_MAX_NUM_OF_ARGS
);

732 
ušt32_t
 
msg_buf_size32
 = 
HEADER_SIZE
 + 
h—d”
.
ba£
.
¡d
.
Çrgs
;

733 
£v”™y
 = 
h—d”
.
ba£
.
¡d
.severity;

735 
p_msg_buf
 = 
	`Äf_memobj_®loc
(&
mempoŞ
, 
msg_buf_size32
*(
ušt32_t
));

737 ià(
p_msg_buf
)

739 
	`Äf_memobj_g‘
(
p_msg_buf
);

740 
	`Äf_memobj_wr™e
(
p_msg_buf
, &
h—d”
, 
HEADER_SIZE
*(
ušt32_t
), 
memobj_off£t
);

741 
memobj_off£t
 +ğ
HEADER_SIZE
*(
ušt32_t
);

743 
i
 = 0; i < 
h—d”
.
ba£
.
¡d
.
Çrgs
; i++)

745 
	`Äf_memobj_wr™e
(
p_msg_buf
, &
m_log_d©a
.
bufãr
[
rd_idx
++ & 
mask
],

746 (
ušt32_t
), 
memobj_off£t
);

747 
memobj_off£t
 +ğ(
ušt32_t
);

751 ià(
h—d”
.
ba£
.
g’”ic
.
ty³
 =ğ
HEADER_TYPE_INVALID
 && (
m_log_d©a
.
log_sk³d
 == 0))

756  
çl£
;

763 ià(
p_msg_buf
)

765 
Äf_log_back’d_t
 * 
p_back’d
 = 
m_log_d©a
.
p_back’d_h—d
;

766 ià(
NRF_LOG_ALLOW_OVERFLOW
 && 
m_log_d©a
.
log_sk³d
)

770 
	`Äf_memobj_put
(
p_msg_buf
);

774 
p_back’d
)

776 
boŞ
 
’Œy_acû±ed
 = 
çl£
;

777 ià(
	`Äf_log_back’d_is_’abËd
(
p_back’d
è=ğ
Œue
)

779 ià(
NRF_LOG_FILTERS_ENABLED
)

781 
ušt8_t
 
back’d_id
 = 
	`Äf_log_back’d_id_g‘
(
p_back’d
);

782 
ušt32_t
 
f‹r_lvls
 = 
	`NRF_LOG_DYNAMIC_SECTION_VARS_GET
(
h—d”
.
moduË_id
)->filter_lvls;

783 
ušt32_t
 
back’d_lvl
 = (
f‹r_lvls
 >> (
back’d_id
*
NRF_LOG_LEVEL_BITS
))

784 & 
NRF_LOG_LEVEL_MASK
;

785 ià(
back’d_lvl
 >ğ
£v”™y
)

787 
’Œy_acû±ed
 = 
Œue
;

792 ()
£v”™y
;

793 
’Œy_acû±ed
 = 
Œue
;

796 ià(
’Œy_acû±ed
)

798 
	`Äf_log_back’d_put
(
p_back’d
, 
p_msg_buf
);

800 
p_back’d
 =…_back’d->
p_Ãxt
;

803 
	`Äf_memobj_put
(
p_msg_buf
);

805 ià(
NRF_LOG_ALLOW_OVERFLOW
)

811 
	`CRITICAL_REGION_ENTER
();

812 ià(
m_log_d©a
.
log_sk³d
 == 0)

814 
m_log_d©a
.
rd_idx
 =„d_idx;

816 
	`CRITICAL_REGION_EXIT
();

820 
m_log_d©a
.
rd_idx
 =„d_idx;

825  
	`bufãr_is_em±y
(è? 
çl£
 : 
Œue
;

826 
	}
}

828 
št32_t
 
	$back’d_id_assign
()

830 
št32_t
 
ÿndid©e_id
;

831 
Äf_log_back’d_t
 * 
p_back’d
;

832 
boŞ
 
id_avaabË
;

833 
ÿndid©e_id
 = 0; cªdid©e_id < 
NRF_LOG_MAX_BACKENDS
; candidate_id++)

835 
p_back’d
 = 
m_log_d©a
.
p_back’d_h—d
;

836 
id_avaabË
 = 
Œue
;

837 
p_back’d
)

839 ià(
	`Äf_log_back’d_id_g‘
(
p_back’d
è=ğ
ÿndid©e_id
)

841 
id_avaabË
 = 
çl£
;

844 
p_back’d
 =…_back’d->
p_Ãxt
;

846 ià(
id_avaabË
)

848  
ÿndid©e_id
;

852 
	}
}

854 
št32_t
 
	$Äf_log_back’d_add
(
Äf_log_back’d_t
 * 
p_back’d
, 
Äf_log_£v”™y_t
 
£v”™y
)

856 
št32_t
 
id
 = 
	`back’d_id_assign
();

857 ià(
id
 == -1)

859  
id
;

862 
	`Äf_log_back’d_id_£t
(
p_back’d
, 
id
);

864 ià(
m_log_d©a
.
p_back’d_h—d
 =ğ
NULL
)

866 
m_log_d©a
.
p_back’d_h—d
 = 
p_back’d
;

867 
p_back’d
->
p_Ãxt
 = 
NULL
;

871 
p_back’d
->
p_Ãxt
 = 
m_log_d©a
.
p_back’d_h—d
->p_next;

872 
m_log_d©a
.
p_back’d_h—d
->
p_Ãxt
 = 
p_back’d
;

875 ià(
NRF_LOG_FILTERS_ENABLED
)

877 
ušt32_t
 
i
;

878 
i
 = 0; i < 
	`Äf_log_moduË_út_g‘
(); i++)

880 
Äf_log_£v”™y_t
 
budš_lvl
 = 
	`Äf_log_moduË_f‹r_g‘
(
id
, 
i
, 
çl£
, false);

881 
Äf_log_£v”™y_t
 
aùu®_£v”™y
 = 
	`MIN
(
budš_lvl
, 
£v”™y
);

882 
	`Äf_log_moduË_f‹r_£t
(
	`Äf_log_back’d_id_g‘
(
p_back’d
), 
i
, 
aùu®_£v”™y
);

886  
id
;

887 
	}
}

889 
	$Äf_log_back’d_»move
(
Äf_log_back’d_t
 * 
p_back’d
)

891 
Äf_log_back’d_t
 * 
p_cu¼
 = 
m_log_d©a
.
p_back’d_h—d
;

892 
Äf_log_back’d_t
 * 
p_´ev
 = 
NULL
;

893 
p_cu¼
 !ğ
p_back’d
)

895 
p_´ev
 = 
p_cu¼
;

896 
p_cu¼
 =…_cu¼->
p_Ãxt
;

899 ià(
p_´ev
)

901 
p_´ev
->
p_Ãxt
 = 
p_back’d
->p_next;

905 
m_log_d©a
.
p_back’d_h—d
 = 
NULL
;

907 
	}
}

909 
	$Äf_log_·nic
()

911 
Äf_log_back’d_t
 * 
p_back’d
 = 
m_log_d©a
.
p_back’d_h—d
;

912 
m_log_d©a
.
autoæush
 = 
Œue
;

913 
p_back’d
)

915 
	`Äf_log_back’d_’abË
(
p_back’d
);

916 
	`Äf_log_back’d_·nic_£t
(
p_back’d
);

917 
p_back’d
 =…_back’d->
p_Ãxt
;

919 
	}
}

921 #ià
NRF_LOG_CLI_CMDS


922 
	~"Äf_şi.h
"

924 cÚ¡ * 
	gm_£v”™y_lvls
[] = {

932 cÚ¡ * 
	gm_£v”™y_lvls_sÜ‹d
[] = {

940 
	$log_¡©us
(
Äf_şi_t
 cÚ¡ * 
p_şi
, 
size_t
 
¬gc
, **
¬gv
)

942 
ušt32_t
 
moduËs_út
 = 
	`Äf_log_moduË_út_g‘
();

943 
ušt32_t
 
back’d_id
 = 
p_şi
->
p_log_back’d
->
back’d
.
id
;

944 
ušt32_t
 
i
;

946 ià(!
	`Äf_log_back’d_is_’abËd
(&
p_şi
->
p_log_back’d
->
back’d
))

948 
	`Äf_şi_årštf
(
p_şi
, 
NRF_CLI_ERROR
, "Logs‡re halted!\r\n");

950 
	`Äf_şi_årštf
(
p_şi
, 
NRF_CLI_NORMAL
, "%-24s | current | buildin \r\n", "module_name");

951 
	`Äf_şi_årštf
(
p_şi
, 
NRF_CLI_NORMAL
, "------------------------------------------\r\n");

952 
i
 = 0; i < 
moduËs_út
; i++)

954 
Äf_log_£v”™y_t
 
moduË_dyÇmic_lvl
 = 
	`Äf_log_moduË_f‹r_g‘
(
back’d_id
, 
i
, 
Œue
,rue);

955 
Äf_log_£v”™y_t
 
moduË_comped_lvl
 = 
	`Äf_log_moduË_f‹r_g‘
(
back’d_id
, 
i
, 
Œue
, 
çl£
);

956 
Äf_log_£v”™y_t
 
aùu®_comped_lvl
 = 
	`MIN
(
moduË_comped_lvl
, (Äf_log_£v”™y_t)
NRF_LOG_DEFAULT_LEVEL
);

957 
	`Äf_şi_årštf
(
p_şi
, 
NRF_CLI_NORMAL
, "%-24s | %-7s | %s%s\r\n",

958 
	`Äf_log_moduË_Çme_g‘
(
i
, 
Œue
),

959 
m_£v”™y_lvls
[
moduË_dyÇmic_lvl
],

960 
m_£v”™y_lvls
[
aùu®_comped_lvl
],

961 
aùu®_comped_lvl
 < 
moduË_comped_lvl
 ? "*" : "");

963 
	}
}

965 
boŞ
 
	$moduË_id_g‘
(cÚ¡ * 
p_Çme
, 
ušt32_t
 * 
p_id
)

967 
ušt32_t
 
moduËs_út
 = 
	`Äf_log_moduË_út_g‘
();

968 cÚ¡ * 
p_tmp_Çme
;

969 
ušt32_t
 
j
;

970 
j
 = 0; j < 
moduËs_út
; j++)

972 
p_tmp_Çme
 = 
	`Äf_log_moduË_Çme_g‘
(
j
, 
çl£
);

973 ià(
	`¡ºcmp
(
p_tmp_Çme
, 
p_Çme
, 32) == 0)

975 *
p_id
 = 
j
;

979  (
j
 !ğ
moduËs_út
);

980 
	}
}

982 
boŞ
 
	$moduË_id_f‹r_£t
(
ušt32_t
 
back’d_id
,

983 
ušt32_t
 
moduË_id
,

984 
Äf_log_£v”™y_t
 
lvl
)

986 
Äf_log_£v”™y_t
 
budš_lvl
 = 
	`Äf_log_moduË_f‹r_g‘
(
back’d_id
, 
moduË_id
, 
çl£
, false);

987 ià(
lvl
 > 
budš_lvl
)

989  
çl£
;

993 
	`Äf_log_moduË_f‹r_£t
(
back’d_id
, 
moduË_id
, 
lvl
);

994  
Œue
;

996 
	}
}

998 
	$log_ù¾
(
Äf_şi_t
 cÚ¡ * 
p_şi
, 
size_t
 
¬gc
, **
¬gv
)

1000 
ušt32_t
 
back’d_id
 = 
p_şi
->
p_log_back’d
->
back’d
.
id
;

1001 
Äf_log_£v”™y_t
 
lvl
;

1002 
ušt32_t
 
fœ¡_m_Çme_idx
;

1003 
ušt32_t
 
i
;

1004 
boŞ
 
®l_moduËs
 = 
çl£
;

1006 ià(
¬gc
 > 0)

1008 ià(
	`¡ºcmp
(
¬gv
[0], "enable", 7) == 0)

1010 ià(
¬gc
 == 1)

1012 
	`Äf_şi_årštf
(
p_şi
, 
NRF_CLI_ERROR
, "Bad…arameter count.\r\n");

1016 ià(
¬gc
 == 2)

1018 
®l_moduËs
 = 
Œue
;

1021 
i
 = 0; i < 
	`ARRAY_SIZE
(
m_£v”™y_lvls
); i++)

1023 ià(
	`¡ºcmp
(
¬gv
[1], 
m_£v”™y_lvls
[
i
], 10) == 0)

1029 ià(
i
 =ğ
	`ARRAY_SIZE
(
m_£v”™y_lvls
))

1031 
	`Äf_şi_årštf
(
p_şi
, 
NRF_CLI_ERROR
, "UnknowÀ£v”™y†ev–: %s\r\n", 
¬gv
[1]);

1035 
lvl
 = (
Äf_log_£v”™y_t
)
i
;

1036 
fœ¡_m_Çme_idx
 = 2;

1039 ià(
	`¡ºcmp
(
¬gv
[0], "disable", 8) == 0)

1041 ià(
¬gc
 == 1)

1043 
®l_moduËs
 = 
Œue
;

1045 
lvl
 = 
NRF_LOG_SEVERITY_NONE
;

1046 
fœ¡_m_Çme_idx
 = 1;

1050 
	`Äf_şi_årštf
(
p_şi
, 
NRF_CLI_ERROR
, "UnknowÀİtiÚ: %s\r\n", 
¬gv
[0]);

1054 ià(
®l_moduËs
)

1056 
i
 = 0; i < 
	`Äf_log_moduË_út_g‘
(); i++)

1058 ià(
	`moduË_id_f‹r_£t
(
back’d_id
, 
i
, 
lvl
è=ğ
çl£
)

1060 
	`Äf_şi_årštf
(
p_şi
, 
NRF_CLI_ERROR
, "Lev– uÇvaabË fÜ moduË: %s\r\n", 
	`Äf_log_moduË_Çme_g‘
(
i
, 
çl£
));

1066 
i
 = 
fœ¡_m_Çme_idx
; i < 
¬gc
; i++)

1068 
ušt32_t
 
moduË_id
 = 0;

1069 ià(
	`moduË_id_g‘
(
¬gv
[
i
], &
moduË_id
è=ğ
çl£
)

1071 
	`Äf_şi_årštf
(
p_şi
, 
NRF_CLI_ERROR
, "UnknowÀmoduË:%s\r\n", 
¬gv
[
i
]);

1074 ià(
	`moduË_id_f‹r_£t
(
back’d_id
, 
moduË_id
, 
lvl
è=ğ
çl£
)

1076 
	`Äf_şi_årštf
(
p_şi
, 
NRF_CLI_ERROR
, "Lev– uÇvaabË fÜ moduË: %s\r\n", 
	`Äf_log_moduË_Çme_g‘
(
moduË_id
, 
çl£
));

1081 
	}
}

1082 
moduË_Çme_g‘
(
size_t
 
idx
, 
Äf_şi_¡©ic_’Œy_t
 * 
p_¡©ic
);

1084 
NRF_CLI_CREATE_DYNAMIC_CMD
(
m_moduË_Çme
, 
moduË_Çme_g‘
);

1086 
	$moduË_Çme_g‘
(
size_t
 
idx
, 
Äf_şi_¡©ic_’Œy_t
 * 
p_¡©ic
)

1088 
p_¡©ic
->
hªdËr
 = 
NULL
;

1089 
p_¡©ic
->
p_h–p
 = 
NULL
;

1090 
p_¡©ic
->
p_subcmd
 = &
m_moduË_Çme
;

1091 
p_¡©ic
->
p_syÁax
 = 
	`Äf_log_moduË_Çme_g‘
(
idx
, 
Œue
);

1092 
	}
}

1094 
	$£v”™y_lvl_g‘
(
size_t
 
idx
, 
Äf_şi_¡©ic_’Œy_t
 * 
p_¡©ic
)

1096 
p_¡©ic
->
hªdËr
 = 
NULL
;

1097 
p_¡©ic
->
p_h–p
 = 
NULL
;

1098 
p_¡©ic
->
p_subcmd
 = &
m_moduË_Çme
;

1099 
p_¡©ic
->
p_syÁax
 = (
idx
 < 
	`ARRAY_SIZE
(
m_£v”™y_lvls_sÜ‹d
)) ?

1100 
m_£v”™y_lvls_sÜ‹d
[
idx
] : 
NULL
;

1101 
	}
}

1103 
NRF_CLI_CREATE_DYNAMIC_CMD
(
m_£v”™y_lvl
, 
£v”™y_lvl_g‘
);

1105 
	$log_h®t
(
Äf_şi_t
 cÚ¡ * 
p_şi
, 
size_t
 
¬gc
, **
¬gv
)

1107 
	`Äf_log_back’d_di§bË
(&
p_şi
->
p_log_back’d
->
back’d
);

1108 
	}
}

1110 
	$log_go
(
Äf_şi_t
 cÚ¡ * 
p_şi
, 
size_t
 
¬gc
, **
¬gv
)

1112 
	`Äf_log_back’d_’abË
(&
p_şi
->
p_log_back’d
->
back’d
);

1113 
	}
}

1115 
	$NRF_CLI_CREATE_STATIC_SUBCMD_SET
(
m_sub_log_¡©
)

1117 
	`NRF_CLI_CMD
(
di§bË
, &
m_moduË_Çme
,

1120 
log_ù¾
),

1121 
	`NRF_CLI_CMD
(
’abË
, &
m_£v”™y_lvl
,

1124 
log_ù¾
),

1125 
	`NRF_CLI_CMD
(
go
, 
NULL
, "Resumloggšg", 
log_go
),

1126 
	`NRF_CLI_CMD
(
h®t
, 
NULL
, "H®ˆloggšg", 
log_h®t
),

1127 
	`NRF_CLI_CMD
(
¡©us
, 
NULL
, "Logg” stus", 
log_¡©us
),

1128 
NRF_CLI_SUBCMD_SET_END


1129 
	}
};

1131 
	$log_cmd
(
Äf_şi_t
 cÚ¡ * 
p_şi
, 
size_t
 
¬gc
, **
¬gv
)

1133 ià((
¬gc
 =ğ1è|| 
	`Äf_şi_h–p_»que¡ed
(
p_şi
))

1135 
	`Äf_şi_h–p_´št
(
p_şi
, 
NULL
, 0);

1139 
	`Äf_şi_årštf
(
p_şi
, 
NRF_CLI_ERROR
, "%s:%s%s\r\n", 
¬gv
[0], " unknown…arameter: ",‡rgv[1]);

1140 
	}
}

1142 
NRF_CLI_CMD_REGISTER
(
log
, &
m_sub_log_¡©
, "Commªd fÜ cÚŒŞlšg†ogg”", 
log_cmd
);

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_log\src\nrf_log_str_formatter.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
NRF_LOG
)

42 
	~"Äf_log_¡r_fÜm©‹r.h
"

43 
	~"Äf_log_š‹º®.h
"

44 
	~"Äf_log_ù¾.h
"

45 
	~"Äf_årštf.h
"

46 
	~<ùy³.h
>

48 
	#NRF_LOG_COLOR_CODE_DEFAULT
 "\x1B[0m"

	)

49 
	#NRF_LOG_COLOR_CODE_BLACK
 "\x1B[1;30m"

	)

50 
	#NRF_LOG_COLOR_CODE_RED
 "\x1B[1;31m"

	)

51 
	#NRF_LOG_COLOR_CODE_GREEN
 "\x1B[1;32m"

	)

52 
	#NRF_LOG_COLOR_CODE_YELLOW
 "\x1B[1;33m"

	)

53 
	#NRF_LOG_COLOR_CODE_BLUE
 "\x1B[1;34m"

	)

54 
	#NRF_LOG_COLOR_CODE_MAGENTA
 "\x1B[1;35m"

	)

55 
	#NRF_LOG_COLOR_CODE_CYAN
 "\x1B[1;36m"

	)

56 
	#NRF_LOG_COLOR_CODE_WHITE
 "\x1B[1;37m"

	)

58 cÚ¡ * 
	g£v”™y_Çmes
[] = {

59 
NULL
,

66 cÚ¡ * 
	gm_cŞÜs
[] = {

67 
NRF_LOG_COLOR_CODE_DEFAULT
,

68 
NRF_LOG_COLOR_CODE_BLACK
,

69 
NRF_LOG_COLOR_CODE_RED
,

70 
NRF_LOG_COLOR_CODE_GREEN
,

71 
NRF_LOG_COLOR_CODE_YELLOW
,

72 
NRF_LOG_COLOR_CODE_BLUE
,

73 
NRF_LOG_COLOR_CODE_MAGENTA
,

74 
NRF_LOG_COLOR_CODE_CYAN
,

75 
NRF_LOG_COLOR_CODE_WHITE
,

78 
	$´efix_´oûss
(
Äf_log_¡r_fÜm©‹r_’Œy_·¿ms_t
 * 
p_·¿ms
,

79 
Äf_årštf_ùx_t
 * 
p_ùx
)

81 ià(!(
p_·¿ms
->
¿w
))

83 ià(
p_·¿ms
->
u£_cŞÜs
)

85 
	`Äf_årštf
(
p_ùx
, "%s",

86 
m_cŞÜs
[
	`Äf_log_cŞÜ_id_g‘
Ğ
p_·¿ms
->
moduË_id
,…_·¿ms->
£v”™y
)]);

89 ià(
NRF_LOG_USES_TIMESTAMP
)

91 
	`Äf_årštf
(
p_ùx
, "[%08lu] ", 
p_·¿ms
->
time¡amp
);

94 
	`Äf_årštf
(
p_ùx
, "<%s> %s: ",

95 
£v”™y_Çmes
[
p_·¿ms
->
£v”™y
], 
	`Äf_log_moduË_Çme_g‘
Õ_·¿ms->
moduË_id
, 
çl£
));

97 
	}
}

99 
	$po¡fix_´oûss
(
Äf_log_¡r_fÜm©‹r_’Œy_·¿ms_t
 * 
p_·¿ms
,

100 
Äf_årštf_ùx_t
 * 
p_ùx
,

101 
boŞ
 
Ãwlše
)

103 ià(!
p_·¿ms
->
¿w
)

105 ià(
p_·¿ms
->
u£_cŞÜs
)

107 
	`Äf_årštf
(
p_ùx
, "%s", 
m_cŞÜs
[0]);

109 
	`Äf_årštf
(
p_ùx
, "\r\n");

111 ià(
Ãwlše
)

113 
	`Äf_årštf
(
p_ùx
, "\r\n");

115 
	`Äf_årštf_bufãr_æush
(
p_ùx
);

116 
	}
}

118 
	$Äf_log_¡d_’Œy_´oûss
(cÚ¡ * 
p_¡r
,

119 
ušt32_t
 cÚ¡ * 
p_¬gs
,

120 
ušt32_t
 
Çrgs
,

121 
Äf_log_¡r_fÜm©‹r_’Œy_·¿ms_t
 * 
p_·¿ms
,

122 
Äf_årštf_ùx_t
 * 
p_ùx
)

124 
boŞ
 
auto_æush
 = 
p_ùx
->auto_flush;

125 
p_ùx
->
auto_æush
 = 
çl£
;

127 
	`´efix_´oûss
(
p_·¿ms
, 
p_ùx
);

129 
Çrgs
)

132 
	`Äf_årštf
(
p_ùx
, 
p_¡r
);

135 
	`Äf_årštf
(
p_ùx
, 
p_¡r
, 
p_¬gs
[0]);

138 
	`Äf_årštf
(
p_ùx
, 
p_¡r
, 
p_¬gs
[0],…_args[1]);

141 
	`Äf_årštf
(
p_ùx
, 
p_¡r
, 
p_¬gs
[0],…_args[1],…_args[2]);

144 
	`Äf_årštf
(
p_ùx
, 
p_¡r
, 
p_¬gs
[0],…_args[1],…_args[2],…_args[3]);

147 
	`Äf_årštf
(
p_ùx
, 
p_¡r
, 
p_¬gs
[0],…_args[1],…_args[2],…_args[3],…_args[4]);

150 
	`Äf_årštf
(
p_ùx
, 
p_¡r
, 
p_¬gs
[0],…_args[1],…_args[2],…_args[3],…_args[4],…_args[5]);

157 
	`po¡fix_´oûss
(
p_·¿ms
, 
p_ùx
, 
çl£
);

158 
p_ùx
->
auto_æush
 =‡uto_flush;

159 
	}
}

161 
	#HEXDUMP_BYTES_IN_LINE
 8

	)

163 
	$Äf_log_hexdump_’Œy_´oûss
(
ušt8_t
 * 
p_d©a
,

164 
ušt32_t
 
d©a_Ën
,

165 
Äf_log_¡r_fÜm©‹r_’Œy_·¿ms_t
 * 
p_·¿ms
,

166 
Äf_årštf_ùx_t
 * 
p_ùx
)

168 ià(
d©a_Ën
 > 
HEXDUMP_BYTES_IN_LINE
)

172 
boŞ
 
auto_æush
 = 
p_ùx
->auto_flush;

173 
p_ùx
->
auto_æush
 = 
çl£
;

175 
	`´efix_´oûss
(
p_·¿ms
, 
p_ùx
);

177 
ušt32_t
 
i
;

179 
i
 = 0; i < 
HEXDUMP_BYTES_IN_LINE
; i++)

181 ià(
i
 < 
d©a_Ën
)

183 
	`Äf_årštf
(
p_ùx
, " %02x", 
p_d©a
[
i
]);

187 
	`Äf_årštf
(
p_ùx
, " ");

190 
	`Äf_årštf
(
p_ùx
, "|");

192 
i
 = 0; i < 
HEXDUMP_BYTES_IN_LINE
; i++)

194 ià(
i
 < 
d©a_Ën
)

196 
c
 = ()
p_d©a
[
i
];

197 
	`Äf_årštf
(
p_ùx
, "%c", 
	`i¥ršt
(()
c
) ? c :'.');

201 
	`Äf_årštf
(
p_ùx
, " ");

205 
	`po¡fix_´oûss
(
p_·¿ms
, 
p_ùx
, 
Œue
);

207 
p_ùx
->
auto_æush
 =‡uto_flush;

208 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_memobj\nrf_memobj.c

41 
	~"Äf_memobj.h
"

42 
	~"Äf_©omic.h
"

43 
	~"Äf_as£¹.h
"

45 
memobj_–em_s
 
	tmemobj_–em_t
;

49 
memobj_–em_t
 * 
	mp_Ãxt
;

50 } 
	tmemobj_h—d”_t
;

54 
ušt8_t
 
	mu£r_út
;

55 
ušt8_t
 
	mchunk_út
;

56 
ušt16_t
 
	mchunk_size
;

57 } 
	tmemobj_h—d_h—d”_f›lds_t
;

63 
Äf_©omic_u32_t
 
	m©omic_u£r_út
;

64 
memobj_h—d_h—d”_f›lds_t
 
	mf›lds
;

65 } 
	md©a
;

66 } 
	tmemobj_h—d_h—d”_t
;

70 
memobj_h—d”_t
 
	mh—d”
;

71 
memobj_h—d_h—d”_t
 
	mh—d_h—d”
;

72 
ušt8_t
 
	md©a
[1];

73 } 
	tmemobj_h—d_t
;

75 
STATIC_ASSERT
((
memobj_h—d”_t
è=ğ
NRF_MEMOBJ_STD_HEADER_SIZE
);

77 
	smemobj_–em_s


79 
memobj_h—d”_t
 
	mh—d”
;

80 
ušt8_t
 
	md©a
[1];

83 
»t_code_t
 
	$Äf_memobj_poŞ_š™
(
Äf_memobj_poŞ_t
 cÚ¡ * 
p_poŞ
)

85  
	`Äf_b®loc_š™
((
Äf_b®loc_t
 cÚ¡ *)
p_poŞ
);

86 
	}
}

88 
Äf_memobj_t
 * 
	$Äf_memobj_®loc
(
Äf_memobj_poŞ_t
 cÚ¡ * 
p_poŞ
,

89 
size_t
 
size
)

91 
ušt32_t
 
bsize
 = (ušt32_t)
	`NRF_BALLOC_ELEMENT_SIZE
((
Äf_b®loc_t
 cÚ¡ *)
p_poŞ
è- (
memobj_h—d”_t
);

92 
ušt8_t
 
num_of_chunks
 = (ušt8_t)
	`CEIL_DIV
(
size
 + (
memobj_h—d_h—d”_t
), 
bsize
);

94 
memobj_h—d_t
 * 
p_h—d
 = 
	`Äf_b®loc_®loc
((
Äf_b®loc_t
 cÚ¡ *)
p_poŞ
);

95 ià(
p_h—d
 =ğ
NULL
)

97  
NULL
;

99 
p_h—d
->
h—d_h—d”
.
d©a
.
f›lds
.
u£r_út
 = 0;

100 
p_h—d
->
h—d_h—d”
.
d©a
.
f›lds
.
chunk_út
 = 1;

101 
p_h—d
->
h—d_h—d”
.
d©a
.
f›lds
.
chunk_size
 = 
bsize
;

103 
memobj_h—d”_t
 * 
p_´ev
 = (memobj_h—d”_ˆ*)
p_h—d
;

104 
memobj_h—d”_t
 * 
p_cu¼
;

105 
ušt32_t
 
i
;

106 
ušt32_t
 
chunk_Ëss1
 = (ušt32_t)
num_of_chunks
 - 1;

108 
p_´ev
->
p_Ãxt
 = (
memobj_–em_t
 *)
p_poŞ
;

109 
i
 = 0; i < 
chunk_Ëss1
; i++)

111 
p_cu¼
 = (
memobj_h—d”_t
 *)
	`Äf_b®loc_®loc
((
Äf_b®loc_t
 cÚ¡ *)
p_poŞ
);

112 ià(
p_cu¼
)

114 (
p_h—d
->
h—d_h—d”
.
d©a
.
f›lds
.
chunk_út
)++;

115 
p_´ev
->
p_Ãxt
 = (
memobj_–em_t
 *)
p_cu¼
;

116 
p_cu¼
->
p_Ãxt
 = (
memobj_–em_t
 *)
p_poŞ
;

117 
p_´ev
 = 
p_cu¼
;

122 
	`Äf_memobj_ä“
((
Äf_memobj_t
 *)
p_h—d
);

123  
NULL
;

126  (
Äf_memobj_t
 *)
p_h—d
;

127 
	}
}

129 
	$Äf_memobj_ä“
(
Äf_memobj_t
 * 
p_obj
)

131 
memobj_h—d_t
 * 
p_h—d
 = (memobj_h—d_ˆ*)
p_obj
;

132 
ušt8_t
 
chunk_út
 = 
p_h—d
->
h—d_h—d”
.
d©a
.
f›lds
.chunk_cnt;

133 
ušt32_t
 
i
;

134 
memobj_h—d”_t
 * 
p_cu¼
 = (memobj_h—d”_ˆ*)
p_obj
;

135 
memobj_h—d”_t
 * 
p_Ãxt
;

136 
ušt32_t
 
chunk_Ëss1
 = (ušt32_t)
chunk_út
 - 1;

138 
i
 = 0; i < 
chunk_Ëss1
; i++)

140 
p_cu¼
 = (
memobj_h—d”_t
 *í_cu¼->
p_Ãxt
;

142 
Äf_b®loc_t
 cÚ¡ * 
p_poŞ2
 = (Äf_b®loc_ˆcÚ¡ *)
p_cu¼
->
p_Ãxt
;

144 
p_cu¼
 = (
memobj_h—d”_t
 *)
p_obj
;

145 
i
 = 0; i < 
chunk_út
; i++)

147 
p_Ãxt
 = (
memobj_h—d”_t
 *)
p_cu¼
->p_next;

148 
	`Äf_b®loc_ä“
(
p_poŞ2
, 
p_cu¼
);

149 
p_cu¼
 = 
p_Ãxt
;

151 
	}
}

153 
	$Äf_memobj_g‘
(
Äf_memobj_t
 cÚ¡ * 
p_obj
)

155 
memobj_h—d_t
 * 
p_h—d
 = (memobj_h—d_ˆ*)
p_obj
;

156 ()
	`Äf_©omic_u32_add
(&
p_h—d
->
h—d_h—d”
.
d©a
.
©omic_u£r_út
, 1);

157 
	}
}

159 
	$Äf_memobj_put
(
Äf_memobj_t
 * 
p_obj
)

161 
memobj_h—d_t
 * 
p_h—d
 = (memobj_h—d_ˆ*)
p_obj
;

162 
ušt32_t
 
u£r_út
 = 
	`Äf_©omic_u32_sub
(&
p_h—d
->
h—d_h—d”
.
d©a
.
©omic_u£r_út
, 1);

163 
memobj_h—d_h—d”_f›lds_t
 * 
p_f›lds
 = (memobj_h—d_h—d”_f›lds_ˆ*)&
u£r_út
;

164 ià(
p_f›lds
->
u£r_út
 == 0)

166 
	`Äf_memobj_ä“
(
p_obj
);

168 
	}
}

170 
	$memobj_İ
(
Äf_memobj_t
 * 
p_obj
,

171 * 
p_d©a
,

172 
ušt32_t
 
Ën
,

173 
ušt32_t
 
off£t
,

174 
boŞ
 
»ad
)

177 
memobj_h—d_t
 * 
p_h—d
 = (memobj_h—d_ˆ*)
p_obj
;

178 
ušt32_t
 
¥aû_š_chunk
 = 
p_h—d
->
h—d_h—d”
.
d©a
.
f›lds
.
chunk_size
;

179 
memobj_–em_t
 * 
p_cu¼_chunk
 = (memobj_–em_ˆ*)
p_obj
;

180 
ušt32_t
 
chunk_idx
 = (
off£t
 + (
memobj_h—d_h—d”_f›lds_t
))/
¥aû_š_chunk
;

181 
ušt32_t
 
chunk_off£t
 = (
off£t
 + (
memobj_h—d_h—d”_f›lds_t
)è% 
¥aû_š_chunk
;

183 
ušt8_t
 
chunks_ex³ùed
 = 
	`CEIL_DIV
((
off£t
 + (
memobj_h—d_h—d”_f›lds_t
è+ 
Ën
),

184 
¥aû_š_chunk
);

185 
	`UNUSED_VARIABLE
(
chunks_ex³ùed
);

186 
	`ASSERT
(
p_h—d
->
h—d_h—d”
.
d©a
.
f›lds
.
chunk_út
 >ğ
chunks_ex³ùed
);

188 
chunk_idx
 > 0)

190 
p_cu¼_chunk
 =…_cu¼_chunk->
h—d”
.
p_Ãxt
;

191 
chunk_idx
--;

194 
ušt32_t
 
¤c_off£t
 = 0;

195 
ušt32_t
 
cu¼_ıy_size
 = 
¥aû_š_chunk
-
chunk_off£t
;

196 
cu¼_ıy_size
 = cu¼_ıy_siz> 
Ën
 ?†en : curr_cpy_size;

198 
Ën
)

200 ià(
»ad
)

202 
	`memıy
(&((
ušt8_t
 *)
p_d©a
)[
¤c_off£t
], &
p_cu¼_chunk
->
d©a
[
chunk_off£t
], 
cu¼_ıy_size
);

206 
	`memıy
(&
p_cu¼_chunk
->
d©a
[
chunk_off£t
], &((
ušt8_t
 *)
p_d©a
)[
¤c_off£t
], 
cu¼_ıy_size
);

208 
chunk_off£t
 = 0;

209 
p_cu¼_chunk
 =…_cu¼_chunk->
h—d”
.
p_Ãxt
;

210 
Ën
 -ğ
cu¼_ıy_size
;

211 
¤c_off£t
 +ğ
cu¼_ıy_size
;

212 
cu¼_ıy_size
 = (
¥aû_š_chunk
 > 
Ën
) ?†en : space_in_chunk;

214 
	}
}

216 
	$Äf_memobj_wr™e
(
Äf_memobj_t
 * 
p_obj
,

217 * 
p_d©a
,

218 
ušt32_t
 
Ën
,

219 
ušt32_t
 
off£t
)

222 
	`memobj_İ
(
p_obj
, 
p_d©a
, 
Ën
, 
off£t
, 
çl£
);

223 
	}
}

225 
	$Äf_memobj_»ad
(
Äf_memobj_t
 * 
p_obj
,

226 * 
p_d©a
,

227 
ušt32_t
 
Ën
,

228 
ušt32_t
 
off£t
)

230 
	`memobj_İ
(
p_obj
, 
p_d©a
, 
Ën
, 
off£t
, 
Œue
);

231 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_section_vars\nrf_section_iter.c

41 
	~"sdk_commÚ.h
"

43 #ià
NRF_MODULE_ENABLED
(
NRF_SECTION_ITER
)

45 
	~"Äf_£ùiÚ_™”.h
"

48 #ià!
defšed
(
__GNUC__
)

49 
	$Äf_£ùiÚ_™”_™em_£t
(
Äf_£ùiÚ_™”_t
 * 
p_™”
)

51 
	`ASSERT
(
p_™”
 !ğ
NULL
);

52 
	`ASSERT
(
p_™”
->
p_£t
 !ğ
NULL
);

53 
	`ASSERT
(
p_™”
->
p_£ùiÚ
 !ğ
NULL
);

55 
Œue
)

57 ià(
p_™”
->
p_£ùiÚ
 =ğp_™”->
p_£t
->
p_Ï¡
)

60 
p_™”
->
p_™em
 = 
NULL
;

64 ià(
p_™”
->
p_£ùiÚ
->
p_¡¬t
 !ğp_™”->p_£ùiÚ->
p_’d
)

67 
p_™”
->
p_™em
 =…_™”->
p_£ùiÚ
->
p_¡¬t
;

72 
p_™”
->
p_£ùiÚ
++;

74 
	}
}

78 
	$Äf_£ùiÚ_™”_š™
(
Äf_£ùiÚ_™”_t
 * 
p_™”
, 
Äf_£ùiÚ_£t_t
 cÚ¡ * 
p_£t
)

80 
	`ASSERT
(
p_™”
 !ğ
NULL
);

81 
	`ASSERT
(
p_£t
 !ğ
NULL
);

83 
p_™”
->
p_£t
 =…_set;

85 #ià
	`defšed
(
__GNUC__
)

86 
p_™”
->
p_™em
 =…_™”->
p_£t
->
£ùiÚ
.
p_¡¬t
;

87 ià(
p_™”
->
p_™em
 =ğp_™”->
p_£t
->
£ùiÚ
.
p_’d
)

89 
p_™”
->
p_™em
 = 
NULL
;

92 
p_™”
->
p_£ùiÚ
 = 
p_£t
->
p_fœ¡
;

93 
	`Äf_£ùiÚ_™”_™em_£t
(
p_™”
);

95 
	}
}

97 
	$Äf_£ùiÚ_™”_Ãxt
(
Äf_£ùiÚ_™”_t
 * 
p_™”
)

99 
	`ASSERT
(
p_™”
 !ğ
NULL
);

100 
	`ASSERT
(
p_™”
->
p_£t
 !ğ
NULL
);

102 ià(
p_™”
->
p_™em
 =ğ
NULL
)

107 
p_™”
->
p_™em
 = (*)((
size_t
)Õ_™”->p_™emè+…_™”->
p_£t
->
™em_size
);

109 #ià
	`defšed
(
__GNUC__
)

110 ià(
p_™”
->
p_™em
 =ğp_™”->
p_£t
->
£ùiÚ
.
p_’d
)

112 
p_™”
->
p_™em
 = 
NULL
;

115 
	`ASSERT
(
p_™”
->
p_£ùiÚ
 !ğ
NULL
);

117 ià(
p_™”
->
p_™em
 =ğp_™”->
p_£ùiÚ
->
p_’d
)

119 
p_™”
->
p_£ùiÚ
++;

120 
	`Äf_£ùiÚ_™”_™em_£t
(
p_™”
);

123 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\fds\fds.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
FDS
)

42 
	~"fds.h
"

43 
	~"fds_š‹º®_defs.h
"

45 
	~<¡dšt.h
>

46 
	~<¡ršg.h
>

47 
	~<¡dboŞ.h
>

48 
	~"Äf_”rÜ.h
"

49 
	~"Äf_©omic.h
"

50 
	~"Äf_©fifo.h
"

52 
	~"Äf_f¡Üage.h
"

53 #ià(
FDS_BACKEND
 =ğ
NRF_FSTORAGE_SD
)

54 
	~"Äf_f¡Üage_sd.h
"

55 #–ià(
FDS_BACKEND
 =ğ
NRF_FSTORAGE_NVMC
)

56 
	~"Äf_f¡Üage_nvmc.h
"

58 #”rÜ 
Inv®id
 
FDS
 
back’d
.

61 #ià(
FDS_CRC_CHECK_ON_READ
)

62 
	~"üc16.h
"

66 
fs_ev’t_hªdËr
(
Äf_f¡Üage_evt_t
 * 
evt
);

68 
NRF_FSTORAGE_DEF
(
Äf_f¡Üage_t
 
m_fs
) =

71 .
evt_hªdËr
 = 
fs_ev’t_hªdËr
,

77 
boŞ
 vŞ©
	mš™Ÿlized
;

78 
Äf_©omic_æag_t
 
	mš™Ÿlizšg
;

79 } 
	gm_æags
;

83 
Äf_©omic_u32_t
 
	gm_queued_İ_út
;

86 
Äf_©omic_u32_t
 
	gm_u£rs
;

87 
fds_cb_t
 
	gm_cb_bË
[
FDS_MAX_USERS
];

90 
Äf_©omic_u32_t
 
	gm_Ï‹¡_»c_id
;

93 
NRF_ATFIFO_DEF
(
m_queue
, 
fds_İ_t
, 
FDS_OP_QUEUE_SIZE
);

96 
fds_·ge_t
 
	gm_·ges
[
FDS_DATA_PAGES
];

97 
fds_sw­_·ge_t
 
	gm_sw­_·ge
;

100 
fds_gc_d©a_t
 
	gm_gc
;

103 
	$ev’t_£nd
(
fds_evt_t
 cÚ¡ * cÚ¡ 
p_evt
)

105 
ušt32_t
 
u£r
 = 0; u£¸< 
FDS_MAX_USERS
; user++)

107 ià(
m_cb_bË
[
u£r
] !ğ
NULL
)

109 
m_cb_bË
[
u£r
](
p_evt
);

112 
	}
}

115 
	$ev’t_´•¬e
(
fds_İ_t
 cÚ¡ * cÚ¡ 
p_İ
, 
fds_evt_t
 * cÚ¡ 
p_evt
)

117 
p_İ
->
İ_code
)

119 
FDS_OP_INIT
:

120 
p_evt
->
id
 = 
FDS_EVT_INIT
;

123 
FDS_OP_WRITE
:

124 
p_evt
->
id
 = 
FDS_EVT_WRITE
;

125 
p_evt
->
wr™e
.
fe_id
 = 
p_İ
->wr™e.
h—d”
.file_id;

126 
p_evt
->
wr™e
.
»cÜd_key
 = 
p_İ
->wr™e.
h—d”
.record_key;

127 
p_evt
->
wr™e
.
»cÜd_id
 = 
p_İ
->wr™e.
h—d”
.record_id;

128 
p_evt
->
wr™e
.
is_»cÜd_upd©ed
 = 0;

131 
FDS_OP_UPDATE
:

132 
p_evt
->
id
 = 
FDS_EVT_UPDATE
;

133 
p_evt
->
wr™e
.
fe_id
 = 
p_İ
->wr™e.
h—d”
.file_id;

134 
p_evt
->
wr™e
.
»cÜd_key
 = 
p_İ
->wr™e.
h—d”
.record_key;

135 
p_evt
->
wr™e
.
»cÜd_id
 = 
p_İ
->wr™e.
h—d”
.record_id;

136 
p_evt
->
wr™e
.
is_»cÜd_upd©ed
 = (
p_İ
->wr™e.
¡•
 =ğ
FDS_OP_WRITE_DONE
);

139 
FDS_OP_DEL_RECORD
:

140 
p_evt
->
id
 = 
FDS_EVT_DEL_RECORD
;

141 
p_evt
->
d–
.
fe_id
 = 
p_İ
->del.file_id;

142 
p_evt
->
d–
.
»cÜd_key
 = 
p_İ
->del.record_key;

143 
p_evt
->
d–
.
»cÜd_id
 = 
p_İ
->d–.
»cÜd_to_d–‘e
;

146 
FDS_OP_DEL_FILE
:

147 
p_evt
->
id
 = 
FDS_EVT_DEL_FILE
;

148 
p_evt
->
d–
.
fe_id
 = 
p_İ
->del.file_id;

149 
p_evt
->
d–
.
»cÜd_key
 = 
FDS_RECORD_KEY_DIRTY
;

150 
p_evt
->
d–
.
»cÜd_id
 = 0;

153 
FDS_OP_GC
:

154 
p_evt
->
id
 = 
FDS_EVT_GC
;

161 
	}
}

164 
boŞ
 
	$h—d”_has_Ãxt
(
fds_h—d”_t
 cÚ¡ * 
p_hdr
, 
ušt32_t
 cÚ¡ * 
p_·ge_’d
)

166 
ušt32_t
 cÚ¡ * cÚ¡ 
p_hdr32
 = (ušt32_t*)
p_hdr
;

167  ( ( 
p_hdr32
 < 
p_·ge_’d
)

168 && (*
p_hdr32
 !ğ
FDS_ERASED_WORD
));

169 
	}
}

173 
fds_h—d”_t
 cÚ¡ * 
	$h—d”_jump
(
fds_h—d”_t
 cÚ¡ * cÚ¡ 
p_hdr
)

175  (
fds_h—d”_t
*)((
ušt32_t
*)
p_hdr
 + 
FDS_HEADER_SIZE
 +…_hdr->
Ëngth_wÜds
);

176 
	}
}

179 
fds_h—d”_¡©us_t
 
	$h—d”_check
(
fds_h—d”_t
 cÚ¡ * 
p_hdr
, 
ušt32_t
 cÚ¡ * 
p_·ge_’d
)

181 ià(((
ušt32_t
*)
	`h—d”_jump
(
p_hdr
è> 
p_·ge_’d
))

185  
FDS_HEADER_CORRUPT
;

188 iàĞ(
p_hdr
->
fe_id
 =ğ
FDS_FILE_ID_INVALID
)

189 || (
p_hdr
->
»cÜd_key
 =ğ
FDS_RECORD_KEY_DIRTY
))

191  
FDS_HEADER_DIRTY
;

194  
FDS_HEADER_VALID
;

195 
	}
}

198 
boŞ
 
	$add»ss_is_v®id
(
ušt32_t
 cÚ¡ * cÚ¡ 
p_addr
)

200  ((
p_addr
 !ğ
NULL
) &&

201 (
p_addr
 >ğ(
ušt32_t
*)
m_fs
.
¡¬t_addr
) &&

202 (
p_addr
 <ğ(
ušt32_t
*)
m_fs
.
’d_addr
) &&

203 (
	`is_wÜd_®igÃd
(
p_addr
)));

204 
	}
}

208 
fds_·ge_ty³_t
 
	$·ge_id’tify
(
ušt32_t
 cÚ¡ * cÚ¡ 
p_·ge_addr
)

210 iàĞ(
p_·ge_addr
 =ğ
NULL
)

211 || (
p_·ge_addr
[
FDS_PAGE_TAG_WORD_0
] !ğ
FDS_PAGE_TAG_MAGIC
))

213  
FDS_PAGE_UNDEFINED
;

216 
p_·ge_addr
[
FDS_PAGE_TAG_WORD_1
])

218 
FDS_PAGE_TAG_SWAP
:

219  
FDS_PAGE_SWAP
;

221 
FDS_PAGE_TAG_DATA
:

222  
FDS_PAGE_DATA
;

225  
FDS_PAGE_UNDEFINED
;

227 
	}
}

230 
boŞ
 
	$·ge_is_”a£d
(
ušt32_t
 cÚ¡ * cÚ¡ 
p_·ge_addr
)

232 
ušt32_t
 
i
 = 0; i < 
FDS_PAGE_SIZE
; i++)

234 ià(*(
p_·ge_addr
 + 
i
è!ğ
FDS_ERASED_WORD
)

236  
çl£
;

240  
Œue
;

241 
	}
}

245 
boŞ
 
	$·ge_has_¥aû
(
ušt16_t
 
·ge
, ušt16_ˆ
Ëngth_wÜds
)

247 
Ëngth_wÜds
 +ğ
m_·ges
[
·ge
].
wr™e_off£t
;

248 
Ëngth_wÜds
 +ğ
m_·ges
[
·ge
].
wÜds_»£rved
;

249  (
Ëngth_wÜds
 < 
FDS_PAGE_SIZE
);

250 
	}
}

255 
»t_code_t
 
	$·ge_äom_»cÜd
(
ušt16_t
 * cÚ¡ 
p_·ge
, 
ušt32_t
 cÚ¡ * cÚ¡ 
p_»c
)

257 
»t_code_t
 
»t
 = 
FDS_ERR_NOT_FOUND
;

259 
	`CRITICAL_SECTION_ENTER
();

260 
ušt16_t
 
i
 = 0; i < 
FDS_DATA_PAGES
; i++)

262 ià((
p_»c
 > 
m_·ges
[
i
].
p_addr
) &&

263 (
p_»c
 < 
m_·ges
[
i
].
p_addr
 + 
FDS_PAGE_SIZE
))

265 
»t
 = 
FDS_SUCCESS
;

266 *
p_·ge
 = 
i
;

270 
	`CRITICAL_SECTION_EXIT
();

272  
»t
;

273 
	}
}

280 
	$·ge_sÿn
(
ušt32_t
 cÚ¡ * 
p_addr
,

281 
ušt16_t
 * cÚ¡ 
wÜds_wr™‹n
,

282 
boŞ
 * cÚ¡ 
ÿn_gc
)

284 
ušt32_t
 cÚ¡ * cÚ¡ 
p_·ge_’d
 = 
p_addr
 + 
FDS_PAGE_SIZE
;

286 
p_addr
 +ğ
FDS_PAGE_TAG_SIZE
;

287 *
wÜds_wr™‹n
 = 
FDS_PAGE_TAG_SIZE
;

289 
fds_h—d”_t
 cÚ¡ * 
p_h—d”
 = (fds_h—d”_t*)
p_addr
;

291 
	`h—d”_has_Ãxt
(
p_h—d”
, 
p_·ge_’d
))

293 
fds_h—d”_¡©us_t
 
hdr
 = 
	`h—d”_check
(
p_h—d”
, 
p_·ge_’d
);

295 ià(
hdr
 =ğ
FDS_HEADER_VALID
)

298 ià(
p_h—d”
->
»cÜd_id
 > 
m_Ï‹¡_»c_id
)

300 
m_Ï‹¡_»c_id
 = 
p_h—d”
->
»cÜd_id
;

305 ià(
ÿn_gc
 !ğ
NULL
)

307 *
ÿn_gc
 = 
Œue
;

310 ià(
hdr
 =ğ
FDS_HEADER_CORRUPT
)

316 *
wÜds_wr™‹n
 = 
FDS_PAGE_SIZE
;

323 *
wÜds_wr™‹n
 +ğ(
FDS_HEADER_SIZE
 + 
p_h—d”
->
Ëngth_wÜds
);

324 
p_h—d”
 = 
	`h—d”_jump
(p_header);

326 
	}
}

329 
	$·ge_off£ts_upd©e
(
fds_·ge_t
 * cÚ¡ 
p_·ge
, 
ušt16_t
 
Ëngth_wÜds
)

331 
p_·ge
->
wr™e_off£t
 +ğ(
FDS_HEADER_SIZE
 + 
Ëngth_wÜds
);

332 
p_·ge
->
wÜds_»£rved
 -ğ(
FDS_HEADER_SIZE
 + 
Ëngth_wÜds
);

333 
	}
}

337 
»t_code_t
 
	$·ge_g_wr™e_sw­
()

340 
ušt32_t
 cÚ¡ 
·ge_g_sw­
[] = {
FDS_PAGE_TAG_MAGIC
, 
FDS_PAGE_TAG_SWAP
};

341  
	`Äf_f¡Üage_wr™e
(&
m_fs
, (
ušt32_t
)
m_sw­_·ge
.
p_addr
, 
·ge_g_sw­
, 
FDS_PAGE_TAG_SIZE
 * (ušt32_t), 
NULL
);

342 
	}
}

346 
»t_code_t
 
	$·ge_g_wr™e_d©a
(
ušt32_t
 cÚ¡ * cÚ¡ 
p_·ge_addr
)

349 
ušt32_t
 cÚ¡ 
·ge_g_d©a
[] = {
FDS_PAGE_TAG_MAGIC
, 
FDS_PAGE_TAG_DATA
};

350  
	`Äf_f¡Üage_wr™e
(&
m_fs
, (
ušt32_t
)
p_·ge_addr
, 
·ge_g_d©a
, 
FDS_PAGE_TAG_SIZE
 * (ušt32_t), 
NULL
);

351 
	}
}

356 
»t_code_t
 
	$wr™e_¥aû_»£rve
(
ušt16_t
 
Ëngth_wÜds
, ušt16_ˆ* 
p_·ge
)

358 
boŞ
 
¥aû_»£rved
 = 
çl£
;

359 
ušt16_t
 cÚ¡ 
tÙ®_Ën_wÜds
 = 
Ëngth_wÜds
 + 
FDS_HEADER_SIZE
;

361 ià(
tÙ®_Ën_wÜds
 >ğ
FDS_PAGE_SIZE
 - 
FDS_PAGE_TAG_SIZE
)

363  
FDS_ERR_RECORD_TOO_LARGE
;

366 
	`CRITICAL_SECTION_ENTER
();

367 
ušt16_t
 
·ge
 = 0;…ag< 
FDS_DATA_PAGES
;…age++)

369 ià((
m_·ges
[
·ge
].
·ge_ty³
 =ğ
FDS_PAGE_DATA
) &&

370 (
	`·ge_has_¥aû
(
·ge
, 
tÙ®_Ën_wÜds
)))

372 
¥aû_»£rved
 = 
Œue
;

373 *
p_·ge
 = 
·ge
;

375 
m_·ges
[
·ge
].
wÜds_»£rved
 +ğ
tÙ®_Ën_wÜds
;

379 
	`CRITICAL_SECTION_EXIT
();

381  (
¥aû_»£rved
è? 
FDS_SUCCESS
 : 
FDS_ERR_NO_SPACE_IN_FLASH
;

382 
	}
}

387 
	$wr™e_¥aû_ä“
(
ušt16_t
 
Ëngth_wÜds
, ušt16_ˆ
·ge
)

389 
m_·ges
[
·ge
].
wÜds_»£rved
 -ğ(
Ëngth_wÜds
 + 
FDS_HEADER_SIZE
);

390 
	}
}

393 
ušt32_t
 
	$»cÜd_id_Ãw
()

395  
	`Äf_©omic_u32_add
(&
m_Ï‹¡_»c_id
, 1);

396 
	}
}

404 
boŞ
 
	$»cÜd_fšd_Ãxt
(
ušt16_t
 
·ge
, 
ušt32_t
 cÚ¡ ** 
p_»cÜd
)

406 
ušt32_t
 cÚ¡ * 
p_·ge_’d
 = (
m_·ges
[
·ge
].
p_addr
 + 
FDS_PAGE_SIZE
);

410 
fds_h—d”_t
 cÚ¡ * 
p_h—d”
 = (fds_h—d”_t*)(*
p_»cÜd
);

412 ià(
p_h—d”
 !ğ
NULL
)

414 
p_h—d”
 = 
	`h—d”_jump
(p_header);

418 
p_h—d”
 = (
fds_h—d”_t
*)(
m_·ges
[
·ge
].
p_addr
 + 
FDS_PAGE_TAG_SIZE
);

425 
	`h—d”_has_Ãxt
(
p_h—d”
, 
p_·ge_’d
))

427 
	`h—d”_check
(
p_h—d”
, 
p_·ge_’d
))

429 
FDS_HEADER_VALID
:

430 *
p_»cÜd
 = (
ušt32_t
*)
p_h—d”
;

431  
Œue
;

433 
FDS_HEADER_DIRTY
:

434 
p_h—d”
 = 
	`h—d”_jump
(p_header);

437 
FDS_HEADER_CORRUPT
:

440  
çl£
;

445  
çl£
;

446 
	}
}

451 
boŞ
 
	$»cÜd_fšd_by_desc
(
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
, 
ušt16_t
 * cÚ¡ 
p_·ge
)

457 ià((
	`add»ss_is_v®id
(
p_desc
->
p_»cÜd
)) &&

458 (
p_desc
->
gc_run_couÁ
 =ğ
m_gc
.
run_couÁ
) &&

459 (
p_desc
->
»cÜd_id
 =ğ((
fds_h—d”_t
*í_desc->
p_»cÜd
)->record_id))

461  (
	`·ge_äom_»cÜd
(
p_·ge
, 
p_desc
->
p_»cÜd
è=ğ
FDS_SUCCESS
);

465 *
p_·ge
 = 0; *p_·g< 
FDS_DATA_PAGES
; (*p_page)++)

468 
ušt32_t
 cÚ¡ * 
p_»cÜd
 = 
NULL
;

470 
	`»cÜd_fšd_Ãxt
(*
p_·ge
, &
p_»cÜd
))

472 
fds_h—d”_t
 cÚ¡ * cÚ¡ 
p_h—d”
 = (fds_h—d”_t*)
p_»cÜd
;

473 ià(
p_h—d”
->
»cÜd_id
 =ğ
p_desc
->record_id)

475 
p_desc
->
p_»cÜd
 =…_record;

476 
p_desc
->
gc_run_couÁ
 = 
m_gc
.
run_couÁ
;

477  
Œue
;

482  
çl£
;

483 
	}
}

490 
»t_code_t
 
	$»cÜd_fšd
(
ušt16_t
 cÚ¡ * 
p_fe_id
,

491 
ušt16_t
 cÚ¡ * 
p_»cÜd_key
,

492 
fds_»cÜd_desc_t
 * 
p_desc
,

493 
fds_fšd_tok’_t
 * 
p_tok’
)

495 ià(!
m_æags
.
š™Ÿlized
)

497  
FDS_ERR_NOT_INITIALIZED
;

500 ià(
p_desc
 =ğ
NULL
 || 
p_tok’
 == NULL)

502  
FDS_ERR_NULL_ARG
;

506 ; 
p_tok’
->
·ge
 < 
FDS_DATA_PAGES
;…_token->page++)

508 ià(
m_·ges
[
p_tok’
->
·ge
].
·ge_ty³
 !ğ
FDS_PAGE_DATA
)

515 
	`»cÜd_fšd_Ãxt
(
p_tok’
->
·ge
, &p_tok’->
p_addr
))

517 
fds_h—d”_t
 cÚ¡ * 
p_h—d”
 = (fds_h—d”_t*)
p_tok’
->
p_addr
;

520 ià((
p_fe_id
 !ğ
NULL
) &&

521 (
p_h—d”
->
fe_id
 !ğ*
p_fe_id
))

526 ià((
p_»cÜd_key
 !ğ
NULL
) &&

527 (
p_h—d”
->
»cÜd_key
 !ğ*
p_»cÜd_key
))

533 
p_desc
->
»cÜd_id
 = 
p_h—d”
->record_id;

534 
p_desc
->
p_»cÜd
 = 
p_tok’
->
p_addr
;

535 
p_desc
->
gc_run_couÁ
 = 
m_gc
.
run_couÁ
;

537  
FDS_SUCCESS
;

542 
p_tok’
->
p_addr
 = 
NULL
;

545  
FDS_ERR_NOT_FOUND
;

546 
	}
}

550 
	$»cÜds_¡©
(
ušt16_t
 
·ge
,

551 
ušt16_t
 * 
p_v®id_»cÜds
,

552 
ušt16_t
 * 
p_dœty_»cÜds
,

553 
ušt16_t
 * 
p_ä“abË_wÜds
,

554 
boŞ
 * 
p_cÜru±iÚ
)

556 
fds_h—d”_t
 cÚ¡ * 
p_h—d”
 = (fds_h—d”_t*)(
m_·ges
[
·ge
].
p_addr
 + 
FDS_PAGE_TAG_SIZE
);

557 
ušt32_t
 cÚ¡ * cÚ¡ 
p_·ge_’d
 = (
m_·ges
[
·ge
].
p_addr
 + 
FDS_PAGE_SIZE
);

559 
	`h—d”_has_Ãxt
(
p_h—d”
, 
p_·ge_’d
))

561 
	`h—d”_check
(
p_h—d”
, 
p_·ge_’d
))

563 
FDS_HEADER_DIRTY
:

564 *
p_dœty_»cÜds
 += 1;

565 *
p_ä“abË_wÜds
 +ğ
FDS_HEADER_SIZE
 + 
p_h—d”
->
Ëngth_wÜds
;

566 
p_h—d”
 = 
	`h—d”_jump
(p_header);

569 
FDS_HEADER_VALID
:

570 *
p_v®id_»cÜds
 += 1;

571 
p_h—d”
 = 
	`h—d”_jump
(p_header);

574 
FDS_HEADER_CORRUPT
:

576 *
p_dœty_»cÜds
 += 1;

577 *
p_ä“abË_wÜds
 +ğ(
p_·ge_’d
 - (
ušt32_t
*)
p_h—d”
);

578 *
p_cÜru±iÚ
 = 
Œue
;

587 
	}
}

591 
fds_İ_t
 * 
	$queue_buf_g‘
(
Äf_©fifo_™em_put_t
 * 
p_ut_ùx
)

593 
fds_İ_t
 * cÚ¡ 
p_İ
 = (fds_İ_t*è
	`Äf_©fifo_™em_®loc
(
m_queue
, 
p_ut_ùx
);

595 
	`mem£t
(
p_İ
, 0x00, (
fds_İ_t
));

596  
p_İ
;

597 
	}
}

601 
	$queue_buf_¡Üe
(
Äf_©fifo_™em_put_t
 * 
p_ut_ùx
)

603 (è
	`Äf_©fifo_™em_put
(
m_queue
, 
p_ut_ùx
);

604 
	}
}

608 
fds_İ_t
 * 
	$queue_lßd
(
Äf_©fifo_™em_g‘_t
 * 
p_ig‘_ùx
)

610  (
fds_İ_t
*è
	`Äf_©fifo_™em_g‘
(
m_queue
, 
p_ig‘_ùx
);

611 
	}
}

615 
	$queue_ä“
(
Äf_©fifo_™em_g‘_t
 * 
p_ig‘_ùx
)

618 (è
	`Äf_©fifo_™em_ä“
(
m_queue
, 
p_ig‘_ùx
);

619 
	}
}

622 
boŞ
 
	$queue_has_Ãxt
()

625 
	`ASSERT
(
m_queued_İ_út
 != 0);

626  
	`Äf_©omic_u32_sub
(&
m_queued_İ_út
, 1);

627 
	}
}

632 
fds_š™_İts_t
 
	$·ges_š™
()

634 
ušt32_t
 
»t
 = 
NO_PAGES
;

635 
ušt16_t
 
·ge
 = 0;

636 
ušt16_t
 
tÙ®_·ges_avaabË
 = 
FDS_VIRTUAL_PAGES
;

637 
boŞ
 
sw­_£t_but_nÙ_found
 = 
çl£
;

639 
ušt16_t
 
i
 = 0; i < 
FDS_VIRTUAL_PAGES
; i++)

641 
ušt32_t
 cÚ¡ * cÚ¡ 
p_·ge_addr
 = (ušt32_t*)
m_fs
.
¡¬t_addr
 + (
i
 * 
FDS_PAGE_SIZE
);

642 
fds_·ge_ty³_t
 cÚ¡ 
·ge_ty³
 = 
	`·ge_id’tify
(
p_·ge_addr
);

644 
·ge_ty³
)

646 
FDS_PAGE_UNDEFINED
:

648 ià(
	`·ge_is_”a£d
(
p_·ge_addr
))

650 ià(
m_sw­_·ge
.
p_addr
 !ğ
NULL
)

654 
m_·ges
[
·ge
].
·ge_ty³
 = 
FDS_PAGE_ERASED
;

655 
m_·ges
[
·ge
].
p_addr
 = 
p_·ge_addr
;

656 
m_·ges
[
·ge
].
wr™e_off£t
 = 
FDS_PAGE_TAG_SIZE
;

660 
m_gc
.
cur_·ge
 = 
·ge
;

661 
·ge
++;

666 
m_sw­_·ge
.
p_addr
 = 
p_·ge_addr
;

667 
m_sw­_·ge
.
wr™e_off£t
 = 
FDS_PAGE_TAG_SIZE
;

668 
sw­_£t_but_nÙ_found
 = 
Œue
;

671 
»t
 |ğ
PAGE_ERASED
;

677 
tÙ®_·ges_avaabË
--;

678 
m_·ges
[
·ge
].
p_addr
 = 
p_·ge_addr
;

679 
m_·ges
[
·ge
].
·ge_ty³
 = 
FDS_PAGE_UNDEFINED
;

680 
·ge
++;

684 
FDS_PAGE_DATA
:

686 
m_·ges
[
·ge
].
·ge_ty³
 = 
FDS_PAGE_DATA
;

687 
m_·ges
[
·ge
].
p_addr
 = 
p_·ge_addr
;

691 
	`·ge_sÿn
(
p_·ge_addr
, &
m_·ges
[
·ge
].
wr™e_off£t
, &m_·ges[·ge].
ÿn_gc
);

693 
»t
 |ğ
PAGE_DATA
;

694 
·ge
++;

697 
FDS_PAGE_SWAP
:

699 ià(
sw­_£t_but_nÙ_found
)

701 
m_·ges
[
·ge
].
·ge_ty³
 = 
FDS_PAGE_ERASED
;

702 
m_·ges
[
·ge
].
p_addr
 = 
m_sw­_·ge
.p_addr;

703 
m_·ges
[
·ge
].
wr™e_off£t
 = 
FDS_PAGE_TAG_SIZE
;

705 
·ge
++;

708 
m_sw­_·ge
.
p_addr
 = 
p_·ge_addr
;

711 
	`·ge_sÿn
(
p_·ge_addr
, &
m_sw­_·ge
.
wr™e_off£t
, 
NULL
);

713 
»t
 |ğ(
m_sw­_·ge
.
wr™e_off£t
 =ğ
FDS_PAGE_TAG_SIZE
) ?

714 
PAGE_SWAP_CLEAN
 : 
PAGE_SWAP_DIRTY
;

723 ià(
tÙ®_·ges_avaabË
 < 2)

725 
»t
 &ğ
NO_PAGES
;

728  (
fds_š™_İts_t
)
»t
;

729 
	}
}

733 
»t_code_t
 
	$»cÜd_h—d”_wr™e_begš
(
fds_İ_t
 * cÚ¡ 
p_İ
, 
ušt32_t
 * cÚ¡ 
p_addr
)

735 
»t_code_t
 
»t
;

738 
p_İ
->
wr™e
.
¡•
 = 
FDS_OP_WRITE_RECORD_ID
;

740 
»t
 = 
	`Äf_f¡Üage_wr™e
(&
m_fs
, (
ušt32_t
)(
p_addr
 + 
FDS_OFFSET_TL
),

741 &
p_İ
->
wr™e
.
h—d”
.
»cÜd_key
, 
FDS_HEADER_SIZE_TL
 * (
ušt32_t
), 
NULL
);

743  (
»t
 =ğ
NRF_SUCCESS
è? 
FDS_SUCCESS
 : 
FDS_ERR_BUSY
;

744 
	}
}

747 
»t_code_t
 
	$»cÜd_h—d”_wr™e_id
(
fds_İ_t
 * cÚ¡ 
p_İ
, 
ušt32_t
 * cÚ¡ 
p_addr
)

749 
»t_code_t
 
»t
;

753 
p_İ
->
wr™e
.
¡•
 = (p_İ->wr™e.
p_d©a
 !ğ
NULL
) ?

754 
FDS_OP_WRITE_DATA
 : 
FDS_OP_WRITE_HEADER_FINALIZE
;

756 
»t
 = 
	`Äf_f¡Üage_wr™e
(&
m_fs
, (
ušt32_t
)(
p_addr
 + 
FDS_OFFSET_ID
),

757 &
p_İ
->
wr™e
.
h—d”
.
»cÜd_id
, 
FDS_HEADER_SIZE_ID
 * (
ušt32_t
), 
NULL
);

759  (
»t
 =ğ
NRF_SUCCESS
è? 
FDS_SUCCESS
 : 
FDS_ERR_BUSY
;

760 
	}
}

763 
»t_code_t
 
	$»cÜd_h—d”_wr™e_fš®ize
(
fds_İ_t
 * cÚ¡ 
p_İ
, 
ušt32_t
 * cÚ¡ 
p_addr
)

765 
»t_code_t
 
»t
;

769 
p_İ
->
wr™e
.
¡•
 = (p_İ->
İ_code
 =ğ
FDS_OP_UPDATE
) ?

770 
FDS_OP_WRITE_FLAG_DIRTY
 : 
FDS_OP_WRITE_DONE
;

772 
»t
 = 
	`Äf_f¡Üage_wr™e
(&
m_fs
, (
ušt32_t
)(
p_addr
 + 
FDS_OFFSET_IC
),

773 &
p_İ
->
wr™e
.
h—d”
.
fe_id
, 
FDS_HEADER_SIZE_IC
 * (
ušt32_t
), 
NULL
);

775  (
»t
 =ğ
NRF_SUCCESS
è? 
FDS_SUCCESS
 : 
FDS_ERR_BUSY
;

776 
	}
}

779 
»t_code_t
 
	$»cÜd_h—d”_æag_dœty
(
ušt32_t
 * cÚ¡ 
p_»cÜd
, 
ušt16_t
 
·ge_to_gc
)

783 
	`__ALIGN
(4è
ušt32_t
 cÚ¡ 
dœty_h—d”
 = {0xFFFF0000};

786 
»t_code_t
 
»t
;

788 
»t
 = 
	`Äf_f¡Üage_wr™e
(&
m_fs
, (
ušt32_t
)
p_»cÜd
,

789 &
dœty_h—d”
, 
FDS_HEADER_SIZE_TL
 * (
ušt32_t
), 
NULL
);

791 ià(
»t
 !ğ
NRF_SUCCESS
)

793  
FDS_ERR_BUSY
;

796 
m_·ges
[
·ge_to_gc
].
ÿn_gc
 = 
Œue
;

798  
FDS_SUCCESS
;

799 
	}
}

802 
»t_code_t
 
	$»cÜd_fšd_ªd_d–‘e
(
fds_İ_t
 * cÚ¡ 
p_İ
)

804 
»t_code_t
 
»t
;

805 
ušt16_t
 
·ge
;

806 
fds_»cÜd_desc_t
 
desc
 = {0};

808 
desc
.
»cÜd_id
 = 
p_İ
->
d–
.
»cÜd_to_d–‘e
;

810 ià(
	`»cÜd_fšd_by_desc
(&
desc
, &
·ge
))

812 
fds_h—d”_t
 cÚ¡ * cÚ¡ 
p_h—d”
 = (fds_h—d”_ˆcÚ¡ *)
desc
.
p_»cÜd
;

819 
p_İ
->
d–
.
fe_id
 = 
p_h—d”
->file_id;

820 
p_İ
->
d–
.
»cÜd_key
 = 
p_h—d”
->record_key;

823 
»t
 = 
	`»cÜd_h—d”_æag_dœty
((
ušt32_t
*)
desc
.
p_»cÜd
, 
·ge
);

828 
»t
 = 
FDS_ERR_NOT_FOUND
;

831  
»t
;

832 
	}
}

836 
»t_code_t
 
	$fe_fšd_ªd_d–‘e
(
fds_İ_t
 * cÚ¡ 
p_İ
)

838 
»t_code_t
 
»t
;

839 
fds_»cÜd_desc_t
 
desc
;

842 
fds_fšd_tok’_t
 
tok
 = {0};

845 
»t
 = 
	`»cÜd_fšd
(&
p_İ
->
d–
.
fe_id
, 
NULL
, &
desc
, &
tok
);

847 ià(
»t
 =ğ
FDS_SUCCESS
)

850 
»t
 = 
	`»cÜd_h—d”_æag_dœty
((
ušt32_t
*)
desc
.
p_»cÜd
, 
tok
.
·ge
);

855 
	`mem£t
(&
tok
, 0x00, (
fds_fšd_tok’_t
));

858  
»t
;

859 
	}
}

863 
»t_code_t
 
	$»cÜd_wr™e_d©a
(
fds_İ_t
 * cÚ¡ 
p_İ
, 
ušt32_t
 * cÚ¡ 
p_addr
)

865 
»t_code_t
 
»t
;

867 
p_İ
->
wr™e
.
¡•
 = 
FDS_OP_WRITE_HEADER_FINALIZE
;

869 
»t
 = 
	`Äf_f¡Üage_wr™e
(&
m_fs
, (
ušt32_t
)(
p_addr
 + 
FDS_OFFSET_DATA
),

870 
p_İ
->
wr™e
.
p_d©a
,…_İ->wr™e.
h—d”
.
Ëngth_wÜds
 * (
ušt32_t
), 
NULL
);

872  (
»t
 =ğ
NRF_SUCCESS
è? 
FDS_SUCCESS
 : 
FDS_ERR_BUSY
;

873 
	}
}

876 #ià(
FDS_CRC_CHECK_ON_READ
)

877 
boŞ
 
	$üc_v”ify_sucûss
(
ušt16_t
 
üc
, ušt16_ˆ
Ën_wÜds
, 
ušt32_t
 cÚ¡ * cÚ¡ 
p_d©a
)

879 
ušt16_t
 
compu‹d_üc
;

885 
compu‹d_üc
 = 
	`üc16_compu‹
((
ušt8_t
 cÚ¡ *)
p_d©a
, 6, 
NULL
);

886 
compu‹d_üc
 = 
	`üc16_compu‹
((
ušt8_t
 cÚ¡ *)
p_d©a
 + 8,

887 (
FDS_HEADER_SIZE_ID
 + 
Ën_wÜds
è* (
ušt32_t
),

888 &
compu‹d_üc
);

890  (
compu‹d_üc
 =ğ
üc
);

891 
	}
}

895 
	$gc_š™
()

897 
m_gc
.
run_couÁ
++;

898 
m_gc
.
cur_·ge
 = 0;

899 
m_gc
.
»sume
 = 
çl£
;

903 
ušt16_t
 
i
 = 0; i < 
FDS_DATA_PAGES
; i++)

905 
m_gc
.
do_gc_·ge
[
i
] = (
m_·ges
[i].
·ge_ty³
 =ğ
FDS_PAGE_DATA
);

907 
	}
}

912 
boŞ
 
	$gc_·ge_Ãxt
(
ušt16_t
 * cÚ¡ 
p_Ãxt_·ge
)

914 
boŞ
 
»t
 = 
çl£
;

916 
ušt16_t
 
i
 = 0; i < 
FDS_DATA_PAGES
; i++)

918 ià(
m_gc
.
do_gc_·ge
[
i
])

921 
m_gc
.
do_gc_·ge
[
i
] = 
çl£
;

924 ià((
m_·ges
[
i
].
»cÜds_İ’
 =ğ0è&& (m_·ges[i].
ÿn_gc
 =ğ
Œue
))

926 *
p_Ãxt_·ge
 = 
i
;

927 
»t
 = 
Œue
;

933  
»t
;

934 
	}
}

937 
»t_code_t
 
	$gc_sw­_”a£
()

939 
m_gc
.
¡©e
 = 
GC_DISCARD_SWAP
;

940 
m_sw­_·ge
.
wr™e_off£t
 = 
FDS_PAGE_TAG_SIZE
;

942  
	`Äf_f¡Üage_”a£
(&
m_fs
, (
ušt32_t
)
m_sw­_·ge
.
p_addr
, 
FDS_PHY_PAGES_IN_VPAGE
, 
NULL
);

943 
	}
}

948 
»t_code_t
 
	$gc_·ge_”a£
()

950 
ušt32_t
 
»t
;

951 
ušt16_t
 cÚ¡ 
gc
 = 
m_gc
.
cur_·ge
;

953 ià(
m_·ges
[
gc
].
»cÜds_İ’
 == 0)

955 
m_gc
.
¡©e
 = 
GC_ERASE_PAGE
;

957 
»t
 = 
	`Äf_f¡Üage_”a£
(&
m_fs
, (
ušt32_t
)
m_·ges
[
gc
].
p_addr
, 
FDS_PHY_PAGES_IN_VPAGE
, 
NULL
);

963 
»t
 = 
	`gc_sw­_”a£
();

966  
»t
;

967 
	}
}

971 
»t_code_t
 
	$gc_»cÜd_cİy
()

973 
fds_h—d”_t
 cÚ¡ * cÚ¡ 
p_h—d”
 = (fds_h—d”_t*)
m_gc
.
p_»cÜd_¤c
;

974 
ušt32_t
 cÚ¡ * cÚ¡ 
p_de¡
 = 
m_sw­_·ge
.
p_addr
 + m_sw­_·ge.
wr™e_off£t
;

975 
ušt16_t
 cÚ¡ 
»cÜd_Ën
 = 
FDS_HEADER_SIZE
 + 
p_h—d”
->
Ëngth_wÜds
;

977 
m_gc
.
¡©e
 = 
GC_COPY_RECORD
;

981  
	`Äf_f¡Üage_wr™e
(&
m_fs
, (
ušt32_t
)
p_de¡
, 
m_gc
.
p_»cÜd_¤c
,

982 
»cÜd_Ën
 * (
ušt32_t
),

983 
NULL
);

984 
	}
}

987 
»t_code_t
 
	$gc_»cÜd_fšd_Ãxt
()

989 
»t_code_t
 
»t
;

992 ià(
	`»cÜd_fšd_Ãxt
(
m_gc
.
cur_·ge
, &m_gc.
p_»cÜd_¤c
))

994 
»t
 = 
	`gc_»cÜd_cİy
();

999 
»t
 = 
	`gc_·ge_”a£
();

1002  
»t
;

1003 
	}
}

1007 
»t_code_t
 
	$gc_sw­_´omÙe
()

1009 
m_gc
.
¡©e
 = 
GC_PROMOTE_SWAP
;

1010  
	`·ge_g_wr™e_d©a
(
m_·ges
[
m_gc
.
cur_·ge
].
p_addr
);

1011 
	}
}

1015 
»t_code_t
 
	$gc_g_Ãw_sw­
()

1017 
m_gc
.
¡©e
 = 
GC_TAG_NEW_SWAP
;

1018 
m_gc
.
p_»cÜd_¤c
 = 
NULL
;

1019  
	`·ge_g_wr™e_sw­
();

1020 
	}
}

1023 
»t_code_t
 
	$gc_Ãxt_·ge
()

1025 ià(!
	`gc_·ge_Ãxt
(&
m_gc
.
cur_·ge
))

1028 
m_gc
.
¡©e
 = 
GC_BEGIN
;

1029 
m_gc
.
cur_·ge
 = 0;

1030 
m_gc
.
p_»cÜd_¤c
 = 
NULL
;

1032  
FDS_OP_COMPLETED
;

1035  
	`gc_»cÜd_fšd_Ãxt
();

1036 
	}
}

1040 
	$gc_upd©e_sw­_off£t
()

1042 
fds_h—d”_t
 cÚ¡ * cÚ¡ 
p_h—d”
 = (fds_h—d”_t*)
m_gc
.
p_»cÜd_¤c
;

1043 
ušt16_t
 cÚ¡ 
»cÜd_Ën
 = 
FDS_HEADER_SIZE
 + 
p_h—d”
->
Ëngth_wÜds
;

1045 
m_sw­_·ge
.
wr™e_off£t
 +ğ
»cÜd_Ën
;

1046 
	}
}

1049 
	$gc_sw­_·ges
()

1053 
ušt32_t
 cÚ¡ * cÚ¡ 
p_addr
 = 
m_sw­_·ge
.p_addr;

1055 
m_sw­_·ge
.
p_addr
 = 
m_·ges
[
m_gc
.
cur_·ge
].p_addr;

1056 
m_·ges
[
m_gc
.
cur_·ge
].
p_addr
 =…_addr;

1059 
m_·ges
[
m_gc
.
cur_·ge
].
wr™e_off£t
 = 
m_sw­_·ge
.write_offset;

1060 
m_sw­_·ge
.
wr™e_off£t
 = 
FDS_PAGE_TAG_SIZE
;

1061 
	}
}

1064 
	$gc_¡©e_advªû
()

1066 
m_gc
.
¡©e
)

1068 
GC_BEGIN
:

1069 
	`gc_š™
();

1070 
m_gc
.
¡©e
 = 
GC_NEXT_PAGE
;

1074 
GC_COPY_RECORD
:

1075 
	`gc_upd©e_sw­_off£t
();

1076 
m_gc
.
¡©e
 = 
GC_FIND_NEXT_RECORD
;

1080 
GC_ERASE_PAGE
:

1081 
	`gc_sw­_·ges
();

1082 
m_gc
.
¡©e
 = 
GC_PROMOTE_SWAP
;

1086 
GC_DISCARD_SWAP
:

1088 
GC_PROMOTE_SWAP
:

1090 
m_gc
.
¡©e
 = 
GC_TAG_NEW_SWAP
;

1093 
GC_TAG_NEW_SWAP
:

1094 
m_gc
.
¡©e
 = 
GC_NEXT_PAGE
;

1101 
	}
}

1105 
»t_code_t
 
	$š™_execu‹
(
ušt32_t
 
´ev_»t
, 
fds_İ_t
 * cÚ¡ 
p_İ
)

1107 
»t_code_t
 
»t
 = 
FDS_ERR_INTERNAL
;

1109 ià(
´ev_»t
 !ğ
NRF_SUCCESS
)

1112 
m_æags
.
š™Ÿlizšg
 = 
çl£
;

1113  
FDS_ERR_OPERATION_TIMEOUT
;

1116 
p_İ
->
š™
.
¡•
)

1118 
FDS_OP_INIT_TAG_SWAP
:

1121 
p_İ
->
š™
.
¡•
 = 
FDS_OP_INIT_TAG_DATA
;

1122 
»t
 = 
	`·ge_g_wr™e_sw­
();

1125 
FDS_OP_INIT_TAG_DATA
:

1128 
boŞ
 
wr™e_»qd
 = 
çl£
;

1129 
ušt16_t
 
i
 = 0; i < 
FDS_DATA_PAGES
; i++)

1131 ià(
m_·ges
[
i
].
·ge_ty³
 =ğ
FDS_PAGE_ERASED
)

1133 
m_·ges
[
i
].
·ge_ty³
 = 
FDS_PAGE_DATA
;

1134 
wr™e_»qd
 = 
Œue
;

1135 
»t
 = 
	`·ge_g_wr™e_d©a
(
m_·ges
[
i
].
p_addr
);

1139 ià(!
wr™e_»qd
)

1141 
m_æags
.
š™Ÿlized
 = 
Œue
;

1142 
m_æags
.
š™Ÿlizšg
 = 
çl£
;

1143  
FDS_OP_COMPLETED
;

1147 
FDS_OP_INIT_ERASE_SWAP
:

1150 
p_İ
->
š™
.
¡•
 = 
FDS_OP_INIT_TAG_SWAP
;

1151 
m_sw­_·ge
.
wr™e_off£t
 = 
FDS_PAGE_TAG_SIZE
;

1153 
»t
 = 
	`Äf_f¡Üage_”a£
(&
m_fs
, (
ušt32_t
)
m_sw­_·ge
.
p_addr
, 
FDS_PHY_PAGES_IN_VPAGE
, 
NULL
);

1156 
FDS_OP_INIT_PROMOTE_SWAP
:

1158 
p_İ
->
š™
.
¡•
 = 
FDS_OP_INIT_TAG_SWAP
;

1161 
»t
 = 
	`·ge_g_wr™e_d©a
(
m_sw­_·ge
.
p_addr
);

1163 
ušt16_t
 cÚ¡ 
gc
 = 
m_gc
.
cur_·ge
;

1164 
ušt32_t
 cÚ¡ * cÚ¡ 
p_Şd_sw­
 = 
m_sw­_·ge
.
p_addr
;

1167 
m_sw­_·ge
.
p_addr
 = 
m_·ges
[
gc
].p_addr;

1168 
m_·ges
[
gc
].
p_addr
 = 
p_Şd_sw­
;

1171 
m_·ges
[
gc
].
wr™e_off£t
 = 
m_sw­_·ge
.write_offset;

1172 
m_sw­_·ge
.
wr™e_off£t
 = 
FDS_PAGE_TAG_SIZE
;

1174 
m_·ges
[
gc
].
·ge_ty³
 = 
FDS_PAGE_DATA
;

1182 ià(
»t
 !ğ
FDS_SUCCESS
)

1185 
m_æags
.
š™Ÿlizšg
 = 
çl£
;

1186  
FDS_ERR_BUSY
;

1189  
FDS_OP_EXECUTING
;

1190 
	}
}

1194 
»t_code_t
 
	$wr™e_execu‹
(
ušt32_t
 
´ev_»t
, 
fds_İ_t
 * cÚ¡ 
p_İ
)

1196 
»t_code_t
 
»t
;

1197 
ušt32_t
 * 
p_wr™e_addr
;

1198 
fds_·ge_t
 * cÚ¡ 
p_·ge
 = &
m_·ges
[
p_İ
->
wr™e
.
·ge
];

1201 
fds_»cÜd_desc_t
 
desc
 = {0};

1205 
ušt16_t
 
·ge
;

1207 ià(
´ev_»t
 !ğ
NRF_SUCCESS
)

1210 
	`·ge_off£ts_upd©e
(
p_·ge
, 
p_İ
->
wr™e
.
h—d”
.
Ëngth_wÜds
);

1211  
FDS_ERR_OPERATION_TIMEOUT
;

1215 
p_wr™e_addr
 = (
ušt32_t
*)(
p_·ge
->
p_addr
 +…_·ge->
wr™e_off£t
);

1218 
p_İ
->
wr™e
.
¡•
)

1220 
FDS_OP_WRITE_FIND_RECORD
:

1225 
desc
.
p_»cÜd
 = 
NULL
;

1226 
desc
.
»cÜd_id
 = 
p_İ
->
wr™e
.
»cÜd_to_d–‘e
;

1228 ià(!
	`»cÜd_fšd_by_desc
(&
desc
, &
·ge
))

1230  
FDS_ERR_NOT_FOUND
;

1236 
FDS_OP_WRITE_HEADER_BEGIN
:

1237 
»t
 = 
	`»cÜd_h—d”_wr™e_begš
(
p_İ
, 
p_wr™e_addr
);

1240 
FDS_OP_WRITE_RECORD_ID
:

1241 
»t
 = 
	`»cÜd_h—d”_wr™e_id
(
p_İ
, 
p_wr™e_addr
);

1244 
FDS_OP_WRITE_DATA
:

1245 
»t
 = 
	`»cÜd_wr™e_d©a
(
p_İ
, 
p_wr™e_addr
);

1248 
FDS_OP_WRITE_HEADER_FINALIZE
:

1249 
»t
 = 
	`»cÜd_h—d”_wr™e_fš®ize
(
p_İ
, 
p_wr™e_addr
);

1252 
FDS_OP_WRITE_FLAG_DIRTY
:

1253 
p_İ
->
wr™e
.
¡•
 = 
FDS_OP_WRITE_DONE
;

1254 
»t
 = 
	`»cÜd_h—d”_æag_dœty
((
ušt32_t
*)
desc
.
p_»cÜd
, 
·ge
);

1257 
FDS_OP_WRITE_DONE
:

1258 
»t
 = 
FDS_OP_COMPLETED
;

1260 #ià(
FDS_CRC_CHECK_ON_WRITE
)

1261 ià(!
	`üc_v”ify_sucûss
(
p_İ
->
wr™e
.
h—d”
.
üc16
,

1262 
p_İ
->
wr™e
.
h—d”
.
Ëngth_wÜds
,

1263 
p_wr™e_addr
))

1265 
»t
 = 
FDS_ERR_CRC_CHECK_FAILED
;

1271 
»t
 = 
FDS_ERR_INTERNAL
;

1277 ià(
»t
 !ğ
FDS_OP_EXECUTING
)

1280 
	`·ge_off£ts_upd©e
(
p_·ge
, 
p_İ
->
wr™e
.
h—d”
.
Ëngth_wÜds
);

1283  
»t
;

1284 
	}
}

1287 
»t_code_t
 
	$d–‘e_execu‹
(
ušt32_t
 
´ev_»t
, 
fds_İ_t
 * cÚ¡ 
p_İ
)

1289 
»t_code_t
 
»t
;

1291 ià(
´ev_»t
 !ğ
NRF_SUCCESS
)

1293  
FDS_ERR_OPERATION_TIMEOUT
;

1296 
p_İ
->
d–
.
¡•
)

1298 
FDS_OP_DEL_RECORD_FLAG_DIRTY
:

1299 
p_İ
->
d–
.
¡•
 = 
FDS_OP_DEL_DONE
;

1300 
»t
 = 
	`»cÜd_fšd_ªd_d–‘e
(
p_İ
);

1303 
FDS_OP_DEL_FILE_FLAG_DIRTY
:

1304 
»t
 = 
	`fe_fšd_ªd_d–‘e
(
p_İ
);

1305 ià(
»t
 =ğ
FDS_ERR_NOT_FOUND
)

1309 
»t
 = 
FDS_OP_COMPLETED
;

1313 
FDS_OP_DEL_DONE
:

1314 
»t
 = 
FDS_OP_COMPLETED
;

1318 
»t
 = 
FDS_ERR_INTERNAL
;

1322  
»t
;

1323 
	}
}

1326 
»t_code_t
 
	$gc_execu‹
(
ušt32_t
 
´ev_»t
)

1328 
»t_code_t
 
»t
;

1330 ià(
´ev_»t
 !ğ
NRF_SUCCESS
)

1332  
FDS_ERR_OPERATION_TIMEOUT
;

1335 ià(
m_gc
.
»sume
)

1337 
m_gc
.
»sume
 = 
çl£
;

1341 
	`gc_¡©e_advªû
();

1344 
m_gc
.
¡©e
)

1346 
GC_NEXT_PAGE
:

1347 
»t
 = 
	`gc_Ãxt_·ge
();

1350 
GC_FIND_NEXT_RECORD
:

1351 
»t
 = 
	`gc_»cÜd_fšd_Ãxt
();

1354 
GC_COPY_RECORD
:

1355 
»t
 = 
	`gc_»cÜd_cİy
();

1358 
GC_ERASE_PAGE
:

1359 
»t
 = 
	`gc_·ge_”a£
();

1362 
GC_PROMOTE_SWAP
:

1363 
»t
 = 
	`gc_sw­_´omÙe
();

1366 
GC_TAG_NEW_SWAP
:

1367 
»t
 = 
	`gc_g_Ãw_sw­
();

1372 
»t
 = 
FDS_ERR_INTERNAL
;

1377  
»t
;

1378 
	}
}

1381 
	$queue_´oûss
(
»t_code_t
 
»suÉ
)

1383 
fds_İ_t
 * 
m_p_cur_İ
;

1384 
Äf_©fifo_™em_g‘_t
 
m_ig‘_ùx
;

1386 
Œue
)

1388 ià(
m_p_cur_İ
 =ğ
NULL
)

1391 
m_p_cur_İ
 = 
	`queue_lßd
(&
m_ig‘_ùx
);

1401 
	`ASSERT
(
m_p_cur_İ
 !ğ
NULL
);

1403 
m_p_cur_İ
->
İ_code
)

1405 
FDS_OP_INIT
:

1406 
»suÉ
 = 
	`š™_execu‹
ÔesuÉ, 
m_p_cur_İ
);

1409 
FDS_OP_WRITE
:

1410 
FDS_OP_UPDATE
:

1411 
»suÉ
 = 
	`wr™e_execu‹
ÔesuÉ, 
m_p_cur_İ
);

1414 
FDS_OP_DEL_RECORD
:

1415 
FDS_OP_DEL_FILE
:

1416 
»suÉ
 = 
	`d–‘e_execu‹
ÔesuÉ, 
m_p_cur_İ
);

1419 
FDS_OP_GC
:

1420 
»suÉ
 = 
	`gc_execu‹
(result);

1424 
»suÉ
 = 
FDS_ERR_INTERNAL
;

1428 ià(
»suÉ
 =ğ
FDS_OP_EXECUTING
)

1439 
fds_evt_t
 
evt
;

1440 
	`mem£t
(&
evt
, 0x00, (evt));

1442 ià(
»suÉ
 =ğ
FDS_OP_COMPLETED
)

1444 
evt
.
»suÉ
 = 
FDS_SUCCESS
;

1445 
»suÉ
 = 
NRF_SUCCESS
;

1454 
evt
.
»suÉ
 =„esult;

1457 
	`ev’t_´•¬e
(
m_p_cur_İ
, &
evt
);

1458 
	`ev’t_£nd
(&
evt
);

1462 
m_p_cur_İ
 = 
NULL
;

1465 
	`queue_ä“
(&
m_ig‘_ùx
);

1467 ià(!
	`queue_has_Ãxt
())

1473 
	}
}

1476 
	$queue_¡¬t
()

1478 ià(!
	`Äf_©omic_u32_ãtch_add
(&
m_queued_İ_út
, 1))

1480 
	`queue_´oûss
(
NRF_SUCCESS
);

1482 
	}
}

1485 
	$fs_ev’t_hªdËr
(
Äf_f¡Üage_evt_t
 * 
p_evt
)

1487 
	`queue_´oûss
(
p_evt
->
»suÉ
);

1488 
	}
}

1492 
»t_code_t
 
	$wr™e_’queue
(
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
,

1493 
fds_»cÜd_t
 cÚ¡ * cÚ¡ 
p_»cÜd
,

1494 
fds_»£rve_tok’_t
 cÚ¡ * cÚ¡ 
p_tok
,

1495 
fds_İ_code_t
 
İ_code
)

1497 
»t_code_t
 
»t
;

1498 
ušt16_t
 
·ge
;

1499 
ušt16_t
 
üc
 = 0;

1500 
ušt16_t
 
Ëngth_wÜds
 = 0;

1501 
fds_İ_t
 * 
p_İ
;

1502 
Äf_©fifo_™em_put_t
 
ut_ùx
;

1504 ià(!
m_æags
.
š™Ÿlized
)

1506  
FDS_ERR_NOT_INITIALIZED
;

1509 ià(
p_»cÜd
 =ğ
NULL
)

1511  
FDS_ERR_NULL_ARG
;

1514 ià((
p_»cÜd
->
fe_id
 =ğ
FDS_FILE_ID_INVALID
) ||

1515 (
p_»cÜd
->
key
 =ğ
FDS_RECORD_KEY_DIRTY
))

1517  
FDS_ERR_INVALID_ARG
;

1520 ià(!
	`is_wÜd_®igÃd
(
p_»cÜd
->
d©a
.
p_d©a
))

1522  
FDS_ERR_UNALIGNED_ADDR
;

1526 ià(
p_tok
 =ğ
NULL
)

1529 
Ëngth_wÜds
 = 
p_»cÜd
->
d©a
.length_words;

1530 
»t
 = 
	`wr™e_¥aû_»£rve
(
Ëngth_wÜds
, &
·ge
);

1532 ià(
»t
 !ğ
FDS_SUCCESS
)

1536  
»t
;

1541 
·ge
 = 
p_tok
->page;

1542 
Ëngth_wÜds
 = 
p_tok
->length_words;

1546 
p_İ
 = 
	`queue_buf_g‘
(&
ut_ùx
);

1547 ià(
p_İ
 =ğ
NULL
)

1549 
	`CRITICAL_SECTION_ENTER
();

1550 
	`wr™e_¥aû_ä“
(
Ëngth_wÜds
, 
·ge
);

1551 
	`CRITICAL_SECTION_EXIT
();

1552  
FDS_ERR_NO_SPACE_IN_QUEUES
;

1556 
p_İ
->
İ_code
 = op_code;

1557 
p_İ
->
wr™e
.
¡•
 = 
FDS_OP_WRITE_HEADER_BEGIN
;

1558 
p_İ
->
wr™e
.
·ge
 =…age;

1559 
p_İ
->
wr™e
.
p_d©a
 = 
p_»cÜd
->
d©a
.p_data;

1560 
p_İ
->
wr™e
.
h—d”
.
»cÜd_id
 = 
	`»cÜd_id_Ãw
();

1561 
p_İ
->
wr™e
.
h—d”
.
fe_id
 = 
p_»cÜd
->file_id;

1562 
p_İ
->
wr™e
.
h—d”
.
»cÜd_key
 = 
p_»cÜd
->
key
;

1563 
p_İ
->
wr™e
.
h—d”
.
Ëngth_wÜds
 =†ength_words;

1565 ià(
İ_code
 =ğ
FDS_OP_UPDATE
)

1567 
p_İ
->
wr™e
.
¡•
 = 
FDS_OP_WRITE_FIND_RECORD
;

1569 
p_İ
->
wr™e
.
»cÜd_to_d–‘e
 = 
p_desc
->
»cÜd_id
;

1572 #ià(
FDS_CRC_CHECK_ON_READ
)

1575 
üc
 = 
	`üc16_compu‹
((
ušt8_t
*)&
p_İ
->
wr™e
.
h—d”
, 6, 
NULL
);

1576 
üc
 = 
	`üc16_compu‹
((
ušt8_t
*)&
p_İ
->
wr™e
.
h—d”
.
»cÜd_id
, 4, &crc);

1579 
üc
 = 
	`üc16_compu‹
((
ušt8_t
*)
p_»cÜd
->
d©a
.
p_d©a
,

1580 
p_»cÜd
->
d©a
.
Ëngth_wÜds
 * (
ušt32_t
), &
üc
);

1583 
p_İ
->
wr™e
.
h—d”
.
üc16
 = 
üc
;

1585 
	`queue_buf_¡Üe
(&
ut_ùx
);

1588 ià(
p_desc
 !ğ
NULL
)

1590 
p_desc
->
p_»cÜd
 = 
NULL
;

1592 
p_desc
->
»cÜd_id
 = 
p_İ
->
wr™e
.
h—d”
.record_id;

1593 
p_desc
->
»cÜd_is_İ’
 = 
çl£
;

1594 
p_desc
->
gc_run_couÁ
 = 
m_gc
.
run_couÁ
;

1598 
	`queue_¡¬t
();

1600  
FDS_SUCCESS
;

1601 
	}
}

1604 
»t_code_t
 
	$fds_»gi¡”
(
fds_cb_t
 
cb
)

1606 
»t_code_t
 
»t
;

1608 ià(
m_u£rs
 =ğ
FDS_MAX_USERS
)

1610 
»t
 = 
FDS_ERR_USER_LIMIT_REACHED
;

1614 
m_cb_bË
[
m_u£rs
] = 
cb
;

1615 (è
	`Äf_©omic_u32_add
(&
m_u£rs
, 1);

1617 
»t
 = 
FDS_SUCCESS
;

1620  
»t
;

1621 
	}
}

1624 
ušt32_t
 
	$æash_’d_addr
()

1626 
ušt32_t
 cÚ¡ 
boÙlßd”_addr
 = 
NRF_UICR
->
NRFFW
[0];

1627 
ušt32_t
 cÚ¡ 
·ge_sz
 = 
NRF_FICR
->
CODEPAGESIZE
;

1628 #iâdeà
NRF52810_XXAA


1629 
ušt32_t
 cÚ¡ 
code_sz
 = 
NRF_FICR
->
CODESIZE
;

1632 
ušt32_t
 cÚ¡ 
code_sz
 = 48;

1635  (
boÙlßd”_addr
 !ğ0xFFFFFFFFè? boÙlßd”_add¸: (
code_sz
 * 
·ge_sz
);

1636 
	}
}

1639 
	$æash_bounds_£t
()

1641 
ušt32_t
 
æash_size
 = (
FDS_PHY_PAGES
 * 
FDS_PHY_PAGE_SIZE
 * (uint32_t));

1642 
m_fs
.
’d_addr
 = 
	`æash_’d_addr
();

1643 
m_fs
.
¡¬t_addr
 = m_fs.
’d_addr
 - 
æash_size
;

1644 
	}
}

1647 
»t_code_t
 
	$æash_subsy¡em_š™
()

1649 
	`æash_bounds_£t
();

1651 #ià (
FDS_BACKEND
 =ğ
NRF_FSTORAGE_SD
)

1652  
	`Äf_f¡Üage_š™
(&
m_fs
, &
Äf_f¡Üage_sd
, 
NULL
);

1653 #–ià(
FDS_BACKEND
 =ğ
NRF_FSTORAGE_NVMC
)

1654  
	`Äf_f¡Üage_š™
(&
m_fs
, &
Äf_f¡Üage_nvmc
, 
NULL
);

1656 #”rÜ 
Inv®id
 
FDS_BACKEND
.

1658 
	}
}

1661 
	$queue_š™
()

1663 (è
	`NRF_ATFIFO_INIT
(
m_queue
);

1664 
	}
}

1667 
»t_code_t
 
	$fds_š™
()

1669 
»t_code_t
 
»t
;

1670 
fds_evt_t
 cÚ¡ 
evt_sucûss
 =

1672 .
id
 = 
FDS_EVT_INIT
,

1673 .
»suÉ
 = 
FDS_SUCCESS
,

1676 ià(
m_æags
.
š™Ÿlized
)

1679 
	`ev’t_£nd
(&
evt_sucûss
);

1680  
FDS_SUCCESS
;

1683 ià(
	`Äf_©omic_æag_£t_ãtch
(&
m_æags
.
š™Ÿlizšg
))

1686  
FDS_SUCCESS
;

1691 
»t
 = 
	`æash_subsy¡em_š™
();

1692 ià(
»t
 !ğ
NRF_SUCCESS
)

1694  
»t
;

1697 
	`queue_š™
();

1702 
fds_š™_İts_t
 
š™_İts
 = 
	`·ges_š™
();

1704 
š™_İts
)

1706 
NO_PAGES
:

1707 
NO_SWAP
:

1708  
FDS_ERR_NO_PAGES
;

1710 
ALREADY_INSTALLED
:

1713 
m_æags
.
š™Ÿlized
 = 
Œue
;

1714 
m_æags
.
š™Ÿlizšg
 = 
çl£
;

1715 
	`ev’t_£nd
(&
evt_sucûss
);

1716  
FDS_SUCCESS
;

1725 
Äf_©fifo_™em_put_t
 
ut_ùx
;

1727 
fds_İ_t
 * 
p_İ
 = 
	`queue_buf_g‘
(&
ut_ùx
);

1728 ià(
p_İ
 =ğ
NULL
)

1730  
FDS_ERR_NO_SPACE_IN_QUEUES
;

1733 
p_İ
->
İ_code
 = 
FDS_OP_INIT
;

1735 
š™_İts
)

1737 
FRESH_INSTALL
:

1738 
TAG_SWAP
:

1739 
p_İ
->
š™
.
¡•
 = 
FDS_OP_INIT_TAG_SWAP
;

1742 
PROMOTE_SWAP
:

1743 
PROMOTE_SWAP_INST
:

1744 
p_İ
->
š™
.
¡•
 = 
FDS_OP_INIT_PROMOTE_SWAP
;

1747 
DISCARD_SWAP
:

1748 
p_İ
->
š™
.
¡•
 = 
FDS_OP_INIT_ERASE_SWAP
;

1751 
TAG_DATA
:

1752 
TAG_DATA_INST
:

1753 
p_İ
->
š™
.
¡•
 = 
FDS_OP_INIT_TAG_DATA
;

1761 
	`queue_buf_¡Üe
(&
ut_ùx
);

1762 
	`queue_¡¬t
();

1764  
FDS_SUCCESS
;

1765 
	}
}

1768 
»t_code_t
 
	$fds_»cÜd_İ’
(
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
,

1769 
fds_æash_»cÜd_t
 * cÚ¡ 
p_æash_»c
)

1771 
ušt16_t
 
·ge
;

1773 ià((
p_desc
 =ğ
NULL
è|| (
p_æash_»c
 == NULL))

1775  
FDS_ERR_NULL_ARG
;

1779 ià(
	`»cÜd_fšd_by_desc
(
p_desc
, &
·ge
))

1781 
fds_h—d”_t
 cÚ¡ * cÚ¡ 
p_h—d”
 = (fds_h—d”_t*)
p_desc
->
p_»cÜd
;

1783 #ià(
FDS_CRC_CHECK_ON_READ
)

1784 ià(!
	`üc_v”ify_sucûss
(
p_h—d”
->
üc16
,

1785 
p_h—d”
->
Ëngth_wÜds
,

1786 
p_desc
->
p_»cÜd
))

1788  
FDS_ERR_CRC_CHECK_FAILED
;

1792 (è
	`Äf_©omic_u32_add
(&
m_·ges
[
·ge
].
»cÜds_İ’
, 1);

1795 
p_æash_»c
->
p_h—d”
 =…_header;

1796 
p_æash_»c
->
p_d©a
 = (
p_desc
->
p_»cÜd
 + 
FDS_HEADER_SIZE
);

1799 
p_desc
->
»cÜd_is_İ’
 = 
Œue
;

1801  
FDS_SUCCESS
;

1806  
FDS_ERR_NOT_FOUND
;

1807 
	}
}

1810 
»t_code_t
 
	$fds_»cÜd_şo£
(
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
)

1812 
»t_code_t
 
»t
;

1813 
ušt16_t
 
·ge
;

1815 ià(
p_desc
 =ğ
NULL
)

1817  
FDS_ERR_NULL_ARG
;

1820 ià(
	`»cÜd_fšd_by_desc
((
fds_»cÜd_desc_t
*)
p_desc
, &
·ge
))

1822 
	`CRITICAL_SECTION_ENTER
();

1823 ià((
m_·ges
[
·ge
].
»cÜds_İ’
 > 0è&& (
p_desc
->
»cÜd_is_İ’
))

1826 
m_·ges
[
·ge
].
»cÜds_İ’
--;

1827 
p_desc
->
»cÜd_is_İ’
 = 
çl£
;

1829 
»t
 = 
FDS_SUCCESS
;

1833 
»t
 = 
FDS_ERR_NO_OPEN_RECORDS
;

1835 
	`CRITICAL_SECTION_EXIT
();

1839 
»t
 = 
FDS_ERR_NOT_FOUND
;

1842  
»t
;

1843 
	}
}

1846 
»t_code_t
 
	$fds_»£rve
(
fds_»£rve_tok’_t
 * cÚ¡ 
p_tok
, 
ušt16_t
 
Ëngth_wÜds
)

1848 
»t_code_t
 
»t
;

1849 
ušt16_t
 
·ge
;

1851 ià(!
m_æags
.
š™Ÿlized
)

1853  
FDS_ERR_NOT_INITIALIZED
;

1856 ià(
p_tok
 =ğ
NULL
)

1858  
FDS_ERR_NULL_ARG
;

1861 
»t
 = 
	`wr™e_¥aû_»£rve
(
Ëngth_wÜds
, &
·ge
);

1863 ià(
»t
 =ğ
FDS_SUCCESS
)

1865 
p_tok
->
·ge
 =…age;

1866 
p_tok
->
Ëngth_wÜds
 =†ength_words;

1869  
»t
;

1870 
	}
}

1873 
»t_code_t
 
	$fds_»£rve_ÿnûl
(
fds_»£rve_tok’_t
 * cÚ¡ 
p_tok
)

1875 
»t_code_t
 
»t
;

1877 ià(!
m_æags
.
š™Ÿlized
)

1879  
FDS_ERR_NOT_INITIALIZED
;

1882 ià(
p_tok
 =ğ
NULL
)

1884  
FDS_ERR_NULL_ARG
;

1887 ià(
p_tok
->
·ge
 > 
FDS_DATA_PAGES
)

1890  
FDS_ERR_INVALID_ARG
;

1893 
fds_·ge_t
 cÚ¡ * cÚ¡ 
p_·ge
 = &
m_·ges
[
p_tok
->
·ge
];

1895 
	`CRITICAL_SECTION_ENTER
();

1896 ià((
FDS_HEADER_SIZE
 + 
p_tok
->
Ëngth_wÜds
è<ğ
p_·ge
->
wÜds_»£rved
)

1899 
	`wr™e_¥aû_ä“
(
p_tok
->
Ëngth_wÜds
,…_tok->
·ge
);

1902 
p_tok
->
·ge
 = 0;

1903 
p_tok
->
Ëngth_wÜds
 = 0;

1904 
»t
 = 
FDS_SUCCESS
;

1910 
»t
 = 
FDS_ERR_INVALID_ARG
;

1912 
	`CRITICAL_SECTION_EXIT
();

1914  
»t
;

1915 
	}
}

1918 
»t_code_t
 
	$fds_»cÜd_wr™e
(
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
,

1919 
fds_»cÜd_t
 cÚ¡ * cÚ¡ 
p_»cÜd
)

1921  
	`wr™e_’queue
(
p_desc
, 
p_»cÜd
, 
NULL
, 
FDS_OP_WRITE
);

1922 
	}
}

1925 
»t_code_t
 
	$fds_»cÜd_wr™e_»£rved
(
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
,

1926 
fds_»cÜd_t
 cÚ¡ * cÚ¡ 
p_»cÜd
,

1927 
fds_»£rve_tok’_t
 cÚ¡ * cÚ¡ 
p_tok
)

1930 ià(
p_tok
 =ğ
NULL
)

1932  
FDS_ERR_NULL_ARG
;

1935  
	`wr™e_’queue
(
p_desc
, 
p_»cÜd
, 
p_tok
, 
FDS_OP_WRITE
);

1936 
	}
}

1939 
»t_code_t
 
	$fds_»cÜd_upd©e
(
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
,

1940 
fds_»cÜd_t
 cÚ¡ * cÚ¡ 
p_»cÜd
)

1943 ià(
p_desc
 =ğ
NULL
)

1945  
FDS_ERR_NULL_ARG
;

1948  
	`wr™e_’queue
(
p_desc
, 
p_»cÜd
, 
NULL
, 
FDS_OP_UPDATE
);

1949 
	}
}

1952 
»t_code_t
 
	$fds_»cÜd_d–‘e
(
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
)

1954 
fds_İ_t
 * 
p_İ
;

1955 
Äf_©fifo_™em_put_t
 
ut_ùx
;

1957 ià(!
m_æags
.
š™Ÿlized
)

1959  
FDS_ERR_NOT_INITIALIZED
;

1962 ià(
p_desc
 =ğ
NULL
)

1964  
FDS_ERR_NULL_ARG
;

1967 
p_İ
 = 
	`queue_buf_g‘
(&
ut_ùx
);

1968 ià(
p_İ
 =ğ
NULL
)

1970  
FDS_ERR_NO_SPACE_IN_QUEUES
;

1973 
p_İ
->
İ_code
 = 
FDS_OP_DEL_RECORD
;

1974 
p_İ
->
d–
.
¡•
 = 
FDS_OP_DEL_RECORD_FLAG_DIRTY
;

1975 
p_İ
->
d–
.
»cÜd_to_d–‘e
 = 
p_desc
->
»cÜd_id
;

1977 
	`queue_buf_¡Üe
(&
ut_ùx
);

1978 
	`queue_¡¬t
();

1980  
FDS_SUCCESS
;

1981 
	}
}

1984 
»t_code_t
 
	$fds_fe_d–‘e
(
ušt16_t
 
fe_id
)

1986 
fds_İ_t
 * 
p_İ
;

1987 
Äf_©fifo_™em_put_t
 
ut_ùx
;

1989 ià(!
m_æags
.
š™Ÿlized
)

1991  
FDS_ERR_NOT_INITIALIZED
;

1994 ià(
fe_id
 =ğ
FDS_FILE_ID_INVALID
)

1996  
FDS_ERR_INVALID_ARG
;

1999 
p_İ
 = 
	`queue_buf_g‘
(&
ut_ùx
);

2000 ià(
p_İ
 =ğ
NULL
)

2002  
FDS_ERR_NO_SPACE_IN_QUEUES
;

2005 
p_İ
->
İ_code
 = 
FDS_OP_DEL_FILE
;

2006 
p_İ
->
d–
.
¡•
 = 
FDS_OP_DEL_FILE_FLAG_DIRTY
;

2007 
p_İ
->
d–
.
fe_id
 = file_id;

2009 
	`queue_buf_¡Üe
(&
ut_ùx
);

2010 
	`queue_¡¬t
();

2012  
FDS_SUCCESS
;

2013 
	}
}

2016 
»t_code_t
 
	$fds_gc
()

2018 
fds_İ_t
 * 
p_İ
;

2019 
Äf_©fifo_™em_put_t
 
ut_ùx
;

2021 ià(!
m_æags
.
š™Ÿlized
)

2023  
FDS_ERR_NOT_INITIALIZED
;

2026 
p_İ
 = 
	`queue_buf_g‘
(&
ut_ùx
);

2027 ià(
p_İ
 =ğ
NULL
)

2029  
FDS_ERR_NO_SPACE_IN_QUEUES
;

2032 
p_İ
->
İ_code
 = 
FDS_OP_GC
;

2034 
	`queue_buf_¡Üe
(&
ut_ùx
);

2036 ià(
m_gc
.
¡©e
 !ğ
GC_BEGIN
)

2039 
m_gc
.
»sume
 = 
Œue
;

2042 
	`queue_¡¬t
();

2044  
FDS_SUCCESS
;

2045 
	}
}

2048 
»t_code_t
 
	$fds_»cÜd_™”©e
(
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
,

2049 
fds_fšd_tok’_t
 * cÚ¡ 
p_tok’
)

2051  
	`»cÜd_fšd
(
NULL
, NULL, 
p_desc
, 
p_tok’
);

2052 
	}
}

2055 
»t_code_t
 
	$fds_»cÜd_fšd
(
ušt16_t
 
fe_id
,

2056 
ušt16_t
 
»cÜd_key
,

2057 
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
,

2058 
fds_fšd_tok’_t
 * cÚ¡ 
p_tok’
)

2060  
	`»cÜd_fšd
(&
fe_id
, &
»cÜd_key
, 
p_desc
, 
p_tok’
);

2061 
	}
}

2064 
»t_code_t
 
	$fds_»cÜd_fšd_by_key
(
ušt16_t
 
»cÜd_key
,

2065 
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
,

2066 
fds_fšd_tok’_t
 * cÚ¡ 
p_tok’
)

2068  
	`»cÜd_fšd
(
NULL
, &
»cÜd_key
, 
p_desc
, 
p_tok’
);

2069 
	}
}

2072 
»t_code_t
 
	$fds_»cÜd_fšd_š_fe
(
ušt16_t
 
fe_id
,

2073 
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
,

2074 
fds_fšd_tok’_t
 * cÚ¡ 
p_tok’
)

2076  
	`»cÜd_fšd
(&
fe_id
, 
NULL
, 
p_desc
, 
p_tok’
);

2077 
	}
}

2080 
»t_code_t
 
	$fds_desütÜ_äom_»c_id
(
fds_»cÜd_desc_t
 * cÚ¡ 
p_desc
,

2081 
ušt32_t
 
»cÜd_id
)

2083 ià(
p_desc
 =ğ
NULL
)

2085  
FDS_ERR_NULL_ARG
;

2089 
	`mem£t
(
p_desc
, 0x00, (
fds_»cÜd_desc_t
));

2090 
p_desc
->
»cÜd_id
 =„ecord_id;

2092  
FDS_SUCCESS
;

2093 
	}
}

2096 
»t_code_t
 
	$fds_»cÜd_id_äom_desc
(
fds_»cÜd_desc_t
 cÚ¡ * cÚ¡ 
p_desc
,

2097 
ušt32_t
 * cÚ¡ 
p_»cÜd_id
)

2099 ià((
p_desc
 =ğ
NULL
è|| (
p_»cÜd_id
 == NULL))

2101  
FDS_ERR_NULL_ARG
;

2104 *
p_»cÜd_id
 = 
p_desc
->
»cÜd_id
;

2106  
FDS_SUCCESS
;

2107 
	}
}

2110 
»t_code_t
 
	$fds_¡©
(
fds_¡©_t
 * cÚ¡ 
p_¡©
)

2112 
ušt16_t
 cÚ¡ 
wÜds_š_·ge
 = 
FDS_PAGE_SIZE
;

2114 
ušt16_t
 
cÚtig_wÜds
 = 0;

2116 ià(!
m_æags
.
š™Ÿlized
)

2118  
FDS_ERR_NOT_INITIALIZED
;

2121 ià(
p_¡©
 =ğ
NULL
)

2123  
FDS_ERR_NULL_ARG
;

2126 
	`mem£t
(
p_¡©
, 0x00, (
fds_¡©_t
));

2128 
p_¡©
->
·ges_avaabË
 = 
FDS_VIRTUAL_PAGES
;

2130 
ušt16_t
 
·ge
 = 0;…ag< 
FDS_DATA_PAGES
;…age++)

2132 
ušt16_t
 cÚ¡ 
wÜds_u£d
 = 
m_·ges
[
·ge
].
wr™e_off£t
 + m_·ges[·ge].
wÜds_»£rved
;

2134 ià(
	`·ge_id’tify
(
m_·ges
[
·ge
].
p_addr
è=ğ
FDS_PAGE_UNDEFINED
)

2136 
p_¡©
->
·ges_avaabË
--;

2139 
p_¡©
->
İ’_»cÜds
 +ğ
m_·ges
[
·ge
].
»cÜds_İ’
;

2140 
p_¡©
->
wÜds_»£rved
 +ğ
m_·ges
[
·ge
].words_reserved;

2141 
p_¡©
->
wÜds_u£d
 += words_used;

2143 
cÚtig_wÜds
 = (
wÜds_š_·ge
 - 
wÜds_u£d
);

2144 ià(
cÚtig_wÜds
 > 
p_¡©
->
Ïrge¡_cÚtig
)

2146 
p_¡©
->
Ïrge¡_cÚtig
 = 
cÚtig_wÜds
;

2149 
	`»cÜds_¡©
(
·ge
,

2150 &
p_¡©
->
v®id_»cÜds
,

2151 &
p_¡©
->
dœty_»cÜds
,

2152 &
p_¡©
->
ä“abË_wÜds
,

2153 &
p_¡©
->
cÜru±iÚ
);

2156  
FDS_SUCCESS
;

2157 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\fstorage\nrf_fstorage.c

40 
	~"sdk_cÚfig.h
"

42 #ià
NRF_FSTORAGE_ENABLED


44 
	~"Äf_f¡Üage.h
"

45 
	~<¡ddef.h
>

46 
	~<¡dšt.h
>

47 
	~"sdk_”rÜs.h
"

48 
	~"Äf_£ùiÚ.h
"

52 
NRF_SECTION_DEF
(
fs_d©a
, 
Äf_f¡Üage_t
);

54 
boŞ
 
addr_w™hš_bounds
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
, 
ušt32_t
 
addr
, ušt32_ˆ
Ën
);

55 
boŞ
 
addr_is_®igÃd32
(
ušt32_t
 
addr
);

58 
»t_code_t
 
	$Äf_f¡Üage_š™
(
Äf_f¡Üage_t
 * 
p_fs
,

59 
Äf_f¡Üage_­i_t
 * 
p_­i
,

60 * 
p_·¿m
)

62 ià((
p_fs
 =ğ
NULL
è|| (
p_­i
 == NULL))

64  
NRF_ERROR_NULL
;

67 
p_fs
->
p_­i
 =…_api;

69  (
p_fs
->
p_­i
)->
	`š™
Õ_fs, 
p_·¿m
);

70 
	}
}

73 
»t_code_t
 
	$Äf_f¡Üage_unš™
(
Äf_f¡Üage_t
 * 
p_fs
,

74 * 
p_·¿m
)

76 
»t_code_t
 
rc
;

78 ià(
p_fs
 =ğ
NULL
)

80  
NRF_ERROR_NULL
;

83 ià(
p_fs
->
p_­i
 =ğ
NULL
)

85  
NRF_ERROR_INVALID_STATE
;

88 
rc
 = (
p_fs
->
p_­i
)->
	`unš™
Õ_fs, 
p_·¿m
);

91 
p_fs
->
p_­i
 = 
NULL
;

92 
p_fs
->
p_æash_šfo
 = 
NULL
;

94  
rc
;

95 
	}
}

98 
»t_code_t
 
	$Äf_f¡Üage_»ad
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
,

99 
ušt32_t
 
¤c
,

100 * 
p_de¡
,

101 
ušt32_t
 
Ën
)

103 ià((
p_fs
 =ğ
NULL
è|| (
p_de¡
 == NULL))

105  
NRF_ERROR_NULL
;

108 ià(
p_fs
->
p_­i
 =ğ
NULL
)

110  
NRF_ERROR_INVALID_STATE
;

113 ià(
Ën
 == 0)

115  
NRF_ERROR_INVALID_LENGTH
;

119 iàĞ!
	`addr_is_®igÃd32
(
¤c
)

120 || !
	`addr_w™hš_bounds
(
p_fs
, 
¤c
, 
Ën
))

122  
NRF_ERROR_INVALID_ADDR
;

125  (
p_fs
->
p_­i
)->
	`»ad
Õ_fs, 
¤c
, 
p_de¡
, 
Ën
);

126 
	}
}

129 
»t_code_t
 
	$Äf_f¡Üage_wr™e
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
,

130 
ušt32_t
 
de¡
,

131 cÚ¡ * 
p_¤c
,

132 
ušt32_t
 
Ën
,

133 * 
p_cÚ‹xt
)

135 ià((
p_fs
 =ğ
NULL
è|| (
p_¤c
 == NULL))

137  
NRF_ERROR_NULL
;

140 ià(
p_fs
->
p_­i
 =ğ
NULL
)

142  
NRF_ERROR_INVALID_STATE
;

146 ià((
Ën
 =ğ0è|| (Ö’ % 
p_fs
->
p_æash_šfo
->
´og¿m_un™
) != 0))

148  
NRF_ERROR_INVALID_LENGTH
;

152 iàĞ!
	`addr_is_®igÃd32
(
de¡
)

153 || !
	`addr_is_®igÃd32
((
ušt32_t
)
p_¤c
)

154 || !
	`addr_w™hš_bounds
(
p_fs
, 
de¡
, 
Ën
))

156  
NRF_ERROR_INVALID_ADDR
;

159  (
p_fs
->
p_­i
)->
	`wr™e
Õ_fs, 
de¡
, 
p_¤c
, 
Ën
, 
p_cÚ‹xt
);

160 
	}
}

163 
»t_code_t
 
	$Äf_f¡Üage_”a£
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
,

164 
ušt32_t
 
·ge_addr
,

165 
ušt32_t
 
Ën
,

166 * 
p_cÚ‹xt
)

168 ià(
p_fs
 =ğ
NULL
)

170  
NRF_ERROR_NULL
;

173 ià(
p_fs
->
p_­i
 =ğ
NULL
)

175  
NRF_ERROR_INVALID_STATE
;

178 ià(
Ën
 == 0)

180  
NRF_ERROR_INVALID_LENGTH
;

184 iàĞ((
·ge_addr
 & (
p_fs
->
p_æash_šfo
->
”a£_un™
 - 1)) != 0)

185 || !
	`addr_w™hš_bounds
(
p_fs
, 
·ge_addr
, (
Ën
 *…_fs->
p_æash_šfo
->
”a£_un™
)))

187  
NRF_ERROR_INVALID_ADDR
;

190  (
p_fs
->
p_­i
)->
	`”a£
Õ_fs, 
·ge_addr
, 
Ën
, 
p_cÚ‹xt
);

191 
	}
}

194 
ušt8_t
 cÚ¡ * 
	$Äf_f¡Üage_rm­
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
, 
ušt32_t
 
addr
)

196 ià(
p_fs
 =ğ
NULL
)

198  
NULL
;

201  (
p_fs
->
p_­i
)->
	`rm­
Õ_fs, 
addr
);

202 
	}
}

205 
ušt8_t
 * 
	$Äf_f¡Üage_wm­
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
, 
ušt32_t
 
addr
)

207 ià(
p_fs
 =ğ
NULL
)

209  
NULL
;

212  (
p_fs
->
p_­i
)->
	`wm­
Õ_fs, 
addr
);

213 
	}
}

216 
boŞ
 
	$Äf_f¡Üage_is_busy
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
)

220 ià((
p_fs
 =ğ
NULL
è|| (p_fs->
p_­i
 == NULL))

222 
ušt32_t
 
i
 = 0; i < 
NRF_FSTORAGE_INSTANCE_CNT
; i++)

224 
p_fs
 = 
	`NRF_FSTORAGE_INSTANCE_GET
(
i
);

225 ià(
p_fs
->
p_­i
 !ğ
NULL
)

228 ià(
p_fs
->
p_­i
->
	`is_busy
(p_fs))

230  
Œue
;

235  
çl£
;

238  
p_fs
->
p_­i
->
	`is_busy
(p_fs);

239 
	}
}

242 
boŞ
 
	$addr_w™hš_bounds
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
,

243 
ušt32_t
 
addr
,

244 
ušt32_t
 
Ën
)

246  ((
addr
 >ğ
p_fs
->
¡¬t_addr
) &&

247 (
addr
 + 
Ën
 - 1 <ğ
p_fs
->
’d_addr
));

248 
	}
}

251 
boŞ
 
	$addr_is_®igÃd32
(
ušt32_t
 
addr
)

253  !(
addr
 & 0x03);

254 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\fstorage\nrf_fstorage_sd.c

41 
	~"sdk_commÚ.h
"

43 #ià
NRF_MODULE_ENABLED
(
NRF_FSTORAGE
)

45 
	~"Äf_f¡Üage_sd.h
"

46 
	~<¡dšt.h
>

47 
	~<¡ršg.h
>

48 
	~<¡dboŞ.h
>

49 
	~"nÜdic_commÚ.h
"

50 
	~"Äf_soc.h
"

51 
	~"Äf_sdh.h
"

52 
	~"Äf_sdh_soc.h
"

53 
	~"Äf_©omic.h
"

54 
	~"Äf_©fifo.h
"

55 
	~"­p_ut_¶©fÜm.h
"

58 #ià(
NRF_FSTORAGE_SD_MAX_WRITE_SIZE
 % 4)

59 #”rÜ 
NRF_FSTORAGE_SD_MAX_WRITE_SIZE
 
mu¡
 
be
 
a
 
muÉË
 
of
 
the
 
wÜd
 
size
.

66 
	mNRF_FSTORAGE_OP_WRITE
,

67 
	mNRF_FSTORAGE_OP_ERASE


68 } 
	tÄf_f¡Üage_sd_İcode_t
;

70 
ANON_UNIONS_ENABLE


74 
Äf_f¡Üage_t
 cÚ¡ * 
	mp_fs
;

75 
Äf_f¡Üage_sd_İcode_t
 
	mİ_code
;

76 * 
	mp_·¿m
;

81 cÚ¡ * 
	mp_¤c
;

82 
ušt32_t
 
	mde¡
;

83 
ušt32_t
 
	mËn
;

84 
ušt32_t
 
	moff£t
;

85 } 
	mwr™e
;

88 
ušt32_t
 
	m·ge
;

89 
ušt32_t
 
	m´og»ss
;

90 
ušt32_t
 
	m·ges_to_”a£
;

91 } 
	m”a£
;

93 } 
	tÄf_f¡Üage_sd_İ_t
;

94 
ANON_UNIONS_DISABLE


98 
	mNRF_FSTORAGE_STATE_IDLE
,

99 
	mNRF_FSTORAGE_STATE_OP_PENDING
,

100 
	mNRF_FSTORAGE_STATE_OP_EXECUTING
,

101 } 
	tÄf_f¡Üage_sd_¡©e_t
;

106 
Äf_©omic_æag_t
 
	mš™Ÿlized
;

107 
Äf_©omic_æag_t
 
	mqueue_ruÂšg
;

109 
Äf_f¡Üage_sd_¡©e_t
 
	m¡©e
;

110 
ušt32_t
 
	m»Œ›s
;

111 
boŞ
 
	msd_’abËd
;

112 
boŞ
 
	m·u£d
;

114 } 
	tÄf_f¡Üage_sd_wÜk_t
;

117 
Äf_f¡Üage_sys_evt_hªdËr
(
ušt32_t
, *);

118 
boŞ
 
Äf_f¡Üage_sdh_»q_hªdËr
(
Äf_sdh_»q_evt_t
, *);

119 
Äf_f¡Üage_sdh_¡©e_hªdËr
(
Äf_sdh_¡©e_evt_t
, *);

123 
Äf_f¡Üage_šfo_t
 
	gm_æash_šfo
 =

125 #ià 
defšed
(
NRF51
)

126 .
”a£_un™
 = 1024,

127 #–ià
defšed
(
NRF52_SERIES
)

128 .
	g”a£_un™
 = 4096,

130 .
	g´og¿m_un™
 = 4,

131 .
	grm­
 = 
Œue
,

132 .
	gwm­
 = 
çl£
,

136 
NRF_ATFIFO_DEF
(
m_fifo
, 
Äf_f¡Üage_sd_İ_t
, 
NRF_FSTORAGE_SD_QUEUE_SIZE
);

139 
NRF_SDH_SOC_OBSERVER
(
m_sys_obs
, 0, 
Äf_f¡Üage_sys_evt_hªdËr
, 
NULL
);

142 
NRF_SDH_REQUEST_OBSERVER
(
m_»q_obs
, 0) =

144 .
hªdËr
 = 
Äf_f¡Üage_sdh_»q_hªdËr
,

148 
NRF_SDH_STATE_OBSERVER
(
m_¡©e_obs
, 0) =

150 .
hªdËr
 = 
Äf_f¡Üage_sdh_¡©e_hªdËr
,

153 
Äf_f¡Üage_sd_wÜk_t
 
	gm_æags
;

154 
Äf_f¡Üage_sd_İ_t
 * 
	gm_p_cur_İ
;

155 
Äf_©fifo_™em_g‘_t
 
	gm_ig‘_ùx
;

159 
	$ev’t_£nd
(
Äf_f¡Üage_sd_İ_t
 cÚ¡ * 
p_İ
, 
»t_code_t
 
»suÉ
)

161 ià(
p_İ
->
p_fs
->
evt_hªdËr
 =ğ
NULL
)

167 
Äf_f¡Üage_evt_t
 
evt
 =

169 .
»suÉ
 =„esult,

170 .
p_·¿m
 = 
p_İ
->p_param,

173 
p_İ
->
İ_code
)

175 
NRF_FSTORAGE_OP_WRITE
:

176 
evt
.
id
 = 
NRF_FSTORAGE_EVT_WRITE_RESULT
;

177 
evt
.
addr
 = 
p_İ
->
wr™e
.
de¡
;

178 
evt
.
Ën
 = 
p_İ
->
wr™e
.len;

181 
NRF_FSTORAGE_OP_ERASE
:

182 
evt
.
id
 = 
NRF_FSTORAGE_EVT_ERASE_RESULT
;

183 
evt
.
addr
 = (
p_İ
->
”a£
.
·ge
 * 
m_æash_šfo
.
”a£_un™
);

184 
evt
.
Ën
 = 
p_İ
->
”a£
.
·ges_to_”a£
;

192 
p_İ
->
p_fs
->
	`evt_hªdËr
(&
evt
);

193 
	}
}

197 
ušt32_t
 
	$wr™e_execu‹
(
Äf_f¡Üage_sd_İ_t
 cÚ¡ * 
p_İ
)

199 
ušt32_t
 
chunk_Ën
;

201 
chunk_Ën
 = 
	`MIN
(
p_İ
->
wr™e
.
Ën
 -…_İ->wr™e.
off£t
, 
NRF_FSTORAGE_SD_MAX_WRITE_SIZE
);

202 
chunk_Ën
 = 
	`MAX
(1, chunk_ËÀ/ 
m_æash_šfo
.
´og¿m_un™
);

205 
ušt32_t
 * 
p_de¡
 = (ušt32_t*)(
p_İ
->
wr™e
.
de¡
 +…_İ->wr™e.
off£t
);

206 
ušt32_t
 cÚ¡ * 
p_¤c
 = (ušt32_t*)((ušt32_t)
p_İ
->
wr™e
.p_¤ø+…_İ->wr™e.
off£t
);

208  
	`sd_æash_wr™e
(
p_de¡
, 
p_¤c
, 
chunk_Ën
);

209 
	}
}

213 
ušt32_t
 
	$”a£_execu‹
(
Äf_f¡Üage_sd_İ_t
 cÚ¡ * 
p_İ
)

215  
	`sd_æash_·ge_”a£
(
p_İ
->
”a£
.
·ge
 +…_İ->”a£.
´og»ss
);

216 
	}
}

220 
	$queue_ä“
()

222 (è
	`Äf_©fifo_™em_ä“
(
m_fifo
, &
m_ig‘_ùx
);

223 
	}
}

227 
boŞ
 
	$queue_lßd_Ãxt
()

229 
m_p_cur_İ
 = 
	`Äf_©fifo_™em_g‘
(
m_fifo
, &
m_ig‘_ùx
);

231  (
m_p_cur_İ
 !ğ
NULL
);

232 
	}
}

236 
	$queue_´oûss
()

238 ià(
m_æags
.
¡©e
 =ğ
NRF_FSTORAGE_STATE_IDLE
)

240 ià(!
	`queue_lßd_Ãxt
())

243 
m_æags
.
queue_ruÂšg
 = 
çl£
;

248 
m_æags
.
¡©e
 = 
NRF_FSTORAGE_STATE_OP_EXECUTING
;

250 
ušt32_t
 
rc
;

251 
m_p_cur_İ
->
İ_code
)

253 
NRF_FSTORAGE_OP_WRITE
:

254 
rc
 = 
	`wr™e_execu‹
(
m_p_cur_İ
);

257 
NRF_FSTORAGE_OP_ERASE
:

258 
rc
 = 
	`”a£_execu‹
(
m_p_cur_İ
);

262 
rc
 = 
NRF_ERROR_INTERNAL
;

266 
rc
)

268 
NRF_SUCCESS
:

273 ià(!
m_æags
.
sd_’abËd
)

275 
	`Äf_f¡Üage_sys_evt_hªdËr
(
NRF_EVT_FLASH_OPERATION_SUCCESS
, 
NULL
);

279 
NRF_ERROR_BUSY
:

283 
m_æags
.
¡©e
 = 
NRF_FSTORAGE_STATE_OP_PENDING
;

290 
	`ev’t_£nd
(
m_p_cur_İ
, 
NRF_ERROR_INTERNAL
);

291 
m_æags
.
¡©e
 = 
NRF_FSTORAGE_STATE_IDLE
;

292 
m_æags
.
queue_ruÂšg
 = 
çl£
;

295 
	}
}

299 
	$queue_¡¬t
()

301 
Äf_©omic_æag_t
 
queue_ruÂšg
 = 
	`Äf_©omic_u32_ãtch_¡Üe
(&
m_æags
.queue_ruÂšg, 
Œue
);

303 iàĞ(!
queue_ruÂšg
)

304 && (!
m_æags
.
·u£d
))

306 
	`queue_´oûss
();

308 
	}
}

312 
boŞ
 
	$Ú_İ”©iÚ_sucûss
(
Äf_f¡Üage_sd_İ_t
 * cÚ¡ 
p_İ
)

315 
m_æags
.
»Œ›s
 = 0;

317 
p_İ
->
İ_code
)

319 
NRF_FSTORAGE_OP_WRITE
:

323 
ušt32_t
 cÚ¡ 
chunk_Ën
 = 
	`MIN
(
p_İ
->
wr™e
.
Ën
 -…_İ->wr™e.
off£t
,

324 
NRF_FSTORAGE_SD_MAX_WRITE_SIZE
);

326 
p_İ
->
wr™e
.
off£t
 +ğ
chunk_Ën
;

328 ià(
p_İ
->
wr™e
.
off£t
 =ğp_İ->wr™e.
Ën
)

330  
Œue
;

334 
NRF_FSTORAGE_OP_ERASE
:

336 
p_İ
->
”a£
.
´og»ss
++;

338 ià(
p_İ
->
”a£
.
´og»ss
 =ğp_İ->”a£.
·ges_to_”a£
)

340  
Œue
;

349  
çl£
;

350 
	}
}

354 
boŞ
 
	$Ú_İ”©iÚ_çu»
(
Äf_f¡Üage_sd_İ_t
 cÚ¡ * 
p_İ
)

356 
	`UNUSED_PARAMETER
(
p_İ
);

358 
m_æags
.
»Œ›s
++;

360 ià(
m_æags
.
»Œ›s
 > 
NRF_FSTORAGE_SD_MAX_RETRIES
)

363 
m_æags
.
»Œ›s
 = 0;

364  
Œue
;

367  
çl£
;

368 
	}
}

371 
»t_code_t
 
	$š™
(
Äf_f¡Üage_t
 * 
p_fs
, * 
p_·¿m
)

373 
	`UNUSED_PARAMETER
(
p_·¿m
);

375 ià(!
	`Äf_©omic_æag_£t_ãtch
(&
m_æags
.
š™Ÿlized
))

377 
p_fs
->
p_æash_šfo
 = &
m_æash_šfo
;

379 #ià
NRF_SDH_ENABLED


380 
m_æags
.
sd_’abËd
 = 
	`Äf_sdh_is_’abËd
();

383 (è
	`NRF_ATFIFO_INIT
(
m_fifo
);

386  
NRF_SUCCESS
;

387 
	}
}

390 
»t_code_t
 
	$unš™
(
Äf_f¡Üage_t
 * 
p_fs
, * 
p_·¿m
)

392 
	`UNUSED_PARAMETER
(
p_fs
);

393 
	`UNUSED_PARAMETER
(
p_·¿m
);

398 
	`mem£t
(&
m_æags
, 0x00, (m_flags));

400 (è
	`Äf_©fifo_ş—r
(
m_fifo
);

402  
NRF_SUCCESS
;

403 
	}
}

406 
»t_code_t
 
	$wr™e
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
,

407 
ušt32_t
 
de¡
,

408 cÚ¡ * 
p_¤c
,

409 
ušt32_t
 
Ën
,

410 * 
p_·¿m
)

412 
Äf_f¡Üage_sd_İ_t
 * 
p_İ
;

413 
Äf_©fifo_™em_put_t
 
ut_ùx
;

416 
p_İ
 = 
	`Äf_©fifo_™em_®loc
(
m_fifo
, &
ut_ùx
);

418 ià(
p_İ
 =ğ
NULL
)

420  
NRF_ERROR_NO_MEM
;

424 
	`mem£t
(
p_İ
, 0x00, (
Äf_f¡Üage_sd_İ_t
));

426 
p_İ
->
İ_code
 = 
NRF_FSTORAGE_OP_WRITE
;

427 
p_İ
->
p_fs
 =…_fs;

428 
p_İ
->
p_·¿m
 =…_param;

429 
p_İ
->
wr™e
.
de¡
 = dest;

430 
p_İ
->
wr™e
.
p_¤c
 =…_src;

431 
p_İ
->
wr™e
.
Ën
 =†en;

434 (è
	`Äf_©fifo_™em_put
(
m_fifo
, &
ut_ùx
);

436 
	`queue_¡¬t
();

438  
NRF_SUCCESS
;

439 
	}
}

442 
»t_code_t
 
	$»ad
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
, 
ušt32_t
 
¤c
, * 
p_de¡
, ušt32_ˆ
Ën
)

444 
	`memıy
(
p_de¡
, (
ušt32_t
*)
¤c
, 
Ën
);

446  
NRF_SUCCESS
;

447 
	}
}

450 
»t_code_t
 
	$”a£
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
,

451 
ušt32_t
 
·ge_addr
,

452 
ušt32_t
 
Ën
,

453 * 
p_·¿m
)

455 
Äf_f¡Üage_sd_İ_t
 * 
p_İ
;

456 
Äf_©fifo_™em_put_t
 
ut_ùx
;

459 
p_İ
 = 
	`Äf_©fifo_™em_®loc
(
m_fifo
, &
ut_ùx
);

461 ià(
p_İ
 =ğ
NULL
)

463  
NRF_ERROR_NO_MEM
;

467 
	`mem£t
(
p_İ
, 0x00, (
Äf_f¡Üage_sd_İ_t
));

469 
p_İ
->
İ_code
 = 
NRF_FSTORAGE_OP_ERASE
;

470 
p_İ
->
p_fs
 =…_fs;

471 
p_İ
->
p_·¿m
 =…_param;

472 
p_İ
->
”a£
.
·ge
 = (
·ge_addr
 / 
m_æash_šfo
.
”a£_un™
);

473 
p_İ
->
”a£
.
·ges_to_”a£
 = 
Ën
;

476 (è
	`Äf_©fifo_™em_put
(
m_fifo
, &
ut_ùx
);

478 
	`queue_¡¬t
();

480  
NRF_SUCCESS
;

481 
	}
}

484 
ušt8_t
 cÚ¡ * 
	$rm­
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
, 
ušt32_t
 
addr
)

486 
	`UNUSED_PARAMETER
(
p_fs
);

488  (
ušt8_t
*)
addr
;

489 
	}
}

492 
ušt8_t
 * 
	$wm­
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
, 
ušt32_t
 
addr
)

494 
	`UNUSED_PARAMETER
(
p_fs
);

495 
	`UNUSED_PARAMETER
(
addr
);

498  
NULL
;

499 
	}
}

502 
boŞ
 
	$is_busy
(
Äf_f¡Üage_t
 cÚ¡ * 
p_fs
)

504 
	`UNUSED_PARAMETER
(
p_fs
);

506  (
m_æags
.
¡©e
 !ğ
NRF_FSTORAGE_STATE_IDLE
);

507 
	}
}

510 
	$Äf_f¡Üage_sys_evt_hªdËr
(
ušt32_t
 
sys_evt
, * 
p_cÚ‹xt
)

512 
	`UNUSED_PARAMETER
(
p_cÚ‹xt
);

514 
m_æags
.
¡©e
)

516 
NRF_FSTORAGE_STATE_OP_EXECUTING
:

519 
boŞ
 
İ”©iÚ_fšished
 = 
çl£
;

521 
sys_evt
)

523 
NRF_EVT_FLASH_OPERATION_SUCCESS
:

524 
İ”©iÚ_fšished
 = 
	`Ú_İ”©iÚ_sucûss
(
m_p_cur_İ
);

527 
NRF_EVT_FLASH_OPERATION_ERROR
:

528 
İ”©iÚ_fšished
 = 
	`Ú_İ”©iÚ_çu»
(
m_p_cur_İ
);

535 ià(
İ”©iÚ_fšished
)

539 
m_æags
.
¡©e
 = 
NRF_FSTORAGE_STATE_IDLE
;

541 
	`ev’t_£nd
(
m_p_cur_İ
, (
sys_evt
 =ğ
NRF_EVT_FLASH_OPERATION_SUCCESS
) ?

542 
NRF_SUCCESS
 : 
NRF_ERROR_TIMEOUT
);

547 
	`queue_ä“
();

551 
NRF_FSTORAGE_STATE_OP_PENDING
:

562 ià(!
m_æags
.
·u£d
)

564 
	`queue_´oûss
();

569 (è
	`Äf_sdh_»que¡_cÚtšue
();

571 
	}
}

574 
boŞ
 
	$Äf_f¡Üage_sdh_»q_hªdËr
(
Äf_sdh_»q_evt_t
 
»q
, * 
p_cÚ‹xt
)

576 
	`UNUSED_PARAMETER
(
»q
);

577 
	`UNUSED_PARAMETER
(
p_cÚ‹xt
);

579 
m_æags
.
·u£d
 = 
Œue
;

582  (
m_æags
.
¡©e
 =ğ
NRF_FSTORAGE_STATE_IDLE
);

583 
	}
}

586 
	$Äf_f¡Üage_sdh_¡©e_hªdËr
(
Äf_sdh_¡©e_evt_t
 
¡©e
, * 
p_cÚ‹xt
)

588 
	`UNUSED_PARAMETER
(
p_cÚ‹xt
);

590 iàĞ(
¡©e
 =ğ
NRF_SDH_EVT_STATE_ENABLED
)

591 || (
¡©e
 =ğ
NRF_SDH_EVT_STATE_DISABLED
))

593 
m_æags
.
·u£d
 = 
çl£
;

594 
m_æags
.
sd_’abËd
 = (
¡©e
 =ğ
NRF_SDH_EVT_STATE_ENABLED
);

597 
	`queue_´oûss
();

599 
	}
}

603 
Äf_f¡Üage_­i_t
 
	gÄf_f¡Üage_sd
 =

605 .
š™
 = init,

606 .
	gunš™
 = 
unš™
,

607 .
	g»ad
 = 
»ad
,

608 .
	gwr™e
 = 
wr™e
,

609 .
	g”a£
 = 
”a£
,

610 .
	grm­
 = 
rm­
,

611 .
	gwm­
 = 
wm­
,

612 .
	gis_busy
 = 
is_busy


	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\hardfault\hardfault_implementation.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
HARDFAULT_HANDLER
)

42 
	~"h¬dçuÉ.h
"

43 
	~"Äf.h
"

44 
	~"comp”_ab¡¿ùiÚ.h
"

45 
	~"­p_ut_¶©fÜm.h
"

46 #ifdeà
SOFTDEVICE_PRESENT


47 
	~"Äf_soc.h
"

49 
	#NRF_LOG_MODULE_NAME
 
h¬dçuÉ


	)

50 
	~"Äf_log.h
"

51 
	~"Äf_log_ù¾.h
"

52 
NRF_LOG_MODULE_REGISTER
();

54 #ià
defšed
(
DEBUG_NRF
)

61 vŞ©
H¬dFauÉ_¡ack_t
 * 
	gH¬dFauÉ_p_¡ack
;

65 
__WEAK
 
	$H¬dFauÉ_´oûss
(
H¬dFauÉ_¡ack_t
 * 
p_¡ack
)

68 
	`NVIC_Sy¡emRe£t
();

69 
	}
}

72 
	$H¬dFauÉ_c_hªdËr
(
ušt32_t
 * 
p_¡ack_add»ss
)

74 
	`NRF_LOG_FINAL_FLUSH
();

76 #ià(
__CORTEX_M
 == 0x04)

78 #iâdeà
CFSR_MMARVALID


79 
	#CFSR_MMARVALID
 (1 << (0 + 7))

	)

82 #iâdeà
CFSR_BFARVALID


83 
	#CFSR_BFARVALID
 (1 << (8 + 7))

	)

86 #ià
	`defšed
(
DEBUG
)

88 
H¬dFauÉ_¡ack_t
 * 
p_¡ack
 = (H¬dFauÉ_¡ack_ˆ*)
p_¡ack_add»ss
;

89 cÚ¡ *
cf¤_msgs
[] = {

92 [2] = 
NULL
,

96 [6] = 
NULL
,

97 [7] = 
NULL
,

104 [14] = 
NULL
,

105 [15] = 
NULL
,

110 [20] = 
NULL
,

111 [21] = 
NULL
,

112 [22] = 
NULL
,

113 [23] = 
NULL
,

118 
ušt32_t
 
cf¤
 = 
SCB
->
CFSR
;

121 
	`NRF_LOG_ERROR
("HARD FAULT‡ˆ0x%08X", 
p_¡ack
->
pc
);

122 
	`NRF_LOG_ERROR
(" R0: 0x%08X R1: 0x%08X R2: 0x%08X R3: 0x%08X",

123 
p_¡ack
->
r0
,…_¡ack->
r1
,…_¡ack->
r2
,…_¡ack->
r3
);

124 
	`NRF_LOG_ERROR
(" R12: 0x%08X LR: 0x%08X PSR: 0x%08X",

125 
p_¡ack
->
r12
,…_¡ack->
Ì
,…_¡ack->
p¤
);

127 ià(
SCB
->
HFSR
 & 
SCB_HFSR_VECTTBL_Msk
)

129 
	`NRF_LOG_ERROR
("Cause: BusFault on‡ vectorable„ead duringƒxception…rocessing.");

132 
ušt32_t
 
i
 = 0; i < (
cf¤_msgs
) / (cfsr_msgs[0]); i++)

134 ià(((
cf¤
 & (1 << 
i
)è!ğ0è&& (
cf¤_msgs
[i] !ğ
NULL
))

136 
	`NRF_LOG_ERROR
("Cau£: %s.", (
ušt32_t
)
cf¤_msgs
[
i
]);

140 ià(
cf¤
 & 
CFSR_MMARVALID
)

142 
	`NRF_LOG_ERROR
("MemMªagFauÉ Add»ss: 0x%08X", 
SCB
->
MMFAR
);

145 ià(
cf¤
 & 
CFSR_BFARVALID
)

147 
	`NRF_LOG_ERROR
("Bu FauÉ Add»ss: 0x%08X", 
SCB
->
BFAR
);

150 
NRF_BREAKPOINT_COND
;

156 
	`H¬dFauÉ_´oûss
((
H¬dFauÉ_¡ack_t
 *)
p_¡ack_add»ss
);

157 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\pwr_mgmt\nrf_pwr_mgmt.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
NRF_PWR_MGMT
)

43 
	~"Äf_pwr_mgmt.h
"

44 
	~"Äf.h
"

45 
	~"Äf_mtx.h
"

46 
	~"Äf_pow”.h
"

47 
	~"­p_”rÜ.h
"

48 
	~"Äf_as£¹.h
"

49 
	~"Äf_log_ù¾.h
"

50 
	~"­p_ut_¶©fÜm.h
"

52 
	#NRF_LOG_MODULE_NAME
 
pwr_mgmt


	)

53 #ià
NRF_PWR_MGMT_CONFIG_LOG_ENABLED


54 
	#NRF_LOG_LEVEL
 
NRF_PWR_MGMT_CONFIG_LOG_LEVEL


	)

55 
	#NRF_LOG_INFO_COLOR
 
NRF_PWR_MGMT_CONFIG_INFO_COLOR


	)

56 
	#NRF_LOG_DEBUG_COLOR
 
NRF_PWR_MGMT_CONFIG_DEBUG_COLOR


	)

58 
	#NRF_LOG_LEVEL
 0

	)

60 
	~"Äf_log.h
"

61 
NRF_LOG_MODULE_REGISTER
();

63 #ifdeà
SOFTDEVICE_PRESENT


64 
	~"Äf_soc.h
"

65 
	~"Äf_sdh.h
"

69 #ià
NRF_PWR_MGMT_CONFIG_USE_SCHEDULER


70 #ià(
APP_SCHEDULER_ENABLED
 != 1)

73 
	~"­p_scheduËr.h
"

78 
NRF_SECTION_SET_DEF
(
pwr_mgmt_d©a
,

79 
Äf_pwr_mgmt_shutdown_hªdËr_t
,

80 
NRF_PWR_MGMT_CONFIG_HANDLER_PRIORITY_COUNT
);

82 
Äf_pwr_mgmt_evt_t
 
	gm_pwr_mgmt_evt
;

84 
Äf_mtx_t
 
	gm_sysoff_mtx
;

85 
boŞ
 
	gm_shutdown_¡¬‹d
;

86 
Äf_£ùiÚ_™”_t
 
	gm_hªdËrs_™”
;

88 #ià(
NRF_PWR_MGMT_CONFIG_FPU_SUPPORT_ENABLED
 && 
__FPU_PRESENT
)

89 
	#PWR_MGMT_FPU_SLEEP_PREPARE
(è
	`pwr_mgmt_åu_¦“p_´•¬e
()

	)

91 
__STATIC_INLINE
 
	$pwr_mgmt_åu_¦“p_´•¬e
()

93 
ušt32_t
 
åsü
;

94 
	`CRITICAL_REGION_ENTER
();

95 
åsü
 = 
	`__g‘_FPSCR
();

107 
	`__£t_FPSCR
(
åsü
 & ~0x9Fu);

108 
	`__DMB
();

109 
	`NVIC_CË¬P’dšgIRQ
(
FPU_IRQn
);

110 
	`CRITICAL_REGION_EXIT
();

118 
	`ASSERT
((
åsü
 & 0x07) == 0);

119 
	}
}

121 
	#PWR_MGMT_FPU_SLEEP_PREPARE
()

	)

125 #ià
NRF_PWR_MGMT_CONFIG_DEBUG_PIN_ENABLED


126 #undeà
PWR_MGMT_SLEEP_IN_CRITICAL_SECTION_REQUIRED


127 
	#PWR_MGMT_SLEEP_IN_CRITICAL_SECTION_REQUIRED


	)

129 
	~"Äf_gpio.h
"

130 
	#PWR_MGMT_DEBUG_PINS_INIT
(è
	`pwr_mgmt_debug_pšs_š™
()

	)

131 
	#PWR_MGMT_DEBUG_PIN_CLEAR
(è
	`Äf_gpio_pš_ş—r
(
NRF_PWR_MGMT_SLEEP_DEBUG_PIN
)

	)

132 
	#PWR_MGMT_DEBUG_PIN_SET
(è
	`Äf_gpio_pš_£t
(
NRF_PWR_MGMT_SLEEP_DEBUG_PIN
)

	)

134 
__STATIC_INLINE
 
	$pwr_mgmt_debug_pšs_š™
()

136 
	`Äf_gpio_pš_ş—r
(
NRF_PWR_MGMT_SLEEP_DEBUG_PIN
);

137 
	`Äf_gpio_cfg_ouut
(
NRF_PWR_MGMT_SLEEP_DEBUG_PIN
);

138 
	}
}

141 
	#PWR_MGMT_DEBUG_PIN_CLEAR
()

	)

142 
	#PWR_MGMT_DEBUG_PIN_SET
()

	)

143 
	#PWR_MGMT_DEBUG_PINS_INIT
()

	)

147 #ià
NRF_PWR_MGMT_CONFIG_CPU_USAGE_MONITOR_ENABLED


148 #undeà
PWR_MGMT_SLEEP_IN_CRITICAL_SECTION_REQUIRED


149 
	#PWR_MGMT_SLEEP_IN_CRITICAL_SECTION_REQUIRED


	)

151 #undeà
PWR_MGMT_TIMER_REQUIRED


152 
	#PWR_MGMT_TIMER_REQUIRED


	)

153 
	~"­p_tim”.h
"

155 
	#PWR_MGMT_CPU_USAGE_MONITOR_INIT
(è
	`pwr_mgmt_ıu_u§ge_mÚ™Ü_š™
()

	)

156 
	#PWR_MGMT_CPU_USAGE_MONITOR_UPDATE
(è
	`pwr_mgmt_ıu_u§ge_mÚ™Ü_upd©e
()

	)

157 
	#PWR_MGMT_CPU_USAGE_MONITOR_SUMMARY
(è
	`NRF_LOG_INFO
("Maximum CPU usage: %u%%", \

158 
m_max_ıu_u§ge
)

	)

159 
	#PWR_MGMT_CPU_USAGE_MONITOR_SECTION_ENTER
() \

161 
ušt32_t
 
¦“p_¡¬t
 = 
	`­p_tim”_út_g‘
()

	)

163 
	#PWR_MGMT_CPU_USAGE_MONITOR_SECTION_EXIT
() \

164 
ušt32_t
 
¦“p_’d
 = 
	`­p_tim”_út_g‘
(); \

165 
ušt32_t
 
¦“p_du¿tiÚ
; \

166 
¦“p_du¿tiÚ
 = 
	`­p_tim”_út_diff_compu‹
(
¦“p_’d
, \

167 
¦“p_¡¬t
); \

168 
m_ticks_¦“pšg
 +ğ
¦“p_du¿tiÚ
; \

169 }

	)

171 
ušt32_t
 
	gm_ticks_¦“pšg
;

172 
ušt32_t
 
	gm_ticks_Ï¡
;

173 
ušt8_t
 
	gm_max_ıu_u§ge
;

175 
__STATIC_INLINE
 
	$pwr_mgmt_ıu_u§ge_mÚ™Ü_š™
()

177 
m_ticks_¦“pšg
 = 0;

178 
m_ticks_Ï¡
 = 0;

179 
m_max_ıu_u§ge
 = 0;

180 
	}
}

182 
__STATIC_INLINE
 
	$pwr_mgmt_ıu_u§ge_mÚ™Ü_upd©e
()

184 
ušt32_t
 
d–
;

185 
ušt32_t
 
ticks
;

186 
ušt8_t
 
ıu_u§ge
;

188 
ticks
 = 
	`­p_tim”_út_g‘
();

189 
d–
 = 
	`­p_tim”_út_diff_compu‹
(
ticks
, 
m_ticks_Ï¡
);

190 
ıu_u§ge
 = 100 * (
d–
 - 
m_ticks_¦“pšg
) / delta;

192 
	`NRF_LOG_INFO
("CPU U§ge: %u%%", 
ıu_u§ge
);

193 ià(
m_max_ıu_u§ge
 < 
ıu_u§ge
)

195 
m_max_ıu_u§ge
 = 
ıu_u§ge
;

198 
m_ticks_Ï¡
 = 
ticks
;

199 
m_ticks_¦“pšg
 = 0;

200 
	}
}

203 
	#PWR_MGMT_CPU_USAGE_MONITOR_INIT
()

	)

204 
	#PWR_MGMT_CPU_USAGE_MONITOR_UPDATE
()

	)

205 
	#PWR_MGMT_CPU_USAGE_MONITOR_SUMMARY
()

	)

206 
	#PWR_MGMT_CPU_USAGE_MONITOR_SECTION_ENTER
()

	)

207 
	#PWR_MGMT_CPU_USAGE_MONITOR_SECTION_EXIT
()

	)

211 #ià
NRF_PWR_MGMT_CONFIG_STANDBY_TIMEOUT_ENABLED


212 #undeà
PWR_MGMT_TIMER_REQUIRED


213 
	#PWR_MGMT_TIMER_REQUIRED


	)

215 
	#PWR_MGMT_STANDBY_TIMEOUT_INIT
(è
	`pwr_mgmt_¡ªdby_timeout_ş—r
()

	)

216 
	#PWR_MGMT_STANDBY_TIMEOUT_CLEAR
(è
	`pwr_mgmt_¡ªdby_timeout_ş—r
()

	)

217 
	#PWR_MGMT_STANDBY_TIMEOUT_CHECK
(è
	`pwr_mgmt_¡ªdby_timeout_check
()

	)

219 
ušt16_t
 
	gm_¡ªdby_couÁ”
;

222 
__STATIC_INLINE
 
	$pwr_mgmt_¡ªdby_timeout_ş—r
()

224 
m_¡ªdby_couÁ”
 = 0;

225 
	}
}

227 
__STATIC_INLINE
 
	$pwr_mgmt_¡ªdby_timeout_check
()

229 ià(
m_¡ªdby_couÁ”
 < 
NRF_PWR_MGMT_CONFIG_STANDBY_TIMEOUT_S
)

231 
m_¡ªdby_couÁ”
++;

233 ià(
m_shutdown_¡¬‹d
 =ğ
çl£
)

235 
	`Äf_pwr_mgmt_shutdown
(
NRF_PWR_MGMT_SHUTDOWN_GOTO_SYSOFF
);

237 
	}
}

240 
	#PWR_MGMT_STANDBY_TIMEOUT_INIT
()

	)

241 
	#PWR_MGMT_STANDBY_TIMEOUT_CLEAR
()

	)

242 
	#PWR_MGMT_STANDBY_TIMEOUT_CHECK
()

	)

246 #ià
NRF_PWR_MGMT_CONFIG_AUTO_SHUTDOWN_RETRY


247 #undeà
PWR_MGMT_TIMER_REQUIRED


248 
	#PWR_MGMT_TIMER_REQUIRED


	)

250 
	#PWR_MGMT_AUTO_SHUTDOWN_RETRY
(è
	`pwr_mgmt_auto_shutdown_»Œy
()

	)

252 
__STATIC_INLINE
 
	$pwr_mgmt_auto_shutdown_»Œy
()

254 ià(
m_shutdown_¡¬‹d
)

257 
	`Äf_pwr_mgmt_shutdown
(
NRF_PWR_MGMT_SHUTDOWN_CONTINUE
);

259 
	}
}

262 
	#PWR_MGMT_AUTO_SHUTDOWN_RETRY
()

	)

266 #ifdeà
PWR_MGMT_SLEEP_IN_CRITICAL_SECTION_REQUIRED


267 
	#PWR_MGMT_SLEEP_INIT
(è
	`pwr_mgmt_¦“p_š™
()

	)

268 
	#PWR_MGMT_SLEEP_LOCK_ACQUIRE
(è
	`CRITICAL_REGION_ENTER
()

	)

269 
	#PWR_MGMT_SLEEP_LOCK_RELEASE
(è
	`CRITICAL_REGION_EXIT
()

	)

271 
__STATIC_INLINE
 
	$pwr_mgmt_¦“p_š™
()

273 #ifdeà
SOFTDEVICE_PRESENT


274 
	`ASSERT
(
	`cu¼’t_št_´iÜ™y_g‘
(è>ğ
APP_IRQ_PRIORITY_LOW
);

276 
SCB
->
SCR
 |ğ
SCB_SCR_SEVONPEND_Msk
;

277 
	}
}

280 
	#PWR_MGMT_SLEEP_INIT
()

	)

281 
	#PWR_MGMT_SLEEP_LOCK_ACQUIRE
()

	)

282 
	#PWR_MGMT_SLEEP_LOCK_RELEASE
()

	)

286 #ifdeà
PWR_MGMT_TIMER_REQUIRED


287 
	~"­p_tim”.h
"

288 
	#PWR_MGMT_TIMER_CREATE
(è
	`pwr_mgmt_tim”_ü—‹
()

	)

290 
APP_TIMER_DEF
(
m_pwr_mgmt_tim”
);

294 
	$Äf_pwr_mgmt_timeout_hªdËr
(* 
p_cÚ‹xt
)

296 
	`PWR_MGMT_CPU_USAGE_MONITOR_UPDATE
();

297 
	`PWR_MGMT_AUTO_SHUTDOWN_RETRY
();

298 
	`PWR_MGMT_STANDBY_TIMEOUT_CHECK
();

299 
	}
}

301 
__STATIC_INLINE
 
»t_code_t
 
	$pwr_mgmt_tim”_ü—‹
()

303 
»t_code_t
 
»t_code
 = 
	`­p_tim”_ü—‹
(&
m_pwr_mgmt_tim”
,

304 
APP_TIMER_MODE_REPEATED
,

305 
Äf_pwr_mgmt_timeout_hªdËr
);

306 ià(
»t_code
 !ğ
NRF_SUCCESS
)

308  
»t_code
;

311  
	`­p_tim”_¡¬t
(
m_pwr_mgmt_tim”
, 
	`APP_TIMER_TICKS
(1000), 
NULL
);

312 
	}
}

314 
	#PWR_MGMT_TIMER_CREATE
(è
NRF_SUCCESS


	)

317 
»t_code_t
 
	$Äf_pwr_mgmt_š™
()

319 
	`NRF_LOG_INFO
("Init");

321 
m_shutdown_¡¬‹d
 = 
çl£
;

322 
	`Äf_mtx_š™
(&
m_sysoff_mtx
);

323 
	`Äf_£ùiÚ_™”_š™
(&
m_hªdËrs_™”
, &
pwr_mgmt_d©a
);

325 
	`PWR_MGMT_SLEEP_INIT
();

326 
	`PWR_MGMT_DEBUG_PINS_INIT
();

327 
	`PWR_MGMT_STANDBY_TIMEOUT_INIT
();

328 
	`PWR_MGMT_CPU_USAGE_MONITOR_INIT
();

330  
	`PWR_MGMT_TIMER_CREATE
();

331 
	}
}

333 
	$Äf_pwr_mgmt_run
()

335 
	`PWR_MGMT_FPU_SLEEP_PREPARE
();

336 
	`PWR_MGMT_SLEEP_LOCK_ACQUIRE
();

337 
	`PWR_MGMT_CPU_USAGE_MONITOR_SECTION_ENTER
();

338 
	`PWR_MGMT_DEBUG_PIN_SET
();

341 #ifdeà
SOFTDEVICE_PRESENT


342 ià(
	`Äf_sdh_is_’abËd
())

344 
»t_code_t
 
»t_code
 = 
	`sd_­p_evt_wa™
();

345 
	`ASSERT
((
»t_code
 =ğ
NRF_SUCCESS
è|| (»t_cod=ğ
NRF_ERROR_SOFTDEVICE_NOT_ENABLED
));

346 
	`UNUSED_VARIABLE
(
»t_code
);

352 
	`__WFE
();

354 
	`__SEV
();

355 
	`__WFE
();

358 
	`PWR_MGMT_DEBUG_PIN_CLEAR
();

359 
	`PWR_MGMT_CPU_USAGE_MONITOR_SECTION_EXIT
();

360 
	`PWR_MGMT_SLEEP_LOCK_RELEASE
();

361 
	}
}

363 
	$Äf_pwr_mgmt_ãed
()

365 
	`NRF_LOG_DEBUG
("Feed");

367 
	`PWR_MGMT_STANDBY_TIMEOUT_CLEAR
();

368 
	}
}

372 
	$shutdown_´oûss
()

374 
	`NRF_LOG_INFO
("ShutdowÀ¡¬‹d. Ty³ %d", 
m_pwr_mgmt_evt
);

378 
	`Äf_£ùiÚ_™”_g‘
(&
m_hªdËrs_™”
è!ğ
NULL
;

379 
	`Äf_£ùiÚ_™”_Ãxt
(&
m_hªdËrs_™”
))

381 
Äf_pwr_mgmt_shutdown_hªdËr_t
 * 
p_hªdËr
 =

382 (
Äf_pwr_mgmt_shutdown_hªdËr_t
 *è
	`Äf_£ùiÚ_™”_g‘
(&
m_hªdËrs_™”
);

383 ià((*
p_hªdËr
)(
m_pwr_mgmt_evt
))

385 
	`NRF_LOG_INFO
("SysOfàhªdË¸0x%08X =>„—dy", ()*
p_hªdËr
);

390 
	`NRF_LOG_INFO
("SysOfàhªdË¸0x%08X => blockšg", ()*
p_hªdËr
);

395 
	`PWR_MGMT_CPU_USAGE_MONITOR_SUMMARY
();

396 
	`NRF_LOG_INFO
("Shutdown complete.");

397 
	`NRF_LOG_FINAL_FLUSH
();

399 ià((
m_pwr_mgmt_evt
 =ğ
NRF_PWR_MGMT_EVT_PREPARE_RESET
)

400 || (
m_pwr_mgmt_evt
 =ğ
NRF_PWR_MGMT_EVT_PREPARE_DFU
))

402 
	`NVIC_Sy¡emRe£t
();

407 #ifdeà
SOFTDEVICE_PRESENT


408 ià(
	`Äf_sdh_is_’abËd
())

410 
»t_code_t
 
»t_code
 = 
	`sd_pow”_sy¡em_off
();

411 
	`ASSERT
((
»t_code
 =ğ
NRF_SUCCESS
è|| (»t_cod=ğ
NRF_ERROR_SOFTDEVICE_NOT_ENABLED
));

412 
	`UNUSED_VARIABLE
(
»t_code
);

415 
	`Äf_pow”_sy¡em_off
();

417 
	}
}

419 #ià
NRF_PWR_MGMT_CONFIG_USE_SCHEDULER


422 
	$scheduËr_shutdown_hªdËr
(* 
p_ev’t_d©a
, 
ušt16_t
 
ev’t_size
)

424 
	`UNUSED_PARAMETER
(
p_ev’t_d©a
);

425 
	`UNUSED_PARAMETER
(
ev’t_size
);

426 
	`shutdown_´oûss
();

427 
	}
}

430 
	$Äf_pwr_mgmt_shutdown
(
Äf_pwr_mgmt_shutdown_t
 
shutdown_ty³
)

433 ià(!
	`Äf_mtx_Œylock
(&
m_sysoff_mtx
))

438 ià(
shutdown_ty³
 !ğ
NRF_PWR_MGMT_SHUTDOWN_CONTINUE
)

440 ià(
m_shutdown_¡¬‹d
)

442 
	`Äf_mtx_uÆock
(&
m_sysoff_mtx
);

447 
m_pwr_mgmt_evt
 = (
Äf_pwr_mgmt_evt_t
)
shutdown_ty³
;

448 
m_shutdown_¡¬‹d
 = 
Œue
;

452 
	`ASSERT
(
m_shutdown_¡¬‹d
);

453 
	`NRF_LOG_INFO
("ShutdowÀ»que¡ %d", 
shutdown_ty³
);

455 #ià
NRF_PWR_MGMT_CONFIG_USE_SCHEDULER


456 
»t_code_t
 
»t_code
 = 
	`­p_sched_ev’t_put
(
NULL
, 0, 
scheduËr_shutdown_hªdËr
);

457 
	`APP_ERROR_CHECK
(
»t_code
);

459 
	`shutdown_´oûss
();

462 
	`Äf_mtx_uÆock
(&
m_sysoff_mtx
);

463 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\scheduler\app_scheduler.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
APP_SCHEDULER
)

42 
	~"­p_scheduËr.h
"

43 
	~<¡dlib.h
>

44 
	~<¡dšt.h
>

45 
	~<¡ršg.h
>

46 
	~"Äf_soc.h
"

47 
	~"Äf_as£¹.h
"

48 
	~"­p_ut_¶©fÜm.h
"

53 
­p_sched_ev’t_hªdËr_t
 
	mhªdËr
;

54 
ušt16_t
 
	mev’t_d©a_size
;

55 } 
	tev’t_h—d”_t
;

57 
STATIC_ASSERT
((
ev’t_h—d”_t
è<ğ
APP_SCHED_EVENT_HEADER_SIZE
);

59 
ev’t_h—d”_t
 * 
	gm_queue_ev’t_h—d”s
;

60 
ušt8_t
 * 
	gm_queue_ev’t_d©a
;

61 vŞ©
ušt8_t
 
	gm_queue_¡¬t_šdex
;

62 vŞ©
ušt8_t
 
	gm_queue_’d_šdex
;

63 
ušt16_t
 
	gm_queue_ev’t_size
;

64 
ušt16_t
 
	gm_queue_size
;

66 #ià
APP_SCHEDULER_WITH_PROFILER


67 
ušt16_t
 
	gm_max_queue_utiz©iÚ
;

70 #ià
APP_SCHEDULER_WITH_PAUSE


71 
ušt32_t
 
	gm_scheduËr_·u£d_couÁ”
 = 0;

81 
__INLINE
 
ušt8_t
 
	$Ãxt_šdex
(
ušt8_t
 
šdex
)

83  (
šdex
 < 
m_queue_size
) ? (index + 1) : 0;

84 
	}
}

87 
__INLINE
 
ušt8_t
 
	$­p_sched_queue_fuÎ
()

89 
ušt8_t
 
tmp
 = 
m_queue_¡¬t_šdex
;

90  
	`Ãxt_šdex
(
m_queue_’d_šdex
è=ğ
tmp
;

91 
	}
}

94 
	#APP_SCHED_QUEUE_FULL
(è
	`­p_sched_queue_fuÎ
()

	)

97 
__INLINE
 
ušt8_t
 
	$­p_sched_queue_em±y
()

99 
ušt8_t
 
tmp
 = 
m_queue_¡¬t_šdex
;

100  
m_queue_’d_šdex
 =ğ
tmp
;

101 
	}
}

104 
	#APP_SCHED_QUEUE_EMPTY
(è
	`­p_sched_queue_em±y
()

	)

107 
ušt32_t
 
	$­p_sched_š™
(
ušt16_t
 
ev’t_size
, ušt16_ˆ
queue_size
, * 
p_ev’t_bufãr
)

109 
ušt16_t
 
d©a_¡¬t_šdex
 = (
queue_size
 + 1è* (
ev’t_h—d”_t
);

112 ià(!
	`is_wÜd_®igÃd
(
p_ev’t_bufãr
))

114  
NRF_ERROR_INVALID_PARAM
;

118 
m_queue_ev’t_h—d”s
 = 
p_ev’t_bufãr
;

119 
m_queue_ev’t_d©a
 = &((
ušt8_t
 *)
p_ev’t_bufãr
)[
d©a_¡¬t_šdex
];

120 
m_queue_’d_šdex
 = 0;

121 
m_queue_¡¬t_šdex
 = 0;

122 
m_queue_ev’t_size
 = 
ev’t_size
;

123 
m_queue_size
 = 
queue_size
;

125 #ià
APP_SCHEDULER_WITH_PROFILER


126 
m_max_queue_utiz©iÚ
 = 0;

129  
NRF_SUCCESS
;

130 
	}
}

133 
ušt16_t
 
	$­p_sched_queue_¥aû_g‘
()

135 
ušt16_t
 
¡¬t
 = 
m_queue_¡¬t_šdex
;

136 
ušt16_t
 
’d
 = 
m_queue_’d_šdex
;

137 
ušt16_t
 
ä“_¥aû
 = 
m_queue_size
 - ((
’d
 >ğ
¡¬t
) ?

138 (
’d
 - 
¡¬t
è: (
m_queue_size
 + 1 - start +ƒnd));

139  
ä“_¥aû
;

140 
	}
}

143 #ià
APP_SCHEDULER_WITH_PROFILER


144 
	$queue_utiz©iÚ_check
()

146 
ušt16_t
 
¡¬t
 = 
m_queue_¡¬t_šdex
;

147 
ušt16_t
 
’d
 = 
m_queue_’d_šdex
;

148 
ušt16_t
 
queue_utiz©iÚ
 = (
’d
 >ğ
¡¬t
) ? (end - start) :

149 (
m_queue_size
 + 1 - 
¡¬t
 + 
’d
);

151 ià(
queue_utiz©iÚ
 > 
m_max_queue_utiz©iÚ
)

153 
m_max_queue_utiz©iÚ
 = 
queue_utiz©iÚ
;

155 
	}
}

157 
ušt16_t
 
	$­p_sched_queue_utiz©iÚ_g‘
()

159  
m_max_queue_utiz©iÚ
;

160 
	}
}

164 
ušt32_t
 
	$­p_sched_ev’t_put
(cÚ¡ * 
p_ev’t_d©a
,

165 
ušt16_t
 
ev’t_d©a_size
,

166 
­p_sched_ev’t_hªdËr_t
 
hªdËr
)

168 
ušt32_t
 
”r_code
;

170 ià(
ev’t_d©a_size
 <ğ
m_queue_ev’t_size
)

172 
ušt16_t
 
ev’t_šdex
 = 0xFFFF;

174 
	`CRITICAL_REGION_ENTER
();

176 ià(!
	`APP_SCHED_QUEUE_FULL
())

178 
ev’t_šdex
 = 
m_queue_’d_šdex
;

179 
m_queue_’d_šdex
 = 
	`Ãxt_šdex
(m_queue_end_index);

181 #ià
APP_SCHEDULER_WITH_PROFILER


184 
	`queue_utiz©iÚ_check
();

188 
	`CRITICAL_REGION_EXIT
();

190 ià(
ev’t_šdex
 != 0xFFFF)

194 
m_queue_ev’t_h—d”s
[
ev’t_šdex
].
hªdËr
 = handler;

195 ià((
p_ev’t_d©a
 !ğ
NULL
è&& (
ev’t_d©a_size
 > 0))

197 
	`memıy
(&
m_queue_ev’t_d©a
[
ev’t_šdex
 * 
m_queue_ev’t_size
],

198 
p_ev’t_d©a
,

199 
ev’t_d©a_size
);

200 
m_queue_ev’t_h—d”s
[
ev’t_šdex
].
ev’t_d©a_size
 =ƒvent_data_size;

204 
m_queue_ev’t_h—d”s
[
ev’t_šdex
].
ev’t_d©a_size
 = 0;

207 
”r_code
 = 
NRF_SUCCESS
;

211 
”r_code
 = 
NRF_ERROR_NO_MEM
;

216 
”r_code
 = 
NRF_ERROR_INVALID_LENGTH
;

219  
”r_code
;

220 
	}
}

223 #ià
APP_SCHEDULER_WITH_PAUSE


224 
	$­p_sched_·u£
()

226 
	`CRITICAL_REGION_ENTER
();

228 ià(
m_scheduËr_·u£d_couÁ”
 < 
UINT32_MAX
)

230 
m_scheduËr_·u£d_couÁ”
++;

232 
	`CRITICAL_REGION_EXIT
();

233 
	}
}

235 
	$­p_sched_»sume
()

237 
	`CRITICAL_REGION_ENTER
();

239 ià(
m_scheduËr_·u£d_couÁ”
 > 0)

241 
m_scheduËr_·u£d_couÁ”
--;

243 
	`CRITICAL_REGION_EXIT
();

244 
	}
}

253 
__INLINE
 
boŞ
 
	$is_­p_sched_·u£d
()

255 #ià
APP_SCHEDULER_WITH_PAUSE


256  (
m_scheduËr_·u£d_couÁ”
 > 0);

258  
çl£
;

260 
	}
}

263 
	$­p_sched_execu‹
()

265 !
	`is_­p_sched_·u£d
(è&& !
	`APP_SCHED_QUEUE_EMPTY
())

270 
ušt16_t
 
ev’t_šdex
 = 
m_queue_¡¬t_šdex
;

272 * 
p_ev’t_d©a
;

273 
ušt16_t
 
ev’t_d©a_size
;

274 
­p_sched_ev’t_hªdËr_t
 
ev’t_hªdËr
;

276 
p_ev’t_d©a
 = &
m_queue_ev’t_d©a
[
ev’t_šdex
 * 
m_queue_ev’t_size
];

277 
ev’t_d©a_size
 = 
m_queue_ev’t_h—d”s
[
ev’t_šdex
].event_data_size;

278 
ev’t_hªdËr
 = 
m_queue_ev’t_h—d”s
[
ev’t_šdex
].
hªdËr
;

280 
	`ev’t_hªdËr
(
p_ev’t_d©a
, 
ev’t_d©a_size
);

285 
m_queue_¡¬t_šdex
 = 
	`Ãxt_šdex
(m_queue_start_index);

287 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\sensorsim\sensorsim.c

40 
	~"£nsÜsim.h
"

43 
	$£nsÜsim_š™
(
£nsÜsim_¡©e_t
 * 
p_¡©e
,

44 cÚ¡ 
£nsÜsim_cfg_t
 * 
p_cfg
)

46 ià(
p_cfg
->
¡¬t_©_max
)

48 
p_¡©e
->
cu¼’t_v®
 = 
p_cfg
->
max
;

49 
p_¡©e
->
is_šü—sšg
 = 
çl£
;

53 
p_¡©e
->
cu¼’t_v®
 = 
p_cfg
->
mš
;

54 
p_¡©e
->
is_šü—sšg
 = 
Œue
;

56 
	}
}

59 
ušt32_t
 
	$£nsÜsim_m—su»
(
£nsÜsim_¡©e_t
 * 
p_¡©e
,

60 cÚ¡ 
£nsÜsim_cfg_t
 * 
p_cfg
)

62 ià(
p_¡©e
->
is_šü—sšg
)

64 
	`£nsÜsim_šüem’t
(
p_¡©e
, 
p_cfg
);

68 
	`£nsÜsim_deüem’t
(
p_¡©e
, 
p_cfg
);

70  
p_¡©e
->
cu¼’t_v®
;

71 
	}
}

73 
	$£nsÜsim_šüem’t
(
£nsÜsim_¡©e_t
 * 
p_¡©e
,

74 cÚ¡ 
£nsÜsim_cfg_t
 * 
p_cfg
)

76 ià(
p_cfg
->
max
 - 
p_¡©e
->
cu¼’t_v®
 >…_cfg->
šü
)

78 
p_¡©e
->
cu¼’t_v®
 +ğ
p_cfg
->
šü
;

82 
p_¡©e
->
cu¼’t_v®
 = 
p_cfg
->
max
;

83 
p_¡©e
->
is_šü—sšg
 = 
çl£
;

85 
	}
}

88 
	$£nsÜsim_deüem’t
(
£nsÜsim_¡©e_t
 * 
p_¡©e
,

89 cÚ¡ 
£nsÜsim_cfg_t
 * 
p_cfg
)

91 ià(
p_¡©e
->
cu¼’t_v®
 - 
p_cfg
->
mš
 >…_cfg->
šü
)

93 
p_¡©e
->
cu¼’t_v®
 -ğ
p_cfg
->
šü
;

97 
p_¡©e
->
cu¼’t_v®
 = 
p_cfg
->
mš
;

98 
p_¡©e
->
is_šü—sšg
 = 
Œue
;

100 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\strerror\nrf_strerror.c

41 
	~"sdk_commÚ.h
"

42 #ià
NRF_MODULE_ENABLED
(
NRF_STRERROR
)

43 
	~"Äf_¡»¼Ü.h
"

50 
	#NRF_STRERROR_ENTITY
(
mÃmÚic
è{.
code
 = mÃmÚic, .
Çme
 = #mÃmÚic}

	)

57 
»t_code_t
 
	mcode
;

58 cÚ¡ * 
	mÇme
;

59 }
	tÄf_¡»¼Ü_desc_t
;

66 cÚ¡ 
	gm_unknown_¡r
[] = "Unknownƒrror code";

76 
Äf_¡»¼Ü_desc_t
 cÚ¡ 
	gÄf_¡»¼Ü_¬¿y
[] =

78 
NRF_STRERROR_ENTITY
(
NRF_SUCCESS
),

79 
NRF_STRERROR_ENTITY
(
NRF_ERROR_SVC_HANDLER_MISSING
),

80 
NRF_STRERROR_ENTITY
(
NRF_ERROR_SOFTDEVICE_NOT_ENABLED
),

81 
NRF_STRERROR_ENTITY
(
NRF_ERROR_INTERNAL
),

82 
NRF_STRERROR_ENTITY
(
NRF_ERROR_NO_MEM
),

83 
NRF_STRERROR_ENTITY
(
NRF_ERROR_NOT_FOUND
),

84 
NRF_STRERROR_ENTITY
(
NRF_ERROR_NOT_SUPPORTED
),

85 
NRF_STRERROR_ENTITY
(
NRF_ERROR_INVALID_PARAM
),

86 
NRF_STRERROR_ENTITY
(
NRF_ERROR_INVALID_STATE
),

87 
NRF_STRERROR_ENTITY
(
NRF_ERROR_INVALID_LENGTH
),

88 
NRF_STRERROR_ENTITY
(
NRF_ERROR_INVALID_FLAGS
),

89 
NRF_STRERROR_ENTITY
(
NRF_ERROR_INVALID_DATA
),

90 
NRF_STRERROR_ENTITY
(
NRF_ERROR_DATA_SIZE
),

91 
NRF_STRERROR_ENTITY
(
NRF_ERROR_TIMEOUT
),

92 
NRF_STRERROR_ENTITY
(
NRF_ERROR_NULL
),

93 
NRF_STRERROR_ENTITY
(
NRF_ERROR_FORBIDDEN
),

94 
NRF_STRERROR_ENTITY
(
NRF_ERROR_INVALID_ADDR
),

95 
NRF_STRERROR_ENTITY
(
NRF_ERROR_BUSY
),

98 
NRF_STRERROR_ENTITY
(
NRF_ERROR_MODULE_NOT_INITIALZED
),

99 
NRF_STRERROR_ENTITY
(
NRF_ERROR_MUTEX_INIT_FAILED
),

100 
NRF_STRERROR_ENTITY
(
NRF_ERROR_MUTEX_LOCK_FAILED
),

101 
NRF_STRERROR_ENTITY
(
NRF_ERROR_MUTEX_UNLOCK_FAILED
),

102 
NRF_STRERROR_ENTITY
(
NRF_ERROR_MUTEX_COND_INIT_FAILED
),

103 
NRF_STRERROR_ENTITY
(
NRF_ERROR_MODULE_ALREADY_INITIALIZED
),

104 
NRF_STRERROR_ENTITY
(
NRF_ERROR_STORAGE_FULL
),

105 
NRF_STRERROR_ENTITY
(
NRF_ERROR_API_NOT_IMPLEMENTED
),

106 
NRF_STRERROR_ENTITY
(
NRF_ERROR_FEATURE_NOT_ENABLED
),

109 
NRF_STRERROR_ENTITY
(
NRF_ERROR_DRV_TWI_ERR_OVERRUN
),

110 
NRF_STRERROR_ENTITY
(
NRF_ERROR_DRV_TWI_ERR_ANACK
),

111 
NRF_STRERROR_ENTITY
(
NRF_ERROR_DRV_TWI_ERR_DNACK
)

115 cÚ¡ * 
	$Äf_¡»¼Ü_g‘
(
»t_code_t
 
code
)

117 cÚ¡ * 
p_»t
 = 
	`Äf_¡»¼Ü_fšd
(
code
);

118  (
p_»t
 =ğ
NULL
è? 
m_unknown_¡r
 :…_ret;

119 
	}
}

121 cÚ¡ * 
	$Äf_¡»¼Ü_fšd
(
»t_code_t
 
code
)

123 
Äf_¡»¼Ü_desc_t
 cÚ¡ * 
p_¡¬t
;

124 
Äf_¡»¼Ü_desc_t
 cÚ¡ * 
p_’d
;

125 
p_¡¬t
 = 
Äf_¡»¼Ü_¬¿y
;

126 
p_’d
 = 
Äf_¡»¼Ü_¬¿y
 + 
	`ARRAY_SIZE
(nrf_strerror_array);

128 
p_¡¬t
 < 
p_’d
)

130 
Äf_¡»¼Ü_desc_t
 cÚ¡ * 
p_mid
 = 
p_¡¬t
 + ((
p_’d
 -…_start) / 2);

131 
»t_code_t
 
mid_c
 = 
p_mid
->
code
;

132 ià(
mid_c
 > 
code
)

134 
p_’d
 = 
p_mid
;

136 ià(
mid_c
 < 
code
)

138 
p_¡¬t
 = 
p_mid
 + 1;

142  
p_mid
->
Çme
;

145  
NULL
;

146 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\timer\app_timer.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
APP_TIMER
)

42 
	~"­p_tim”.h
"

43 
	~<¡dlib.h
>

44 
	~"Äf.h
"

45 
	~"Äf_soc.h
"

46 
	~"­p_”rÜ.h
"

47 
	~"Äf_d–ay.h
"

48 
	~"­p_ut_¶©fÜm.h
"

49 #ià
APP_TIMER_CONFIG_USE_SCHEDULER


50 
	~"­p_scheduËr.h
"

53 
	#RTC1_IRQ_PRI
 
APP_TIMER_CONFIG_IRQ_PRIORITY


	)

54 
	#SWI_IRQ_PRI
 
APP_TIMER_CONFIG_IRQ_PRIORITY


	)

59 
STATIC_ASSERT
(
RTC1_IRQ_PRI
 =ğ
SWI_IRQ_PRI
);

61 
	#MAX_RTC_COUNTER_VAL
 0x00FFFFFF

	)

63 
	#RTC_COMPARE_OFFSET_MIN
 3

	)

65 
	#MAX_RTC_TASKS_DELAY
 47

	)

67 #ià(
APP_TIMER_CONFIG_SWI_NUMBER
 == 0)

68 
	#SWI_IRQn
 
SWI0_IRQn


	)

69 
	#SWI_IRQHªdËr
 
SWI0_IRQHªdËr


	)

70 #–ià(
APP_TIMER_CONFIG_SWI_NUMBER
 == 1)

71 
	#SWI_IRQn
 
SWI1_IRQn


	)

72 
	#SWI_IRQHªdËr
 
SWI1_IRQHªdËr


	)

77 
	#MODULE_INITIALIZED
 (
m_İ_queue
.
size
 !ğ0è

	)

82 
ušt32_t
 
	mticks_to_expœe
;

83 
ušt32_t
 
	mticks_©_¡¬t
;

84 
ušt32_t
 
	mticks_fœ¡_š‹rv®
;

85 
ušt32_t
 
	mticks_³riodic_š‹rv®
;

86 
boŞ
 
	mis_ruÂšg
;

87 
­p_tim”_mode_t
 
	mmode
;

88 
­p_tim”_timeout_hªdËr_t
 
	mp_timeout_hªdËr
;

89 * 
	mp_cÚ‹xt
;

90 * 
	mÃxt
;

91 } 
	ttim”_node_t
;

93 
STATIC_ASSERT
((
tim”_node_t
è=ğ
APP_TIMER_NODE_SIZE
);

98 
	mTIMER_USER_OP_TYPE_NONE
,

99 
	mTIMER_USER_OP_TYPE_START
,

100 
	mTIMER_USER_OP_TYPE_STOP
,

101 
	mTIMER_USER_OP_TYPE_STOP_ALL


102 } 
	ttim”_u£r_İ_ty³_t
;

107 
ušt32_t
 
	mticks_©_¡¬t
;

108 
ušt32_t
 
	mticks_fœ¡_š‹rv®
;

109 
ušt32_t
 
	mticks_³riodic_š‹rv®
;

110 * 
	mp_cÚ‹xt
;

111 } 
	ttim”_u£r_İ_¡¬t_t
;

116 
tim”_u£r_İ_ty³_t
 
	mİ_ty³
;

117 
tim”_node_t
 * 
	mp_node
;

120 
tim”_u£r_İ_¡¬t_t
 
	m¡¬t
;

121 } 
	m·¿ms
;

122 } 
	ttim”_u£r_İ_t
;

131 
ušt8_t
 
	mfœ¡
;

132 
ušt8_t
 
	mÏ¡
;

133 
ušt8_t
 
	msize
;

134 
tim”_u£r_İ_t
 
	mu£r_İ_queue
[
APP_TIMER_CONFIG_OP_QUEUE_SIZE
+1];

135 } 
	ttim”_İ_queue_t
;

137 
STATIC_ASSERT
((
tim”_İ_queue_t
) % 4 == 0);

139 
	#CONTEXT_QUEUE_SIZE_MAX
 (2)

	)

141 
tim”_İ_queue_t
 
	gm_İ_queue
;

142 
tim”_node_t
 * 
	gmp_tim”_id_h—d
;

143 
ušt32_t
 
	gm_ticks_Ï‹¡
;

144 
ušt32_t
 
	gm_ticks_–­£d
[
CONTEXT_QUEUE_SIZE_MAX
];

145 
ušt8_t
 
	gm_ticks_–­£d_q_»ad_šd
;

146 
ušt8_t
 
	gm_ticks_–­£d_q_wr™e_šd
;

147 
boŞ
 
	gm_¹c1_ruÂšg
;

148 
boŞ
 
	gm_¹c1_»£t
;

150 #ià
APP_TIMER_WITH_PROFILER


151 
ušt8_t
 
	gm_max_u£r_İ_queue_utiz©iÚ
;

158 
	$¹c1_š™
(
ušt32_t
 
´esÿËr
)

160 
NRF_RTC1
->
PRESCALER
 = 
´esÿËr
;

161 
	`NVIC_S‘PriÜ™y
(
RTC1_IRQn
, 
RTC1_IRQ_PRI
);

162 
	}
}

167 
	$¹c1_¡¬t
()

169 
NRF_RTC1
->
EVTENSET
 = 
RTC_EVTEN_COMPARE0_Msk
;

170 
NRF_RTC1
->
INTENSET
 = 
RTC_INTENSET_COMPARE0_Msk
;

172 
	`NVIC_CË¬P’dšgIRQ
(
RTC1_IRQn
);

173 
	`NVIC_EÇbËIRQ
(
RTC1_IRQn
);

175 
NRF_RTC1
->
TASKS_START
 = 1;

176 
	`Äf_d–ay_us
(
MAX_RTC_TASKS_DELAY
);

178 
m_¹c1_ruÂšg
 = 
Œue
;

179 
	}
}

184 
	$¹c1_¡İ
()

186 
	`NVIC_Di§bËIRQ
(
RTC1_IRQn
);

188 
NRF_RTC1
->
EVTENCLR
 = 
RTC_EVTEN_COMPARE0_Msk
;

189 
NRF_RTC1
->
INTENCLR
 = 
RTC_INTENSET_COMPARE0_Msk
;

191 
NRF_RTC1
->
TASKS_STOP
 = 1;

192 
	`Äf_d–ay_us
(
MAX_RTC_TASKS_DELAY
);

194 
NRF_RTC1
->
TASKS_CLEAR
 = 1;

195 
m_ticks_Ï‹¡
 = 0;

196 
	`Äf_d–ay_us
(
MAX_RTC_TASKS_DELAY
);

198 
m_¹c1_ruÂšg
 = 
çl£
;

199 
	}
}

206 
__INLINE
 
ušt32_t
 
	$¹c1_couÁ”_g‘
()

208  
NRF_RTC1
->
COUNTER
;

209 
	}
}

216 
__INLINE
 
ušt32_t
 
	$ticks_diff_g‘
(
ušt32_t
 
ticks_now
, ušt32_ˆ
ticks_Şd
)

218  ((
ticks_now
 - 
ticks_Şd
è& 
MAX_RTC_COUNTER_VAL
);

219 
	}
}

227 
__INLINE
 
	$¹c1_com·»0_£t
(
ušt32_t
 
v®ue
)

229 
NRF_RTC1
->
CC
[0] = 
v®ue
;

230 
	}
}

237 
	$tim”_li¡_š£¹
(
tim”_node_t
 * 
p_tim”
)

239 ià(
mp_tim”_id_h—d
 =ğ
NULL
)

241 
mp_tim”_id_h—d
 = 
p_tim”
;

245 ià(
p_tim”
->
ticks_to_expœe
 <ğ
mp_tim”_id_h—d
->ticks_to_expire)

247 
mp_tim”_id_h—d
->
ticks_to_expœe
 -ğ
p_tim”
->ticks_to_expire;

249 
p_tim”
->
Ãxt
 = 
mp_tim”_id_h—d
;

250 
mp_tim”_id_h—d
 = 
p_tim”
;

254 
tim”_node_t
 * 
p_´evious
;

255 
tim”_node_t
 * 
p_cu¼’t
;

256 
ušt32_t
 
ticks_to_expœe
;

258 
ticks_to_expœe
 = 
p_tim”
->ticks_to_expire;

259 
p_´evious
 = 
mp_tim”_id_h—d
;

260 
p_cu¼’t
 = 
mp_tim”_id_h—d
;

262 (
p_cu¼’t
 !ğ
NULL
è&& (
ticks_to_expœe
 >…_current->ticks_to_expire))

264 
ticks_to_expœe
 -ğ
p_cu¼’t
->ticks_to_expire;

265 
p_´evious
 = 
p_cu¼’t
;

266 
p_cu¼’t
 =…_cu¼’t->
Ãxt
;

269 ià(
p_cu¼’t
 !ğ
NULL
)

271 
p_cu¼’t
->
ticks_to_expœe
 -=icks_to_expire;

274 
p_tim”
->
ticks_to_expœe
 =icks_to_expire;

275 
p_tim”
->
Ãxt
 = 
p_cu¼’t
;

276 
p_´evious
->
Ãxt
 = 
p_tim”
;

279 
	}
}

288 
boŞ
 
	$tim”_li¡_»move
(
tim”_node_t
 * 
p_tim”
)

290 
tim”_node_t
 * 
p_Şd_h—d
;

291 
tim”_node_t
 * 
p_´evious
;

292 
tim”_node_t
 * 
p_cu¼’t
;

293 
ušt32_t
 
timeout
;

296 
p_Şd_h—d
 = 
mp_tim”_id_h—d
;

297 
p_´evious
 = 
mp_tim”_id_h—d
;

298 
p_cu¼’t
 = 
p_´evious
;

300 
p_cu¼’t
 !ğ
NULL
)

302 ià(
p_cu¼’t
 =ğ
p_tim”
)

306 
p_´evious
 = 
p_cu¼’t
;

307 
p_cu¼’t
 =…_cu¼’t->
Ãxt
;

311 ià(
p_cu¼’t
 =ğ
NULL
)

313  
çl£
;

317 ià(
p_´evious
 =ğ
p_cu¼’t
)

319 
mp_tim”_id_h—d
 = mp_tim”_id_h—d->
Ãxt
;

322 ià(
mp_tim”_id_h—d
 =ğ
NULL
)

324 
NRF_RTC1
->
TASKS_CLEAR
 = 1;

325 
m_ticks_Ï‹¡
 = 0;

326 
m_¹c1_»£t
 = 
Œue
;

327 
	`Äf_d–ay_us
(
MAX_RTC_TASKS_DELAY
);

332 
timeout
 = 
p_cu¼’t
->
ticks_to_expœe
;

335 
p_´evious
->
Ãxt
 = 
p_cu¼’t
->next;

338 
p_cu¼’t
 = 
p_´evious
->
Ãxt
;

339 ià(
p_cu¼’t
 !ğ
NULL
)

341 
p_cu¼’t
->
ticks_to_expœe
 +ğ
timeout
;

344  (
p_Şd_h—d
 !ğ
mp_tim”_id_h—d
);

345 
	}
}

350 
	$tim”_timeouts_check_sched
()

352 
	`NVIC_S‘P’dšgIRQ
(
RTC1_IRQn
);

353 
	}
}

358 
	$tim”_li¡_hªdËr_sched
()

360 
	`NVIC_S‘P’dšgIRQ
(
SWI_IRQn
);

361 
	}
}

363 #ià
APP_TIMER_CONFIG_USE_SCHEDULER


364 
	$timeout_hªdËr_scheduËd_exec
(* 
p_ev’t_d©a
, 
ušt16_t
 
ev’t_size
)

366 
	`APP_ERROR_CHECK_BOOL
(
ev’t_size
 =ğ(
­p_tim”_ev’t_t
));

367 
­p_tim”_ev’t_t
 cÚ¡ * 
p_tim”_ev’t
 = (­p_tim”_ev’t_ˆ*)
p_ev’t_d©a
;

369 
p_tim”_ev’t
->
	`timeout_hªdËr
Õ_tim”_ev’t->
p_cÚ‹xt
);

370 
	}
}

378 
	$timeout_hªdËr_exec
(
tim”_node_t
 * 
p_tim”
)

380 #ià
APP_TIMER_CONFIG_USE_SCHEDULER


381 
­p_tim”_ev’t_t
 
tim”_ev’t
;

383 
tim”_ev’t
.
timeout_hªdËr
 = 
p_tim”
->
p_timeout_hªdËr
;

384 
tim”_ev’t
.
p_cÚ‹xt
 = 
p_tim”
->p_context;

385 
ušt32_t
 
”r_code
 = 
	`­p_sched_ev’t_put
(&
tim”_ev’t
, Ñim”_ev’t), 
timeout_hªdËr_scheduËd_exec
);

386 
	`APP_ERROR_CHECK
(
”r_code
);

388 
p_tim”
->
	`p_timeout_hªdËr
Õ_tim”->
p_cÚ‹xt
);

390 
	}
}

395 
	$tim”_timeouts_check
()

398 ià(
mp_tim”_id_h—d
 !ğ
NULL
)

400 
tim”_node_t
 * 
p_tim”
;

401 
tim”_node_t
 * 
p_´evious_tim”
;

402 
ušt32_t
 
ticks_–­£d
;

403 
ušt32_t
 
ticks_expœed
;

406 
ticks_expœed
 = 0;

409 
ticks_–­£d
 = 
	`ticks_diff_g‘
(
	`¹c1_couÁ”_g‘
(), 
m_ticks_Ï‹¡
);

412 
p_tim”
 = 
mp_tim”_id_h—d
;

415 
p_tim”
 !ğ
NULL
)

418 ià(
ticks_–­£d
 < 
p_tim”
->
ticks_to_expœe
)

424 
ticks_–­£d
 -ğ
p_tim”
->
ticks_to_expœe
;

425 
ticks_expœed
 +ğ
p_tim”
->
ticks_to_expœe
;

428 
p_´evious_tim”
 = 
p_tim”
;

429 
p_tim”
 =…_tim”->
Ãxt
;

432 ià(
p_´evious_tim”
->
is_ruÂšg
)

434 
p_´evious_tim”
->
is_ruÂšg
 = 
çl£
;

435 
	`timeout_hªdËr_exec
(
p_´evious_tim”
);

440 ià(
m_ticks_–­£d_q_»ad_šd
 =ğ
m_ticks_–­£d_q_wr™e_šd
)

447 ià(++
m_ticks_–­£d_q_wr™e_šd
 =ğ
CONTEXT_QUEUE_SIZE_MAX
)

451 
m_ticks_–­£d_q_wr™e_šd
 = 0;

456 
m_ticks_–­£d
[
m_ticks_–­£d_q_wr™e_šd
] = 
ticks_expœed
;

458 
	`tim”_li¡_hªdËr_sched
();

460 
	}
}

469 
boŞ
 
	$–­£d_ticks_acquœe
(
ušt32_t
 * 
p_ticks_–­£d
)

472 ià(
m_ticks_–­£d_q_»ad_šd
 !ğ
m_ticks_–­£d_q_wr™e_šd
)

475 
m_ticks_–­£d_q_»ad_šd
++;

476 ià(
m_ticks_–­£d_q_»ad_šd
 =ğ
CONTEXT_QUEUE_SIZE_MAX
)

478 
m_ticks_–­£d_q_»ad_šd
 = 0;

481 *
p_ticks_–­£d
 = 
m_ticks_–­£d
[
m_ticks_–­£d_q_»ad_šd
];

483 
m_ticks_Ï‹¡
 +ğ*
p_ticks_–­£d
;

484 
m_ticks_Ï‹¡
 &ğ
MAX_RTC_COUNTER_VAL
;

486  
Œue
;

491 *
p_ticks_–­£d
 = 0;

492  
çl£
;

494 
	}
}

503 
	$expœed_tim”s_hªdËr
(
ušt32_t
 
ticks_–­£d
,

504 
ušt32_t
 
ticks_´evious
,

505 
tim”_node_t
 ** 
p_»¡¬t_li¡_h—d
)

507 
ušt32_t
 
ticks_expœed
 = 0;

509 
mp_tim”_id_h—d
 !ğ
NULL
)

511 
tim”_node_t
 * 
p_tim”
;

512 
tim”_node_t
 * 
p_tim”_expœed
;

515 
p_tim”
 = 
mp_tim”_id_h—d
;

518 ià(
ticks_–­£d
 < 
p_tim”
->
ticks_to_expœe
)

520 
p_tim”
->
ticks_to_expœe
 -ğ
ticks_–­£d
;

525 
ticks_–­£d
 -ğ
p_tim”
->
ticks_to_expœe
;

526 
ticks_expœed
 +ğ
p_tim”
->
ticks_to_expœe
;

529 
p_tim”
->
ticks_to_expœe
 = 0;

532 
p_tim”_expœed
 = 
mp_tim”_id_h—d
;

533 
mp_tim”_id_h—d
 = 
p_tim”
->
Ãxt
;

536 ià(
p_tim”
->
ticks_³riodic_š‹rv®
 != 0)

538 
p_tim”
->
ticks_©_¡¬t
 = (
ticks_´evious
 + 
ticks_expœed
è& 
MAX_RTC_COUNTER_VAL
;

539 
p_tim”
->
ticks_fœ¡_š‹rv®
 =…_tim”->
ticks_³riodic_š‹rv®
;

540 
p_tim”
->
Ãxt
 = *
p_»¡¬t_li¡_h—d
;

541 *
p_»¡¬t_li¡_h—d
 = 
p_tim”_expœed
;

544 
	}
}

553 
boŞ
 
	$li¡_š£¹iÚs_hªdËr
(
tim”_node_t
 * 
p_»¡¬t_li¡_h—d
)

555 
boŞ
 
com·»_upd©e
 = 
çl£
;

557 
tim”_node_t
 * 
p_tim”_id_Şd_h—d
;

560 
p_tim”_id_Şd_h—d
 = 
mp_tim”_id_h—d
;

563 (
p_»¡¬t_li¡_h—d
 !ğ
NULL
è|| (
m_İ_queue
.
fœ¡
 !ğm_İ_queue.
Ï¡
))

565 
tim”_node_t
 * 
p_tim”
;

567 ià(
p_»¡¬t_li¡_h—d
 !ğ
NULL
)

569 
p_tim”
 = 
p_»¡¬t_li¡_h—d
;

570 
p_»¡¬t_li¡_h—d
 = 
p_tim”
->
Ãxt
;

574 
tim”_u£r_İ_t
 * 
p_u£r_İ
 = &
m_İ_queue
.
u£r_İ_queue
[m_İ_queue.
fœ¡
];

576 
m_İ_queue
.
fœ¡
++;

577 ià(
m_İ_queue
.
fœ¡
 =ğm_İ_queue.
size
)

579 
m_İ_queue
.
fœ¡
 = 0;

582 
p_tim”
 = 
p_u£r_İ
->
p_node
;

584 
p_u£r_İ
->
İ_ty³
)

586 
TIMER_USER_OP_TYPE_STOP
:

588 ià(
	`tim”_li¡_»move
(
p_u£r_İ
->
p_node
))

590 
com·»_upd©e
 = 
Œue
;

593 
p_tim”
->
is_ruÂšg
 = 
çl£
;

596 
TIMER_USER_OP_TYPE_STOP_ALL
:

598 
mp_tim”_id_h—d
 !ğ
NULL
)

600 
tim”_node_t
 * 
p_h—d
 = 
mp_tim”_id_h—d
;

602 
p_h—d
->
is_ruÂšg
 = 
çl£
;

603 
mp_tim”_id_h—d
 = 
p_h—d
->
Ãxt
;

606 
TIMER_USER_OP_TYPE_START
:

613 ià(
p_tim”
->
is_ruÂšg
)

618 
p_tim”
->
ticks_©_¡¬t
 = 
p_u£r_İ
->
·¿ms
.
¡¬t
.ticks_at_start;

619 
p_tim”
->
ticks_fœ¡_š‹rv®
 = 
p_u£r_İ
->
·¿ms
.
¡¬t
.ticks_first_interval;

620 
p_tim”
->
ticks_³riodic_š‹rv®
 = 
p_u£r_İ
->
·¿ms
.
¡¬t
.ticks_periodic_interval;

621 
p_tim”
->
p_cÚ‹xt
 = 
p_u£r_İ
->
·¿ms
.
¡¬t
.p_context;

623 ià(
m_¹c1_»£t
)

625 
p_tim”
->
ticks_©_¡¬t
 = 0;

631 ((
p_tim”
->
ticks_©_¡¬t
 - 
m_ticks_Ï‹¡
è& 
MAX_RTC_COUNTER_VAL
)

633 (
MAX_RTC_COUNTER_VAL
 / 2)

636 
p_tim”
->
ticks_to_expœe
 = 
	`ticks_diff_g‘
Õ_tim”->
ticks_©_¡¬t
, 
m_ticks_Ï‹¡
) +

637 
p_tim”
->
ticks_fœ¡_š‹rv®
;

641 
ušt32_t
 
d–_cu¼’t_¡¬t
;

643 
d–_cu¼’t_¡¬t
 = 
	`ticks_diff_g‘
(
m_ticks_Ï‹¡
, 
p_tim”
->
ticks_©_¡¬t
);

644 ià(
p_tim”
->
ticks_fœ¡_š‹rv®
 > 
d–_cu¼’t_¡¬t
)

646 
p_tim”
->
ticks_to_expœe
 =…_tim”->
ticks_fœ¡_š‹rv®
 - 
d–_cu¼’t_¡¬t
;

650 
p_tim”
->
ticks_to_expœe
 = 0;

654 
p_tim”
->
ticks_©_¡¬t
 = 0;

655 
p_tim”
->
ticks_fœ¡_š‹rv®
 = 0;

656 
p_tim”
->
is_ruÂšg
 = 
Œue
;

657 
p_tim”
->
Ãxt
 = 
NULL
;

660 
	`tim”_li¡_š£¹
(
p_tim”
);

663  (
com·»_upd©e
 || (
mp_tim”_id_h—d
 !ğ
p_tim”_id_Şd_h—d
));

664 
	}
}

669 
	$com·»_»g_upd©e
(
tim”_node_t
 * 
p_tim”_id_h—d_Şd
)

672 ià(
mp_tim”_id_h—d
 !ğ
NULL
)

674 
ušt32_t
 
ticks_to_expœe
 = 
mp_tim”_id_h—d
->ticks_to_expire;

675 
ušt32_t
 
´e_couÁ”_v®
 = 
	`¹c1_couÁ”_g‘
();

676 
ušt32_t
 
cc
 = 
m_ticks_Ï‹¡
;

677 
ušt32_t
 
ticks_–­£d
 = 
	`ticks_diff_g‘
(
´e_couÁ”_v®
, 
cc
è+ 
RTC_COMPARE_OFFSET_MIN
;

679 ià(!
m_¹c1_ruÂšg
)

682 
	`¹c1_¡¬t
();

685 
cc
 +ğ(
ticks_–­£d
 < 
ticks_to_expœe
) ?icks_to_expire :icks_elapsed;

686 
cc
 &ğ
MAX_RTC_COUNTER_VAL
;

688 
	`¹c1_com·»0_£t
(
cc
);

690 
ušt32_t
 
po¡_couÁ”_v®
 = 
	`¹c1_couÁ”_g‘
();

693 (
	`ticks_diff_g‘
(
po¡_couÁ”_v®
, 
´e_couÁ”_v®
è+ 
RTC_COMPARE_OFFSET_MIN
)

695 
	`ticks_diff_g‘
(
cc
, 
´e_couÁ”_v®
)

703 
	`¹c1_com·»0_£t
(
	`¹c1_couÁ”_g‘
());

704 
	`Äf_d–ay_us
(
MAX_RTC_TASKS_DELAY
);

705 
	`tim”_timeouts_check_sched
();

710 #ià(
APP_TIMER_KEEPS_RTC_ACTIVE
 == 0)

712 
	`¹c1_¡İ
();

715 
	}
}

720 
	$tim”_li¡_hªdËr
()

722 
tim”_node_t
 * 
p_»¡¬t_li¡_h—d
 = 
NULL
;

724 
ušt32_t
 
ticks_–­£d
;

725 
ušt32_t
 
ticks_´evious
;

726 
boŞ
 
ticks_have_–­£d
;

727 
boŞ
 
com·»_upd©e
 = 
çl£
;

728 
tim”_node_t
 * 
p_tim”_id_h—d_Şd
;

730 #ià
APP_TIMER_WITH_PROFILER


732 
ušt8_t
 
size
 = 
m_İ_queue
.size;

733 
ušt8_t
 
fœ¡
 = 
m_İ_queue
.first;

734 
ušt8_t
 
Ï¡
 = 
m_İ_queue
.last;

735 
ušt8_t
 
utiz©iÚ
 = (
fœ¡
 <ğ
Ï¡
è? (Ï¡ - fœ¡è: (
size
 + 1 - first +†ast);

737 ià(
utiz©iÚ
 > 
m_max_u£r_İ_queue_utiz©iÚ
)

739 
m_max_u£r_İ_queue_utiz©iÚ
 = 
utiz©iÚ
;

745 
ticks_´evious
 = 
m_ticks_Ï‹¡
;

746 
p_tim”_id_h—d_Şd
 = 
mp_tim”_id_h—d
;

749 
ticks_have_–­£d
 = 
	`–­£d_ticks_acquœe
(&
ticks_–­£d
);

752 ià(
ticks_have_–­£d
)

754 
	`expœed_tim”s_hªdËr
(
ticks_–­£d
, 
ticks_´evious
, &
p_»¡¬t_li¡_h—d
);

755 
com·»_upd©e
 = 
Œue
;

760 ià(
	`li¡_š£¹iÚs_hªdËr
(
p_»¡¬t_li¡_h—d
))

762 
com·»_upd©e
 = 
Œue
;

766 ià(
com·»_upd©e
)

768 
	`com·»_»g_upd©e
(
p_tim”_id_h—d_Şd
);

770 
m_¹c1_»£t
 = 
çl£
;

771 
	}
}

778 
	$u£r_İ_’que
(
ušt8_t
 
Ï¡_šdex
)

780 
m_İ_queue
.
Ï¡
 = 
Ï¡_šdex
;

781 
	}
}

790 
tim”_u£r_İ_t
 * 
	$u£r_İ_®loc
Ğ
ušt8_t
 * 
p_Ï¡_šdex
)

792 
ušt8_t
 
Ï¡
;

793 
tim”_u£r_İ_t
 * 
p_u£r_İ
;

795 
Ï¡
 = 
m_İ_queue
.last + 1;

796 ià(
Ï¡
 =ğ
m_İ_queue
.
size
)

799 
Ï¡
 = 0;

801 ià(
Ï¡
 =ğ
m_İ_queue
.
fœ¡
)

804  
NULL
;

807 *
p_Ï¡_šdex
 = 
Ï¡
;

808 
p_u£r_İ
 = &
m_İ_queue
.
u£r_İ_queue
[m_İ_queue.
Ï¡
];

810  
p_u£r_İ
;

811 
	}
}

824 
ušt32_t
 
	$tim”_¡¬t_İ_scheduË
(
tim”_node_t
 * 
p_node
,

825 
ušt32_t
 
timeout_š™Ÿl
,

826 
ušt32_t
 
timeout_³riodic
,

827 * 
p_cÚ‹xt
)

829 
ušt8_t
 
Ï¡_šdex
;

830 
ušt32_t
 
”r_code
 = 
NRF_SUCCESS
;

832 
	`CRITICAL_REGION_ENTER
();

833 
tim”_u£r_İ_t
 * 
p_u£r_İ
 = 
	`u£r_İ_®loc
(&
Ï¡_šdex
);

834 ià(
p_u£r_İ
 =ğ
NULL
)

836 
”r_code
 = 
NRF_ERROR_NO_MEM
;

840 
p_u£r_İ
->
İ_ty³
 = 
TIMER_USER_OP_TYPE_START
;

841 
p_u£r_İ
->
p_node
 =…_node;

842 
p_u£r_İ
->
·¿ms
.
¡¬t
.
ticks_©_¡¬t
 = 
	`¹c1_couÁ”_g‘
();

843 
p_u£r_İ
->
·¿ms
.
¡¬t
.
ticks_fœ¡_š‹rv®
 = 
timeout_š™Ÿl
;

844 
p_u£r_İ
->
·¿ms
.
¡¬t
.
ticks_³riodic_š‹rv®
 = 
timeout_³riodic
;

845 
p_u£r_İ
->
·¿ms
.
¡¬t
.
p_cÚ‹xt
 =…_context;

847 
	`u£r_İ_’que
(
Ï¡_šdex
);

849 
	`CRITICAL_REGION_EXIT
();

851 ià(
”r_code
 =ğ
NRF_SUCCESS
)

853 
	`tim”_li¡_hªdËr_sched
();

856  
”r_code
;

857 
	}
}

868 
ušt32_t
 
	$tim”_¡İ_İ_scheduË
(
tim”_node_t
 * 
p_node
,

869 
tim”_u£r_İ_ty³_t
 
İ_ty³
)

871 
ušt8_t
 
Ï¡_šdex
;

872 
ušt32_t
 
”r_code
 = 
NRF_SUCCESS
;

874 
	`CRITICAL_REGION_ENTER
();

875 
tim”_u£r_İ_t
 * 
p_u£r_İ
 = 
	`u£r_İ_®loc
(&
Ï¡_šdex
);

876 ià(
p_u£r_İ
 =ğ
NULL
)

878 
”r_code
 = 
NRF_ERROR_NO_MEM
;

882 
p_u£r_İ
->
İ_ty³
 = op_type;

883 
p_u£r_İ
->
p_node
 =…_node;

885 
	`u£r_İ_’que
(
Ï¡_šdex
);

887 
	`CRITICAL_REGION_EXIT
();

889 ià(
”r_code
 =ğ
NRF_SUCCESS
)

891 
	`tim”_li¡_hªdËr_sched
();

894  
”r_code
;

895 
	}
}

901 
	$RTC1_IRQHªdËr
()

904 
NRF_RTC1
->
EVENTS_COMPARE
[0] = 0;

905 
NRF_RTC1
->
EVENTS_COMPARE
[1] = 0;

906 
NRF_RTC1
->
EVENTS_COMPARE
[2] = 0;

907 
NRF_RTC1
->
EVENTS_COMPARE
[3] = 0;

908 
NRF_RTC1
->
EVENTS_TICK
 = 0;

909 
NRF_RTC1
->
EVENTS_OVRFLW
 = 0;

912 
	`tim”_timeouts_check
();

913 
	}
}

920 
	$SWI_IRQHªdËr
()

922 
	`tim”_li¡_hªdËr
();

923 
	}
}

926 
»t_code_t
 
	$­p_tim”_š™
()

929 
	`¹c1_¡İ
();

932 
m_İ_queue
.
fœ¡
 = 0;

933 
m_İ_queue
.
Ï¡
 = 0;

934 
m_İ_queue
.
size
 = 
APP_TIMER_CONFIG_OP_QUEUE_SIZE
+1;

936 
mp_tim”_id_h—d
 = 
NULL
;

937 
m_ticks_–­£d_q_»ad_šd
 = 0;

938 
m_ticks_–­£d_q_wr™e_šd
 = 0;

940 #ià
APP_TIMER_WITH_PROFILER


941 
m_max_u£r_İ_queue_utiz©iÚ
 = 0;

944 
	`NVIC_CË¬P’dšgIRQ
(
SWI_IRQn
);

945 
	`NVIC_S‘PriÜ™y
(
SWI_IRQn
, 
SWI_IRQ_PRI
);

946 
	`NVIC_EÇbËIRQ
(
SWI_IRQn
);

948 
	`¹c1_š™
(
APP_TIMER_CONFIG_RTC_FREQUENCY
);

950 
m_ticks_Ï‹¡
 = 
	`¹c1_couÁ”_g‘
();

952  
NRF_SUCCESS
;

953 
	}
}

956 
»t_code_t
 
	$­p_tim”_ü—‹
(
­p_tim”_id_t
 cÚ¡ * 
p_tim”_id
,

957 
­p_tim”_mode_t
 
mode
,

958 
­p_tim”_timeout_hªdËr_t
 
timeout_hªdËr
)

961 
	`VERIFY_MODULE_INITIALIZED
();

963 ià(
timeout_hªdËr
 =ğ
NULL
)

965  
NRF_ERROR_INVALID_PARAM
;

967 ià(
p_tim”_id
 =ğ
NULL
)

969  
NRF_ERROR_INVALID_PARAM
;

971 ià(((
tim”_node_t
*)*
p_tim”_id
)->
is_ruÂšg
)

973  
NRF_ERROR_INVALID_STATE
;

976 
tim”_node_t
 * 
p_node
 = (tim”_node_ˆ*)*
p_tim”_id
;

977 
p_node
->
is_ruÂšg
 = 
çl£
;

978 
p_node
->
mode
 = mode;

979 
p_node
->
p_timeout_hªdËr
 = 
timeout_hªdËr
;

980  
NRF_SUCCESS
;

981 
	}
}

983 
»t_code_t
 
	$­p_tim”_¡¬t
(
­p_tim”_id_t
 
tim”_id
, 
ušt32_t
 
timeout_ticks
, * 
p_cÚ‹xt
)

985 
ušt32_t
 
timeout_³riodic
;

986 
tim”_node_t
 * 
p_node
 = (tim”_node_t*)
tim”_id
;

989 
	`VERIFY_MODULE_INITIALIZED
();

991 ià(
tim”_id
 == 0)

993  
NRF_ERROR_INVALID_STATE
;

995 ià(
timeout_ticks
 < 
APP_TIMER_MIN_TIMEOUT_TICKS
)

997  
NRF_ERROR_INVALID_PARAM
;

999 ià(
p_node
->
p_timeout_hªdËr
 =ğ
NULL
)

1001  
NRF_ERROR_INVALID_STATE
;

1005 
timeout_³riodic
 = (
p_node
->
mode
 =ğ
APP_TIMER_MODE_REPEATED
è? 
timeout_ticks
 : 0;

1007  
	`tim”_¡¬t_İ_scheduË
(
p_node
,

1008 
timeout_ticks
,

1009 
timeout_³riodic
,

1010 
p_cÚ‹xt
);

1011 
	}
}

1014 
»t_code_t
 
	$­p_tim”_¡İ
(
­p_tim”_id_t
 
tim”_id
)

1016 
tim”_node_t
 * 
p_node
 = (tim”_node_t*)
tim”_id
;

1018 
	`VERIFY_MODULE_INITIALIZED
();

1020 ià((
tim”_id
 =ğ
NULL
è|| (
p_node
->
p_timeout_hªdËr
 == NULL))

1022  
NRF_ERROR_INVALID_STATE
;

1025 
p_node
->
is_ruÂšg
 = 
çl£
;

1028  
	`tim”_¡İ_İ_scheduË
(
p_node
, 
TIMER_USER_OP_TYPE_STOP
);

1029 
	}
}

1032 
»t_code_t
 
	$­p_tim”_¡İ_®l
()

1035 
	`VERIFY_MODULE_INITIALIZED
();

1037  
	`tim”_¡İ_İ_scheduË
(
NULL
, 
TIMER_USER_OP_TYPE_STOP_ALL
);

1038 
	}
}

1041 
ušt32_t
 
	$­p_tim”_út_g‘
()

1043  
	`¹c1_couÁ”_g‘
();

1044 
	}
}

1047 
ušt32_t
 
	$­p_tim”_út_diff_compu‹
(
ušt32_t
 
ticks_to
,

1048 
ušt32_t
 
ticks_äom
)

1050  
	`ticks_diff_g‘
(
ticks_to
, 
ticks_äom
);

1051 
	}
}

1053 #ià
APP_TIMER_WITH_PROFILER


1054 
ušt8_t
 
	$­p_tim”_İ_queue_utiz©iÚ_g‘
()

1056  
m_max_u£r_İ_queue_utiz©iÚ
;

1057 
	}
}

1060 
	$­p_tim”_·u£
()

1062 
NRF_RTC1
->
TASKS_STOP
 = 1;

1063 
	}
}

1065 
	$­p_tim”_»sume
()

1067 
NRF_RTC1
->
TASKS_START
 = 1;

1068 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\util\app_error.c

49 
	~"Äf.h
"

50 
	~<¡dio.h
>

51 
	~"­p_”rÜ.h
"

52 
	~"nÜdic_commÚ.h
"

53 
	~"sdk_”rÜs.h
"

65 
	$­p_”rÜ_hªdËr
(
»t_code_t
 
”rÜ_code
, 
ušt32_t
 
lše_num
, cÚ¡ 
ušt8_t
 * 
p_fe_Çme
)

67 
”rÜ_šfo_t
 
”rÜ_šfo
 =

69 .
lše_num
 =†ine_num,

70 .
p_fe_Çme
 =…_file_name,

71 .
”r_code
 = 
”rÜ_code
,

73 
	`­p_”rÜ_çuÉ_hªdËr
(
NRF_FAULT_ID_SDK_ERROR
, 0, (
ušt32_t
)(&
”rÜ_šfo
));

75 
	`UNUSED_VARIABLE
(
”rÜ_šfo
);

76 
	}
}

79 
	$­p_”rÜ_hªdËr_b¬e
(
»t_code_t
 
”rÜ_code
)

81 
”rÜ_šfo_t
 
”rÜ_šfo
 =

83 .
lše_num
 = 0,

84 .
p_fe_Çme
 = 
NULL
,

85 .
”r_code
 = 
”rÜ_code
,

88 
	`­p_”rÜ_çuÉ_hªdËr
(
NRF_FAULT_ID_SDK_ERROR
, 0, (
ušt32_t
)(&
”rÜ_šfo
));

90 
	`UNUSED_VARIABLE
(
”rÜ_šfo
);

91 
	}
}

94 
	$­p_”rÜ_§ve_ªd_¡İ
(
ušt32_t
 
id
, ušt32_ˆ
pc
, ušt32_ˆ
šfo
)

99 
ušt32_t
 
çuÉ_id
;

100 
ušt32_t
 
pc
;

101 
ušt32_t
 
”rÜ_šfo
;

102 
as£¹_šfo_t
 * 
p_as£¹_šfo
;

103 
”rÜ_šfo_t
 * 
p_”rÜ_šfo
;

104 
»t_code_t
 
”r_code
;

105 
ušt32_t
 
lše_num
;

106 cÚ¡ 
ušt8_t
 * 
p_fe_Çme
;

107 } 
m_”rÜ_d©a
 = {0};

111 vŞ©
boŞ
 
loİ
 = 
Œue
;

112 
	`UNUSED_VARIABLE
(
loİ
);

114 
m_”rÜ_d©a
.
çuÉ_id
 = 
id
;

115 
m_”rÜ_d©a
.
pc
 =…c;

116 
m_”rÜ_d©a
.
”rÜ_šfo
 = 
šfo
;

118 
id
)

120 
NRF_FAULT_ID_SDK_ASSERT
:

121 
m_”rÜ_d©a
.
p_as£¹_šfo
 = (
as£¹_šfo_t
 *)
šfo
;

122 
m_”rÜ_d©a
.
lše_num
 = m_”rÜ_d©a.
p_as£¹_šfo
->line_num;

123 
m_”rÜ_d©a
.
p_fe_Çme
 = m_”rÜ_d©a.
p_as£¹_šfo
->p_file_name;

126 
NRF_FAULT_ID_SDK_ERROR
:

127 
m_”rÜ_d©a
.
p_”rÜ_šfo
 = (
”rÜ_šfo_t
 *)
šfo
;

128 
m_”rÜ_d©a
.
”r_code
 = m_”rÜ_d©a.
p_”rÜ_šfo
->err_code;

129 
m_”rÜ_d©a
.
lše_num
 = m_”rÜ_d©a.
p_”rÜ_šfo
->line_num;

130 
m_”rÜ_d©a
.
p_fe_Çme
 = m_”rÜ_d©a.
p_”rÜ_šfo
->p_file_name;

134 
	`UNUSED_VARIABLE
(
m_”rÜ_d©a
);

137 
	`__di§bË_œq
();

138 
loİ
);

140 
	`__’abË_œq
();

141 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\util\app_error_weak.c

40 
	~"­p_”rÜ.h
"

42 
	~"Äf_log.h
"

43 
	~"Äf_log_ù¾.h
"

44 
	~"Äf_¡»¼Ü.h
"

46 #ià
defšed
(
SOFTDEVICE_PRESENT
) && SOFTDEVICE_PRESENT

47 
	~"Äf_sdm.h
"

56 
__WEAK
 
	$­p_”rÜ_çuÉ_hªdËr
(
ušt32_t
 
id
, ušt32_ˆ
pc
, ušt32_ˆ
šfo
)

58 
	`NRF_LOG_FINAL_FLUSH
();

60 #iâdeà
DEBUG


61 
	`NRF_LOG_ERROR
("Fatalƒrror");

63 
id
)

65 #ià
	`defšed
(
SOFTDEVICE_PRESENT
) && SOFTDEVICE_PRESENT

66 
NRF_FAULT_ID_SD_ASSERT
:

67 
	`NRF_LOG_ERROR
("SOFTDEVICE: ASSERTION FAILED");

69 
NRF_FAULT_ID_APP_MEMACC
:

70 
	`NRF_LOG_ERROR
("SOFTDEVICE: INVALID MEMORY ACCESS");

73 
NRF_FAULT_ID_SDK_ASSERT
:

75 
as£¹_šfo_t
 * 
p_šfo
 = (as£¹_šfo_ˆ*)
šfo
;

76 
	`NRF_LOG_ERROR
("ASSERTION FAILED‡t %s:%u",

77 
p_šfo
->
p_fe_Çme
,

78 
p_šfo
->
lše_num
);

81 
NRF_FAULT_ID_SDK_ERROR
:

83 
”rÜ_šfo_t
 * 
p_šfo
 = (”rÜ_šfo_ˆ*)
šfo
;

84 
	`NRF_LOG_ERROR
("ERROR %u [%s]‡t %s:%u",

85 
p_šfo
->
”r_code
,

86 
	`Äf_¡»¼Ü_g‘
(
p_šfo
->
”r_code
),

87 
p_šfo
->
p_fe_Çme
,

88 
p_šfo
->
lše_num
);

92 
	`NRF_LOG_ERROR
("UNKNOWN FAULT‡ˆ0x%08X", 
pc
);

97 
NRF_BREAKPOINT_COND
;

100 #iâdeà
DEBUG


101 
	`NRF_LOG_WARNING
("System„eset");

102 
	`NVIC_Sy¡emRe£t
();

104 
	`­p_”rÜ_§ve_ªd_¡İ
(
id
, 
pc
, 
šfo
);

106 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\util\app_util_platform.c

40 
	~"­p_ut_¶©fÜm.h
"

42 #ifdeà
SOFTDEVICE_PRESENT


44 
Äf_nvic_¡©e_t
 
	gÄf_nvic_¡©e
;

47 
ušt32_t
 
	gm_š_ü™iÿl_»giÚ
 = 0;

49 
	$­p_ut_di§bË_œq
()

51 
	`__di§bË_œq
();

52 
m_š_ü™iÿl_»giÚ
++;

53 
	}
}

55 
	$­p_ut_’abË_œq
()

57 
m_š_ü™iÿl_»giÚ
--;

58 ià(
m_š_ü™iÿl_»giÚ
 == 0)

60 
	`__’abË_œq
();

62 
	}
}

64 
	$­p_ut_ü™iÿl_»giÚ_’‹r
(
ušt8_t
 *
p_Ã¡ed
)

66 #ià
__CORTEX_M
 == (0x04U)

67 
	`ASSERT
(
APP_LEVEL_PRIVILEGED
 =ğ
	`´ivege_Ëv–_g‘
())

70 #ià
	`defšed
(
SOFTDEVICE_PRESENT
)

72 (è
	`sd_nvic_ü™iÿl_»giÚ_’‹r
(
p_Ã¡ed
);

74 
	`­p_ut_di§bË_œq
();

76 
	}
}

78 
	$­p_ut_ü™iÿl_»giÚ_ex™
(
ušt8_t
 
Ã¡ed
)

80 #ià
__CORTEX_M
 == (0x04U)

81 
	`ASSERT
(
APP_LEVEL_PRIVILEGED
 =ğ
	`´ivege_Ëv–_g‘
())

84 #ià
	`defšed
(
SOFTDEVICE_PRESENT
)

86 (è
	`sd_nvic_ü™iÿl_»giÚ_ex™
(
Ã¡ed
);

88 
	`­p_ut_’abË_œq
();

90 
	}
}

93 
ušt8_t
 
	$´ivege_Ëv–_g‘
()

95 #ià
__CORTEX_M
 =ğ(0x00Uè|| 
	`defšed
(
_WIN32
è|| defšed(
__unix
è|| defšed(
__APPLE__
)

97  
APP_LEVEL_PRIVILEGED
;

98 #–ià
__CORTEX_M
 == (0x04U)

99 
ušt32_t
 
i¤_veùÜ_num
 = 
	`__g‘_IPSR
(è& 
IPSR_ISR_Msk
 ;

100 ià(0 =ğ
i¤_veùÜ_num
)

103 
št32_t
 
cÚŒŞ
 = 
	`__g‘_CONTROL
();

104  
cÚŒŞ
 & 
CONTROL_nPRIV_Msk
 ? 
APP_LEVEL_UNPRIVILEGED
 : 
APP_LEVEL_PRIVILEGED
;

109  
APP_LEVEL_PRIVILEGED
;

112 
	}
}

115 
ušt8_t
 
	$cu¼’t_št_´iÜ™y_g‘
()

117 
ušt32_t
 
i¤_veùÜ_num
 = 
	`__g‘_IPSR
(è& 
IPSR_ISR_Msk
 ;

118 ià(
i¤_veùÜ_num
 > 0)

120 
št32_t
 
œq_ty³
 = ((št32_t)
i¤_veùÜ_num
 - 
EXTERNAL_INT_VECTOR_OFFSET
);

121  (
	`NVIC_G‘PriÜ™y
((
IRQn_Ty³
)
œq_ty³
) & 0xFF);

125  
APP_IRQ_PRIORITY_THREAD
;

127 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\util\nrf_assert.c

40 
	~"Äf_as£¹.h
"

41 
	~"­p_”rÜ.h
"

42 
	~"nÜdic_commÚ.h
"

44 
__WEAK
 
	$as£¹_Äf_ÿÎback
(
ušt16_t
 
lše_num
, cÚ¡ 
ušt8_t
 * 
fe_Çme
)

46 
as£¹_šfo_t
 
as£¹_šfo
 =

48 .
lše_num
 =†ine_num,

49 .
p_fe_Çme
 = 
fe_Çme
,

51 
	`­p_”rÜ_çuÉ_hªdËr
(
NRF_FAULT_ID_SDK_ASSERT
, 0, (
ušt32_t
)(&
as£¹_šfo
));

53 
	`UNUSED_VARIABLE
(
as£¹_šfo
);

54 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\util\sdk_mapped_flags.c

40 
	~"sdk_m­³d_æags.h
"

41 
	~<¡dšt.h
>

42 
	~<¡dboŞ.h
>

43 
	~<¡ddef.h
>

44 
	~"comp”_ab¡¿ùiÚ.h
"

49 
STATIC_ASSERT
(((
sdk_m­³d_æags_t
è* 
SDK_MAPPED_FLAGS_N_KEYS_PER_BYTE
è>ğ
SDK_MAPPED_FLAGS_N_KEYS
);

59 
__INLINE
 
	$sdk_m­³d_æags_£t_by_šdex
(
sdk_m­³d_æags_t
 * 
p_æags
, 
ušt16_t
 
šdex
)

61 *
p_æags
 |ğ(1U << 
šdex
);

62 
	}
}

72 
__INLINE
 
	$sdk_m­³d_æags_ş—r_by_šdex
(
sdk_m­³d_æags_t
 * 
p_æags
, 
ušt16_t
 
šdex
)

74 *
p_æags
 &ğ~(1U << 
šdex
);

75 
	}
}

85 
__INLINE
 
boŞ
 
	$sdk_m­³d_æags_g‘_by_šdex
(
sdk_m­³d_æags_t
 
æags
, 
ušt16_t
 
šdex
)

87  ((
æags
 & (1 << 
šdex
)) != 0);

88 
	}
}

92 
ušt16_t
 
	$sdk_m­³d_æags_fœ¡_key_šdex_g‘
(
sdk_m­³d_æags_t
 
æags
)

94 
ušt16_t
 
i
 = 0; i < 
SDK_MAPPED_FLAGS_N_KEYS
; i++)

96 ià(
	`sdk_m­³d_æags_g‘_by_šdex
(
æags
, 
i
))

98  
i
;

101  
SDK_MAPPED_FLAGS_INVALID_INDEX
;

102 
	}
}

105 
	$sdk_m­³d_æags_upd©e_by_key
(
ušt16_t
 * 
p_keys
,

106 
sdk_m­³d_æags_t
 * 
p_æags
,

107 
ušt16_t
 
key
,

108 
boŞ
 
v®ue
)

110 
	`sdk_m­³d_æags_bulk_upd©e_by_key
(
p_keys
, 
p_æags
, 1, 
key
, 
v®ue
);

111 
	}
}

114 
	$sdk_m­³d_æags_bulk_upd©e_by_key
(
ušt16_t
 * 
p_keys
,

115 
sdk_m­³d_æags_t
 * 
p_æags
,

116 
ušt32_t
 
n_æag_cŞËùiÚs
,

117 
ušt16_t
 
key
,

118 
boŞ
 
v®ue
)

120 ià((
p_keys
 !ğ
NULL
è&& (
p_æags
 !ğNULLè&& (
n_æag_cŞËùiÚs
 > 0))

122 
ušt32_t
 
i
 = 0; i < 
SDK_MAPPED_FLAGS_N_KEYS
; i++)

124 ià(
p_keys
[
i
] =ğ
key
)

126 
ušt32_t
 
j
 = 0; j < 
n_æag_cŞËùiÚs
; j++)

128 ià(
v®ue
)

130 
	`sdk_m­³d_æags_£t_by_šdex
(&
p_æags
[
j
], 
i
);

134 
	`sdk_m­³d_æags_ş—r_by_šdex
(&
p_æags
[
j
], 
i
);

141 
	}
}

144 
boŞ
 
	$sdk_m­³d_æags_g‘_by_key_w_idx
(
ušt16_t
 * 
p_keys
,

145 
sdk_m­³d_æags_t
 
æags
,

146 
ušt16_t
 
key
,

147 
ušt8_t
 * 
p_šdex
)

149 ià(
p_keys
 !ğ
NULL
)

151 
ušt32_t
 
i
 = 0; i < 
SDK_MAPPED_FLAGS_N_KEYS
; i++)

153 ià(
p_keys
[
i
] =ğ
key
)

155 ià(
p_šdex
 !ğ
NULL
)

157 *
p_šdex
 = 
i
;

159  
	`sdk_m­³d_æags_g‘_by_šdex
(
æags
, 
i
);

163 ià(
p_šdex
 !ğ
NULL
)

165 *
p_šdex
 = 
SDK_MAPPED_FLAGS_N_KEYS
;

167  
çl£
;

168 
	}
}

171 
boŞ
 
	$sdk_m­³d_æags_g‘_by_key
(
ušt16_t
 * 
p_keys
, 
sdk_m­³d_æags_t
 
æags
, ušt16_ˆ
key
)

173 ià(
p_keys
 !ğ
NULL
)

175 
ušt32_t
 
i
 = 0; i < 
SDK_MAPPED_FLAGS_N_KEYS
; i++)

177 ià(
p_keys
[
i
] =ğ
key
)

179  
	`sdk_m­³d_æags_g‘_by_šdex
(
æags
, 
i
);

183  
çl£
;

184 
	}
}

187 
sdk_m­³d_æags_key_li¡_t
 
	$sdk_m­³d_æags_key_li¡_g‘
(
ušt16_t
 * 
p_keys
,

188 
sdk_m­³d_æags_t
 
æags
)

190 
sdk_m­³d_æags_key_li¡_t
 
key_li¡
;

191 
key_li¡
.
Ën
 = 0;

193 ià(
p_keys
 !ğ
NULL
)

195 
ušt32_t
 
i
 = 0; i < 
SDK_MAPPED_FLAGS_N_KEYS
; i++)

197 ià(
	`sdk_m­³d_æags_g‘_by_šdex
(
æags
, 
i
))

199 
key_li¡
.
æag_keys
[key_li¡.
Ën
++] = 
p_keys
[
i
];

204  
key_li¡
;

205 
	}
}

208 
ušt32_t
 
	$sdk_m­³d_æags_n_æags_£t
(
sdk_m­³d_æags_t
 
æags
)

210 
ušt32_t
 
n_æags_£t
 = 0;

212 
ušt32_t
 
i
 = 0; i < 
SDK_MAPPED_FLAGS_N_KEYS
; i++)

214 ià(
	`sdk_m­³d_æags_g‘_by_šdex
(
æags
, 
i
))

216 
n_æags_£t
 += 1;

219  
n_æags_£t
;

220 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\softdevice\common\nrf_sdh.c

41 
	~"sdk_commÚ.h
"

42 #ià
NRF_MODULE_ENABLED
(
NRF_SDH
)

44 
	~"Äf_sdh.h
"

46 
	~<¡dšt.h
>

48 
	~"Äf_sdm.h
"

49 
	~"Äf_nvic.h
"

50 
	~"sdk_cÚfig.h
"

51 
	~"­p_”rÜ.h
"

52 
	~"­p_ut_¶©fÜm.h
"

55 
	#NRF_LOG_MODULE_NAME
 
Äf_sdh


	)

56 #ià
NRF_SDH_LOG_ENABLED


57 
	#NRF_LOG_LEVEL
 
NRF_SDH_LOG_LEVEL


	)

58 
	#NRF_LOG_INFO_COLOR
 
NRF_SDH_INFO_COLOR


	)

59 
	#NRF_LOG_DEBUG_COLOR
 
NRF_SDH_DEBUG_COLOR


	)

61 
	#NRF_LOG_LEVEL
 0

	)

63 
	~"Äf_log.h
"

64 
NRF_LOG_MODULE_REGISTER
();

66 #ià(
NRF_SDH_DISPATCH_MODEL
 =ğ
NRF_SDH_DISPATCH_MODEL_APPSH
)

67 #ià!
APP_SCHEDULER_ENABLED


70 
	~"­p_scheduËr.h
"

75 
NRF_SECTION_SET_DEF
(
sdh_»q_ob£rv”s
, 
Äf_sdh_»q_ob£rv”_t
, 
NRF_SDH_REQ_OBSERVER_PRIO_LEVELS
);

78 
NRF_SECTION_SET_DEF
(
sdh_¡©e_ob£rv”s
, 
Äf_sdh_¡©e_ob£rv”_t
, 
NRF_SDH_STATE_OBSERVER_PRIO_LEVELS
);

81 
NRF_SECTION_SET_DEF
(
sdh_¡ack_ob£rv”s
, 
Äf_sdh_¡ack_ob£rv”_t
, 
NRF_SDH_STACK_OBSERVER_PRIO_LEVELS
);

84 
boŞ
 
	gm_Äf_sdh_’abËd
;

85 
boŞ
 
	gm_Äf_sdh_su¥’ded
;

86 
boŞ
 
	gm_Äf_sdh_cÚtšue
;

93 
»t_code_t
 
	$sdh_»que¡_ob£rv”_nÙify
(
Äf_sdh_»q_evt_t
 
»q
)

95 
Äf_£ùiÚ_™”_t
 
™”
;

97 
	`NRF_LOG_DEBUG
("S‹„eque¡: 0x%08X", 
»q
);

99 
	`Äf_£ùiÚ_™”_š™
(&
™”
, &
sdh_»q_ob£rv”s
);

100 
	`Äf_£ùiÚ_™”_g‘
(&
™”
è!ğ
NULL
;

101 
	`Äf_£ùiÚ_™”_Ãxt
(&
™”
))

103 
Äf_sdh_»q_ob£rv”_t
 * 
p_ob£rv”
;

104 
Äf_sdh_»q_evt_hªdËr_t
 
hªdËr
;

106 
p_ob£rv”
 = (
Äf_sdh_»q_ob£rv”_t
 *è
	`Äf_£ùiÚ_™”_g‘
(&
™”
);

107 
hªdËr
 = 
p_ob£rv”
->handler;

109 ià(
	`hªdËr
(
»q
, 
p_ob£rv”
->
p_cÚ‹xt
))

111 
	`NRF_LOG_DEBUG
("NÙify ob£rv” 0x%08X =>„—dy", 
p_ob£rv”
);

116 
	`NRF_LOG_DEBUG
("NÙify ob£rv” 0x%08X => blockšg", 
p_ob£rv”
);

117  
NRF_ERROR_BUSY
;

120  
NRF_SUCCESS
;

121 
	}
}

128 
	$sdh_¡©e_ob£rv”_nÙify
(
Äf_sdh_¡©e_evt_t
 
evt
)

130 
Äf_£ùiÚ_™”_t
 
™”
;

132 
	`NRF_LOG_DEBUG
("S‹ chªge: 0x%08X", 
evt
);

134 
	`Äf_£ùiÚ_™”_š™
(&
™”
, &
sdh_¡©e_ob£rv”s
);

135 
	`Äf_£ùiÚ_™”_g‘
(&
™”
è!ğ
NULL
;

136 
	`Äf_£ùiÚ_™”_Ãxt
(&
™”
))

138 
Äf_sdh_¡©e_ob£rv”_t
 * 
p_ob£rv”
;

139 
Äf_sdh_¡©e_evt_hªdËr_t
 
hªdËr
;

141 
p_ob£rv”
 = (
Äf_sdh_¡©e_ob£rv”_t
 *è
	`Äf_£ùiÚ_™”_g‘
(&
™”
);

142 
hªdËr
 = 
p_ob£rv”
->handler;

144 
	`hªdËr
(
evt
, 
p_ob£rv”
->
p_cÚ‹xt
);

146 
	}
}

149 
	$soádeviûs_evt_œq_’abË
()

151 #ifdeà
SOFTDEVICE_PRESENT


152 
»t_code_t
 
»t_code
 = 
	`sd_nvic_EÇbËIRQ
((
IRQn_Ty³
)
SD_EVT_IRQn
);

153 
	`APP_ERROR_CHECK
(
»t_code
);

156 
	`NVIC_EÇbËIRQ
(
SD_EVT_IRQn
);

158 
	}
}

161 
	$soádeviû_evt_œq_di§bË
()

163 #ifdeà
SOFTDEVICE_PRESENT


164 
»t_code_t
 
»t_code
 = 
	`sd_nvic_Di§bËIRQ
((
IRQn_Ty³
)
SD_EVT_IRQn
);

165 
	`APP_ERROR_CHECK
(
»t_code
);

168 
	`NVIC_Di§bËIRQ
(
SD_EVT_IRQn
);

170 
	}
}

173 #iâdeà
S140


174 
	$swi_š‹¼u±_´iÜ™y_wÜk¬ound
()

181 #ifdeà
SOFTDEVICE_PRESENT


182 
»t_code_t
 
»t_code
;

183 
»t_code
 = 
	`sd_nvic_S‘PriÜ™y
(
SD_EVT_IRQn
, 
APP_IRQ_PRIORITY_LOWEST
);

184 
	`APP_ERROR_CHECK
(
»t_code
);

185 
»t_code
 = 
	`sd_nvic_S‘PriÜ™y
(
RADIO_NOTIFICATION_IRQn
, 
APP_IRQ_PRIORITY_LOWEST
);

186 
	`APP_ERROR_CHECK
(
»t_code
);

189 
	`NVIC_S‘PriÜ™y
(
SD_EVT_IRQn
, 
APP_IRQ_PRIORITY_LOWEST
);

190 
	`NVIC_S‘PriÜ™y
(
RADIO_NOTIFICATION_IRQn
, 
APP_IRQ_PRIORITY_LOWEST
);

192 
	}
}

196 
»t_code_t
 
	$Äf_sdh_’abË_»que¡
()

198 
»t_code_t
 
»t_code
;

200 ià(
m_Äf_sdh_’abËd
)

202  
NRF_ERROR_INVALID_STATE
;

205 
m_Äf_sdh_cÚtšue
 = 
Œue
;

208 ià(
	`sdh_»que¡_ob£rv”_nÙify
(
NRF_SDH_EVT_ENABLE_REQUEST
è=ğ
NRF_ERROR_BUSY
)

211  
NRF_SUCCESS
;

215 
	`sdh_¡©e_ob£rv”_nÙify
(
NRF_SDH_EVT_STATE_ENABLE_PREPARE
);

217 
Äf_şock_lf_cfg_t
 cÚ¡ 
şock_lf_cfg
 =

219 .
sourû
 = 
NRF_SDH_CLOCK_LF_SRC
,

220 .
rc_ùiv
 = 
NRF_SDH_CLOCK_LF_RC_CTIV
,

221 .
rc_‹mp_ùiv
 = 
NRF_SDH_CLOCK_LF_RC_TEMP_CTIV
,

222 #ifdeà
S140


223 .
xl_accu¿cy
 = 
NRF_SDH_CLOCK_LF_XTAL_ACCURACY


225 .
accu¿cy
 = 
NRF_SDH_CLOCK_LF_XTAL_ACCURACY


229 #ifdeà
ANT_LICENSE_KEY


230 
»t_code
 = 
	`sd_soádeviû_’abË
(&
şock_lf_cfg
, 
­p_”rÜ_çuÉ_hªdËr
, 
ANT_LICENSE_KEY
);

232 
»t_code
 = 
	`sd_soádeviû_’abË
(&
şock_lf_cfg
, 
­p_”rÜ_çuÉ_hªdËr
);

235 ià(
»t_code
 !ğ
NRF_SUCCESS
)

237  
»t_code
;

240 
m_Äf_sdh_’abËd
 = 
Œue
;

241 
m_Äf_sdh_cÚtšue
 = 
çl£
;

242 
m_Äf_sdh_su¥’ded
 = 
çl£
;

244 #iâdeà
S140


247 
	`swi_š‹¼u±_´iÜ™y_wÜk¬ound
();

252 
	`soádeviûs_evt_œq_’abË
();

255 
	`sdh_¡©e_ob£rv”_nÙify
(
NRF_SDH_EVT_STATE_ENABLED
);

257  
NRF_SUCCESS
;

258 
	}
}

261 
»t_code_t
 
	$Äf_sdh_di§bË_»que¡
()

263 
»t_code_t
 
»t_code
;

265 ià(!
m_Äf_sdh_’abËd
)

267  
NRF_ERROR_INVALID_STATE
;

270 
m_Äf_sdh_cÚtšue
 = 
Œue
;

273 ià(
	`sdh_»que¡_ob£rv”_nÙify
(
NRF_SDH_EVT_DISABLE_REQUEST
è=ğ
NRF_ERROR_BUSY
)

276  
NRF_SUCCESS
;

280 
	`sdh_¡©e_ob£rv”_nÙify
(
NRF_SDH_EVT_STATE_DISABLE_PREPARE
);

282 
»t_code
 = 
	`sd_soádeviû_di§bË
();

283 ià(
»t_code
 !ğ
NRF_SUCCESS
)

285  
»t_code
;

288 
m_Äf_sdh_’abËd
 = 
çl£
;

289 
m_Äf_sdh_cÚtšue
 = 
çl£
;

291 
	`soádeviû_evt_œq_di§bË
();

294 
	`sdh_¡©e_ob£rv”_nÙify
(
NRF_SDH_EVT_STATE_DISABLED
);

296  
NRF_SUCCESS
;

297 
	}
}

300 
»t_code_t
 
	$Äf_sdh_»que¡_cÚtšue
()

302 ià(!
m_Äf_sdh_cÚtšue
)

304  
NRF_ERROR_INVALID_STATE
;

307 ià(
m_Äf_sdh_’abËd
)

309  
	`Äf_sdh_di§bË_»que¡
();

313  
	`Äf_sdh_’abË_»que¡
();

315 
	}
}

318 
boŞ
 
	$Äf_sdh_is_’abËd
()

320  
m_Äf_sdh_’abËd
;

321 
	}
}

324 
	$Äf_sdh_su¥’d
()

326 ià(!
m_Äf_sdh_’abËd
)

331 
	`soádeviû_evt_œq_di§bË
();

332 
m_Äf_sdh_su¥’ded
 = 
Œue
;

333 
	}
}

336 
	$Äf_sdh_»sume
()

338 ià((!
m_Äf_sdh_su¥’ded
è|| (!
m_Äf_sdh_’abËd
))

344 #ifdeà
SOFTDEVICE_PRESENT


345 
»t_code_t
 
»t_code
 = 
	`sd_nvic_S‘P’dšgIRQ
((
IRQn_Ty³
)
SD_EVT_IRQn
);

346 
	`APP_ERROR_CHECK
(
»t_code
);

348 
	`NVIC_S‘P’dšgIRQ
((
IRQn_Ty³
)
SD_EVT_IRQn
);

351 
	`soádeviûs_evt_œq_’abË
();

353 
m_Äf_sdh_su¥’ded
 = 
çl£
;

354 
	}
}

357 
boŞ
 
	$Äf_sdh_is_su¥’ded
()

359  (!
m_Äf_sdh_’abËd
è|| (
m_Äf_sdh_su¥’ded
);

360 
	}
}

363 
	$Äf_sdh_evts_pŞl
()

365 
Äf_£ùiÚ_™”_t
 
™”
;

368 
	`Äf_£ùiÚ_™”_š™
(&
™”
, &
sdh_¡ack_ob£rv”s
);

369 
	`Äf_£ùiÚ_™”_g‘
(&
™”
è!ğ
NULL
;

370 
	`Äf_£ùiÚ_™”_Ãxt
(&
™”
))

372 
Äf_sdh_¡ack_ob£rv”_t
 * 
p_ob£rv”
;

373 
Äf_sdh_¡ack_evt_hªdËr_t
 
hªdËr
;

375 
p_ob£rv”
 = (
Äf_sdh_¡ack_ob£rv”_t
 *è
	`Äf_£ùiÚ_™”_g‘
(&
™”
);

376 
hªdËr
 = 
p_ob£rv”
->handler;

378 
	`hªdËr
(
p_ob£rv”
->
p_cÚ‹xt
);

380 
	}
}

383 #ià(
NRF_SDH_DISPATCH_MODEL
 =ğ
NRF_SDH_DISPATCH_MODEL_INTERRUPT
)

385 
	$SD_EVT_IRQHªdËr
()

387 
	`Äf_sdh_evts_pŞl
();

388 
	}
}

390 #–ià(
NRF_SDH_DISPATCH_MODEL
 =ğ
NRF_SDH_DISPATCH_MODEL_APPSH
)

399 
	$­psh_ev’ts_pŞl
(* 
p_ev’t_d©a
, 
ušt16_t
 
ev’t_size
)

401 
	`UNUSED_PARAMETER
(
p_ev’t_d©a
);

402 
	`UNUSED_PARAMETER
(
ev’t_size
);

404 
	`Äf_sdh_evts_pŞl
();

405 
	}
}

408 
	$SD_EVT_IRQHªdËr
()

410 
»t_code_t
 
»t_code
 = 
	`­p_sched_ev’t_put
(
NULL
, 0, 
­psh_ev’ts_pŞl
);

411 
	`APP_ERROR_CHECK
(
»t_code
);

412 
	}
}

414 #–ià(
NRF_SDH_DISPATCH_MODEL
 =ğ
NRF_SDH_DISPATCH_MODEL_POLLING
)

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\softdevice\common\nrf_sdh_ble.c

41 
	~"sdk_commÚ.h
"

42 #ià
NRF_MODULE_ENABLED
(
NRF_SDH_BLE
)

44 
	~"Äf_sdh_bË.h
"

46 
	~"Äf_sdh.h
"

47 
	~"­p_”rÜ.h
"

48 
	~"Äf_¡»¼Ü.h
"

51 
	#NRF_LOG_MODULE_NAME
 
Äf_sdh_bË


	)

52 #ià
NRF_SDH_BLE_LOG_ENABLED


53 
	#NRF_LOG_LEVEL
 
NRF_SDH_BLE_LOG_LEVEL


	)

54 
	#NRF_LOG_INFO_COLOR
 
NRF_SDH_BLE_INFO_COLOR


	)

55 
	#NRF_LOG_DEBUG_COLOR
 
NRF_SDH_BLE_DEBUG_COLOR


	)

57 
	#NRF_LOG_LEVEL
 0

	)

59 
	~"Äf_log.h
"

60 
NRF_LOG_MODULE_REGISTER
();

64 
NRF_SECTION_SET_DEF
(
sdh_bË_ob£rv”s
, 
Äf_sdh_bË_evt_ob£rv”_t
, 
NRF_SDH_BLE_OBSERVER_PRIO_LEVELS
);

68 #ià
defšed
(
__CC_ARM
)

69 
ušt32_t
 
Image$$RW_IRAM1$$Ba£
;

70 
ušt32_t
 cÚ¡ * cÚ¡ 
	gm_¿m_¡¬t
 = &
Image$$RW_IRAM1$$Ba£
;

71 #–ià
defšed
(
__ICCARM__
)

72 
ušt32_t
 
__ICFEDIT_»giÚ_RAM_¡¬t__
;

73 
ušt32_t
 cÚ¡ * cÚ¡ 
	gm_¿m_¡¬t
 = &
__ICFEDIT_»giÚ_RAM_¡¬t__
;

74 #–ià
defšed
(
__SES_ARM
)

75 
ušt32_t
 
__­p_¿m_¡¬t__
;

76 
ušt32_t
 cÚ¡ * cÚ¡ 
	gm_¿m_¡¬t
 = &
__­p_¿m_¡¬t__
;

77 #–ià
defšed
(
__GNUC__
)

78 
ušt32_t
 
__d©a_¡¬t__
;

79 
ušt32_t
 cÚ¡ * cÚ¡ 
	gm_¿m_¡¬t
 = &
__d©a_¡¬t__
;

83 
	#RAM_START
 0x20000000

	)

84 
	#APP_RAM_START
 (
ušt32_t
)
m_¿m_¡¬t


	)

87 
»t_code_t
 
	$Äf_sdh_bË_­p_¿m_¡¬t_g‘
(
ušt32_t
 * 
p_­p_¿m_¡¬t
)

89 ià(
p_­p_¿m_¡¬t
 =ğ
NULL
)

91  
NRF_ERROR_NULL
;

94 *
p_­p_¿m_¡¬t
 = 
APP_RAM_START
;

96  
NRF_SUCCESS
;

97 
	}
}

100 
»t_code_t
 
	$Äf_sdh_bË_deçuÉ_cfg_£t
(
ušt8_t
 
cÚn_cfg_g
, 
ušt32_t
 * 
p_¿m_¡¬t
)

102 
ušt32_t
 
»t_code
;

104 
»t_code
 = 
	`Äf_sdh_bË_­p_¿m_¡¬t_g‘
(
p_¿m_¡¬t
);

105 ià(
»t_code
 !ğ
NRF_SUCCESS
)

107  
»t_code
;

110 #ifdeà
S112


111 
	`STATIC_ASSERT
(
NRF_SDH_BLE_CENTRAL_LINK_COUNT
 == 0, "When using s112, NRF_SDH_BLE_CENTRAL_LINK_COUNT must be 0.");

118 
bË_cfg_t
 
bË_cfg
;

120 #ià(
NRF_SDH_BLE_TOTAL_LINK_COUNT
 != 0)

122 
	`mem£t
(&
bË_cfg
, 0, (ble_cfg));

123 
bË_cfg
.
cÚn_cfg
.
cÚn_cfg_g
 = conn_cfg_tag;

124 
bË_cfg
.
cÚn_cfg
.
·¿ms
.
g­_cÚn_cfg
.
cÚn_couÁ
 = 
NRF_SDH_BLE_TOTAL_LINK_COUNT
;

125 
bË_cfg
.
cÚn_cfg
.
·¿ms
.
g­_cÚn_cfg
.
ev’t_Ëngth
 = 
NRF_SDH_BLE_GAP_EVENT_LENGTH
;

127 
»t_code
 = 
	`sd_bË_cfg_£t
(
BLE_CONN_CFG_GAP
, &
bË_cfg
, *
p_¿m_¡¬t
);

128 ià(
»t_code
 !ğ
NRF_SUCCESS
)

130 
	`NRF_LOG_ERROR
("sd_ble_cfg_set()„eturned %s when‡ttemptingo set BLE_CONN_CFG_GAP.",

131 
	`Äf_¡»¼Ü_g‘
(
»t_code
));

135 
	`mem£t
(&
bË_cfg
, 0, (ble_cfg));

136 
bË_cfg
.
g­_cfg
.
rŞe_couÁ_cfg
.
³rh_rŞe_couÁ
 = 
NRF_SDH_BLE_PERIPHERAL_LINK_COUNT
;

137 #iâdeà
S112


138 
bË_cfg
.
g­_cfg
.
rŞe_couÁ_cfg
.
ûÁ¿l_rŞe_couÁ
 = 
NRF_SDH_BLE_CENTRAL_LINK_COUNT
;

139 
bË_cfg
.
g­_cfg
.
rŞe_couÁ_cfg
.
ûÁ¿l_£c_couÁ
 = 
NRF_SDH_BLE_CENTRAL_LINK_COUNT
 ?

140 
BLE_GAP_ROLE_COUNT_CENTRAL_SEC_DEFAULT
 : 0;

143 
»t_code
 = 
	`sd_bË_cfg_£t
(
BLE_GAP_CFG_ROLE_COUNT
, &
bË_cfg
, *
p_¿m_¡¬t
);

144 ià(
»t_code
 !ğ
NRF_SUCCESS
)

146 
	`NRF_LOG_ERROR
("sd_ble_cfg_set()„eturned %s when‡ttemptingo set BLE_GAP_CFG_ROLE_COUNT.",

147 
	`Äf_¡»¼Ü_g‘
(
»t_code
));

151 #ià(
NRF_SDH_BLE_GATT_MAX_MTU_SIZE
 != 23)

152 
	`mem£t
(&
bË_cfg
, 0x00, (ble_cfg));

153 
bË_cfg
.
cÚn_cfg
.
cÚn_cfg_g
 = conn_cfg_tag;

154 
bË_cfg
.
cÚn_cfg
.
·¿ms
.
g©t_cÚn_cfg
.
©t_mtu
 = 
NRF_SDH_BLE_GATT_MAX_MTU_SIZE
;

156 
»t_code
 = 
	`sd_bË_cfg_£t
(
BLE_CONN_CFG_GATT
, &
bË_cfg
, *
p_¿m_¡¬t
);

157 ià(
»t_code
 !ğ
NRF_SUCCESS
)

159 
	`NRF_LOG_ERROR
("sd_ble_cfg_set()„eturned %s when‡ttemptingo set BLE_CONN_CFG_GATT.",

160 
	`Äf_¡»¼Ü_g‘
(
»t_code
));

166 
	`mem£t
(&
bË_cfg
, 0, (ble_cfg));

167 
bË_cfg
.
commÚ_cfg
.
vs_uuid_cfg
.
vs_uuid_couÁ
 = 
NRF_SDH_BLE_VS_UUID_COUNT
;

169 
»t_code
 = 
	`sd_bË_cfg_£t
(
BLE_COMMON_CFG_VS_UUID
, &
bË_cfg
, *
p_¿m_¡¬t
);

170 ià(
»t_code
 !ğ
NRF_SUCCESS
)

172 
	`NRF_LOG_ERROR
("sd_ble_cfg_set()„eturned %s when‡ttemptingo set BLE_COMMON_CFG_VS_UUID.",

173 
	`Äf_¡»¼Ü_g‘
(
»t_code
));

177 
	`mem£t
(&
bË_cfg
, 0x00, (ble_cfg));

178 
bË_cfg
.
g©ts_cfg
.
©Œ_b_size
.©Œ_b_sizğ
NRF_SDH_BLE_GATTS_ATTR_TAB_SIZE
;

180 
»t_code
 = 
	`sd_bË_cfg_£t
(
BLE_GATTS_CFG_ATTR_TAB_SIZE
, &
bË_cfg
, *
p_¿m_¡¬t
);

181 ià(
»t_code
 !ğ
NRF_SUCCESS
)

183 
	`NRF_LOG_ERROR
("sd_ble_cfg_set()„eturned %s when‡ttemptingo set BLE_GATTS_CFG_ATTR_TAB_SIZE.",

184 
	`Äf_¡»¼Ü_g‘
(
»t_code
));

188 
	`mem£t
(&
bË_cfg
, 0x00, (ble_cfg));

189 
bË_cfg
.
g©ts_cfg
.
£rviû_chªged
.£rviû_chªged = 
NRF_SDH_BLE_SERVICE_CHANGED
;

191 
»t_code
 = 
	`sd_bË_cfg_£t
(
BLE_GATTS_CFG_SERVICE_CHANGED
, &
bË_cfg
, *
p_¿m_¡¬t
);

192 ià(
»t_code
 !ğ
NRF_SUCCESS
)

194 
	`NRF_LOG_ERROR
("sd_ble_cfg_set()„eturned %s when‡ttemptingo set BLE_GATTS_CFG_SERVICE_CHANGED.",

195 
	`Äf_¡»¼Ü_g‘
(
»t_code
));

198  
NRF_SUCCESS
;

199 
	}
}

203 
ušt32_t
 
	$¿m_’d_add»ss_g‘
()

205 
ušt32_t
 
¿m_tÙ®_size
;

207 #ifdeà
NRF51


208 
ušt32_t
 
block_size
 = 
NRF_FICR
->
SIZERAMBLOCKS
;

209 
¿m_tÙ®_size
 = 
block_size
 * 
NRF_FICR
->
NUMRAMBLOCK
;

211 
¿m_tÙ®_size
 = 
NRF_FICR
->
INFO
.
RAM
 * 1024;

214  
RAM_START
 + 
¿m_tÙ®_size
;

215 
	}
}

218 
»t_code_t
 
	$Äf_sdh_bË_’abË
(
ušt32_t
 * cÚ¡ 
p_­p_¿m_¡¬t
)

221 
ušt32_t
 cÚ¡ 
­p_¿m_¡¬t_lšk
 = *
p_­p_¿m_¡¬t
;

223 
	`NRF_LOG_DEBUG
("RAM s¹ © 0x%x", 
­p_¿m_¡¬t_lšk
);

225 
»t_code_t
 
»t_code
 = 
	`sd_bË_’abË
(
p_­p_¿m_¡¬t
);

226 ià(*
p_­p_¿m_¡¬t
 !ğ
­p_¿m_¡¬t_lšk
)

228 
	`NRF_LOG_WARNING
("RAM starts‡t 0x%x, can be‡djustedo 0x%x.",

229 
­p_¿m_¡¬t_lšk
, *
p_­p_¿m_¡¬t
);

231 
	`NRF_LOG_WARNING
("RAM size can be‡djustedo 0x%x.",

232 
	`¿m_’d_add»ss_g‘
(è- (*
p_­p_¿m_¡¬t
));

235 ià(
»t_code
 !ğ
NRF_SUCCESS
)

237 
	`NRF_LOG_ERROR
("sd_bË_’abË(è»tuºed %s.", 
	`Äf_¡»¼Ü_g‘
(
»t_code
));

240  
»t_code
;

241 
	}
}

248 
	$Äf_sdh_bË_evts_pŞl
(* 
p_cÚ‹xt
)

250 
»t_code_t
 
»t_code
;

252 
	`UNUSED_VARIABLE
(
p_cÚ‹xt
);

254 
Œue
)

256 
	`__ALIGN
(4è
ušt8_t
 
evt_bufãr
[
NRF_SDH_BLE_EVT_BUF_SIZE
];

258 
bË_evt_t
 * 
p_bË_evt
;

259 
ušt16_t
 
evt_Ën
 = (ušt16_t)(
evt_bufãr
);

261 
»t_code
 = 
	`sd_bË_evt_g‘
(
evt_bufãr
, &
evt_Ën
);

262 ià(
»t_code
 !ğ
NRF_SUCCESS
)

267 
p_bË_evt
 = (
bË_evt_t
 *)
evt_bufãr
;

269 
	`NRF_LOG_DEBUG
("BLEƒv’t: 0x%x.", 
p_bË_evt
->
h—d”
.
evt_id
);

272 
Äf_£ùiÚ_™”_t
 
™”
;

273 
	`Äf_£ùiÚ_™”_š™
(&
™”
, &
sdh_bË_ob£rv”s
);

274 
	`Äf_£ùiÚ_™”_g‘
(&
™”
è!ğ
NULL
;

275 
	`Äf_£ùiÚ_™”_Ãxt
(&
™”
))

277 
Äf_sdh_bË_evt_ob£rv”_t
 * 
p_ob£rv”
;

278 
Äf_sdh_bË_evt_hªdËr_t
 
hªdËr
;

280 
p_ob£rv”
 = (
Äf_sdh_bË_evt_ob£rv”_t
 *)
	`Äf_£ùiÚ_™”_g‘
(&
™”
);

281 
hªdËr
 = 
p_ob£rv”
->handler;

283 
	`hªdËr
(
p_bË_evt
, 
p_ob£rv”
->
p_cÚ‹xt
);

287 ià(
»t_code
 !ğ
NRF_ERROR_NOT_FOUND
)

289 
	`APP_ERROR_HANDLER
(
»t_code
);

291 
	}
}

294 
NRF_SDH_STACK_OBSERVER
(
m_Äf_sdh_bË_evts_pŞl
, 
NRF_SDH_BLE_STACK_OBSERVER_PRIO
) =

296 .
hªdËr
 = 
Äf_sdh_bË_evts_pŞl
,

297 .
	gp_cÚ‹xt
 = 
NULL
,

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\softdevice\common\nrf_sdh_soc.c

41 
	~"sdk_commÚ.h
"

42 #ià
NRF_MODULE_ENABLED
(
NRF_SDH_SOC
)

44 
	~"Äf_sdh_soc.h
"

46 
	~"Äf_sdh.h
"

47 
	~"Äf_soc.h
"

48 
	~"­p_”rÜ.h
"

51 
	#NRF_LOG_MODULE_NAME
 
Äf_sdh_soc


	)

52 #ià
NRF_SDH_SOC_LOG_ENABLED


53 
	#NRF_LOG_LEVEL
 
NRF_SDH_SOC_LOG_LEVEL


	)

54 
	#NRF_LOG_INFO_COLOR
 
NRF_SDH_SOC_INFO_COLOR


	)

55 
	#NRF_LOG_DEBUG_COLOR
 
NRF_SDH_SOC_DEBUG_COLOR


	)

57 
	#NRF_LOG_LEVEL
 0

	)

59 
	~"Äf_log.h
"

60 
NRF_LOG_MODULE_REGISTER
();

64 
NRF_SECTION_SET_DEF
(
sdh_soc_ob£rv”s
, 
Äf_sdh_soc_evt_ob£rv”_t
, 
NRF_SDH_SOC_OBSERVER_PRIO_LEVELS
);

71 
	$Äf_sdh_soc_evts_pŞl
(* 
p_cÚ‹xt
)

73 
»t_code_t
 
»t_code
;

75 
	`UNUSED_VARIABLE
(
p_cÚ‹xt
);

77 
Œue
)

79 
ušt32_t
 
evt_id
;

81 
»t_code
 = 
	`sd_evt_g‘
(&
evt_id
);

82 ià(
»t_code
 !ğ
NRF_SUCCESS
)

87 
	`NRF_LOG_DEBUG
("SoCƒv’t: 0x%x.", 
evt_id
);

90 
Äf_£ùiÚ_™”_t
 
™”
;

91 
	`Äf_£ùiÚ_™”_š™
(&
™”
, &
sdh_soc_ob£rv”s
);

92 
	`Äf_£ùiÚ_™”_g‘
(&
™”
è!ğ
NULL
;

93 
	`Äf_£ùiÚ_™”_Ãxt
(&
™”
))

95 
Äf_sdh_soc_evt_ob£rv”_t
 * 
p_ob£rv”
;

96 
Äf_sdh_soc_evt_hªdËr_t
 
hªdËr
;

98 
p_ob£rv”
 = (
Äf_sdh_soc_evt_ob£rv”_t
 *è
	`Äf_£ùiÚ_™”_g‘
(&
™”
);

99 
hªdËr
 = 
p_ob£rv”
->handler;

101 
	`hªdËr
(
evt_id
, 
p_ob£rv”
->
p_cÚ‹xt
);

105 ià(
»t_code
 !ğ
NRF_ERROR_NOT_FOUND
)

107 
	`APP_ERROR_HANDLER
(
»t_code
);

109 
	}
}

112 
NRF_SDH_STACK_OBSERVER
(
m_Äf_sdh_soc_evts_pŞl
, 
NRF_SDH_SOC_STACK_OBSERVER_PRIO
) =

114 .
hªdËr
 = 
Äf_sdh_soc_evts_pŞl
,

115 .
	gp_cÚ‹xt
 = 
NULL
,

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\toolchain\gcc\gcc_startup_nrf52840.S

23 .
syÁax
 
	gunif›d


24 .
¬ch
 
	g¬mv7e
-
	gm


26 #ifdeà
__STARTUP_CONFIG


27 
	~"¡¬tup_cÚfig.h
"

28 #iâdeà
__STARTUP_CONFIG_STACK_ALIGNEMENT


29 
	#__STARTUP_CONFIG_STACK_ALIGNEMENT
 3

	)

33 .
	g£ùiÚ
 .
	g¡ack


34 #ià
defšed
(
__STARTUP_CONFIG
)

35 .
®ign
 
	g__STARTUP_CONFIG_STACK_ALIGNEMENT


36 .
equ
 
	gSck_Size
, 
	g__STARTUP_CONFIG_STACK_SIZE


37 #–ià
defšed
(
__STACK_SIZE
)

38 .
	g®ign
 3

39 .
equ
 
	gSck_Size
, 
	g__STACK_SIZE


41 .
	g®ign
 3

42 .
equ
 
	gSck_Size
, 8192

44 .
globl
 
	g__SckTİ


45 .
globl
 
__SckLim™


46 
	g__SckLim™
:

47 .
¥aû
 
Sck_Size


48 .
size
 
__SckLim™
, . - __StackLimit

49 
	g__SckTİ
:

50 .
size
 
__SckTİ
, . - 
	g__SckTİ


52 .
	g£ùiÚ
 .
	gh—p


53 .
	g®ign
 3

54 #ià
defšed
(
__STARTUP_CONFIG
)

55 .
equ
 
	gH—p_Size
, 
	g__STARTUP_CONFIG_HEAP_SIZE


56 #–ià
defšed
(
__HEAP_SIZE
)

57 .
equ
 
	gH—p_Size
, 
	g__HEAP_SIZE


59 .
equ
 
	gH—p_Size
, 8192

61 .
globl
 
	g__H—pBa£


62 .
globl
 
__H—pLim™


63 
	g__H—pBa£
:

64 .
H—p_Size


65 .
¥aû
 
H—p_Size


66 .
’dif


67 .
size
 
__H—pBa£
, . - __HeapBase

68 
	g__H—pLim™
:

69 .
size
 
__H—pLim™
, . - 
	g__H—pLim™


71 .
	g£ùiÚ
 .
	gi¤_veùÜ


72 .
	g®ign
 2

73 .
globl
 
__i¤_veùÜ


74 
	g__i¤_veùÜ
:

75 .
__SckTİ


76 .
Re£t_HªdËr


77 .
NMI_HªdËr


78 .
H¬dFauÉ_HªdËr


79 .
MemÜyMªagem’t_HªdËr


80 .
BusFauÉ_HªdËr


81 .
U§geFauÉ_HªdËr


86 .
SVC_HªdËr


87 .
DebugMÚ_HªdËr


89 .
P’dSV_HªdËr


90 .
SysTick_HªdËr


93 .
POWER_CLOCK_IRQHªdËr


94 .
RADIO_IRQHªdËr


95 .
UARTE0_UART0_IRQHªdËr


96 .
SPIM0_SPIS0_TWIM0_TWIS0_SPI0_TWI0_IRQHªdËr


97 .
SPIM1_SPIS1_TWIM1_TWIS1_SPI1_TWI1_IRQHªdËr


98 .
NFCT_IRQHªdËr


99 .
GPIOTE_IRQHªdËr


100 .
SAADC_IRQHªdËr


101 .
TIMER0_IRQHªdËr


102 .
TIMER1_IRQHªdËr


103 .
TIMER2_IRQHªdËr


104 .
RTC0_IRQHªdËr


105 .
TEMP_IRQHªdËr


106 .
RNG_IRQHªdËr


107 .
ECB_IRQHªdËr


108 .
CCM_AAR_IRQHªdËr


109 .
WDT_IRQHªdËr


110 .
RTC1_IRQHªdËr


111 .
QDEC_IRQHªdËr


112 .
COMP_LPCOMP_IRQHªdËr


113 .
SWI0_EGU0_IRQHªdËr


114 .
SWI1_EGU1_IRQHªdËr


115 .
SWI2_EGU2_IRQHªdËr


116 .
SWI3_EGU3_IRQHªdËr


117 .
SWI4_EGU4_IRQHªdËr


118 .
SWI5_EGU5_IRQHªdËr


119 .
TIMER3_IRQHªdËr


120 .
TIMER4_IRQHªdËr


121 .
PWM0_IRQHªdËr


122 .
PDM_IRQHªdËr


125 .
MWU_IRQHªdËr


126 .
PWM1_IRQHªdËr


127 .
PWM2_IRQHªdËr


128 .
SPIM2_SPIS2_SPI2_IRQHªdËr


129 .
RTC2_IRQHªdËr


130 .
I2S_IRQHªdËr


131 .
FPU_IRQHªdËr


132 .
USBD_IRQHªdËr


133 .
UARTE1_IRQHªdËr


134 .
QSPI_IRQHªdËr


135 .
CRYPTOCELL_IRQHªdËr


138 .
PWM3_IRQHªdËr


140 .
SPIM3_IRQHªdËr


206 .
size
 
__i¤_veùÜ
, . - 
	g__i¤_veùÜ


211 .
	g‹xt


212 .
	gthumb


213 .
	gthumb_func


214 .
	g®ign
 1

215 .
globl
 
	gRe£t_HªdËr


216 .
ty³
 
	gRe£t_HªdËr
, %
funùiÚ


217 
	gRe£t_HªdËr
:

229 
ldr
 
r1
, =
__‘ext


230 
ldr
 
r2
, =
__d©a_¡¬t__


231 
ldr
 
r3
, =
__bss_¡¬t__


233 
subs
 
r3
, 
r2


234 
	gbË
 .
	gL_loİ1_dÚe


236 .
	gL_loİ1
:

237 
subs
 
r3
, #4

238 
ldr
 
	gr0
, [
r1
,
r3
]

239 
¡r
 
	gr0
, [
r2
,
r3
]

240 
	gbgt
 .
	gL_loİ1


242 .
	gL_loİ1_dÚe
:

254 #ifdeà
__STARTUP_CLEAR_BSS


255 
ldr
 
r1
, =
__bss_¡¬t__


256 
ldr
 
r2
, =
__bss_’d__


258 
movs
 
r0
, 0

260 
subs
 
	gr2
, 
r1


261 
	gbË
 .
	gL_loİ3_dÚe


263 .
	gL_loİ3
:

264 
subs
 
r2
, #4

265 
¡r
 
	gr0
, [
r1
, 
r2
]

266 
	gbgt
 .
	gL_loİ3


268 .
	gL_loİ3_dÚe
:

272 
bl
 
Sy¡emIn™


277 #iâdeà
__START


278 
	#__START
 
_¡¬t


	)

280 
bl
 
__START


282 .
poŞ


283 .
size
 
Re£t_HªdËr
,.-
	gRe£t_HªdËr


285 .
	g£ùiÚ
 ".text"

290 .
w—k
 
	gNMI_HªdËr


291 .
ty³
 
	gNMI_HªdËr
, %
funùiÚ


292 
	gNMI_HªdËr
:

293 
b
 .

294 .
size
 
NMI_HªdËr
, . - 
	gNMI_HªdËr


297 .
w—k
 
	gH¬dFauÉ_HªdËr


298 .
ty³
 
	gH¬dFauÉ_HªdËr
, %
funùiÚ


299 
	gH¬dFauÉ_HªdËr
:

300 
b
 .

301 .
size
 
H¬dFauÉ_HªdËr
, . - 
	gH¬dFauÉ_HªdËr


304 .
w—k
 
	gMemÜyMªagem’t_HªdËr


305 .
ty³
 
	gMemÜyMªagem’t_HªdËr
, %
funùiÚ


306 
	gMemÜyMªagem’t_HªdËr
:

307 
b
 .

308 .
size
 
MemÜyMªagem’t_HªdËr
, . - 
	gMemÜyMªagem’t_HªdËr


311 .
w—k
 
	gBusFauÉ_HªdËr


312 .
ty³
 
	gBusFauÉ_HªdËr
, %
funùiÚ


313 
	gBusFauÉ_HªdËr
:

314 
b
 .

315 .
size
 
BusFauÉ_HªdËr
, . - 
	gBusFauÉ_HªdËr


318 .
w—k
 
	gU§geFauÉ_HªdËr


319 .
ty³
 
	gU§geFauÉ_HªdËr
, %
funùiÚ


320 
	gU§geFauÉ_HªdËr
:

321 
b
 .

322 .
size
 
U§geFauÉ_HªdËr
, . - 
	gU§geFauÉ_HªdËr


325 .
w—k
 
	gSVC_HªdËr


326 .
ty³
 
	gSVC_HªdËr
, %
funùiÚ


327 
	gSVC_HªdËr
:

328 
b
 .

329 .
size
 
SVC_HªdËr
, . - 
	gSVC_HªdËr


332 .
w—k
 
	gDebugMÚ_HªdËr


333 .
ty³
 
	gDebugMÚ_HªdËr
, %
funùiÚ


334 
	gDebugMÚ_HªdËr
:

335 
b
 .

336 .
size
 
DebugMÚ_HªdËr
, . - 
	gDebugMÚ_HªdËr


339 .
w—k
 
	gP’dSV_HªdËr


340 .
ty³
 
	gP’dSV_HªdËr
, %
funùiÚ


341 
	gP’dSV_HªdËr
:

342 
b
 .

343 .
size
 
P’dSV_HªdËr
, . - 
	gP’dSV_HªdËr


346 .
w—k
 
	gSysTick_HªdËr


347 .
ty³
 
	gSysTick_HªdËr
, %
funùiÚ


348 
	gSysTick_HªdËr
:

349 
b
 .

350 .
size
 
SysTick_HªdËr
, . - 
	gSysTick_HªdËr


355 .
globl
 
	gDeçuÉ_HªdËr


356 .
ty³
 
	gDeçuÉ_HªdËr
, %
funùiÚ


357 
	gDeçuÉ_HªdËr
:

358 
b
 .

359 .
size
 
DeçuÉ_HªdËr
, . - 
	gDeçuÉ_HªdËr


361 .
maüo
 
IRQ
 
	ghªdËr


362 .
	gw—k
 \
	ghªdËr


363 .
	g£t
 \
	ghªdËr
, 
	gDeçuÉ_HªdËr


364 .
’dm


366 
IRQ
 
POWER_CLOCK_IRQHªdËr


367 
IRQ
 
RADIO_IRQHªdËr


368 
IRQ
 
UARTE0_UART0_IRQHªdËr


369 
IRQ
 
SPIM0_SPIS0_TWIM0_TWIS0_SPI0_TWI0_IRQHªdËr


370 
IRQ
 
SPIM1_SPIS1_TWIM1_TWIS1_SPI1_TWI1_IRQHªdËr


371 
IRQ
 
NFCT_IRQHªdËr


372 
IRQ
 
GPIOTE_IRQHªdËr


373 
IRQ
 
SAADC_IRQHªdËr


374 
IRQ
 
TIMER0_IRQHªdËr


375 
IRQ
 
TIMER1_IRQHªdËr


376 
IRQ
 
TIMER2_IRQHªdËr


377 
IRQ
 
RTC0_IRQHªdËr


378 
IRQ
 
TEMP_IRQHªdËr


379 
IRQ
 
RNG_IRQHªdËr


380 
IRQ
 
ECB_IRQHªdËr


381 
IRQ
 
CCM_AAR_IRQHªdËr


382 
IRQ
 
WDT_IRQHªdËr


383 
IRQ
 
RTC1_IRQHªdËr


384 
IRQ
 
QDEC_IRQHªdËr


385 
IRQ
 
COMP_LPCOMP_IRQHªdËr


386 
IRQ
 
SWI0_EGU0_IRQHªdËr


387 
IRQ
 
SWI1_EGU1_IRQHªdËr


388 
IRQ
 
SWI2_EGU2_IRQHªdËr


389 
IRQ
 
SWI3_EGU3_IRQHªdËr


390 
IRQ
 
SWI4_EGU4_IRQHªdËr


391 
IRQ
 
SWI5_EGU5_IRQHªdËr


392 
IRQ
 
TIMER3_IRQHªdËr


393 
IRQ
 
TIMER4_IRQHªdËr


394 
IRQ
 
PWM0_IRQHªdËr


395 
IRQ
 
PDM_IRQHªdËr


396 
IRQ
 
MWU_IRQHªdËr


397 
IRQ
 
PWM1_IRQHªdËr


398 
IRQ
 
PWM2_IRQHªdËr


399 
IRQ
 
SPIM2_SPIS2_SPI2_IRQHªdËr


400 
IRQ
 
RTC2_IRQHªdËr


401 
IRQ
 
I2S_IRQHªdËr


402 
IRQ
 
FPU_IRQHªdËr


403 
IRQ
 
USBD_IRQHªdËr


404 
IRQ
 
UARTE1_IRQHªdËr


405 
IRQ
 
QSPI_IRQHªdËr


406 
IRQ
 
CRYPTOCELL_IRQHªdËr


407 
IRQ
 
PWM3_IRQHªdËr


408 
IRQ
 
	gSPIM3_IRQHªdËr


410 .
	g’d


	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\toolchain\gcc\nrf5x_common.ld

18 
OUTPUT_FORMAT
 ("elf32-littlearm", "elf32-bigarm", "elf32-littlearm")

47 
	$ENTRY
(
Re£t_HªdËr
)

49 
SECTIONS


51 .
‹xt
 :

53 
	`KEEP
(*(.
i¤_veùÜ
))

54 *(.
‹xt
*)

56 
	`KEEP
(*(.
š™
))

57 
	`KEEP
(*(.
fši
))

60 *
ütbegš
.
	`o
(.
ùÜs
)

61 *
ütbegš
?.
	`o
(.
ùÜs
)

62 *(
	`EXCLUDE_FILE
(*
ü‹nd
?.
o
 *ü‹nd.oè.
ùÜs
)

63 *(
	`SORT
(.
ùÜs
.*))

64 *(.
ùÜs
)

67 *
ütbegš
.
	`o
(.
dtÜs
)

68 *
ütbegš
?.
	`o
(.
dtÜs
)

69 *(
	`EXCLUDE_FILE
(*
ü‹nd
?.
o
 *ü‹nd.oè.
dtÜs
)

70 *(
	`SORT
(.
dtÜs
.*))

71 *(.
dtÜs
)

73 *(.
rod©a
*)

75 
	`KEEP
(*(.
eh_äame
*))

76 } > 
FLASH


78 .
ARM
.
exb
 :

80 *(.
ARM
.
exb
* .
gnu
.
lškÚû
.
¬mexb
.*)

81 } > 
FLASH


83 
__exidx_¡¬t
 = .;

84 .
ARM
.
exidx
 :

86 *(.
ARM
.
exidx
* .
gnu
.
lškÚû
.
¬mexidx
.*)

87 } > 
FLASH


88 
__exidx_’d
 = .;

90 
__‘ext
 = .;

92 .
d©a
 : 
	`AT
 (
__‘ext
)

94 
__d©a_¡¬t__
 = .;

95 *(
vbË
)

96 *(.
d©a
*)

98 . = 
	`ALIGN
(4);

100 
	`PROVIDE_HIDDEN
 (
__´eš™_¬¿y_¡¬t
 = .);

101 
	`KEEP
(*(.
´eš™_¬¿y
))

102 
	`PROVIDE_HIDDEN
 (
__´eš™_¬¿y_’d
 = .);

104 . = 
	`ALIGN
(4);

106 
	`PROVIDE_HIDDEN
 (
__š™_¬¿y_¡¬t
 = .);

107 
	`KEEP
(*(
	`SORT
(.
š™_¬¿y
.*)))

108 
	`KEEP
(*(.
š™_¬¿y
))

109 
	`PROVIDE_HIDDEN
 (
__š™_¬¿y_’d
 = .);

112 . = 
	`ALIGN
(4);

114 
	`PROVIDE_HIDDEN
 (
__fši_¬¿y_¡¬t
 = .);

115 
	`KEEP
(*(
	`SORT
(.
fši_¬¿y
.*)))

116 
	`KEEP
(*(.
fši_¬¿y
))

117 
	`PROVIDE_HIDDEN
 (
__fši_¬¿y_’d
 = .);

119 
	`KEEP
(*(.
jü
*))

120 . = 
	`ALIGN
(4);

122 
__d©a_’d__
 = .;

124 } > 
RAM


126 .
bss
 :

128 . = 
	`ALIGN
(4);

129 
__bss_¡¬t__
 = .;

130 *(.
bss
*)

131 *(
COMMON
)

132 . = 
	`ALIGN
(4);

133 
__bss_’d__
 = .;

134 } > 
RAM


136 .
	`h—p
 (
COPY
):

138 
__H—pBa£
 = .;

139 
__’d__
 = .;

140 
	`PROVIDE
(
’d
 = .);

141 
	`KEEP
(*(.
h—p
*))

142 
__H—pLim™
 = .;

143 } > 
RAM


148 .
	`¡ack_dummy
 (
COPY
):

150 
	`KEEP
(*(.
¡ack
*))

151 } > 
RAM


155 
__SckTİ
 = 
	`ORIGIN
(
RAM
è+ 
	`LENGTH
(RAM);

156 
__SckLim™
 = 
__SckTİ
 - 
	`SIZEOF
(.
¡ack_dummy
);

157 
	`PROVIDE
(
__¡ack
 = 
__SckTİ
);

160 
	`ASSERT
(
__SckLim™
 >ğ
__H—pLim™
, "region RAM overflowed with stack")

163 
D©aIn™FÏshU£d
 = 
__bss_¡¬t__
 - 
__d©a_¡¬t__
;

164 
CodeFÏshU£d
 = 
__‘ext
 - 
	`ORIGIN
(
FLASH
);

165 
TÙ®FÏshU£d
 = 
CodeFÏshU£d
 + 
D©aIn™FÏshU£d
;

166 
	`ASSERT
(
TÙ®FÏshU£d
 <ğ
	`LENGTH
(
FLASH
), "region FLASH overflowed with .data‡nd user data")

168 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\toolchain\system_nrf52840.c

26 
	~<¡dšt.h
>

27 
	~<¡dboŞ.h
>

28 
	~"Äf.h
"

29 
	~"sy¡em_Äf52840.h
"

33 
	#__SYSTEM_CLOCK_64M
 (64000000UL)

	)

35 
boŞ
 
”¿_36
();

36 
boŞ
 
”¿_66
();

37 
boŞ
 
”¿_98
();

38 
boŞ
 
”¿_103
();

39 
boŞ
 
”¿_115
();

40 
boŞ
 
”¿_120
();

41 
boŞ
 
”¿_136
();

44 #ià
defšed
 ( 
__CC_ARM
 )

45 
ušt32_t
 
Sy¡emCÜeClock
 
__©Œibu‹__
((
u£d
)èğ
__SYSTEM_CLOCK_64M
;

46 #–ià
defšed
 ( 
__ICCARM__
 )

47 
__roÙ
 
ušt32_t
 
	gSy¡emCÜeClock
 = 
__SYSTEM_CLOCK_64M
;

48 #–ià
defšed
 ( 
__GNUC__
 )

49 
ušt32_t
 
Sy¡emCÜeClock
 
__©Œibu‹__
((
u£d
)èğ
__SYSTEM_CLOCK_64M
;

52 
	$Sy¡emCÜeClockUpd©e
()

54 
Sy¡emCÜeClock
 = 
__SYSTEM_CLOCK_64M
;

55 
	}
}

57 
	$Sy¡emIn™
()

61 #ià
	`defšed
 (
ENABLE_SWO
)

62 
CÜeDebug
->
DEMCR
 |ğ
CÜeDebug_DEMCR_TRCENA_Msk
;

63 
NRF_CLOCK
->
TRACECONFIG
 |ğ
CLOCK_TRACECONFIG_TRACEMUX_S”Ÿl
 << 
CLOCK_TRACECONFIG_TRACEMUX_Pos
;

64 
NRF_P1
->
PIN_CNF
[0] = (
GPIO_PIN_CNF_DRIVE_H0H1
 << 
GPIO_PIN_CNF_DRIVE_Pos
è| (
GPIO_PIN_CNF_INPUT_CÚÃù
 << 
GPIO_PIN_CNF_INPUT_Pos
è| (
GPIO_PIN_CNF_DIR_Ouut
 << 
GPIO_PIN_CNF_DIR_Pos
);

69 #ià
	`defšed
 (
ENABLE_TRACE
)

70 
CÜeDebug
->
DEMCR
 |ğ
CÜeDebug_DEMCR_TRCENA_Msk
;

71 
NRF_CLOCK
->
TRACECONFIG
 |ğ
CLOCK_TRACECONFIG_TRACEMUX_P¬®Ël
 << 
CLOCK_TRACECONFIG_TRACEMUX_Pos
;

72 
NRF_P0
->
PIN_CNF
[7] = (
GPIO_PIN_CNF_DRIVE_H0H1
 << 
GPIO_PIN_CNF_DRIVE_Pos
è| (
GPIO_PIN_CNF_INPUT_CÚÃù
 << 
GPIO_PIN_CNF_INPUT_Pos
è| (
GPIO_PIN_CNF_DIR_Ouut
 << 
GPIO_PIN_CNF_DIR_Pos
);

73 
NRF_P1
->
PIN_CNF
[0] = (
GPIO_PIN_CNF_DRIVE_H0H1
 << 
GPIO_PIN_CNF_DRIVE_Pos
è| (
GPIO_PIN_CNF_INPUT_CÚÃù
 << 
GPIO_PIN_CNF_INPUT_Pos
è| (
GPIO_PIN_CNF_DIR_Ouut
 << 
GPIO_PIN_CNF_DIR_Pos
);

74 
NRF_P0
->
PIN_CNF
[12] = (
GPIO_PIN_CNF_DRIVE_H0H1
 << 
GPIO_PIN_CNF_DRIVE_Pos
è| (
GPIO_PIN_CNF_INPUT_CÚÃù
 << 
GPIO_PIN_CNF_INPUT_Pos
è| (
GPIO_PIN_CNF_DIR_Ouut
 << 
GPIO_PIN_CNF_DIR_Pos
);

75 
NRF_P0
->
PIN_CNF
[11] = (
GPIO_PIN_CNF_DRIVE_H0H1
 << 
GPIO_PIN_CNF_DRIVE_Pos
è| (
GPIO_PIN_CNF_INPUT_CÚÃù
 << 
GPIO_PIN_CNF_INPUT_Pos
è| (
GPIO_PIN_CNF_DIR_Ouut
 << 
GPIO_PIN_CNF_DIR_Pos
);

76 
NRF_P1
->
PIN_CNF
[9] = (
GPIO_PIN_CNF_DRIVE_H0H1
 << 
GPIO_PIN_CNF_DRIVE_Pos
è| (
GPIO_PIN_CNF_INPUT_CÚÃù
 << 
GPIO_PIN_CNF_INPUT_Pos
è| (
GPIO_PIN_CNF_DIR_Ouut
 << 
GPIO_PIN_CNF_DIR_Pos
);

81 ià(
	`”¿_36
()){

82 
NRF_CLOCK
->
EVENTS_DONE
 = 0;

83 
NRF_CLOCK
->
EVENTS_CTTO
 = 0;

84 
NRF_CLOCK
->
CTIV
 = 0;

89 ià(
	`”¿_66
()){

90 
NRF_TEMP
->
A0
 = 
NRF_FICR
->
TEMP
.A0;

91 
NRF_TEMP
->
A1
 = 
NRF_FICR
->
TEMP
.A1;

92 
NRF_TEMP
->
A2
 = 
NRF_FICR
->
TEMP
.A2;

93 
NRF_TEMP
->
A3
 = 
NRF_FICR
->
TEMP
.A3;

94 
NRF_TEMP
->
A4
 = 
NRF_FICR
->
TEMP
.A4;

95 
NRF_TEMP
->
A5
 = 
NRF_FICR
->
TEMP
.A5;

96 
NRF_TEMP
->
B0
 = 
NRF_FICR
->
TEMP
.B0;

97 
NRF_TEMP
->
B1
 = 
NRF_FICR
->
TEMP
.B1;

98 
NRF_TEMP
->
B2
 = 
NRF_FICR
->
TEMP
.B2;

99 
NRF_TEMP
->
B3
 = 
NRF_FICR
->
TEMP
.B3;

100 
NRF_TEMP
->
B4
 = 
NRF_FICR
->
TEMP
.B4;

101 
NRF_TEMP
->
B5
 = 
NRF_FICR
->
TEMP
.B5;

102 
NRF_TEMP
->
T0
 = 
NRF_FICR
->
TEMP
.T0;

103 
NRF_TEMP
->
T1
 = 
NRF_FICR
->
TEMP
.T1;

104 
NRF_TEMP
->
T2
 = 
NRF_FICR
->
TEMP
.T2;

105 
NRF_TEMP
->
T3
 = 
NRF_FICR
->
TEMP
.T3;

106 
NRF_TEMP
->
T4
 = 
NRF_FICR
->
TEMP
.T4;

111 ià(
	`”¿_98
()){

112 *(vŞ©
ušt32_t
 *)0x4000568Cul = 0x00038148ul;

117 ià(
	`”¿_103
()){

118 
NRF_CCM
->
MAXPACKETSIZE
 = 0xFBul;

123 ià(
	`”¿_115
()){

124 *(vŞ©
ušt32_t
 *)0x40000EE4 = (*(volatile uint32_t *)0x40000EE4 & 0xFFFFFFF0) | (*(uint32_t *)0x10000258 & 0x0000000F);

129 ià(
	`”¿_120
()){

130 *(vŞ©
ušt32_t
 *)0x40029640ul = 0x200ul;

135 ià(
	`”¿_136
()){

136 ià(
NRF_POWER
->
RESETREAS
 & 
POWER_RESETREAS_RESETPIN_Msk
){

137 
NRF_POWER
->
RESETREAS
 = ~
POWER_RESETREAS_RESETPIN_Msk
;

144 #ià(
__FPU_USED
 == 1)

145 
SCB
->
CPACR
 |= (3UL << 20) | (3UL << 22);

146 
	`__DSB
();

147 
	`__ISB
();

153 #ià
	`defšed
 (
CONFIG_NFCT_PINS_AS_GPIOS
)

154 ià((
NRF_UICR
->
NFCPINS
 & 
UICR_NFCPINS_PROTECT_Msk
è=ğ(
UICR_NFCPINS_PROTECT_NFC
 << 
UICR_NFCPINS_PROTECT_Pos
)){

155 
NRF_NVMC
->
CONFIG
 = 
NVMC_CONFIG_WEN_W’
 << 
NVMC_CONFIG_WEN_Pos
;

156 
NRF_NVMC
->
READY
 =ğ
NVMC_READY_READY_Busy
){}

157 
NRF_UICR
->
NFCPINS
 &ğ~
UICR_NFCPINS_PROTECT_Msk
;

158 
NRF_NVMC
->
READY
 =ğ
NVMC_READY_READY_Busy
){}

159 
NRF_NVMC
->
CONFIG
 = 
NVMC_CONFIG_WEN_R’
 << 
NVMC_CONFIG_WEN_Pos
;

160 
NRF_NVMC
->
READY
 =ğ
NVMC_READY_READY_Busy
){}

161 
	`NVIC_Sy¡emRe£t
();

168 #ià
	`defšed
 (
CONFIG_GPIO_AS_PINRESET
)

169 ià(((
NRF_UICR
->
PSELRESET
[0] & 
UICR_PSELRESET_CONNECT_Msk
è!ğ(
UICR_PSELRESET_CONNECT_CÚÃùed
 << 
UICR_PSELRESET_CONNECT_Pos
)) ||

170 ((
NRF_UICR
->
PSELRESET
[1] & 
UICR_PSELRESET_CONNECT_Msk
è!ğ(
UICR_PSELRESET_CONNECT_CÚÃùed
 << 
UICR_PSELRESET_CONNECT_Pos
))){

171 
NRF_NVMC
->
CONFIG
 = 
NVMC_CONFIG_WEN_W’
 << 
NVMC_CONFIG_WEN_Pos
;

172 
NRF_NVMC
->
READY
 =ğ
NVMC_READY_READY_Busy
){}

173 
NRF_UICR
->
PSELRESET
[0] = 18;

174 
NRF_NVMC
->
READY
 =ğ
NVMC_READY_READY_Busy
){}

175 
NRF_UICR
->
PSELRESET
[1] = 18;

176 
NRF_NVMC
->
READY
 =ğ
NVMC_READY_READY_Busy
){}

177 
NRF_NVMC
->
CONFIG
 = 
NVMC_CONFIG_WEN_R’
 << 
NVMC_CONFIG_WEN_Pos
;

178 
NRF_NVMC
->
READY
 =ğ
NVMC_READY_READY_Busy
){}

179 
	`NVIC_Sy¡emRe£t
();

183 
	`Sy¡emCÜeClockUpd©e
();

184 
	}
}

187 
boŞ
 
	$”¿_36
()

189 ià((*(
ušt32_t
 *)0x10000130ul == 0x8ul) && (*(uint32_t *)0x10000134ul == 0x0ul)){

190  
Œue
;

193  
çl£
;

194 
	}
}

197 
boŞ
 
	$”¿_66
()

199 ià((*(
ušt32_t
 *)0x10000130ul == 0x8ul) && (*(uint32_t *)0x10000134ul == 0x0ul)){

200  
Œue
;

203  
çl£
;

204 
	}
}

207 
boŞ
 
	$”¿_98
()

209 ià((*(
ušt32_t
 *)0x10000130ul == 0x8ul) && (*(uint32_t *)0x10000134ul == 0x0ul)){

210  
Œue
;

213  
çl£
;

214 
	}
}

217 
boŞ
 
	$”¿_103
()

219 ià((*(
ušt32_t
 *)0x10000130ul == 0x8ul) && (*(uint32_t *)0x10000134ul == 0x0ul)){

220  
Œue
;

223  
çl£
;

224 
	}
}

227 
boŞ
 
	$”¿_115
()

229 ià((*(
ušt32_t
 *)0x10000130ul == 0x8ul) && (*(uint32_t *)0x10000134ul == 0x0ul)){

230  
Œue
;

233  
çl£
;

234 
	}
}

237 
boŞ
 
	$”¿_120
()

239 ià((*(
ušt32_t
 *)0x10000130ul == 0x8ul) && (*(uint32_t *)0x10000134ul == 0x0ul)){

240  
Œue
;

243  
çl£
;

244 
	}
}

247 
boŞ
 
	$”¿_136
()

249 ià((*(
ušt32_t
 *)0x10000130ul == 0x8ul) && (*(uint32_t *)0x10000134ul == 0x0ul)){

250  
Œue
;

253  
çl£
;

254 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\examples\ble_peripheral\ble_app_hids_mouse\main.c

55 
	~<¡dšt.h
>

56 
	~<¡ršg.h
>

57 
	~"nÜdic_commÚ.h
"

58 
	~"Äf.h
"

59 
	~"Äf_sdm.h
"

60 
	~"­p_”rÜ.h
"

61 
	~"bË.h
"

62 
	~"bË_”r.h
"

63 
	~"bË_hci.h
"

64 
	~"bË_¤v_commÚ.h
"

65 
	~"bË_advd©a.h
"

66 
	~"bË_hids.h
"

67 
	~"bË_bas.h
"

68 
	~"bË_dis.h
"

69 
	~"bË_cÚn_·¿ms.h
"

70 
	~"£nsÜsim.h
"

71 
	~"b¥_bŠ_bË.h
"

72 
	~"­p_scheduËr.h
"

73 
	~"Äf_sdh.h
"

74 
	~"Äf_sdh_soc.h
"

75 
	~"Äf_sdh_bË.h
"

76 
	~"­p_tim”.h
"

77 
	~"³”_mªag”.h
"

78 
	~"bË_adv”tisšg.h
"

79 
	~"fds.h
"

80 
	~"bË_cÚn_¡©e.h
"

81 
	~"Äf_bË_g©t.h
"

83 
	~"Äf_log.h
"

84 
	~"Äf_log_ù¾.h
"

85 
	~"Äf_log_deçuÉ_back’ds.h
"

87 
	~"Üd”Proûssšg.h
"

90 
	#DEVICE_NAME
 "NÜdic_Mou£"

	)

91 
	#MANUFACTURER_NAME
 "NÜdicSemicÚduùÜ"

	)

93 
	#APP_BLE_OBSERVER_PRIO
 3

	)

94 
	#APP_BLE_CONN_CFG_TAG
 1

	)

96 
	#BATTERY_LEVEL_MEAS_INTERVAL
 
	`APP_TIMER_TICKS
(2000è

	)

97 
	#MIN_BATTERY_LEVEL
 81

	)

98 
	#MAX_BATTERY_LEVEL
 100

	)

99 
	#BATTERY_LEVEL_INCREMENT
 1

	)

101 
	#PNP_ID_VENDOR_ID_SOURCE
 0x02

	)

102 
	#PNP_ID_VENDOR_ID
 0x1915

	)

103 
	#PNP_ID_PRODUCT_ID
 0xEEEE

	)

104 
	#PNP_ID_PRODUCT_VERSION
 0x0001

	)

107 
	#MIN_CONN_INTERVAL
 
	`MSEC_TO_UNITS
(7.5, 
UNIT_1_25_MS
è

	)

108 
	#MAX_CONN_INTERVAL
 
	`MSEC_TO_UNITS
(15, 
UNIT_1_25_MS
è

	)

109 
	#SLAVE_LATENCY
 20

	)

110 
	#CONN_SUP_TIMEOUT
 
	`MSEC_TO_UNITS
(3000, 
UNIT_10_MS
è

	)

112 
	#FIRST_CONN_PARAMS_UPDATE_DELAY
 
	`APP_TIMER_TICKS
(5000è

	)

113 
	#NEXT_CONN_PARAMS_UPDATE_DELAY
 
	`APP_TIMER_TICKS
(30000è

	)

114 
	#MAX_CONN_PARAM_UPDATE_COUNT
 3

	)

116 
	#SEC_PARAM_BOND
 1

	)

117 
	#SEC_PARAM_MITM
 0

	)

118 
	#SEC_PARAM_LESC
 0

	)

119 
	#SEC_PARAM_KEYPRESS
 0

	)

120 
	#SEC_PARAM_IO_CAPABILITIES
 
BLE_GAP_IO_CAPS_NONE


	)

121 
	#SEC_PARAM_OOB
 0

	)

122 
	#SEC_PARAM_MIN_KEY_SIZE
 7

	)

123 
	#SEC_PARAM_MAX_KEY_SIZE
 16

	)

125 
	#MOVEMENT_SPEED
 5

	)

126 
	#INPUT_REPORT_COUNT
 3

	)

127 
	#INPUT_REP_BUTTONS_LEN
 3

	)

128 
	#INPUT_REP_MOVEMENT_LEN
 3

	)

129 
	#INPUT_REP_MEDIA_PLAYER_LEN
 1

	)

130 
	#INPUT_REP_BUTTONS_INDEX
 0

	)

131 
	#INPUT_REP_MOVEMENT_INDEX
 1

	)

132 
	#INPUT_REP_MPLAYER_INDEX
 2

	)

133 
	#INPUT_REP_REF_BUTTONS_ID
 1

	)

134 
	#INPUT_REP_REF_MOVEMENT_ID
 2

	)

135 
	#INPUT_REP_REF_MPLAYER_ID
 3

	)

137 
	#BASE_USB_HID_SPEC_VERSION
 0x0101

	)

139 
	#SCHED_MAX_EVENT_DATA_SIZE
 
APP_TIMER_SCHED_EVENT_DATA_SIZE


	)

140 #ifdeà
SVCALL_AS_NORMAL_FUNCTION


141 
	#SCHED_QUEUE_SIZE
 20

	)

143 
	#SCHED_QUEUE_SIZE
 10

	)

146 
	#DEAD_BEEF
 0xDEADBEEF

	)

148 
	#APP_FEATURE_NOT_SUPPORTED
 
BLE_GATT_STATUS_ATTERR_APP_BEGIN
 + 2

	)

150 
	#APP_ADV_FAST_INTERVAL
 0x0028

	)

151 
	#APP_ADV_SLOW_INTERVAL
 0x0C80

	)

152 
	#APP_ADV_FAST_TIMEOUT
 10

	)

153 
	#APP_ADV_SLOW_TIMEOUT
 10

	)

156 
APP_TIMER_DEF
(
m_b©‹ry_tim”_id
);

157 
BLE_BAS_DEF
(
m_bas
);

158 
BLE_HIDS_DEF
(
m_hids
);

159 
NRF_BLE_GATT_DEF
(
m_g©t
);

160 
BLE_ADVERTISING_DEF
(
m_adv”tisšg
);

162 
boŞ
 
	gm_š_boÙ_mode
 = 
çl£
;

163 
ušt16_t
 
	gm_cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

164 
pm_³”_id_t
 
	gm_³”_id
;

165 
£nsÜsim_cfg_t
 
	gm_b©‹ry_sim_cfg
;

166 
£nsÜsim_¡©e_t
 
	gm_b©‹ry_sim_¡©e
;

167 
pm_³”_id_t
 
	gm_wh™–i¡_³”s
[
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
];

168 
ušt32_t
 
	gm_wh™–i¡_³”_út
;

169 
bË_uuid_t
 
	gm_adv_uuids
[] =

171 {
BLE_UUID_HUMAN_INTERFACE_DEVICE_SERVICE
, 
BLE_UUID_TYPE_BLE
}

176 
Üd”T
 
	g»mDeviûOrd”
;

178 
Ú_hids_evt
(
bË_hids_t
 * 
p_hids
, 
bË_hids_evt_t
 * 
p_evt
);

180 
bË_evt_hªdËr
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
, * 
p_cÚ‹xt
);

181 
pm_evt_hªdËr
(
pm_evt_t
 cÚ¡ * 
p_evt
);

182 
Ú_adv_evt
(
bË_adv_evt_t
 
bË_adv_evt
);

183 
bË_adv”tisšg_”rÜ_hªdËr
(
ušt32_t
 
Äf_”rÜ
);

188 
boŞ
 
	m»mCÚÃt
;

189 }
	gadvS‹
 =

191 .
»mCÚÃt
 = 
çl£


207 
	$as£¹_Äf_ÿÎback
(
ušt16_t
 
lše_num
, cÚ¡ 
ušt8_t
 * 
p_fe_Çme
)

209 
	`­p_”rÜ_hªdËr
(
DEAD_BEEF
, 
lše_num
, 
p_fe_Çme
);

210 
	}
}

219 
	$³”_li¡_g‘
(
pm_³”_id_t
 * 
p_³”s
, 
ušt32_t
 * 
p_size
)

221 
pm_³”_id_t
 
³”_id
;

222 
ušt32_t
 
³”s_to_cİy
;

224 
³”s_to_cİy
 = (*
p_size
 < 
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
) ?

225 *
p_size
 : 
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
;

227 
³”_id
 = 
	`pm_Ãxt_³”_id_g‘
(
PM_PEER_ID_INVALID
);

228 *
p_size
 = 0;

230 (
³”_id
 !ğ
PM_PEER_ID_INVALID
è&& (
³”s_to_cİy
--))

232 
p_³”s
[(*
p_size
)++] = 
³”_id
;

233 
³”_id
 = 
	`pm_Ãxt_³”_id_g‘
(peer_id);

235 
	}
}

240 
	$d–‘e_bÚds
()

242 
»t_code_t
 
”r_code
;

244 
	`NRF_LOG_INFO
("Erase bonds!");

246 
”r_code
 = 
	`pm_³”s_d–‘e
();

247 
	`APP_ERROR_CHECK
(
”r_code
);

248 
	}
}

253 
	$adv”tisšg_¡¬t
(
boŞ
 
”a£_bÚds
)

255 ià(
”a£_bÚds
 =ğ
Œue
)

257 
	`d–‘e_bÚds
();

262 
»t_code_t
 
»t
;

264 
	`mem£t
(
m_wh™–i¡_³”s
, 
PM_PEER_ID_INVALID
, (m_whitelist_peers));

265 
m_wh™–i¡_³”_út
 = ((
m_wh™–i¡_³”s
è/ (
pm_³”_id_t
));

267 
	`³”_li¡_g‘
(
m_wh™–i¡_³”s
, &
m_wh™–i¡_³”_út
);

269 
	`NRF_LOG_INFO
("Numb” P“¸%d", 
m_wh™–i¡_³”_út
);

271 
»t
 = 
	`pm_wh™–i¡_£t
(
m_wh™–i¡_³”s
, 
m_wh™–i¡_³”_út
);

272 
	`APP_ERROR_CHECK
(
»t
);

276 
»t
 = 
	`pm_deviû_id’t™›s_li¡_£t
(
m_wh™–i¡_³”s
, 
m_wh™–i¡_³”_út
);

277 ià(
»t
 !ğ
NRF_ERROR_NOT_SUPPORTED
)

279 
	`APP_ERROR_CHECK
(
»t
);

282 
	`NRF_LOG_INFO
("------start‡dv6-------");

283 
»t
 = 
	`bË_adv”tisšg_¡¬t
(&
m_adv”tisšg
, 
BLE_ADV_MODE_DIRECTED
);

284 
	`APP_ERROR_CHECK
(
»t
);

286 
	}
}

298 
	#DETECTED_DEV_FREE
 0xFF

	)

299 
	#DIRECT_CONN_QUANTITY
 0x3

	)

301 
	#APP_ADV_FAST_SCANING_INTERVAL
 0x0023

	)

302 
	#APP_ADV_FAST_SCANING_TIMEOUT
 5

	)

304 
	#APP_ADV_FAST_CONNECT_INTERVAL
 0x0023

	)

305 
	#APP_ADV_FAST_CONNECT_TIMEOUT
 5

	)

307 
	#APP_ADV_FAST_SEARCH_INTERVAL
 0x0140

	)

308 
	#APP_ADV_FAST_SEARCH_TIMEOUT
 60

	)

312 
	mADV_PROC_START_CONNECT
,

313 
	mADV_PROC_STOP_ADV
,

314 
	mADV_PROC_CONNECT
,

315 }
	tadvProcEvT
;

319 
	mDEV_SCANNING
,

320 
	mDEV_CONNECTION
,

321 }
	tcÚnPha£
;

325 
	mADV_IDLE
,

326 
	mADV_GENERAL
,

327 
	mADV_ADD_NEW
,

328 
	mADV_RECONNECT_SCAN
,

329 
	mADV_RECONNECT_CONNECT
,

330 }
	tadvTy³T
;

334 
cÚnPha£
 
	mpha£
;

335 
ušt16_t
 
	mli¡D‘eùedDev
[
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
];

336 
ušt8_t
 
	mquªt™yD‘eùedDev
;

337 
ušt8_t
 
	mcÚÃùCÁ
;

338 
ušt8_t
 
	mloİCÁ
;

339 }
	gadvDœOrdCÚnS‹
;

341 
advTy³T
 
	gcu¼’tAdv
 = 
ADV_IDLE
;

343 
Üd”T
 
	gdeviûOrd”
;

347 
	$adv”tisšg_š™
(
ušt16_t
 
š‹rv®MSecÚds
, ušt16_ˆ
³riodSecÚds
, 
boŞ
 
wh™–i¡EÇbËd
)

349 
»t_code_t
 
”r_code
;

350 
ušt8_t
 
adv_æags
;

351 
bË_adv”tisšg_š™_t
 
š™
;

353 
	`mem£t
(&
š™
, 0, (init));

355 
adv_æags
 = 
BLE_GAP_ADV_FLAGS_LE_ONLY_LIMITED_DISC_MODE
;

356 
š™
.
advd©a
.
Çme_ty³
 = 
BLE_ADVDATA_FULL_NAME
;

357 
š™
.
advd©a
.
šşude_­³¬ªû
 = 
Œue
;

358 
š™
.
advd©a
.
æags
 = 
adv_æags
;

359 
š™
.
advd©a
.
uuids_com¶‘e
.
uuid_út
 = (
m_adv_uuids
) / (m_adv_uuids[0]);

360 
š™
.
advd©a
.
uuids_com¶‘e
.
p_uuids
 = 
m_adv_uuids
;

362 
š™
.
cÚfig
.
bË_adv_Ú_discÚÃù_di§bËd
 = 
Œue
;

363 
š™
.
cÚfig
.
bË_adv_wh™–i¡_’abËd
 = 
çl£
;

364 
š™
.
cÚfig
.
bË_adv_dœeùed_’abËd
 = 
çl£
;

365 
š™
.
cÚfig
.
bË_adv_dœeùed_¦ow_’abËd
 = 
çl£
;

366 
š™
.
cÚfig
.
bË_adv_dœeùed_¦ow_š‹rv®
 = 
APP_ADV_FAST_INTERVAL
;

367 
š™
.
cÚfig
.
bË_adv_dœeùed_¦ow_timeout
 = 
APP_ADV_FAST_TIMEOUT
;

368 
š™
.
cÚfig
.
bË_adv_ç¡_’abËd
 = 
Œue
;

369 
š™
.
cÚfig
.
bË_adv_ç¡_š‹rv®
 = 
š‹rv®MSecÚds
;

370 
š™
.
cÚfig
.
bË_adv_ç¡_timeout
 = 
³riodSecÚds
;

371 
š™
.
cÚfig
.
bË_adv_¦ow_’abËd
 = 
çl£
;

372 
š™
.
cÚfig
.
bË_adv_¦ow_š‹rv®
 = 
APP_ADV_SLOW_INTERVAL
;

373 
š™
.
cÚfig
.
bË_adv_¦ow_timeout
 = 
APP_ADV_SLOW_TIMEOUT
;

375 
š™
.
evt_hªdËr
 = 
Ú_adv_evt
;

376 
š™
.
”rÜ_hªdËr
 = 
bË_adv”tisšg_”rÜ_hªdËr
;

378 
”r_code
 = 
	`bË_adv”tisšg_š™
(&
m_adv”tisšg
, &
š™
);

379 
	`APP_ERROR_CHECK
(
”r_code
);

381 
	`bË_adv”tisšg_cÚn_cfg_g_£t
(&
m_adv”tisšg
, 
APP_BLE_CONN_CFG_TAG
);

382 
	}
}

385 
boŞ
 
	$³”IdInLi¡
(
pm_³”_id_t
 
³”IdIn
)

387 
pm_³”_id_t
 
³”_id
;

389 
³”_id
 = 
	`pm_Ãxt_³”_id_g‘
(
PM_PEER_ID_INVALID
);

391 
³”_id
 !ğ
PM_PEER_ID_INVALID
 )

393 ifĞ
³”IdIn
 =ğ
³”_id
)

395  
Œue
;

397 
³”_id
 = 
	`pm_Ãxt_³”_id_g‘
(peer_id);

399  
çl£
;

400 
	}
}

405 
	$adv”tisšgApS¹
(
advTy³T
 
advTy³
, 
ušt16_t
 
³”Id
)

407 
»t_code_t
 
»t
;

408 if(
cu¼’tAdv
 !ğ
ADV_IDLE
)

410 
	`sd_bË_g­_adv_¡İ
();

412 
advTy³
)

414 
ADV_GENERAL
:

415 
	`NRF_LOG_INFO
("ADV General");

416 
m_wh™–i¡_³”_út
 = 0;

418 
	`adv”tisšg_š™
(
APP_ADV_FAST_SEARCH_INTERVAL
, 
APP_ADV_FAST_SEARCH_TIMEOUT
, 
çl£
);

420 
cu¼’tAdv
 = 
ADV_GENERAL
;

422 
ADV_ADD_NEW
:

423 
	`NRF_LOG_INFO
("ADV‡dd‚ew");

424 
m_wh™–i¡_³”_út
 = 0;

426 
	`adv”tisšg_š™
(
APP_ADV_FAST_SEARCH_INTERVAL
, 
APP_ADV_FAST_SEARCH_TIMEOUT
, 
çl£
);

428 
cu¼’tAdv
 = 
ADV_ADD_NEW
;

430 
ADV_RECONNECT_SCAN
:

433 
	`mem£t
(
m_wh™–i¡_³”s
, 
PM_PEER_ID_INVALID
, (m_whitelist_peers));

434 
m_wh™–i¡_³”_út
 = ((
m_wh™–i¡_³”s
è/ (
pm_³”_id_t
));

435 
	`³”_li¡_g‘
(
m_wh™–i¡_³”s
, &
m_wh™–i¡_³”_út
);

437 
	`NRF_LOG_INFO
("Adv„ecÚ: %d", 
m_wh™–i¡_³”_út
);

440 if(
m_wh™–i¡_³”_út
 == 0)

443 
	`adv”tisšg_š™
(
APP_ADV_FAST_SEARCH_INTERVAL
, 
APP_ADV_FAST_SEARCH_TIMEOUT
, 
çl£
);

444 
cu¼’tAdv
 = 
ADV_GENERAL
;

449 
	`adv”tisšg_š™
(
APP_ADV_FAST_SCANING_INTERVAL
, 
APP_ADV_FAST_SCANING_TIMEOUT
, 
çl£
);

450 
cu¼’tAdv
 = 
ADV_RECONNECT_SCAN
;

454 
ADV_RECONNECT_CONNECT
:

456 
	`adv”tisšg_š™
(
APP_ADV_FAST_CONNECT_INTERVAL
, 
APP_ADV_FAST_CONNECT_TIMEOUT
, 
çl£
);

458 
	`NRF_LOG_INFO
("Adv„econ conn");

459 
m_wh™–i¡_³”s
[0] = 
³”Id
;

460 
m_wh™–i¡_³”_út
 = 1;

462 
cu¼’tAdv
 = 
ADV_RECONNECT_SCAN
;

468 
»t
 = 
	`pm_wh™–i¡_£t
((
m_wh™–i¡_³”_út
 =ğ0 ) ? (
NULL
è: (
m_wh™–i¡_³”s
),

469 (
m_wh™–i¡_³”_út
 == 0 ) ? (0) : (m_whitelist_peer_cnt));

470 
	`APP_ERROR_CHECK
(
»t
);

473 
»t
 = 
	`pm_deviû_id’t™›s_li¡_£t
((
m_wh™–i¡_³”_út
 =ğ0 ) ? (
NULL
è: (
m_wh™–i¡_³”s
),

474 (
m_wh™–i¡_³”_út
 == 0 ) ? (0) : (m_whitelist_peer_cnt));

476 ià(
»t
 !ğ
NRF_ERROR_NOT_SUPPORTED
)

478 
	`APP_ERROR_CHECK
(
»t
);

480 
	`NRF_LOG_INFO
("------start‡dv1-------");

481 
»t
 = 
	`bË_adv”tisšg_¡¬t
(&
m_adv”tisšg
, 
BLE_ADV_MODE_FAST
);

482 
	`APP_ERROR_CHECK
(
»t
);

483 
	}
}

486 
	$adv”tisšgAddNew
(
advProcEvT
 
šEv
, 
ušt16_t
 
cÚnHªdË
, 
pm_³”_id_t
 
³”Id
)

488 
»t_code_t
 
”r_code
;

489 if(!
	`³”IdInLi¡
(
³”Id
))

491 
	`NRF_LOG_INFO
("No device onhe†ist");

494 
	`NRF_LOG_INFO
("Disconnect old dev");

495 
”r_code
 = 
	`sd_bË_g­_discÚÃù
(
cÚnHªdË
, 
BLE_HCI_REMOTE_USER_TERMINATED_CONNECTION
);

496 ià(
”r_code
 !ğ
NRF_ERROR_INVALID_STATE
)

498 
	`APP_ERROR_CHECK
(
”r_code
);

500 
	}
}

504 
	$adv”tisšgDœeùProc
(
advProcEvT
 
šEv
, 
ušt16_t
 
cÚnHªdË
, 
pm_³”_id_t
 
³”Id
)

506 
»t_code_t
 
”r_code
;

507 
šEv
)

509 
ADV_PROC_START_CONNECT
:

510 
	`NRF_LOG_INFO
("CONNECT");

511 
advDœOrdCÚnS‹
.
pha£
)

513 
DEV_SCANNING
:

515 
ušt8_t
 
pos
;

516 
	`NRF_LOG_INFO
("_SCANNING_");

517 
	`Üd”G‘Pos
(
»mDeviûOrd”
, 
³”Id
, &
pos
);

519 
advDœOrdCÚnS‹
.
li¡D‘eùedDev
[
pos
] = 
³”Id
;

520 
advDœOrdCÚnS‹
.
quªt™yD‘eùedDev
++;

522 
”r_code
 = 
	`sd_bË_g­_discÚÃù
(
cÚnHªdË
, 
BLE_HCI_REMOTE_USER_TERMINATED_CONNECTION
);

523 ià(
”r_code
 !ğ
NRF_ERROR_INVALID_STATE
)

525 
	`APP_ERROR_CHECK
(
”r_code
);

529 
DEV_CONNECTION
:

530 
	`NRF_LOG_INFO
("_CONNECTION_");

534 
ADV_PROC_STOP_ADV
:

535 
	`NRF_LOG_INFO
("STOP_ADV");

536 
advDœOrdCÚnS‹
.
pha£
)

538 
DEV_SCANNING
:

540 
ušt8_t
 
út_1
 = 0;

541 
ušt8_t
 
út_2
 = 0;

542 
	`NRF_LOG_INFO
("_SCANNING_");

543 
út_1
 = 0; cÁ_1 < 
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
 - 1; cnt_1++)

545 
út_2
 = 
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
-1; cnt_2 > 0; cnt_2--)

547 if(
advDœOrdCÚnS‹
.
li¡D‘eùedDev
[
út_2
 - 1] =ğ
DETECTED_DEV_FREE
 &&

548 
advDœOrdCÚnS‹
.
li¡D‘eùedDev
[
út_2
 ] !ğ
DETECTED_DEV_FREE
)

550 
advDœOrdCÚnS‹
.
li¡D‘eùedDev
[
út_2
 - 1] =‡dvDirOrdConnState.listDetectedDev[cnt_2 ];

551 
advDœOrdCÚnS‹
.
li¡D‘eùedDev
[
út_2
 ] = 
DETECTED_DEV_FREE
;

555 
	`NRF_LOG_INFO
("Fšd %d", 
advDœOrdCÚnS‹
.
quªt™yD‘eùedDev
);

556 
advDœOrdCÚnS‹
.
cÚÃùCÁ
 = 0;

557 
	`adv”tisšgApS¹
(
ADV_RECONNECT_CONNECT
 , 
advDœOrdCÚnS‹
.
li¡D‘eùedDev
[advDœOrdCÚnS‹.
cÚÃùCÁ
]);

560 
DEV_CONNECTION
:

561 
	`NRF_LOG_INFO
("_CONNECTION_");

562 if(
advDœOrdCÚnS‹
.
cÚÃùCÁ
 >ğadvDœOrdCÚnS‹.
quªt™yD‘eùedDev
)

565 
advDœOrdCÚnS‹
.
loİCÁ
++;

567 if(
advDœOrdCÚnS‹
.
loİCÁ
 >ğ
DIRECT_CONN_QUANTITY
)

573 
	`mem£t
(
advDœOrdCÚnS‹
.
li¡D‘eùedDev
, 
DETECTED_DEV_FREE
, (advDirOrdConnState.listDetectedDev));

574 
advDœOrdCÚnS‹
.
cÚÃùCÁ
 = 0;

575 
advDœOrdCÚnS‹
.
pha£
 = 
DEV_SCANNING
;

576 
	`adv”tisšgApS¹
(
ADV_RECONNECT_SCAN
, 0);

579 
advDœOrdCÚnS‹
.
cÚÃùCÁ
++;

580 
	`adv”tisšgApS¹
(
ADV_RECONNECT_CONNECT
, 
advDœOrdCÚnS‹
.
li¡D‘eùedDev
[advDœOrdCÚnS‹.
cÚÃùCÁ
]);

587 
	}
}

591 
	$adv”tisšgProûssšg
(
advProcEvT
 
šEv
, 
ušt16_t
 
cÚnHªdË
, 
pm_³”_id_t
 
³”Id
)

593 
cu¼’tAdv
)

595 
ADV_GENERAL
:

596 
	`NRF_LOG_INFO
("ADV_GENERAL");

598 
ADV_ADD_NEW
:

599 
	`NRF_LOG_INFO
("ADV_ADD_NEW");

600 
	`adv”tisšgAddNew
(
šEv
, 
cÚnHªdË
, 
³”Id
);

602 
ADV_RECONNECT_SCAN
:

603 
	`NRF_LOG_INFO
("ADV_SCAN");

604 
	`adv”tisšgDœeùProc
(
šEv
, 
cÚnHªdË
, 
³”Id
);

606 
ADV_RECONNECT_CONNECT
:

607 
	`NRF_LOG_INFO
("ADV_CONNECT");

608 
	`adv”tisšgDœeùProc
(
šEv
, 
cÚnHªdË
, 
³”Id
);

613 
	}
}

622 
	$£rviû_”rÜ_hªdËr
(
ušt32_t
 
Äf_”rÜ
)

624 
	`APP_ERROR_HANDLER
(
Äf_”rÜ
);

625 
	}
}

632 
	$bË_adv”tisšg_”rÜ_hªdËr
(
ušt32_t
 
Äf_”rÜ
)

634 
	`APP_ERROR_HANDLER
(
Äf_”rÜ
);

635 
	}
}

640 
	$b©‹ry_Ëv–_upd©e
()

642 
»t_code_t
 
”r_code
;

643 
ušt8_t
 
b©‹ry_Ëv–
;

645 
b©‹ry_Ëv–
 = (
ušt8_t
)
	`£nsÜsim_m—su»
(&
m_b©‹ry_sim_¡©e
, &
m_b©‹ry_sim_cfg
);

647 
”r_code
 = 
	`bË_bas_b©‹ry_Ëv–_upd©e
(&
m_bas
, 
b©‹ry_Ëv–
);

648 ià((
”r_code
 !ğ
NRF_SUCCESS
) &&

649 (
”r_code
 !ğ
NRF_ERROR_BUSY
) &&

650 (
”r_code
 !ğ
NRF_ERROR_RESOURCES
) &&

651 (
”r_code
 !ğ
NRF_ERROR_FORBIDDEN
) &&

652 (
”r_code
 !ğ
NRF_ERROR_INVALID_STATE
) &&

653 (
”r_code
 !ğ
BLE_ERROR_GATTS_SYS_ATTR_MISSING
)

656 
	`APP_ERROR_HANDLER
(
”r_code
);

658 
	}
}

668 
	$b©‹ry_Ëv–_m—s_timeout_hªdËr
(* 
p_cÚ‹xt
)

670 
	`UNUSED_PARAMETER
(
p_cÚ‹xt
);

671 
	`b©‹ry_Ëv–_upd©e
();

672 
	}
}

679 
	$tim”s_š™
()

681 
»t_code_t
 
”r_code
;

683 
”r_code
 = 
	`­p_tim”_š™
();

684 
	`APP_ERROR_CHECK
(
”r_code
);

687 
”r_code
 = 
	`­p_tim”_ü—‹
(&
m_b©‹ry_tim”_id
,

688 
APP_TIMER_MODE_REPEATED
,

689 
b©‹ry_Ëv–_m—s_timeout_hªdËr
);

690 
	`APP_ERROR_CHECK
(
”r_code
);

691 
	}
}

699 
	$g­_·¿ms_š™
()

701 
»t_code_t
 
”r_code
;

702 
bË_g­_cÚn_·¿ms_t
 
g­_cÚn_·¿ms
;

703 
bË_g­_cÚn_£c_mode_t
 
£c_mode
;

705 
	`BLE_GAP_CONN_SEC_MODE_SET_OPEN
(&
£c_mode
);

707 
”r_code
 = 
	`sd_bË_g­_deviû_Çme_£t
(&
£c_mode
,

708 (cÚ¡ 
ušt8_t
 *)
DEVICE_NAME
,

709 
	`¡¾’
(
DEVICE_NAME
));

710 
	`APP_ERROR_CHECK
(
”r_code
);

712 
”r_code
 = 
	`sd_bË_g­_­³¬ªû_£t
(
BLE_APPEARANCE_HID_MOUSE
);

713 
	`APP_ERROR_CHECK
(
”r_code
);

715 
	`mem£t
(&
g­_cÚn_·¿ms
, 0, (gap_conn_params));

717 
g­_cÚn_·¿ms
.
mš_cÚn_š‹rv®
 = 
MIN_CONN_INTERVAL
;

718 
g­_cÚn_·¿ms
.
max_cÚn_š‹rv®
 = 
MAX_CONN_INTERVAL
;

719 
g­_cÚn_·¿ms
.
¦ave_Ï‹ncy
 = 
SLAVE_LATENCY
;

720 
g­_cÚn_·¿ms
.
cÚn_sup_timeout
 = 
CONN_SUP_TIMEOUT
;

722 
”r_code
 = 
	`sd_bË_g­_µı_£t
(&
g­_cÚn_·¿ms
);

723 
	`APP_ERROR_CHECK
(
”r_code
);

724 
	}
}

729 
	$g©t_š™
()

731 
»t_code_t
 
”r_code
 = 
	`Äf_bË_g©t_š™
(&
m_g©t
, 
NULL
);

732 
	`APP_ERROR_CHECK
(
”r_code
);

733 
	}
}

738 
	$dis_š™
()

740 
»t_code_t
 
”r_code
;

741 
bË_dis_š™_t
 
dis_š™_obj
;

742 
bË_dis_²p_id_t
 
²p_id
;

744 
²p_id
.
v’dÜ_id_sourû
 = 
PNP_ID_VENDOR_ID_SOURCE
;

745 
²p_id
.
v’dÜ_id
 = 
PNP_ID_VENDOR_ID
;

746 
²p_id
.
´oduù_id
 = 
PNP_ID_PRODUCT_ID
;

747 
²p_id
.
´oduù_v”siÚ
 = 
PNP_ID_PRODUCT_VERSION
;

749 
	`mem£t
(&
dis_š™_obj
, 0, (dis_init_obj));

751 
	`bË_¤v_ascii_to_utf8
(&
dis_š™_obj
.
mªuçù_Çme_¡r
, 
MANUFACTURER_NAME
);

752 
dis_š™_obj
.
p_²p_id
 = &
²p_id
;

754 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
dis_š™_obj
.
dis_©Œ_md
.
»ad_³rm
);

755 
	`BLE_GAP_CONN_SEC_MODE_SET_NO_ACCESS
(&
dis_š™_obj
.
dis_©Œ_md
.
wr™e_³rm
);

757 
”r_code
 = 
	`bË_dis_š™
(&
dis_š™_obj
);

758 
	`APP_ERROR_CHECK
(
”r_code
);

759 
	}
}

764 
	$bas_š™
()

766 
»t_code_t
 
”r_code
;

767 
bË_bas_š™_t
 
bas_š™_obj
;

769 
	`mem£t
(&
bas_š™_obj
, 0, (bas_init_obj));

771 
bas_š™_obj
.
evt_hªdËr
 = 
NULL
;

772 
bas_š™_obj
.
suµÜt_nÙifiÿtiÚ
 = 
Œue
;

773 
bas_š™_obj
.
p_»pÜt_»f
 = 
NULL
;

774 
bas_š™_obj
.
š™Ÿl_b©t_Ëv–
 = 100;

776 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
bas_š™_obj
.
b©‹ry_Ëv–_ch¬_©Œ_md
.
cccd_wr™e_³rm
);

777 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
bas_š™_obj
.
b©‹ry_Ëv–_ch¬_©Œ_md
.
»ad_³rm
);

778 
	`BLE_GAP_CONN_SEC_MODE_SET_NO_ACCESS
(&
bas_š™_obj
.
b©‹ry_Ëv–_ch¬_©Œ_md
.
wr™e_³rm
);

780 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
bas_š™_obj
.
b©‹ry_Ëv–_»pÜt_»ad_³rm
);

782 
”r_code
 = 
	`bË_bas_š™
(&
m_bas
, &
bas_š™_obj
);

783 
	`APP_ERROR_CHECK
(
”r_code
);

784 
	}
}

789 
	$hids_š™
()

791 
»t_code_t
 
”r_code
;

792 
bË_hids_š™_t
 
hids_š™_obj
;

793 
bË_hids_šp_»p_š™_t
 
šp_»p_¬¿y
[
INPUT_REPORT_COUNT
];

794 
bË_hids_šp_»p_š™_t
 * 
p_šput_»pÜt
;

795 
ušt8_t
 
hid_šfo_æags
;

797 
ušt8_t
 
»p_m­_d©a
[] =

877 
	`mem£t
(
šp_»p_¬¿y
, 0, (inp_rep_array));

879 
p_šput_»pÜt
 = &
šp_»p_¬¿y
[
INPUT_REP_BUTTONS_INDEX
];

880 
p_šput_»pÜt
->
max_Ën
 = 
INPUT_REP_BUTTONS_LEN
;

881 
p_šput_»pÜt
->
»p_»f
.
»pÜt_id
 = 
INPUT_REP_REF_BUTTONS_ID
;

882 
p_šput_»pÜt
->
»p_»f
.
»pÜt_ty³
 = 
BLE_HIDS_REP_TYPE_INPUT
;

884 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
p_šput_»pÜt
->
£cur™y_mode
.
cccd_wr™e_³rm
);

885 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
p_šput_»pÜt
->
£cur™y_mode
.
»ad_³rm
);

886 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
p_šput_»pÜt
->
£cur™y_mode
.
wr™e_³rm
);

888 
p_šput_»pÜt
 = &
šp_»p_¬¿y
[
INPUT_REP_MOVEMENT_INDEX
];

889 
p_šput_»pÜt
->
max_Ën
 = 
INPUT_REP_MOVEMENT_LEN
;

890 
p_šput_»pÜt
->
»p_»f
.
»pÜt_id
 = 
INPUT_REP_REF_MOVEMENT_ID
;

891 
p_šput_»pÜt
->
»p_»f
.
»pÜt_ty³
 = 
BLE_HIDS_REP_TYPE_INPUT
;

893 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
p_šput_»pÜt
->
£cur™y_mode
.
cccd_wr™e_³rm
);

894 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
p_šput_»pÜt
->
£cur™y_mode
.
»ad_³rm
);

895 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
p_šput_»pÜt
->
£cur™y_mode
.
wr™e_³rm
);

897 
p_šput_»pÜt
 = &
šp_»p_¬¿y
[
INPUT_REP_MPLAYER_INDEX
];

898 
p_šput_»pÜt
->
max_Ën
 = 
INPUT_REP_MEDIA_PLAYER_LEN
;

899 
p_šput_»pÜt
->
»p_»f
.
»pÜt_id
 = 
INPUT_REP_REF_MPLAYER_ID
;

900 
p_šput_»pÜt
->
»p_»f
.
»pÜt_ty³
 = 
BLE_HIDS_REP_TYPE_INPUT
;

902 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
p_šput_»pÜt
->
£cur™y_mode
.
cccd_wr™e_³rm
);

903 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
p_šput_»pÜt
->
£cur™y_mode
.
»ad_³rm
);

904 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
p_šput_»pÜt
->
£cur™y_mode
.
wr™e_³rm
);

906 
hid_šfo_æags
 = 
HID_INFO_FLAG_REMOTE_WAKE_MSK
 | 
HID_INFO_FLAG_NORMALLY_CONNECTABLE_MSK
;

908 
	`mem£t
(&
hids_š™_obj
, 0, (hids_init_obj));

910 
hids_š™_obj
.
evt_hªdËr
 = 
Ú_hids_evt
;

911 
hids_š™_obj
.
”rÜ_hªdËr
 = 
£rviû_”rÜ_hªdËr
;

912 
hids_š™_obj
.
is_kb
 = 
çl£
;

913 
hids_š™_obj
.
is_mou£
 = 
Œue
;

914 
hids_š™_obj
.
šp_»p_couÁ
 = 
INPUT_REPORT_COUNT
;

915 
hids_š™_obj
.
p_šp_»p_¬¿y
 = 
šp_»p_¬¿y
;

916 
hids_š™_obj
.
ou_»p_couÁ
 = 0;

917 
hids_š™_obj
.
p_ou_»p_¬¿y
 = 
NULL
;

918 
hids_š™_obj
.
ã©u»_»p_couÁ
 = 0;

919 
hids_š™_obj
.
p_ã©u»_»p_¬¿y
 = 
NULL
;

920 
hids_š™_obj
.
»p_m­
.
d©a_Ën
 = (
»p_m­_d©a
);

921 
hids_š™_obj
.
»p_m­
.
p_d©a
 = 
»p_m­_d©a
;

922 
hids_š™_obj
.
hid_šfÜm©iÚ
.
bcd_hid
 = 
BASE_USB_HID_SPEC_VERSION
;

923 
hids_š™_obj
.
hid_šfÜm©iÚ
.
b_couÁry_code
 = 0;

924 
hids_š™_obj
.
hid_šfÜm©iÚ
.
æags
 = 
hid_šfo_æags
;

925 
hids_š™_obj
.
šşuded_£rviûs_couÁ
 = 0;

926 
hids_š™_obj
.
p_šşuded_£rviûs_¬¿y
 = 
NULL
;

928 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
hids_š™_obj
.
»p_m­
.
£cur™y_mode
.
»ad_³rm
);

929 
	`BLE_GAP_CONN_SEC_MODE_SET_NO_ACCESS
(&
hids_š™_obj
.
»p_m­
.
£cur™y_mode
.
wr™e_³rm
);

930 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
hids_š™_obj
.
hid_šfÜm©iÚ
.
£cur™y_mode
.
»ad_³rm
);

931 
	`BLE_GAP_CONN_SEC_MODE_SET_NO_ACCESS
(&
hids_š™_obj
.
hid_šfÜm©iÚ
.
£cur™y_mode
.
wr™e_³rm
);

933 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(

934 &
hids_š™_obj
.
£cur™y_mode_boÙ_mou£_šp_»p
.
cccd_wr™e_³rm
);

935 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(

936 &
hids_š™_obj
.
£cur™y_mode_boÙ_mou£_šp_»p
.
»ad_³rm
);

937 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(

938 &
hids_š™_obj
.
£cur™y_mode_boÙ_mou£_šp_»p
.
wr™e_³rm
);

940 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
hids_š™_obj
.
£cur™y_mode_´ÙocŞ
.
»ad_³rm
);

941 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
hids_š™_obj
.
£cur™y_mode_´ÙocŞ
.
wr™e_³rm
);

942 
	`BLE_GAP_CONN_SEC_MODE_SET_NO_ACCESS
(&
hids_š™_obj
.
£cur™y_mode_ù¾_pošt
.
»ad_³rm
);

943 
	`BLE_GAP_CONN_SEC_MODE_SET_ENC_NO_MITM
(&
hids_š™_obj
.
£cur™y_mode_ù¾_pošt
.
wr™e_³rm
);

945 
”r_code
 = 
	`bË_hids_š™
(&
m_hids
, &
hids_š™_obj
);

946 
	`APP_ERROR_CHECK
(
”r_code
);

947 
	}
}

952 
	$£rviûs_š™
()

954 
	`dis_š™
();

955 
	`bas_š™
();

956 
	`hids_š™
();

957 
	}
}

962 
	$£nsÜ_simuÏtÜ_š™
()

964 
m_b©‹ry_sim_cfg
.
mš
 = 
MIN_BATTERY_LEVEL
;

965 
m_b©‹ry_sim_cfg
.
max
 = 
MAX_BATTERY_LEVEL
;

966 
m_b©‹ry_sim_cfg
.
šü
 = 
BATTERY_LEVEL_INCREMENT
;

967 
m_b©‹ry_sim_cfg
.
¡¬t_©_max
 = 
Œue
;

969 
	`£nsÜsim_š™
(&
m_b©‹ry_sim_¡©e
, &
m_b©‹ry_sim_cfg
);

970 
	}
}

977 
	$cÚn_·¿ms_”rÜ_hªdËr
(
ušt32_t
 
Äf_”rÜ
)

979 
	`APP_ERROR_HANDLER
(
Äf_”rÜ
);

980 
	}
}

985 
	$cÚn_·¿ms_š™
()

987 
»t_code_t
 
”r_code
;

988 
bË_cÚn_·¿ms_š™_t
 
ı_š™
;

990 
	`mem£t
(&
ı_š™
, 0, (cp_init));

992 
ı_š™
.
p_cÚn_·¿ms
 = 
NULL
;

993 
ı_š™
.
fœ¡_cÚn_·¿ms_upd©e_d–ay
 = 
FIRST_CONN_PARAMS_UPDATE_DELAY
;

994 
ı_š™
.
Ãxt_cÚn_·¿ms_upd©e_d–ay
 = 
NEXT_CONN_PARAMS_UPDATE_DELAY
;

995 
ı_š™
.
max_cÚn_·¿ms_upd©e_couÁ
 = 
MAX_CONN_PARAM_UPDATE_COUNT
;

996 
ı_š™
.
¡¬t_Ú_nÙify_cccd_hªdË
 = 
BLE_GATT_HANDLE_INVALID
;

997 
ı_š™
.
discÚÃù_Ú_ç
 = 
çl£
;

998 
ı_š™
.
evt_hªdËr
 = 
NULL
;

999 
ı_š™
.
”rÜ_hªdËr
 = 
cÚn_·¿ms_”rÜ_hªdËr
;

1001 
”r_code
 = 
	`bË_cÚn_·¿ms_š™
(&
ı_š™
);

1002 
	`APP_ERROR_CHECK
(
”r_code
);

1003 
	}
}

1008 
	$tim”s_¡¬t
()

1010 
»t_code_t
 
”r_code
;

1012 
”r_code
 = 
	`­p_tim”_¡¬t
(
m_b©‹ry_tim”_id
, 
BATTERY_LEVEL_MEAS_INTERVAL
, 
NULL
);

1013 
	`APP_ERROR_CHECK
(
”r_code
);

1014 
	}
}

1021 
	$¦“p_mode_’‹r
()

1023 
»t_code_t
 
”r_code
;

1025 
”r_code
 = 
	`b¥_šdiÿtiÚ_£t
(
BSP_INDICATE_IDLE
);

1026 
	`APP_ERROR_CHECK
(
”r_code
);

1029 
”r_code
 = 
	`b¥_bŠ_bË_¦“p_mode_´•¬e
();

1030 
	`APP_ERROR_CHECK
(
”r_code
);

1033 
”r_code
 = 
	`sd_pow”_sy¡em_off
();

1034 
	`APP_ERROR_CHECK
(
”r_code
);

1035 
	}
}

1045 
	$Ú_hids_evt
(
bË_hids_t
 * 
p_hids
, 
bË_hids_evt_t
 * 
p_evt
)

1047 
p_evt
->
evt_ty³
)

1049 
BLE_HIDS_EVT_BOOT_MODE_ENTERED
:

1050 
m_š_boÙ_mode
 = 
Œue
;

1053 
BLE_HIDS_EVT_REPORT_MODE_ENTERED
:

1054 
m_š_boÙ_mode
 = 
çl£
;

1057 
BLE_HIDS_EVT_NOTIF_ENABLED
:

1064 
	}
}

1072 
	$bË_¡ack_š™
()

1074 
»t_code_t
 
”r_code
;

1076 
”r_code
 = 
	`Äf_sdh_’abË_»que¡
();

1077 
	`APP_ERROR_CHECK
(
”r_code
);

1081 
ušt32_t
 
¿m_¡¬t
 = 0;

1082 
”r_code
 = 
	`Äf_sdh_bË_deçuÉ_cfg_£t
(
APP_BLE_CONN_CFG_TAG
, &
¿m_¡¬t
);

1083 
	`APP_ERROR_CHECK
(
”r_code
);

1086 
”r_code
 = 
	`Äf_sdh_bË_’abË
(&
¿m_¡¬t
);

1087 
	`APP_ERROR_CHECK
(
”r_code
);

1090 
	`NRF_SDH_BLE_OBSERVER
(
m_bË_ob£rv”
, 
APP_BLE_OBSERVER_PRIO
, 
bË_evt_hªdËr
, 
NULL
);

1091 
	}
}

1096 
	$³”_mªag”_š™
()

1098 
bË_g­_£c_·¿ms_t
 
£c_·¿m
;

1099 
»t_code_t
 
”r_code
;

1101 
”r_code
 = 
	`pm_š™
();

1102 
	`APP_ERROR_CHECK
(
”r_code
);

1104 
	`mem£t
(&
£c_·¿m
, 0, (
bË_g­_£c_·¿ms_t
));

1107 
£c_·¿m
.
bÚd
 = 
SEC_PARAM_BOND
;

1108 
£c_·¿m
.
m™m
 = 
SEC_PARAM_MITM
;

1109 
£c_·¿m
.
Ësc
 = 
SEC_PARAM_LESC
;

1110 
£c_·¿m
.
key´ess
 = 
SEC_PARAM_KEYPRESS
;

1111 
£c_·¿m
.
io_ÿps
 = 
SEC_PARAM_IO_CAPABILITIES
;

1112 
£c_·¿m
.
oob
 = 
SEC_PARAM_OOB
;

1113 
£c_·¿m
.
mš_key_size
 = 
SEC_PARAM_MIN_KEY_SIZE
;

1114 
£c_·¿m
.
max_key_size
 = 
SEC_PARAM_MAX_KEY_SIZE
;

1115 
£c_·¿m
.
kdi¡_own
.
’c
 = 1;

1116 
£c_·¿m
.
kdi¡_own
.
id
 = 1;

1117 
£c_·¿m
.
kdi¡_³”
.
’c
 = 1;

1118 
£c_·¿m
.
kdi¡_³”
.
id
 = 1;

1120 
”r_code
 = 
	`pm_£c_·¿ms_£t
(&
£c_·¿m
);

1121 
	`APP_ERROR_CHECK
(
”r_code
);

1123 
”r_code
 = 
	`pm_»gi¡”
(
pm_evt_hªdËr
);

1124 
	`APP_ERROR_CHECK
(
”r_code
);

1125 
	}
}

1133 
	$scheduËr_š™
()

1135 
	`APP_SCHED_INIT
(
SCHED_MAX_EVENT_DATA_SIZE
, 
SCHED_QUEUE_SIZE
);

1136 
	}
}

1144 
	$mou£_movem’t_£nd
(
št16_t
 
x_d–
, iÁ16_ˆ
y_d–
)

1146 
»t_code_t
 
”r_code
;

1148 ià(
m_š_boÙ_mode
)

1150 
x_d–
 = 
	`MIN
(x_delta, 0x00ff);

1151 
y_d–
 = 
	`MIN
(y_delta, 0x00ff);

1153 
”r_code
 = 
	`bË_hids_boÙ_mou£_šp_»p_£nd
(&
m_hids
,

1155 (
št8_t
)
x_d–
,

1156 (
št8_t
)
y_d–
,

1158 
NULL
);

1162 
ušt8_t
 
bufãr
[
INPUT_REP_MOVEMENT_LEN
];

1164 
	`APP_ERROR_CHECK_BOOL
(
INPUT_REP_MOVEMENT_LEN
 == 3);

1166 
x_d–
 = 
	`MIN
(x_delta, 0x0fff);

1167 
y_d–
 = 
	`MIN
(y_delta, 0x0fff);

1169 
bufãr
[0] = 
x_d–
 & 0x00ff;

1170 
bufãr
[1] = ((
y_d–
 & 0x000fè<< 4è| ((
x_d–
 & 0x0f00) >> 8);

1171 
bufãr
[2] = (
y_d–
 & 0x0ff0) >> 4;

1173 
”r_code
 = 
	`bË_hids_šp_»p_£nd
(&
m_hids
,

1174 
INPUT_REP_MOVEMENT_INDEX
,

1175 
INPUT_REP_MOVEMENT_LEN
,

1176 
bufãr
);

1179 ià((
”r_code
 !ğ
NRF_SUCCESS
) &&

1180 (
”r_code
 !ğ
NRF_ERROR_INVALID_STATE
) &&

1181 (
”r_code
 !ğ
NRF_ERROR_RESOURCES
) &&

1182 (
”r_code
 !ğ
BLE_ERROR_GATTS_SYS_ATTR_MISSING
)

1185 
	`APP_ERROR_HANDLER
(
”r_code
);

1187 
	}
}

1194 
	$b¥_ev’t_hªdËr
(
b¥_ev’t_t
 
ev’t
)

1196 
»t_code_t
 
”r_code
;

1198 
ev’t
)

1200 
BSP_EVENT_SLEEP
:

1201 
	`¦“p_mode_’‹r
();

1204 
BSP_EVENT_DISCONNECT
:

1205 
”r_code
 = 
	`sd_bË_g­_discÚÃù
(
m_cÚn_hªdË
,

1206 
BLE_HCI_REMOTE_USER_TERMINATED_CONNECTION
);

1207 ià(
”r_code
 !ğ
NRF_ERROR_INVALID_STATE
)

1209 
	`APP_ERROR_CHECK
(
”r_code
);

1213 
BSP_EVENT_WHITELIST_OFF
:

1214 ià(
m_cÚn_hªdË
 =ğ
BLE_CONN_HANDLE_INVALID
)

1216 
”r_code
 = 
	`bË_adv”tisšg_»¡¬t_w™hout_wh™–i¡
(&
m_adv”tisšg
);

1217 ià(
”r_code
 !ğ
NRF_ERROR_INVALID_STATE
)

1219 
	`APP_ERROR_CHECK
(
”r_code
);

1224 
BSP_EVENT_KEY_0
:

1225 
	`NRF_LOG_INFO
("KEY_0");

1226 ià(
m_cÚn_hªdË
 !ğ
BLE_CONN_HANDLE_INVALID
)

1228 
	`mou£_movem’t_£nd
(-
MOVEMENT_SPEED
, 0);

1232 
BSP_EVENT_KEY_1
:

1233 
	`NRF_LOG_INFO
("KEY_1");

1234 ià(
m_cÚn_hªdË
 !ğ
BLE_CONN_HANDLE_INVALID
)

1236 
	`mou£_movem’t_£nd
(0, -
MOVEMENT_SPEED
);

1240 
BSP_EVENT_KEY_2
:

1241 
	`NRF_LOG_INFO
("KEY_2");

1242 ià(
m_cÚn_hªdË
 !ğ
BLE_CONN_HANDLE_INVALID
)

1244 
	`mou£_movem’t_£nd
(
MOVEMENT_SPEED
, 0);

1248 
BSP_EVENT_KEY_3
:

1249 
	`NRF_LOG_INFO
("Start general‡dvert");

1250 
	`adv”tisšgApS¹
(
ADV_ADD_NEW
, 0);

1256 
	}
}

1263 
	$bu‰Ús_Ëds_š™
(
boŞ
 * 
p_”a£_bÚds
)

1265 
»t_code_t
 
”r_code
;

1266 
b¥_ev’t_t
 
¡¬tup_ev’t
;

1268 
”r_code
 = 
	`b¥_š™
(
BSP_INIT_LED
 | 
BSP_INIT_BUTTONS
, 
b¥_ev’t_hªdËr
);

1270 
	`APP_ERROR_CHECK
(
”r_code
);

1272 
”r_code
 = 
	`b¥_bŠ_bË_š™
(
NULL
, &
¡¬tup_ev’t
);

1273 
	`APP_ERROR_CHECK
(
”r_code
);

1275 *
p_”a£_bÚds
 = (
¡¬tup_ev’t
 =ğ
BSP_EVENT_CLEAR_BONDING_DATA
);

1276 
	}
}

1281 
	$log_š™
()

1283 
»t_code_t
 
”r_code
 = 
	`NRF_LOG_INIT
(
NULL
);

1284 
	`APP_ERROR_CHECK
(
”r_code
);

1286 
	`NRF_LOG_DEFAULT_BACKENDS_INIT
();

1287 
	}
}

1292 
	$pow”_mªage
()

1294 
»t_code_t
 
”r_code
 = 
	`sd_­p_evt_wa™
();

1295 
	`APP_ERROR_CHECK
(
”r_code
);

1296 
	}
}

1301 
	$maš
()

1303 
boŞ
 
”a£_bÚds
;

1306 
	`log_š™
();

1307 
	`NRF_LOG_INFO
("Gerasimchuk started.");

1309 
deviûOrd”
 = 
	`Üd”M®loc
();

1311 
	`tim”s_š™
();

1312 
	`bu‰Ús_Ëds_š™
(&
”a£_bÚds
);

1313 
	`bË_¡ack_š™
();

1314 
	`scheduËr_š™
();

1315 
	`g­_·¿ms_š™
();

1316 
	`g©t_š™
();

1318 
	`£rviûs_š™
();

1319 
	`£nsÜ_simuÏtÜ_š™
();

1320 
	`cÚn_·¿ms_š™
();

1321 
	`³”_mªag”_š™
();

1325 
	`tim”s_¡¬t
();

1327 
	`adv”tisšgApS¹
(
ADV_RECONNECT_SCAN
, 0);

1332 
	`­p_sched_execu‹
();

1333 ià(
	`NRF_LOG_PROCESS
(è=ğ
çl£
)

1335 
	`pow”_mªage
();

1338 
	}
}

1352 
	$bË_evt_hªdËr
(
bË_evt_t
 cÚ¡ * 
p_bË_evt
, * 
p_cÚ‹xt
)

1354 
»t_code_t
 
”r_code
;

1357 
p_bË_evt
->
h—d”
.
evt_id
)

1359 
BLE_GAP_EVT_CONNECTED
: 
	`NRF_LOG_INFO
("CONNECTED"); ;

1360 
BLE_GAP_EVT_DISCONNECTED
: 
	`NRF_LOG_INFO
("DISCONNECTED"); ;

1361 
BLE_GAP_EVT_CONN_PARAM_UPDATE
: 
	`NRF_LOG_INFO
("CONN_PARAM_UPDATE"); ;

1362 
BLE_GAP_EVT_SEC_PARAMS_REQUEST
: 
	`NRF_LOG_INFO
("SEC_PARAMS_REQUEST"); ;

1363 
BLE_GAP_EVT_SEC_INFO_REQUEST
: 
	`NRF_LOG_INFO
("SEC_INFO_REQUEST"); ;

1364 
BLE_GAP_EVT_PASSKEY_DISPLAY
: 
	`NRF_LOG_INFO
("PASSKEY_DISPLAY"); ;

1365 
BLE_GAP_EVT_KEY_PRESSED
: 
	`NRF_LOG_INFO
("KEY_PRESSED"); ;

1366 
BLE_GAP_EVT_AUTH_KEY_REQUEST
: 
	`NRF_LOG_INFO
("AUTH_KEY_REQUEST"); ;

1367 
BLE_GAP_EVT_LESC_DHKEY_REQUEST
: 
	`NRF_LOG_INFO
("LESC_DHKEY_REQUEST"); ;

1368 
BLE_GAP_EVT_AUTH_STATUS
: 
	`NRF_LOG_INFO
("AUTH_STATUS"); ;

1369 
BLE_GAP_EVT_CONN_SEC_UPDATE
: 
	`NRF_LOG_INFO
("CONN_SEC_UPDATE"); ;

1370 
BLE_GAP_EVT_TIMEOUT
: 
	`NRF_LOG_INFO
("TIMEOUT"); ;

1371 
BLE_GAP_EVT_RSSI_CHANGED
: 
	`NRF_LOG_INFO
("RSSI_CHANGED"); ;

1372 
BLE_GAP_EVT_ADV_REPORT
: 
	`NRF_LOG_INFO
("ADV_REPORT"); ;

1373 
BLE_GAP_EVT_SEC_REQUEST
: 
	`NRF_LOG_INFO
("SEC_REQUEST"); ;

1374 
BLE_GAP_EVT_CONN_PARAM_UPDATE_REQUEST
: 
	`NRF_LOG_INFO
("CONN_PARAM_UPDATE_REQUEST"); ;

1375 
BLE_GAP_EVT_SCAN_REQ_REPORT
: 
	`NRF_LOG_INFO
("SCAN_REQ_REPORT"); ;

1376 
BLE_GAP_EVT_PHY_UPDATE
: 
	`NRF_LOG_INFO
("PHY_UPDATE"); ;

1377 
BLE_GAP_EVT_DATA_LENGTH_UPDATE_REQUEST
: 
	`NRF_LOG_INFO
("DATA_LENGTH_UPDATE_REQUEST"); ;

1378 
BLE_GAP_EVT_DATA_LENGTH_UPDATE
: 
	`NRF_LOG_INFO
("DATA_LENGTH_UPDATE"); ;

1381 
p_bË_evt
->
h—d”
.
evt_id
)

1383 
BLE_GAP_EVT_CONNECTED
:

1385 
”r_code
 = 
	`b¥_šdiÿtiÚ_£t
(
BSP_INDICATE_CONNECTED
);

1386 
	`APP_ERROR_CHECK
(
”r_code
);

1388 
m_cÚn_hªdË
 = 
p_bË_evt
->
evt
.
g­_evt
.
cÚn_hªdË
;

1391 
BLE_GAP_EVT_DISCONNECTED
:

1395 
m_cÚn_hªdË
 = 
BLE_CONN_HANDLE_INVALID
;

1398 #iâdeà
S140


1399 
BLE_GAP_EVT_PHY_UPDATE_REQUEST
:

1401 
	`NRF_LOG_DEBUG
("PHY update„equest.");

1402 
bË_g­_phys_t
 cÚ¡ 
phys
 =

1404 .
rx_phys
 = 
BLE_GAP_PHY_AUTO
,

1405 .
tx_phys
 = 
BLE_GAP_PHY_AUTO
,

1407 
”r_code
 = 
	`sd_bË_g­_phy_upd©e
(
p_bË_evt
->
evt
.
g­_evt
.
cÚn_hªdË
, &
phys
);

1408 
	`APP_ERROR_CHECK
(
”r_code
);

1412 
BLE_GATTC_EVT_TIMEOUT
:

1414 
	`NRF_LOG_DEBUG
("GATT Client Timeout.");

1415 
”r_code
 = 
	`sd_bË_g­_discÚÃù
(
p_bË_evt
->
evt
.
g©tc_evt
.
cÚn_hªdË
,

1416 
BLE_HCI_REMOTE_USER_TERMINATED_CONNECTION
);

1417 
	`APP_ERROR_CHECK
(
”r_code
);

1420 
BLE_GATTS_EVT_TIMEOUT
:

1422 
	`NRF_LOG_DEBUG
("GATT Server Timeout.");

1423 
”r_code
 = 
	`sd_bË_g­_discÚÃù
(
p_bË_evt
->
evt
.
g©ts_evt
.
cÚn_hªdË
,

1424 
BLE_HCI_REMOTE_USER_TERMINATED_CONNECTION
);

1425 
	`APP_ERROR_CHECK
(
”r_code
);

1428 
BLE_EVT_USER_MEM_REQUEST
:

1429 
”r_code
 = 
	`sd_bË_u£r_mem_»¶y
(
m_cÚn_hªdË
, 
NULL
);

1430 
	`APP_ERROR_CHECK
(
”r_code
);

1433 
BLE_GATTS_EVT_RW_AUTHORIZE_REQUEST
:

1435 
bË_g©ts_evt_rw_authÜize_»que¡_t
 
»q
;

1436 
bË_g©ts_rw_authÜize_»¶y_·¿ms_t
 
auth_»¶y
;

1438 
»q
 = 
p_bË_evt
->
evt
.
g©ts_evt
.
·¿ms
.
authÜize_»que¡
;

1440 ià(
»q
.
ty³
 !ğ
BLE_GATTS_AUTHORIZE_TYPE_INVALID
)

1442 ià((
»q
.
»que¡
.
wr™e
.
İ
 =ğ
BLE_GATTS_OP_PREP_WRITE_REQ
) ||

1443 (
»q
.
»que¡
.
wr™e
.
İ
 =ğ
BLE_GATTS_OP_EXEC_WRITE_REQ_NOW
) ||

1444 (
»q
.
»que¡
.
wr™e
.
İ
 =ğ
BLE_GATTS_OP_EXEC_WRITE_REQ_CANCEL
))

1446 ià(
»q
.
ty³
 =ğ
BLE_GATTS_AUTHORIZE_TYPE_WRITE
)

1448 
auth_»¶y
.
ty³
 = 
BLE_GATTS_AUTHORIZE_TYPE_WRITE
;

1452 
auth_»¶y
.
ty³
 = 
BLE_GATTS_AUTHORIZE_TYPE_READ
;

1454 
auth_»¶y
.
·¿ms
.
wr™e
.
g©t_¡©us
 = 
APP_FEATURE_NOT_SUPPORTED
;

1455 
”r_code
 = 
	`sd_bË_g©ts_rw_authÜize_»¶y
(
p_bË_evt
->
evt
.
g©ts_evt
.
cÚn_hªdË
,

1456 &
auth_»¶y
);

1457 
	`APP_ERROR_CHECK
(
”r_code
);

1466 
	}
}

1475 
	$pm_evt_hªdËr
(
pm_evt_t
 cÚ¡ * 
p_evt
)

1477 
»t_code_t
 
”r_code
;

1479 
p_evt
->
evt_id
)

1481 
PM_EVT_BONDED_PEER_CONNECTED
: 
	`NRF_LOG_INFO
("PM_EVT_BONDED_PEER_CONNECTED"); ;

1482 
PM_EVT_CONN_SEC_START
: 
	`NRF_LOG_INFO
("PM_EVT_CONN_SEC_START"); ;

1483 
PM_EVT_CONN_SEC_SUCCEEDED
: 
	`NRF_LOG_INFO
("PM_EVT_CONN_SEC_SUCCEEDED"); ;

1484 
PM_EVT_CONN_SEC_FAILED
: 
	`NRF_LOG_INFO
("PM_EVT_CONN_SEC_FAILED"); ;

1485 
PM_EVT_CONN_SEC_CONFIG_REQ
: 
	`NRF_LOG_INFO
("PM_EVT_CONN_SEC_CONFIG_REQ"); ;

1486 
PM_EVT_CONN_SEC_PARAMS_REQ
: 
	`NRF_LOG_INFO
("PM_EVT_CONN_SEC_PARAMS_REQ"); ;

1487 
PM_EVT_STORAGE_FULL
: 
	`NRF_LOG_INFO
("PM_EVT_STORAGE_FULL"); ;

1488 
PM_EVT_ERROR_UNEXPECTED
: 
	`NRF_LOG_INFO
("PM_EVT_ERROR_UNEXPECTED"); ;

1489 
PM_EVT_PEER_DATA_UPDATE_SUCCEEDED
: 
	`NRF_LOG_INFO
("PM_EVT_PEER_DATA_UPDATE_SUCCEEDED"); ;

1490 
PM_EVT_PEER_DATA_UPDATE_FAILED
: 
	`NRF_LOG_INFO
("PM_EVT_PEER_DATA_UPDATE_FAILED"); ;

1491 
PM_EVT_PEER_DELETE_SUCCEEDED
: 
	`NRF_LOG_INFO
("PM_EVT_PEER_DELETE_SUCCEEDED"); ;

1492 
PM_EVT_PEER_DELETE_FAILED
: 
	`NRF_LOG_INFO
("PM_EVT_PEER_DELETE_FAILED"); ;

1493 
PM_EVT_PEERS_DELETE_SUCCEEDED
: 
	`NRF_LOG_INFO
("PM_EVT_PEERS_DELETE_SUCCEEDED"); ;

1494 
PM_EVT_PEERS_DELETE_FAILED
: 
	`NRF_LOG_INFO
("PM_EVT_PEERS_DELETE_FAILED"); ;

1495 
PM_EVT_LOCAL_DB_CACHE_APPLIED
: 
	`NRF_LOG_INFO
("PM_EVT_LOCAL_DB_CACHE_APPLIED"); ;

1496 
PM_EVT_LOCAL_DB_CACHE_APPLY_FAILED
: 
	`NRF_LOG_INFO
("PM_EVT_LOCAL_DB_CACHE_APPLY_FAILED"); ;

1497 
PM_EVT_SERVICE_CHANGED_IND_SENT
: 
	`NRF_LOG_INFO
("PM_EVT_SERVICE_CHANGED_IND_SENT"); ;

1498 
PM_EVT_SERVICE_CHANGED_IND_CONFIRMED
: 
	`NRF_LOG_INFO
("PM_EVT_SERVICE_CHANGED_IND_CONFIRMED"); ;

1499 
PM_EVT_SLAVE_SECURITY_REQ
: 
	`NRF_LOG_INFO
("PM_EVT_SLAVE_SECURITY_REQ"); ;

1500 
PM_EVT_FLASH_GARBAGE_COLLECTED
: 
	`NRF_LOG_INFO
("PM_EVT_FLASH_GARBAGE_COLLECTED"); ;

1503 
p_evt
->
evt_id
)

1506 
PM_EVT_BONDED_PEER_CONNECTED
:

1508 
	`NRF_LOG_INFO
("P»v cÚ: %d", 
p_evt
->
³”_id
);

1510 
	`adv”tisšgProûssšg
(
ADV_PROC_START_CONNECT
, 
p_evt
->
cÚn_hªdË
,…_evt->
³”_id
);

1514 
PM_EVT_CONN_SEC_SUCCEEDED
:

1516 
	`NRF_LOG_INFO
("Connection secured:„ole: %d, conn_handle: 0x%x,…rocedure: %d.",

1517 
	`bË_cÚn_¡©e_rŞe
(
p_evt
->
cÚn_hªdË
),

1518 
p_evt
->
cÚn_hªdË
,

1519 
p_evt
->
·¿ms
.
cÚn_£c_sucûeded
.
´oûdu»
);

1522 
m_³”_id
 = 
p_evt
->
³”_id
;

1526 
PM_EVT_CONN_SEC_FAILED
:

1536 
PM_EVT_CONN_SEC_CONFIG_REQ
:

1539 
pm_cÚn_£c_cÚfig_t
 
cÚn_£c_cÚfig
 = {.
®low_»·œšg
 = 
çl£
};

1540 
	`pm_cÚn_£c_cÚfig_»¶y
(
p_evt
->
cÚn_hªdË
, &
cÚn_£c_cÚfig
);

1543 
PM_EVT_STORAGE_FULL
:

1546 
”r_code
 = 
	`fds_gc
();

1547 ià(
”r_code
 =ğ
FDS_ERR_BUSY
 ||ƒ¼_cod=ğ
FDS_ERR_NO_SPACE_IN_QUEUES
)

1553 
	`APP_ERROR_CHECK
(
”r_code
);

1557 
PM_EVT_PEERS_DELETE_SUCCEEDED
:

1559 
	`adv”tisšg_¡¬t
(
çl£
);

1562 
PM_EVT_LOCAL_DB_CACHE_APPLY_FAILED
:

1565 
	`pm_loÿl_d©aba£_has_chªged
();

1568 
PM_EVT_PEER_DATA_UPDATE_SUCCEEDED
:

1570 iàĞ
p_evt
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
æash_chªged


1571 && (
p_evt
->
·¿ms
.
³”_d©a_upd©e_sucûeded
.
d©a_id
 =ğ
PM_PEER_DATA_ID_BONDING
))

1573 
	`NRF_LOG_INFO
("New Bond,‡ddhe…eerohe whitelist if…ossible");

1574 
	`NRF_LOG_INFO
("\tm_whitelist_peer_cnt %d, MAX_PEERS_WLIST %d",

1575 
m_wh™–i¡_³”_út
 + 1,

1576 
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
);

1579 ià(
m_wh™–i¡_³”_út
 < 
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
)

1582 
m_wh™–i¡_³”s
[
m_wh™–i¡_³”_út
++] = 
m_³”_id
;

1585 
”r_code
 = 
	`pm_wh™–i¡_£t
(
m_wh™–i¡_³”s
, 
m_wh™–i¡_³”_út
);

1586 
	`APP_ERROR_CHECK
(
”r_code
);

1588 
”r_code
 = 
	`pm_deviû_id’t™›s_li¡_£t
(
m_wh™–i¡_³”s
, 
m_wh™–i¡_³”_út
);

1589 ià(
”r_code
 !ğ
NRF_ERROR_NOT_SUPPORTED
)

1591 
	`APP_ERROR_CHECK
(
”r_code
);

1597 
PM_EVT_PEER_DATA_UPDATE_FAILED
:

1600 
	`APP_ERROR_CHECK
(
p_evt
->
·¿ms
.
³”_d©a_upd©e_çed
.
”rÜ
);

1603 
PM_EVT_PEER_DELETE_FAILED
:

1606 
	`APP_ERROR_CHECK
(
p_evt
->
·¿ms
.
³”_d–‘e_çed
.
”rÜ
);

1609 
PM_EVT_PEERS_DELETE_FAILED
:

1612 
	`APP_ERROR_CHECK
(
p_evt
->
·¿ms
.
³”s_d–‘e_çed_evt
.
”rÜ
);

1615 
PM_EVT_ERROR_UNEXPECTED
:

1618 
	`APP_ERROR_CHECK
(
p_evt
->
·¿ms
.
”rÜ_uÃx³ùed
.
”rÜ
);

1621 
PM_EVT_CONN_SEC_START
:

1622 
PM_EVT_PEER_DELETE_SUCCEEDED
:

1623 
PM_EVT_LOCAL_DB_CACHE_APPLIED
:

1624 
PM_EVT_SERVICE_CHANGED_IND_SENT
:

1625 
PM_EVT_SERVICE_CHANGED_IND_CONFIRMED
:

1629 
	}
}

1639 
	$Ú_adv_evt
(
bË_adv_evt_t
 
bË_adv_evt
)

1641 
»t_code_t
 
”r_code
;

1643 
	`NRF_LOG_INFO
("ADV_EV %d", 
bË_adv_evt
);

1645 
bË_adv_evt
)

1647 
BLE_ADV_EVT_DIRECTED
:

1648 
	`NRF_LOG_INFO
("Directed‡dvertising.");

1649 
”r_code
 = 
	`b¥_šdiÿtiÚ_£t
(
BSP_INDICATE_ADVERTISING_DIRECTED
);

1650 
	`APP_ERROR_CHECK
(
”r_code
);

1653 
BLE_ADV_EVT_FAST
:

1655 
”r_code
 = 
	`b¥_šdiÿtiÚ_£t
(
BSP_INDICATE_ADVERTISING
);

1656 
	`APP_ERROR_CHECK
(
”r_code
);

1659 
BLE_ADV_EVT_SLOW
:

1660 
	`NRF_LOG_INFO
("Slow‡dvertising.");

1661 
”r_code
 = 
	`b¥_šdiÿtiÚ_£t
(
BSP_INDICATE_ADVERTISING_SLOW
);

1662 
	`APP_ERROR_CHECK
(
”r_code
);

1665 
BLE_ADV_EVT_FAST_WHITELIST
:

1666 
	`NRF_LOG_INFO
("Fast‡dvertising with whitelist.");

1667 
”r_code
 = 
	`b¥_šdiÿtiÚ_£t
(
BSP_INDICATE_ADVERTISING_WHITELIST
);

1668 
	`APP_ERROR_CHECK
(
”r_code
);

1671 
BLE_ADV_EVT_SLOW_WHITELIST
:

1672 
	`NRF_LOG_INFO
("Slow‡dvertising with whitelist.");

1673 
”r_code
 = 
	`b¥_šdiÿtiÚ_£t
(
BSP_INDICATE_ADVERTISING_WHITELIST
);

1674 
	`APP_ERROR_CHECK
(
”r_code
);

1675 
”r_code
 = 
	`bË_adv”tisšg_»¡¬t_w™hout_wh™–i¡
(&
m_adv”tisšg
);

1676 
	`APP_ERROR_CHECK
(
”r_code
);

1679 
BLE_ADV_EVT_IDLE
:

1680 
”r_code
 = 
	`b¥_šdiÿtiÚ_£t
(
BSP_INDICATE_IDLE
);

1681 
	`APP_ERROR_CHECK
(
”r_code
);

1684 
	`adv”tisšgProûssšg
(
ADV_PROC_STOP_ADV
, 0, 0);

1689 
BLE_ADV_EVT_WHITELIST_REQUEST
:

1691 
bË_g­_addr_t
 
wh™–i¡_addrs
[
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
];

1692 
bË_g­_œk_t
 
wh™–i¡_œks
[
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
];

1693 
ušt32_t
 
addr_út
 = 
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
;

1694 
ušt32_t
 
œk_út
 = 
BLE_GAP_WHITELIST_ADDR_MAX_COUNT
;

1696 
”r_code
 = 
	`pm_wh™–i¡_g‘
(
wh™–i¡_addrs
, &
addr_út
,

1697 
wh™–i¡_œks
, &
œk_út
);

1698 
	`APP_ERROR_CHECK
(
”r_code
);

1699 
	`NRF_LOG_INFO
("pm_whitelist_get„eturns %d‡ddr in whitelist‡nd %d irk whitelist",

1700 
addr_út
,

1701 
œk_út
);

1704 
”r_code
 = 
	`bË_adv”tisšg_wh™–i¡_»¶y
(&
m_adv”tisšg
,

1705 
wh™–i¡_addrs
,

1706 
addr_út
,

1707 
wh™–i¡_œks
,

1708 
œk_út
);

1709 
	`APP_ERROR_CHECK
(
”r_code
);

1713 
BLE_ADV_EVT_PEER_ADDR_REQUEST
:

1715 
pm_³”_d©a_bÚdšg_t
 
³”_bÚdšg_d©a
;

1716 
	`NRF_LOG_INFO
("Dir_next");

1719 ià(
m_³”_id
 !ğ
PM_PEER_ID_INVALID
)

1722 
”r_code
 = 
	`pm_³”_d©a_bÚdšg_lßd
(
m_³”_id
, &
³”_bÚdšg_d©a
);

1723 ià(
”r_code
 !ğ
NRF_ERROR_NOT_FOUND
)

1725 
	`APP_ERROR_CHECK
(
”r_code
);

1727 
bË_g­_addr_t
 * 
p_³”_addr
 = &(
³”_bÚdšg_d©a
.
³”_bË_id
.
id_addr_šfo
);

1728 
”r_code
 = 
	`bË_adv”tisšg_³”_addr_»¶y
(&
m_adv”tisšg
, 
p_³”_addr
);

1729 
	`APP_ERROR_CHECK
(
”r_code
);

1739 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\examples\ble_peripheral\ble_app_hids_mouse\pca10056\s140\armgcc\ble_app_hids_mouse_gcc_nrf52.ld

3 
	$SEARCH_DIR
(.)

4 
	`GROUP
(-
lgcc
 -
lc
 -
Êosys
)

6 
MEMORY


8 
	`FLASH
 (
rx
è: 
ORIGIN
 = 0x22000, 
LENGTH
 = 0xde000

9 
	`RAM
 (
rwx
è: 
ORIGIN
 = 0x20002088, 
LENGTH
 = 0x3df78

11 
	}
}

13 
	gSECTIONS


17 
	gSECTIONS


19 . = 
ALIGN
(4);

20 .
	gmem_£ùiÚ_dummy_¿m
 :

23 .
log_dyÇmic_d©a
 :

25 
PROVIDE
(
__¡¬t_log_dyÇmic_d©a
 = .);

26 
KEEP
(*(
SORT
(.
log_dyÇmic_d©a
*)))

27 
PROVIDE
(
__¡İ_log_dyÇmic_d©a
 = .);

28 } > 
	gRAM


29 .
	gfs_d©a
 :

31 
PROVIDE
(
__¡¬t_fs_d©a
 = .);

32 
KEEP
(*(.
fs_d©a
))

33 
PROVIDE
(
__¡İ_fs_d©a
 = .);

34 } > 
	gRAM


35 .
	gşi_sÜ‹d_cmd_±rs
 :

37 
PROVIDE
(
__¡¬t_şi_sÜ‹d_cmd_±rs
 = .);

38 
KEEP
(*(.
şi_sÜ‹d_cmd_±rs
))

39 
PROVIDE
(
__¡İ_şi_sÜ‹d_cmd_±rs
 = .);

40 } > 
	gRAM


42 } 
INSERT
 
	gAFTER
 .
	gd©a
;

44 
	gSECTIONS


46 .
	gmem_£ùiÚ_dummy_rom
 :

49 .
sdh_soc_ob£rv”s
 :

51 
PROVIDE
(
__¡¬t_sdh_soc_ob£rv”s
 = .);

52 
KEEP
(*(
SORT
(.
sdh_soc_ob£rv”s
*)))

53 
PROVIDE
(
__¡İ_sdh_soc_ob£rv”s
 = .);

54 } > 
	gFLASH


55 .
	gpwr_mgmt_d©a
 :

57 
PROVIDE
(
__¡¬t_pwr_mgmt_d©a
 = .);

58 
KEEP
(*(
SORT
(.
pwr_mgmt_d©a
*)))

59 
PROVIDE
(
__¡İ_pwr_mgmt_d©a
 = .);

60 } > 
	gFLASH


61 .
	gsdh_bË_ob£rv”s
 :

63 
PROVIDE
(
__¡¬t_sdh_bË_ob£rv”s
 = .);

64 
KEEP
(*(
SORT
(.
sdh_bË_ob£rv”s
*)))

65 
PROVIDE
(
__¡İ_sdh_bË_ob£rv”s
 = .);

66 } > 
	gFLASH


67 .
	glog_cÚ¡_d©a
 :

69 
PROVIDE
(
__¡¬t_log_cÚ¡_d©a
 = .);

70 
KEEP
(*(
SORT
(.
log_cÚ¡_d©a
*)))

71 
PROVIDE
(
__¡İ_log_cÚ¡_d©a
 = .);

72 } > 
	gFLASH


73 .
	gsdh_»q_ob£rv”s
 :

75 
PROVIDE
(
__¡¬t_sdh_»q_ob£rv”s
 = .);

76 
KEEP
(*(
SORT
(.
sdh_»q_ob£rv”s
*)))

77 
PROVIDE
(
__¡İ_sdh_»q_ob£rv”s
 = .);

78 } > 
	gFLASH


79 .
	gsdh_¡©e_ob£rv”s
 :

81 
PROVIDE
(
__¡¬t_sdh_¡©e_ob£rv”s
 = .);

82 
KEEP
(*(
SORT
(.
sdh_¡©e_ob£rv”s
*)))

83 
PROVIDE
(
__¡İ_sdh_¡©e_ob£rv”s
 = .);

84 } > 
	gFLASH


85 .
	gsdh_¡ack_ob£rv”s
 :

87 
PROVIDE
(
__¡¬t_sdh_¡ack_ob£rv”s
 = .);

88 
KEEP
(*(
SORT
(.
sdh_¡ack_ob£rv”s
*)))

89 
PROVIDE
(
__¡İ_sdh_¡ack_ob£rv”s
 = .);

90 } > 
	gFLASH


91 .
	gşi_commªd
 :

93 
PROVIDE
(
__¡¬t_şi_commªd
 = .);

94 
KEEP
(*(.
şi_commªd
))

95 
PROVIDE
(
__¡İ_şi_commªd
 = .);

96 } > 
	gFLASH


99 } 
INSERT
 
	gAFTER
 .
‹xt


101 
	gINCLUDE
 "nrf5x_common.ld"

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\external\fprintf\nrf_fprintf.c

40 
	~"sdk_commÚ.h
"

41 #ià
NRF_MODULE_ENABLED
(
NRF_FPRINTF
)

42 
	~<¡d¬g.h
>

44 
	~"Äf_as£¹.h
"

45 
	~"Äf_årštf_fÜm©.h
"

47 
	$Äf_årštf_bufãr_æush
(
Äf_årštf_ùx_t
 * cÚ¡ 
p_ùx
)

49 
	`ASSERT
(
p_ùx
 !ğ
NULL
);

51 ià(
p_ùx
->
io_bufãr_út
 == 0)

56 
p_ùx
->
	`fwr™e
Õ_ùx->
p_u£r_ùx
,

57 
p_ùx
->
p_io_bufãr
,

58 
p_ùx
->
io_bufãr_út
);

59 
p_ùx
->
io_bufãr_út
 = 0;

60 
	}
}

62 
	$Äf_årštf
(
Äf_årštf_ùx_t
 * cÚ¡ 
p_ùx
,

63 cÚ¡ * 
p_fmt
,

66 
	`ASSERT
(
p_ùx
 !ğ
NULL
);

67 
	`ASSERT
(
p_ùx
->
fwr™e
 !ğ
NULL
);

68 
	`ASSERT
(
p_ùx
->
p_io_bufãr
 !ğ
NULL
);

69 
	`ASSERT
(
p_ùx
->
io_bufãr_size
 > 0);

71 ià(
p_fmt
 =ğ
NULL
)

76 
va_li¡
 
¬gs
 = {0};

77 
	`va_¡¬t
(
¬gs
, 
p_fmt
);

79 
	`Äf_årštf_fmt
(
p_ùx
, 
p_fmt
, &
¬gs
);

81 
	`va_’d
(
¬gs
);

82 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\external\fprintf\nrf_fprintf_format.c

59 
	~"sdk_commÚ.h
"

60 #ià
NRF_MODULE_ENABLED
(
NRF_FPRINTF
)

62 
	~<¡d¬g.h
>

64 
	~"Äf_as£¹.h
"

65 
	~"Äf_årštf.h
"

66 
	~"Äf_årštf_fÜm©.h
"

68 
	#NRF_CLI_FORMAT_FLAG_LEFT_JUSTIFY
 (1u << 0)

	)

69 
	#NRF_CLI_FORMAT_FLAG_PAD_ZERO
 (1u << 1)

	)

70 
	#NRF_CLI_FORMAT_FLAG_PRINT_SIGN
 (1u << 2)

	)

72 
	$bufãr_add
(
Äf_årštf_ùx_t
 * cÚ¡ 
p_ùx
, 
c
)

74 
p_ùx
->
p_io_bufãr
[p_ùx->
io_bufãr_út
++] = 
c
;

76 ià(
p_ùx
->
io_bufãr_út
 >ğp_ùx->
io_bufãr_size
)

78 
	`Äf_årštf_bufãr_æush
(
p_ùx
);

80 
	}
}

82 
	$¡ršg_´št
(
Äf_årštf_ùx_t
 * cÚ¡ 
p_ùx
,

83 cÚ¡ * 
p_¡r
,

84 
ušt32_t
 
F›ldWidth
,

85 
ušt32_t
 
FÜm©FÏgs
)

87 
ušt32_t
 
Width
 = 0;

88 
c
;

90 ià((
FÜm©FÏgs
 & 
NRF_CLI_FORMAT_FLAG_LEFT_JUSTIFY
) == NRF_CLI_FORMAT_FLAG_LEFT_JUSTIFY)

92 (
c
 = *
p_¡r
) != '\0')

94 
p_¡r
++;

95 
Width
++;

96 
	`bufãr_add
(
p_ùx
, 
c
);

99 (
F›ldWidth
 > 
Width
) && (FieldWidth > 0))

101 
F›ldWidth
--;

102 
	`bufãr_add
(
p_ùx
, ' ');

107 ià(
p_¡r
 != 0)

109 
Width
 = 
	`¡¾’
(
p_¡r
);

112 (
F›ldWidth
 > 
Width
) && (FieldWidth > 0))

114 
F›ldWidth
--;

115 
	`bufãr_add
(
p_ùx
, ' ');

118 (
c
 = *
p_¡r
) != '\0')

120 
p_¡r
++;

121 
Width
++;

122 
	`bufãr_add
(
p_ùx
, 
c
);

125 
	}
}

127 
	$unsigÃd_´št
(
Äf_årštf_ùx_t
 * cÚ¡ 
p_ùx
,

128 
ušt32_t
 
v
,

129 
ušt32_t
 
Ba£
,

130 
ušt32_t
 
NumDig™s
,

131 
ušt32_t
 
F›ldWidth
,

132 
ušt32_t
 
FÜm©FÏgs
)

134 cÚ¡ 
_aV2C
[16] = {'0', '1', '2', '3', '4', '5', '6', '7', '8', '9',

136 
ušt32_t
 
Div
;

137 
ušt32_t
 
V®ue
;

138 
ušt32_t
 
Width
;

139 
c
;

141 
V®ue
 = 
v
;

145 
Width
 = 1u;

146 
V®ue
 >ğ
Ba£
)

148 
V®ue
 = (V®u/ 
Ba£
);

149 
Width
++;

151 ià(
NumDig™s
 > 
Width
)

153 
Width
 = 
NumDig™s
;

158 ià((
FÜm©FÏgs
 & 
NRF_CLI_FORMAT_FLAG_LEFT_JUSTIFY
) == 0u)

160 ià(
F›ldWidth
 != 0u)

162 ià(((
FÜm©FÏgs
 & 
NRF_CLI_FORMAT_FLAG_PAD_ZERO
) == NRF_CLI_FORMAT_FLAG_PAD_ZERO) &&

163 (
NumDig™s
 == 0u))

165 
c
 = '0';

169 
c
 = ' ';

171 (
F›ldWidth
 !ğ0uè&& (
Width
 < FieldWidth))

173 
F›ldWidth
--;

174 
	`bufãr_add
(
p_ùx
, 
c
);

179 
V®ue
 = 1;

191 ià(
NumDig™s
 > 1u)

193 
NumDig™s
--;

197 
Div
 = 
v
 / 
V®ue
;

199 ià(
Div
 < 
Ba£
)

204 
V®ue
 *ğ
Ba£
;

211 
Div
 = 
v
 / 
V®ue
;

212 
v
 -ğ
Div
 * 
V®ue
;

213 
	`bufãr_add
(
p_ùx
, 
_aV2C
[
Div
]);

214 
V®ue
 /ğ
Ba£
;

215 } 
V®ue
);

219 ià((
FÜm©FÏgs
 & 
NRF_CLI_FORMAT_FLAG_LEFT_JUSTIFY
) == NRF_CLI_FORMAT_FLAG_LEFT_JUSTIFY)

221 ià(
F›ldWidth
 != 0u)

223 (
F›ldWidth
 !ğ0uè&& (
Width
 < FieldWidth))

225 
F›ldWidth
--;

226 
	`bufãr_add
(
p_ùx
, ' ');

230 
	}
}

232 
	$št_´št
(
Äf_årštf_ùx_t
 * cÚ¡ 
p_ùx
,

233 
št32_t
 
v
,

234 
ušt32_t
 
Ba£
,

235 
ušt32_t
 
NumDig™s
,

236 
ušt32_t
 
F›ldWidth
,

237 
ušt32_t
 
FÜm©FÏgs
)

239 
ušt32_t
 
Width
;

240 
št32_t
 
Numb”
;

242 
Numb”
 = (
v
 < 0) ? -v : v;

247 
Width
 = 1u;

248 
Numb”
 >ğ(
št32_t
)
Ba£
)

250 
Numb”
 = (Numb” / (
št32_t
)
Ba£
);

251 
Width
++;

253 ià(
NumDig™s
 > 
Width
)

255 
Width
 = 
NumDig™s
;

257 ià((
F›ldWidth
 > 0uè&& ((
v
 < 0) ||

258 ((
FÜm©FÏgs
 & 
NRF_CLI_FORMAT_FLAG_PRINT_SIGN
) == NRF_CLI_FORMAT_FLAG_PRINT_SIGN)))

260 
F›ldWidth
--;

265 ià((((
FÜm©FÏgs
 & 
NRF_CLI_FORMAT_FLAG_PAD_ZERO
è=ğ0uè|| (
NumDig™s
 != 0u)) &&

266 ((
FÜm©FÏgs
 & 
NRF_CLI_FORMAT_FLAG_LEFT_JUSTIFY
) == 0u))

268 ià(
F›ldWidth
 != 0u)

270 (
F›ldWidth
 !ğ0uè&& (
Width
 < FieldWidth))

272 
F›ldWidth
--;

273 
	`bufãr_add
(
p_ùx
, ' ');

280 ià(
v
 < 0)

282 
v
 = -v;

283 
	`bufãr_add
(
p_ùx
, '-');

285 ià((
FÜm©FÏgs
 & 
NRF_CLI_FORMAT_FLAG_PRINT_SIGN
) == NRF_CLI_FORMAT_FLAG_PRINT_SIGN)

287 
	`bufãr_add
(
p_ùx
, '+');

296 ià(((
FÜm©FÏgs
 & 
NRF_CLI_FORMAT_FLAG_PAD_ZERO
) == NRF_CLI_FORMAT_FLAG_PAD_ZERO) &&

297 ((
FÜm©FÏgs
 & 
NRF_CLI_FORMAT_FLAG_LEFT_JUSTIFY
è=ğ0uè&& (
NumDig™s
 == 0u))

299 ià(
F›ldWidth
 != 0u)

301 (
F›ldWidth
 !ğ0uè&& (
Width
 < FieldWidth))

303 
F›ldWidth
--;

304 
	`bufãr_add
(
p_ùx
, '0');

311 
	`unsigÃd_´št
(
p_ùx
, (
ušt32_t
)
v
, 
Ba£
, 
NumDig™s
, 
F›ldWidth
, 
FÜm©FÏgs
);

312 
	}
}

314 
	$Äf_årštf_fmt
(
Äf_årštf_ùx_t
 * cÚ¡ 
p_ùx
,

315 cÚ¡ * 
p_fmt
,

316 
va_li¡
 * 
p_¬gs
)

318 
	`ASSERT
(
p_ùx
 !ğ
NULL
);

320 
	`ASSERT
(
p_ùx
->
fwr™e
 !ğ
NULL
);

321 
	`ASSERT
(
p_ùx
->
p_io_bufãr
 !ğ
NULL
);

322 
	`ASSERT
(
p_ùx
->
io_bufãr_size
 > 0);

324 ià(
p_fmt
 =ğ
NULL
)

329 
c
;

330 
št32_t
 
v
;

331 
ušt32_t
 
NumDig™s
;

332 
ušt32_t
 
FÜm©FÏgs
;

333 
ušt32_t
 
F›ldWidth
;

337 
c
 = *
p_fmt
;

338 
p_fmt
++;

340 ià(
c
 == 0u)

344 ià(
c
 == '%')

349 
FÜm©FÏgs
 = 0u;

350 
v
 = 1;

354 
c
 = *
p_fmt
;

355 
c
)

358 
FÜm©FÏgs
 |ğ
NRF_CLI_FORMAT_FLAG_LEFT_JUSTIFY
;

359 
p_fmt
++;

362 
FÜm©FÏgs
 |ğ
NRF_CLI_FORMAT_FLAG_PAD_ZERO
;

363 
p_fmt
++;

366 
FÜm©FÏgs
 |ğ
NRF_CLI_FORMAT_FLAG_PRINT_SIGN
;

367 
p_fmt
++;

370 
v
 = 0;

373 } 
v
);

378 
F›ldWidth
 = 0u;

381 ià(
c
 == '*')

384 
F›ldWidth
 +ğ
	`va_¬g
(*
p_¬gs
, );

386 
p_fmt
++;

389 
c
 = *
p_fmt
;

390 ià((
c
 < '0') || (c > '9'))

394 
p_fmt
++;

395 
F›ldWidth
 = (F›ldWidth * 10uè+ (
c
 - '0');

401 
NumDig™s
 = 0u;

402 
c
 = *
p_fmt
;

403 ià(
c
 == '.')

405 
p_fmt
++;

408 
c
 = *
p_fmt
;

409 ià((
c
 < '0') || (c > '9'))

413 
p_fmt
++;

414 
NumDig™s
 = NumDig™ * 10u + (
c
 - '0');

420 
c
 = *
p_fmt
;

423 ià((
c
 == 'l') || (c == 'h'))

425 
p_fmt
++;

426 
c
 = *
p_fmt
;

437 
c
)

441 
c0
;

442 
v
 = 
	`va_¬g
(*
p_¬gs
, 
št32_t
);

443 
c0
 = ()
v
;

444 
	`bufãr_add
(
p_ùx
, 
c0
);

449 
v
 = 
	`va_¬g
(*
p_¬gs
, 
št32_t
);

450 
	`št_´št
(
p_ùx
,

451 
v
,

453 
NumDig™s
,

454 
F›ldWidth
,

455 
FÜm©FÏgs
);

458 
v
 = 
	`va_¬g
(*
p_¬gs
, 
št32_t
);

459 
	`unsigÃd_´št
(
p_ùx
,

460 (
ušt32_t
)
v
,

462 
NumDig™s
,

463 
F›ldWidth
,

464 
FÜm©FÏgs
);

468 
v
 = 
	`va_¬g
(*
p_¬gs
, 
št32_t
);

469 
	`unsigÃd_´št
(
p_ùx
,

470 (
ušt32_t
)
v
,

472 
NumDig™s
,

473 
F›ldWidth
,

474 
FÜm©FÏgs
);

478 cÚ¡ * 
p_s
 = 
	`va_¬g
(*
p_¬gs
, const *);

479 
	`¡ršg_´št
(
p_ùx
, 
p_s
, 
F›ldWidth
, 
FÜm©FÏgs
);

483 
v
 = 
	`va_¬g
(*
p_¬gs
, 
št32_t
);

484 
	`bufãr_add
(
p_ùx
, '0');

485 
	`bufãr_add
(
p_ùx
, 'x');

486 
	`unsigÃd_´št
(
p_ùx
, (
ušt32_t
)
v
, 16u, 8u, 8u, 0);

489 
	`bufãr_add
(
p_ùx
, '%');

495 
p_fmt
++;

499 
	`bufãr_add
(
p_ùx
, 
c
);

501 } *
p_fmt
 != '\0');

503 ià(
p_ùx
->
auto_æush
)

505 
	`Äf_årštf_bufãr_æush
(
p_ùx
);

507 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\external\segger_rtt\SEGGER_RTT.c

86 
	~"SEGGER_RTT.h
"

88 
	~<¡ršg.h
>

97 #iâdeà 
BUFFER_SIZE_UP


98 
	#BUFFER_SIZE_UP
 1024

100 

	)

101 #iâdeà 
BUFFER_SIZE_DOWN


102 
	#BUFFER_SIZE_DOWN
 16

104 

	)

105 #iâdeà 
SEGGER_RTT_MAX_NUM_UP_BUFFERS


106 
	#SEGGER_RTT_MAX_NUM_UP_BUFFERS
 2

108 

	)

109 #iâdeà 
SEGGER_RTT_MAX_NUM_DOWN_BUFFERS


110 
	#SEGGER_RTT_MAX_NUM_DOWN_BUFFERS
 2

112 

	)

113 #iâdeà
SEGGER_RTT_BUFFER_SECTION


114 #ià
defšed
(
SEGGER_RTT_SECTION
)

115 
	#SEGGER_RTT_BUFFER_SECTION
 
SEGGER_RTT_SECTION


	)

119 #iâdeà 
SEGGER_RTT_ALIGNMENT


120 
	#SEGGER_RTT_ALIGNMENT
 0

	)

123 #iâdeà 
SEGGER_RTT_BUFFER_ALIGNMENT


124 
	#SEGGER_RTT_BUFFER_ALIGNMENT
 0

	)

127 #iâdeà 
SEGGER_RTT_MODE_DEFAULT


128 
	#SEGGER_RTT_MODE_DEFAULT
 
SEGGER_RTT_MODE_NO_BLOCK_SKIP


	)

131 #iâdeà 
SEGGER_RTT_LOCK


132 
	#SEGGER_RTT_LOCK
()

	)

135 #iâdeà 
SEGGER_RTT_UNLOCK


136 
	#SEGGER_RTT_UNLOCK
()

	)

139 #iâdeà 
STRLEN


140 
	#STRLEN
(
a
è
	`¡¾’
(×))

	)

143 #iâdeà 
SEGGER_RTT_MEMCPY_USE_BYTELOOP


144 
	#SEGGER_RTT_MEMCPY_USE_BYTELOOP
 0

	)

147 #iâdeà 
SEGGER_RTT_MEMCPY


148 #ifdeà 
MEMCPY


149 
	#SEGGER_RTT_MEMCPY
(
pDe¡
, 
pSrc
, 
NumBy‹s
è
	`MEMCPY
(ÕDe¡), (pSrc), (NumBy‹s))

	)

151 
	#SEGGER_RTT_MEMCPY
(
pDe¡
, 
pSrc
, 
NumBy‹s
è
	`memıy
(ÕDe¡), (pSrc), (NumBy‹s))

	)

155 #iâdeà 
MIN


156 
	#MIN
(
a
, 
b
è((×è< (b)è? (aè: (b))

	)

159 #iâdeà 
MAX


160 
	#MAX
(
a
, 
b
è((×è> (b)è? (aè: (b))

	)

165 #iâdeà
NULL


166 
	#NULL
 0

	)

175 #ià(
defšed
 
__ICCARM__
è|| (defšed 
__ICCRX__
)

176 
	#RTT_PRAGMA
(
P
è
	`_P¿gma
(#P)

	)

179 #ià
SEGGER_RTT_ALIGNMENT
 || 
SEGGER_RTT_BUFFER_ALIGNMENT


180 #ià(
defšed
 
__GNUC__
)

181 
	#SEGGER_RTT_ALIGN
(
V¬
, 
Alignm’t
èV¬ 
	`__©Œibu‹__
 ((
	`®igÃd
 (Alignm’t)))

	)

182 #–ià(
defšed
 
__ICCARM__
è|| (defšed 
__ICCRX__
)

183 
	#PRAGMA
(
A
è
	`_P¿gma
(#A)

	)

184 
	#SEGGER_RTT_ALIGN
(
V¬
, 
Alignm’t
è
	`RTT_PRAGMA
(
d©a_®ignm’t
=Alignment) \

185 
V¬


	)

186 #–ià(
defšed
 
__CC_ARM
)

187 
	#SEGGER_RTT_ALIGN
(
V¬
, 
Alignm’t
èV¬ 
	`__©Œibu‹__
 ((
	`®igÃd
 (Alignm’t)))

	)

192 
	#SEGGER_RTT_ALIGN
(
V¬
, 
Alignm’t
è
	)
Var

195 #ià
defšed
(
SEGGER_RTT_SECTION
è|| defšed (
SEGGER_RTT_BUFFER_SECTION
)

196 #ià(
defšed
 
__GNUC__
)

197 
	#SEGGER_RTT_PUT_SECTION
(
V¬
, 
SeùiÚ
è
	`__©Œibu‹__
 ((
	`£ùiÚ
 (SeùiÚ))è
	)
Var

198 #–ià(
defšed
 
__ICCARM__
è|| (defšed 
__ICCRX__
)

199 
	#SEGGER_RTT_PUT_SECTION
(
V¬
, 
SeùiÚ
è
	`RTT_PRAGMA
(
loÿtiÚ
=Section) \

200 
V¬


	)

201 #–ià(
defšed
 
__CC_ARM
)

202 
	#SEGGER_RTT_PUT_SECTION
(
V¬
, 
SeùiÚ
è
	`__©Œibu‹__
 ((
	`£ùiÚ
 (SeùiÚ), 
z”o_š™
)è
	)
Var

207 
	#SEGGER_RTT_PUT_SECTION
(
V¬
, 
SeùiÚ
è
	)
Var

211 #ià
SEGGER_RTT_ALIGNMENT


212 
	#SEGGER_RTT_CB_ALIGN
(
V¬
è
	`SEGGER_RTT_ALIGN
(V¬, 
SEGGER_RTT_ALIGNMENT
)

	)

214 
	#SEGGER_RTT_CB_ALIGN
(
V¬
è
	)
Var

217 #ià
SEGGER_RTT_BUFFER_ALIGNMENT


218 
	#SEGGER_RTT_BUFFER_ALIGN
(
V¬
è
	`SEGGER_RTT_ALIGN
(V¬, 
SEGGER_RTT_BUFFER_ALIGNMENT
)

	)

220 
	#SEGGER_RTT_BUFFER_ALIGN
(
V¬
è
	)
Var

224 #ià
defšed
(
SEGGER_RTT_SECTION
)

225 
	#SEGGER_RTT_PUT_CB_SECTION
(
V¬
è
	`SEGGER_RTT_PUT_SECTION
(V¬, 
SEGGER_RTT_SECTION
)

	)

227 
	#SEGGER_RTT_PUT_CB_SECTION
(
V¬
è
	)
Var

230 #ià
defšed
(
SEGGER_RTT_BUFFER_SECTION
)

231 
	#SEGGER_RTT_PUT_BUFFER_SECTION
(
V¬
è
	`SEGGER_RTT_PUT_SECTION
(V¬, 
SEGGER_RTT_BUFFER_SECTION
)

	)

233 
	#SEGGER_RTT_PUT_BUFFER_SECTION
(
V¬
è
	)
Var

243 
	g_aT”mš®Id
[16] = { '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F' };

254 
SEGGER_RTT_PUT_CB_SECTION
(
SEGGER_RTT_CB_ALIGN
(
SEGGER_RTT_CB
 
_SEGGER_RTT
));

256 
SEGGER_RTT_PUT_BUFFER_SECTION
(
SEGGER_RTT_BUFFER_ALIGN
(
_acUpBufãr
 [
BUFFER_SIZE_UP
]));

257 
SEGGER_RTT_PUT_BUFFER_SECTION
(
SEGGER_RTT_BUFFER_ALIGN
(
_acDownBufãr
[
BUFFER_SIZE_DOWN
]));

259 
	g_AùiveT”mš®
;

277 
	#INIT
() do { \

278 ià(
_SEGGER_RTT
.
acID
[0] =ğ'\0'è{ 
	`_DoIn™
(); } \

279 } 0)

	)

280 
	$_DoIn™
() {

281 
SEGGER_RTT_CB
* 
p
;

285 
p
 = &
_SEGGER_RTT
;

286 
p
->
MaxNumUpBufãrs
 = 
SEGGER_RTT_MAX_NUM_UP_BUFFERS
;

287 
p
->
MaxNumDownBufãrs
 = 
SEGGER_RTT_MAX_NUM_DOWN_BUFFERS
;

291 
p
->
aUp
[0].
sName
 = "Terminal";

292 
p
->
aUp
[0].
pBufãr
 = 
_acUpBufãr
;

293 
p
->
aUp
[0].
SizeOfBufãr
 = (
_acUpBufãr
);

294 
p
->
aUp
[0].
RdOff
 = 0u;

295 
p
->
aUp
[0].
WrOff
 = 0u;

296 
p
->
aUp
[0].
FÏgs
 = 
SEGGER_RTT_MODE_DEFAULT
;

300 
p
->
aDown
[0].
sName
 = "Terminal";

301 
p
->
aDown
[0].
pBufãr
 = 
_acDownBufãr
;

302 
p
->
aDown
[0].
SizeOfBufãr
 = (
_acDownBufãr
);

303 
p
->
aDown
[0].
RdOff
 = 0u;

304 
p
->
aDown
[0].
WrOff
 = 0u;

305 
p
->
aDown
[0].
FÏgs
 = 
SEGGER_RTT_MODE_DEFAULT
;

311 
	`¡rıy
(&
p
->
acID
[7], "RTT");

312 
	`¡rıy
(&
p
->
acID
[0], "SEGGER");

313 
p
->
acID
[6] = ' ';

314 
	}
}

335 
	$_Wr™eBlockšg
(
SEGGER_RTT_BUFFER_UP
* 
pRšg
, cÚ¡ * 
pBufãr
, 
NumBy‹s
) {

336 
NumBy‹sToWr™e
;

337 
NumBy‹sWr™‹n
;

338 
RdOff
;

339 
WrOff
;

340 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


341 * 
pD¡
;

346 
NumBy‹sWr™‹n
 = 0u;

347 
WrOff
 = 
pRšg
->WrOff;

349 
RdOff
 = 
pRšg
->RdOff;

350 ià(
RdOff
 > 
WrOff
) {

351 
NumBy‹sToWr™e
 = 
RdOff
 - 
WrOff
 - 1u;

353 
NumBy‹sToWr™e
 = 
pRšg
->
SizeOfBufãr
 - (
WrOff
 - 
RdOff
 + 1u);

355 
NumBy‹sToWr™e
 = 
	`MIN
(NumBy‹sToWr™e, (
pRšg
->
SizeOfBufãr
 - 
WrOff
));

356 
NumBy‹sToWr™e
 = 
	`MIN
(NumBy‹sToWr™e, 
NumBy‹s
);

357 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


358 
pD¡
 = 
pRšg
->
pBufãr
 + 
WrOff
;

359 
NumBy‹sWr™‹n
 +ğ
NumBy‹sToWr™e
;

360 
NumBy‹s
 -ğ
NumBy‹sToWr™e
;

361 
WrOff
 +ğ
NumBy‹sToWr™e
;

362 
NumBy‹sToWr™e
--) {

363 *
pD¡
++ = *
pBufãr
++;

366 
	`SEGGER_RTT_MEMCPY
(
pRšg
->
pBufãr
 + 
WrOff
,…Bufãr, 
NumBy‹sToWr™e
);

367 
NumBy‹sWr™‹n
 +ğ
NumBy‹sToWr™e
;

368 
pBufãr
 +ğ
NumBy‹sToWr™e
;

369 
NumBy‹s
 -ğ
NumBy‹sToWr™e
;

370 
WrOff
 +ğ
NumBy‹sToWr™e
;

372 ià(
WrOff
 =ğ
pRšg
->
SizeOfBufãr
) {

373 
WrOff
 = 0u;

375 
pRšg
->
WrOff
 = WrOff;

376 } 
NumBy‹s
);

378  
NumBy‹sWr™‹n
;

379 
	}
}

399 
	$_Wr™eNoCheck
(
SEGGER_RTT_BUFFER_UP
* 
pRšg
, cÚ¡ * 
pD©a
, 
NumBy‹s
) {

400 
NumBy‹sAtOnû
;

401 
WrOff
;

402 
Rem
;

403 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


404 * 
pD¡
;

407 
WrOff
 = 
pRšg
->WrOff;

408 
Rem
 = 
pRšg
->
SizeOfBufãr
 - 
WrOff
;

409 ià(
Rem
 > 
NumBy‹s
) {

413 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


414 
pD¡
 = 
pRšg
->
pBufãr
 + 
WrOff
;

415 
WrOff
 +ğ
NumBy‹s
;

416 
NumBy‹s
--) {

417 *
pD¡
++ = *
pD©a
++;

419 
pRšg
->
WrOff
 = WrOff;

421 
	`SEGGER_RTT_MEMCPY
(
pRšg
->
pBufãr
 + 
WrOff
, 
pD©a
, 
NumBy‹s
);

422 
pRšg
->
WrOff
 = WrOfà+ 
NumBy‹s
;

428 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


429 
pD¡
 = 
pRšg
->
pBufãr
 + 
WrOff
;

430 
NumBy‹sAtOnû
 = 
Rem
;

431 
NumBy‹sAtOnû
--) {

432 *
pD¡
++ = *
pD©a
++;

434 
pD¡
 = 
pRšg
->
pBufãr
;

435 
NumBy‹sAtOnû
 = 
NumBy‹s
 - 
Rem
;

436 
NumBy‹sAtOnû
--) {

437 *
pD¡
++ = *
pD©a
++;

439 
pRšg
->
WrOff
 = 
NumBy‹s
 - 
Rem
;

441 
NumBy‹sAtOnû
 = 
Rem
;

442 
	`SEGGER_RTT_MEMCPY
(
pRšg
->
pBufãr
 + 
WrOff
, 
pD©a
, 
NumBy‹sAtOnû
);

443 
NumBy‹sAtOnû
 = 
NumBy‹s
 - 
Rem
;

444 
	`SEGGER_RTT_MEMCPY
(
pRšg
->
pBufãr
, 
pD©a
 + 
Rem
, 
NumBy‹sAtOnû
);

445 
pRšg
->
WrOff
 = 
NumBy‹sAtOnû
;

448 
	}
}

463 
	$_Po¡T”mš®Sw™ch
(
SEGGER_RTT_BUFFER_UP
* 
pRšg
, 
T”mš®Id
) {

464 
ac
[2];

466 
ac
[0] = 0xFFu;

467 
ac
[1] = 
_aT”mš®Id
[
T”mš®Id
];

468 
	`_Wr™eBlockšg
(
pRšg
, 
ac
, 2u);

469 
	}
}

485 
	$_G‘AvaWr™eS·û
(
SEGGER_RTT_BUFFER_UP
* 
pRšg
) {

486 
RdOff
;

487 
WrOff
;

488 
r
;

493 
RdOff
 = 
pRšg
->RdOff;

494 
WrOff
 = 
pRšg
->WrOff;

495 ià(
RdOff
 <ğ
WrOff
) {

496 
r
 = 
pRšg
->
SizeOfBufãr
 - 1u - 
WrOff
 + 
RdOff
;

498 
r
 = 
RdOff
 - 
WrOff
 - 1u;

500  
r
;

501 
	}
}

526 
	$SEGGER_RTT_R—dNoLock
(
BufãrIndex
, * 
pD©a
, 
BufãrSize
) {

527 
NumBy‹sRem
;

528 
NumBy‹sR—d
;

529 
RdOff
;

530 
WrOff
;

531 * 
pBufãr
;

532 
SEGGER_RTT_BUFFER_DOWN
* 
pRšg
;

533 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


534 cÚ¡ * 
pSrc
;

537 
	`INIT
();

538 
pRšg
 = &
_SEGGER_RTT
.
aDown
[
BufãrIndex
];

539 
pBufãr
 = (*)
pD©a
;

540 
RdOff
 = 
pRšg
->RdOff;

541 
WrOff
 = 
pRšg
->WrOff;

542 
NumBy‹sR—d
 = 0u;

546 ià(
RdOff
 > 
WrOff
) {

547 
NumBy‹sRem
 = 
pRšg
->
SizeOfBufãr
 - 
RdOff
;

548 
NumBy‹sRem
 = 
	`MIN
(NumBy‹sRem, 
BufãrSize
);

549 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


550 
pSrc
 = 
pRšg
->
pBufãr
 + 
RdOff
;

551 
NumBy‹sR—d
 +ğ
NumBy‹sRem
;

552 
BufãrSize
 -ğ
NumBy‹sRem
;

553 
RdOff
 +ğ
NumBy‹sRem
;

554 
NumBy‹sRem
--) {

555 *
pBufãr
++ = *
pSrc
++;

558 
	`SEGGER_RTT_MEMCPY
(
pBufãr
, 
pRšg
->pBufã¸+ 
RdOff
, 
NumBy‹sRem
);

559 
NumBy‹sR—d
 +ğ
NumBy‹sRem
;

560 
pBufãr
 +ğ
NumBy‹sRem
;

561 
BufãrSize
 -ğ
NumBy‹sRem
;

562 
RdOff
 +ğ
NumBy‹sRem
;

567 ià(
RdOff
 =ğ
pRšg
->
SizeOfBufãr
) {

568 
RdOff
 = 0u;

574 
NumBy‹sRem
 = 
WrOff
 - 
RdOff
;

575 
NumBy‹sRem
 = 
	`MIN
(NumBy‹sRem, 
BufãrSize
);

576 ià(
NumBy‹sRem
 > 0u) {

577 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


578 
pSrc
 = 
pRšg
->
pBufãr
 + 
RdOff
;

579 
NumBy‹sR—d
 +ğ
NumBy‹sRem
;

580 
BufãrSize
 -ğ
NumBy‹sRem
;

581 
RdOff
 +ğ
NumBy‹sRem
;

582 
NumBy‹sRem
--) {

583 *
pBufãr
++ = *
pSrc
++;

586 
	`SEGGER_RTT_MEMCPY
(
pBufãr
, 
pRšg
->pBufã¸+ 
RdOff
, 
NumBy‹sRem
);

587 
NumBy‹sR—d
 +ğ
NumBy‹sRem
;

588 
pBufãr
 +ğ
NumBy‹sRem
;

589 
BufãrSize
 -ğ
NumBy‹sRem
;

590 
RdOff
 +ğ
NumBy‹sRem
;

593 ià(
NumBy‹sR—d
) {

594 
pRšg
->
RdOff
 = RdOff;

597  
NumBy‹sR—d
;

598 
	}
}

616 
	$SEGGER_RTT_R—d
(
BufãrIndex
, * 
pBufãr
, 
BufãrSize
) {

617 
NumBy‹sR—d
;

619 
	`SEGGER_RTT_LOCK
();

623 
NumBy‹sR—d
 = 
	`SEGGER_RTT_R—dNoLock
(
BufãrIndex
, 
pBufãr
, 
BufãrSize
);

627 
	`SEGGER_RTT_UNLOCK
();

629  
NumBy‹sR—d
;

630 
	}
}

655 
	$SEGGER_RTT_Wr™eW™hOv”wr™eNoLock
(
BufãrIndex
, cÚ¡ * 
pBufãr
, 
NumBy‹s
) {

656 cÚ¡ * 
pD©a
;

657 
SEGGER_RTT_BUFFER_UP
* 
pRšg
;

658 
Ava
;

659 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


660 * 
pD¡
;

663 
pD©a
 = (cÚ¡ *)
pBufãr
;

667 
pRšg
 = &
_SEGGER_RTT
.
aUp
[
BufãrIndex
];

671 ià(
pRšg
->
WrOff
 =ğpRšg->
RdOff
) {

672 
Ava
 = 
pRšg
->
SizeOfBufãr
 - 1u;

673 } iàĞ
pRšg
->
WrOff
 <…Ršg->
RdOff
) {

674 
Ava
 = 
pRšg
->
RdOff
 -…Ršg->
WrOff
 - 1u;

676 
Ava
 = 
pRšg
->
RdOff
 -…Ršg->
WrOff
 - 1u +…Ršg->
SizeOfBufãr
;

678 ià(
NumBy‹s
 > 
Ava
) {

679 
pRšg
->
RdOff
 +ğ(
NumBy‹s
 - 
Ava
);

680 
pRšg
->
RdOff
 >ğpRšg->
SizeOfBufãr
) {

681 
pRšg
->
RdOff
 -ğpRšg->
SizeOfBufãr
;

687 
Ava
 = 
pRšg
->
SizeOfBufãr
 -…Ršg->
WrOff
;

689 ià(
Ava
 > 
NumBy‹s
) {

693 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


694 
pD¡
 = 
pRšg
->
pBufãr
 +…Ršg->
WrOff
;

695 
Ava
 = 
NumBy‹s
;

696 
NumBy‹s
--) {

697 *
pD¡
++ = *
pD©a
++;

699 
pRšg
->
WrOff
 +ğ
Ava
;

701 
	`SEGGER_RTT_MEMCPY
(
pRšg
->
pBufãr
 +…Ršg->
WrOff
, 
pD©a
, 
NumBy‹s
);

702 
pRšg
->
WrOff
 +ğ
NumBy‹s
;

709 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


710 
pD¡
 = 
pRšg
->
pBufãr
 +…Ršg->
WrOff
;

711 
NumBy‹s
 -ğ
Ava
;

712 
Ava
--) {

713 *
pD¡
++ = *
pD©a
++;

715 
pRšg
->
WrOff
 = 0;

717 
	`SEGGER_RTT_MEMCPY
(
pRšg
->
pBufãr
 +…Ršg->
WrOff
, 
pD©a
, 
Ava
);

718 
pD©a
 +ğ
Ava
;

719 
pRšg
->
WrOff
 = 0;

720 
NumBy‹s
 -ğ
Ava
;

722 
Ava
 = (
pRšg
->
SizeOfBufãr
 - 1);

724 } 
NumBy‹s
);

725 
	}
}

751 
	$SEGGER_RTT_Wr™eSkNoLock
(
BufãrIndex
, cÚ¡ * 
pBufãr
, 
NumBy‹s
) {

752 cÚ¡ * 
pD©a
;

753 
SEGGER_RTT_BUFFER_UP
* 
pRšg
;

754 
Ava
;

755 
RdOff
;

756 
WrOff
;

757 
Rem
;

758 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


759 * 
pD¡
;

762 
pD©a
 = (cÚ¡ *)
pBufãr
;

766 
pRšg
 = &
_SEGGER_RTT
.
aUp
[
BufãrIndex
];

767 
RdOff
 = 
pRšg
->RdOff;

768 
WrOff
 = 
pRšg
->WrOff;

782 ià(
RdOff
 <ğ
WrOff
) {

786 
Ava
 = 
pRšg
->
SizeOfBufãr
 - 1u - 
WrOff
 ;

787 ià(
Ava
 >ğ
NumBy‹s
) {

788 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


789 
pD¡
 = 
pRšg
->
pBufãr
 + 
WrOff
;

790 
WrOff
 +ğ
NumBy‹s
;

791 
NumBy‹s
--) {

792 *
pD¡
++ = *
pD©a
++;

794 
pRšg
->
WrOff
 = WrOff;

796 
	`SEGGER_RTT_MEMCPY
(
pRšg
->
pBufãr
 + 
WrOff
, 
pD©a
, 
NumBy‹s
);

797 
pRšg
->
WrOff
 = WrOfà+ 
NumBy‹s
;

804 
Ava
 +ğ
RdOff
;

808 ià(
Ava
 >ğ
NumBy‹s
) {

812 
Rem
 = 
pRšg
->
SizeOfBufãr
 - 
WrOff
;

813 ià(
Rem
 > 
NumBy‹s
) {

814 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


815 
pD¡
 = 
pRšg
->
pBufãr
 + 
WrOff
;

816 
WrOff
 +ğ
NumBy‹s
;

817 
NumBy‹s
--) {

818 *
pD¡
++ = *
pD©a
++;

820 
pRšg
->
WrOff
 = WrOff;

822 
	`SEGGER_RTT_MEMCPY
(
pRšg
->
pBufãr
 + 
WrOff
, 
pD©a
, 
NumBy‹s
);

823 
pRšg
->
WrOff
 = WrOfà+ 
NumBy‹s
;

829 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


830 
pD¡
 = 
pRšg
->
pBufãr
 + 
WrOff
;

831 
NumBy‹s
 -ğ
Rem
;

832 
WrOff
 = 
NumBy‹s
;

834 *
pD¡
++ = *
pD©a
++;

835 } --
Rem
);

836 
pD¡
 = 
pRšg
->
pBufãr
;

838 *
pD¡
++ = *
pD©a
++;

839 } --
NumBy‹s
);

840 
pRšg
->
WrOff
 = WrOff;

842 
	`SEGGER_RTT_MEMCPY
(
pRšg
->
pBufãr
 + 
WrOff
, 
pD©a
, 
Rem
);

843 
	`SEGGER_RTT_MEMCPY
(
pRšg
->
pBufãr
, 
pD©a
 + 
Rem
, 
NumBy‹s
 - Rem);

844 
pRšg
->
WrOff
 = 
NumBy‹s
 - 
Rem
;

850 
Ava
 = 
RdOff
 - 
WrOff
 - 1u;

851 ià(
Ava
 >ğ
NumBy‹s
) {

852 #ià
SEGGER_RTT_MEMCPY_USE_BYTELOOP


853 
pD¡
 = 
pRšg
->
pBufãr
 + 
WrOff
;

854 
WrOff
 +ğ
NumBy‹s
;

855 
NumBy‹s
--) {

856 *
pD¡
++ = *
pD©a
++;

858 
pRšg
->
WrOff
 = WrOff;

860 
	`SEGGER_RTT_MEMCPY
(
pRšg
->
pBufãr
 + 
WrOff
, 
pD©a
, 
NumBy‹s
);

861 
pRšg
->
WrOff
 = WrOfà+ 
NumBy‹s
;

870 
	}
}

895 
	$SEGGER_RTT_Wr™eNoLock
(
BufãrIndex
, cÚ¡ * 
pBufãr
, 
NumBy‹s
) {

896 
Stus
;

897 
Ava
;

898 cÚ¡ * 
pD©a
;

899 
SEGGER_RTT_BUFFER_UP
* 
pRšg
;

901 
pD©a
 = (cÚ¡ *)
pBufãr
;

905 
pRšg
 = &
_SEGGER_RTT
.
aUp
[
BufãrIndex
];

909 
pRšg
->
FÏgs
) {

910 
SEGGER_RTT_MODE_NO_BLOCK_SKIP
:

915 
Ava
 = 
	`_G‘AvaWr™eS·û
(
pRšg
);

916 ià(
Ava
 < 
NumBy‹s
) {

917 
Stus
 = 0u;

919 
Stus
 = 
NumBy‹s
;

920 
	`_Wr™eNoCheck
(
pRšg
, 
pD©a
, 
NumBy‹s
);

923 
SEGGER_RTT_MODE_NO_BLOCK_TRIM
:

927 
Ava
 = 
	`_G‘AvaWr™eS·û
(
pRšg
);

928 
Stus
 = 
Ava
 < 
NumBy‹s
 ? Avail : NumBytes;

929 
	`_Wr™eNoCheck
(
pRšg
, 
pD©a
, 
Stus
);

931 
SEGGER_RTT_MODE_BLOCK_IF_FIFO_FULL
:

935 
Stus
 = 
	`_Wr™eBlockšg
(
pRšg
, 
pD©a
, 
NumBy‹s
);

938 
Stus
 = 0u;

944  
Stus
;

945 
	}
}

966 
	$SEGGER_RTT_Wr™e
(
BufãrIndex
, cÚ¡ * 
pBufãr
, 
NumBy‹s
) {

967 
Stus
;

969 
	`INIT
();

970 
	`SEGGER_RTT_LOCK
();

974 
Stus
 = 
	`SEGGER_RTT_Wr™eNoLock
(
BufãrIndex
, 
pBufãr
, 
NumBy‹s
);

978 
	`SEGGER_RTT_UNLOCK
();

980  
Stus
;

981 
	}
}

1003 
	$SEGGER_RTT_Wr™eSŒšg
(
BufãrIndex
, cÚ¡ * 
s
) {

1004 
L’
;

1006 
L’
 = 
	`STRLEN
(
s
);

1007  
	`SEGGER_RTT_Wr™e
(
BufãrIndex
, 
s
, 
L’
);

1008 
	}
}

1033 
	$SEGGER_RTT_PutCh¬SkNoLock
(
BufãrIndex
, 
c
) {

1034 
SEGGER_RTT_BUFFER_UP
* 
pRšg
;

1035 
WrOff
;

1036 
Stus
;

1040 
pRšg
 = &
_SEGGER_RTT
.
aUp
[
BufãrIndex
];

1044 
WrOff
 = 
pRšg
->WrOff + 1;

1045 ià(
WrOff
 =ğ
pRšg
->
SizeOfBufãr
) {

1046 
WrOff
 = 0;

1051 ià(
WrOff
 !ğ
pRšg
->
RdOff
) {

1052 
pRšg
->
pBufãr
[pRšg->
WrOff
] = 
c
;

1053 
pRšg
->
WrOff
 = WrOff;

1054 
Stus
 = 1;

1056 
Stus
 = 0;

1059  
Stus
;

1060 
	}
}

1080 
	$SEGGER_RTT_PutCh¬Sk
(
BufãrIndex
, 
c
) {

1081 
SEGGER_RTT_BUFFER_UP
* 
pRšg
;

1082 
WrOff
;

1083 
Stus
;

1087 
	`INIT
();

1088 
	`SEGGER_RTT_LOCK
();

1092 
pRšg
 = &
_SEGGER_RTT
.
aUp
[
BufãrIndex
];

1096 
WrOff
 = 
pRšg
->WrOff + 1;

1097 ià(
WrOff
 =ğ
pRšg
->
SizeOfBufãr
) {

1098 
WrOff
 = 0;

1103 ià(
WrOff
 !ğ
pRšg
->
RdOff
) {

1104 
pRšg
->
pBufãr
[pRšg->
WrOff
] = 
c
;

1105 
pRšg
->
WrOff
 = WrOff;

1106 
Stus
 = 1;

1108 
Stus
 = 0;

1113 
	`SEGGER_RTT_UNLOCK
();

1115  
Stus
;

1116 
	}
}

1136 
	$SEGGER_RTT_PutCh¬
(
BufãrIndex
, 
c
) {

1137 
SEGGER_RTT_BUFFER_UP
* 
pRšg
;

1138 
WrOff
;

1139 
Stus
;

1143 
	`INIT
();

1144 
	`SEGGER_RTT_LOCK
();

1148 
pRšg
 = &
_SEGGER_RTT
.
aUp
[
BufãrIndex
];

1152 
WrOff
 = 
pRšg
->WrOff + 1;

1153 ià(
WrOff
 =ğ
pRšg
->
SizeOfBufãr
) {

1154 
WrOff
 = 0;

1159 ià(
pRšg
->
FÏgs
 =ğ
SEGGER_RTT_MODE_BLOCK_IF_FIFO_FULL
) {

1160 
WrOff
 =ğ
pRšg
->
RdOff
) {

1167 ià(
WrOff
 !ğ
pRšg
->
RdOff
) {

1168 
pRšg
->
pBufãr
[pRšg->
WrOff
] = 
c
;

1169 
pRšg
->
WrOff
 = WrOff;

1170 
Stus
 = 1;

1172 
Stus
 = 0;

1177 
	`SEGGER_RTT_UNLOCK
();

1179  
Stus
;

1180 
	}
}

1197 
	$SEGGER_RTT_G‘Key
() {

1198 
c
;

1199 
r
;

1201 
r
 = ()
	`SEGGER_RTT_R—d
(0u, &
c
, 1u);

1202 ià(
r
 == 1) {

1203 
r
 = ()()
c
;

1205 
r
 = -1;

1207  
r
;

1208 
	}
}

1225 
	$SEGGER_RTT_Wa™Key
() {

1226 
r
;

1229 
r
 = 
	`SEGGER_RTT_G‘Key
();

1230 } 
r
 < 0);

1231  
r
;

1232 
	}
}

1248 
	$SEGGER_RTT_HasKey
() {

1249 
RdOff
;

1250 
r
;

1252 
	`INIT
();

1253 
RdOff
 = 
_SEGGER_RTT
.
aDown
[0].RdOff;

1254 ià(
RdOff
 !ğ
_SEGGER_RTT
.
aDown
[0].
WrOff
) {

1255 
r
 = 1;

1257 
r
 = 0;

1259  
r
;

1260 
	}
}

1274 
	$SEGGER_RTT_HasD©a
(
BufãrIndex
) {

1275 
SEGGER_RTT_BUFFER_DOWN
* 
pRšg
;

1276 
v
;

1278 
pRšg
 = &
_SEGGER_RTT
.
aDown
[
BufãrIndex
];

1279 
v
 = 
pRšg
->
WrOff
;

1280  
v
 - 
pRšg
->
RdOff
;

1281 
	}
}

1302 
	$SEGGER_RTT_AÎocDownBufãr
(cÚ¡ * 
sName
, * 
pBufãr
, 
BufãrSize
, 
FÏgs
) {

1303 
BufãrIndex
;

1305 
	`INIT
();

1306 
	`SEGGER_RTT_LOCK
();

1307 
BufãrIndex
 = 0;

1309 ià(
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
pBufãr
 =ğ
NULL
) {

1312 
BufãrIndex
++;

1313 } 
BufãrIndex
 < 
_SEGGER_RTT
.
MaxNumDownBufãrs
);

1314 ià(
BufãrIndex
 < 
_SEGGER_RTT
.
MaxNumDownBufãrs
) {

1315 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
sName
 = sName;

1316 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
pBufãr
 = (*)pBuffer;

1317 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
SizeOfBufãr
 = 
BufãrSize
;

1318 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
RdOff
 = 0u;

1319 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
WrOff
 = 0u;

1320 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
FÏgs
 = Flags;

1322 
BufãrIndex
 = -1;

1324 
	`SEGGER_RTT_UNLOCK
();

1325  
BufãrIndex
;

1326 
	}
}

1347 
	$SEGGER_RTT_AÎocUpBufãr
(cÚ¡ * 
sName
, * 
pBufãr
, 
BufãrSize
, 
FÏgs
) {

1348 
BufãrIndex
;

1350 
	`INIT
();

1351 
	`SEGGER_RTT_LOCK
();

1352 
BufãrIndex
 = 0;

1354 ià(
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
pBufãr
 =ğ
NULL
) {

1357 
BufãrIndex
++;

1358 } 
BufãrIndex
 < 
_SEGGER_RTT
.
MaxNumUpBufãrs
);

1359 ià(
BufãrIndex
 < 
_SEGGER_RTT
.
MaxNumUpBufãrs
) {

1360 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
sName
 = sName;

1361 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
pBufãr
 = (*)pBuffer;

1362 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
SizeOfBufãr
 = 
BufãrSize
;

1363 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
RdOff
 = 0u;

1364 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
WrOff
 = 0u;

1365 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
FÏgs
 = Flags;

1367 
BufãrIndex
 = -1;

1369 
	`SEGGER_RTT_UNLOCK
();

1370  
BufãrIndex
;

1371 
	}
}

1398 
	$SEGGER_RTT_CÚfigUpBufãr
(
BufãrIndex
, cÚ¡ * 
sName
, * 
pBufãr
, 
BufãrSize
, 
FÏgs
) {

1399 
r
;

1401 
	`INIT
();

1402 ià(
BufãrIndex
 < ()
_SEGGER_RTT
.
MaxNumUpBufãrs
) {

1403 
	`SEGGER_RTT_LOCK
();

1404 ià(
BufãrIndex
 > 0u) {

1405 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
sName
 = sName;

1406 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
pBufãr
 = (*)pBuffer;

1407 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
SizeOfBufãr
 = 
BufãrSize
;

1408 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
RdOff
 = 0u;

1409 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
WrOff
 = 0u;

1411 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
FÏgs
 = Flags;

1412 
	`SEGGER_RTT_UNLOCK
();

1413 
r
 = 0;

1415 
r
 = -1;

1417  
r
;

1418 
	}
}

1445 
	$SEGGER_RTT_CÚfigDownBufãr
(
BufãrIndex
, cÚ¡ * 
sName
, * 
pBufãr
, 
BufãrSize
, 
FÏgs
) {

1446 
r
;

1448 
	`INIT
();

1449 ià(
BufãrIndex
 < ()
_SEGGER_RTT
.
MaxNumDownBufãrs
) {

1450 
	`SEGGER_RTT_LOCK
();

1451 ià(
BufãrIndex
 > 0u) {

1452 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
sName
 = sName;

1453 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
pBufãr
 = (*)pBuffer;

1454 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
SizeOfBufãr
 = 
BufãrSize
;

1455 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
RdOff
 = 0u;

1456 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
WrOff
 = 0u;

1458 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
FÏgs
 = Flags;

1459 
	`SEGGER_RTT_UNLOCK
();

1460 
r
 = 0;

1462 
r
 = -1;

1464  
r
;

1465 
	}
}

1483 
	$SEGGER_RTT_S‘NameUpBufãr
(
BufãrIndex
, cÚ¡ * 
sName
) {

1484 
r
;

1486 
	`INIT
();

1487 ià(
BufãrIndex
 < ()
_SEGGER_RTT
.
MaxNumUpBufãrs
) {

1488 
	`SEGGER_RTT_LOCK
();

1489 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
sName
 = sName;

1490 
	`SEGGER_RTT_UNLOCK
();

1491 
r
 = 0;

1493 
r
 = -1;

1495  
r
;

1496 
	}
}

1514 
	$SEGGER_RTT_S‘NameDownBufãr
(
BufãrIndex
, cÚ¡ * 
sName
) {

1515 
r
;

1517 
	`INIT
();

1518 ià(
BufãrIndex
 < ()
_SEGGER_RTT
.
MaxNumDownBufãrs
) {

1519 
	`SEGGER_RTT_LOCK
();

1520 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
sName
 = sName;

1521 
	`SEGGER_RTT_UNLOCK
();

1522 
r
 = 0;

1524 
r
 = -1;

1526  
r
;

1527 
	}
}

1545 
	$SEGGER_RTT_S‘FÏgsUpBufãr
(
BufãrIndex
, 
FÏgs
) {

1546 
r
;

1548 
	`INIT
();

1549 ià(
BufãrIndex
 < ()
_SEGGER_RTT
.
MaxNumUpBufãrs
) {

1550 
	`SEGGER_RTT_LOCK
();

1551 
_SEGGER_RTT
.
aUp
[
BufãrIndex
].
FÏgs
 = Flags;

1552 
	`SEGGER_RTT_UNLOCK
();

1553 
r
 = 0;

1555 
r
 = -1;

1557  
r
;

1558 
	}
}

1576 
	$SEGGER_RTT_S‘FÏgsDownBufãr
(
BufãrIndex
, 
FÏgs
) {

1577 
r
;

1579 
	`INIT
();

1580 ià(
BufãrIndex
 < ()
_SEGGER_RTT
.
MaxNumDownBufãrs
) {

1581 
	`SEGGER_RTT_LOCK
();

1582 
_SEGGER_RTT
.
aDown
[
BufãrIndex
].
FÏgs
 = Flags;

1583 
	`SEGGER_RTT_UNLOCK
();

1584 
r
 = 0;

1586 
r
 = -1;

1588  
r
;

1589 
	}
}

1600 
	$SEGGER_RTT_In™
 () {

1601 
	`_DoIn™
();

1602 
	}
}

1618 
	$SEGGER_RTT_S‘T”mš®
 (
T”mš®Id
) {

1619 
ac
[2];

1620 
SEGGER_RTT_BUFFER_UP
* 
pRšg
;

1621 
Ava
;

1622 
r
;

1624 
	`INIT
();

1626 
r
 = 0;

1627 
ac
[0] = 0xFFU;

1628 ià(()
T”mš®Id
 < ()(
_aT”mš®Id
)) {

1629 
ac
[1] = 
_aT”mš®Id
[()
T”mš®Id
];

1630 
pRšg
 = &
_SEGGER_RTT
.
aUp
[0];

1631 
	`SEGGER_RTT_LOCK
();

1632 ià((
pRšg
->
FÏgs
 & 
SEGGER_RTT_MODE_MASK
è=ğ
SEGGER_RTT_MODE_BLOCK_IF_FIFO_FULL
) {

1633 
_AùiveT”mš®
 = 
T”mš®Id
;

1634 
	`_Wr™eBlockšg
(
pRšg
, 
ac
, 2u);

1636 
Ava
 = 
	`_G‘AvaWr™eS·û
(
pRšg
);

1637 ià(
Ava
 >= 2) {

1638 
_AùiveT”mš®
 = 
T”mš®Id
;

1639 
	`_Wr™eNoCheck
(
pRšg
, 
ac
, 2u);

1641 
r
 = -1;

1644 
	`SEGGER_RTT_UNLOCK
();

1646 
r
 = -1;

1648  
r
;

1649 
	}
}

1668 
	$SEGGER_RTT_T”mš®Out
 (
T”mš®Id
, cÚ¡ * 
s
) {

1669 
Stus
;

1670 
F¿gL’
;

1671 
Ava
;

1672 
SEGGER_RTT_BUFFER_UP
* 
pRšg
;

1674 
	`INIT
();

1678 ià(
T”mš®Id
 < ()(
_aT”mš®Id
)) {

1682 
pRšg
 = &
_SEGGER_RTT
.
aUp
[0];

1687 
F¿gL’
 = 
	`STRLEN
(
s
);

1691 
	`SEGGER_RTT_LOCK
();

1692 
Ava
 = 
	`_G‘AvaWr™eS·û
(
pRšg
);

1693 
pRšg
->
FÏgs
 & 
SEGGER_RTT_MODE_MASK
) {

1694 
SEGGER_RTT_MODE_NO_BLOCK_SKIP
:

1699 ià(
Ava
 < (
F¿gL’
 + 4u)) {

1700 
Stus
 = 0;

1702 
	`_Po¡T”mš®Sw™ch
(
pRšg
, 
T”mš®Id
);

1703 
Stus
 = ()
	`_Wr™eBlockšg
(
pRšg
, 
s
, 
F¿gL’
);

1704 
	`_Po¡T”mš®Sw™ch
(
pRšg
, 
_AùiveT”mš®
);

1707 
SEGGER_RTT_MODE_NO_BLOCK_TRIM
:

1713 ià(
Ava
 < 4u) {

1714 
Stus
 = -1;

1716 
	`_Po¡T”mš®Sw™ch
(
pRšg
, 
T”mš®Id
);

1717 
Stus
 = ()
	`_Wr™eBlockšg
(
pRšg
, 
s
, (
F¿gL’
 < (
Ava
 - 4u)) ? FragLen : (Avail - 4u));

1718 
	`_Po¡T”mš®Sw™ch
(
pRšg
, 
_AùiveT”mš®
);

1721 
SEGGER_RTT_MODE_BLOCK_IF_FIFO_FULL
:

1725 
	`_Po¡T”mš®Sw™ch
(
pRšg
, 
T”mš®Id
);

1726 
Stus
 = ()
	`_Wr™eBlockšg
(
pRšg
, 
s
, 
F¿gL’
);

1727 
	`_Po¡T”mš®Sw™ch
(
pRšg
, 
_AùiveT”mš®
);

1730 
Stus
 = -1;

1736 
	`SEGGER_RTT_UNLOCK
();

1738 
Stus
 = -1;

1740  
Stus
;

1741 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\external\segger_rtt\SEGGER_RTT_Syscalls_GCC.c

66 
	~"sdk_cÚfig.h
"

67 #ià!
defšed
(
RETARGET_ENABLED
) || RETARGET_ENABLED == 0

68 #ià
defšed
(
NRF_LOG_USES_RTT
) && NRF_LOG_USES_RTT == 1

69 #ià(
defšed
 
__GNUC__
è&& !(defšed 
__SES_ARM
è&& !(defšed 
__CROSSWORKS_ARM
)

71 
	~<»’t.h
>

72 
	~"SEGGER_RTT.h
"

85 
	g_»’t
;

93 
_wr™e
(
fe
, *
±r
, 
Ën
);

94 
_ssize_t
 
_wr™e_r
 
_PARAMS
 ((
_»’t
 *, , cÚ¡ *, 
size_t
));

113 
	$_wr™e
(
fe
, *
±r
, 
Ën
) {

114 (è
fe
;

115 
	`SEGGER_RTT_Wr™e
(0, 
±r
, 
Ën
);

116  
Ën
;

117 
	}
}

129 
_ssize_t
 
_wr™e_r
 
_PARAMS
((
_»’t
 *
r
, 
fe
, cÚ¡ *
±r
, 
size_t
 
Ën
)) {

130 (è
	gfe
;

131 (è
	gr
;

132 
SEGGER_RTT_Wr™e
(0, 
±r
, 
Ën
);

133  
	gËn
;

	@C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\external\segger_rtt\SEGGER_RTT_printf.c

64 
	~"SEGGER_RTT.h
"

65 
	~"SEGGER_RTT_CÚf.h
"

74 #iâdeà
SEGGER_RTT_PRINTF_BUFFER_SIZE


75 
	#SEGGER_RTT_PRINTF_BUFFER_SIZE
 (64)

	)

78 
	~<¡dlib.h
>

79 
	~<¡d¬g.h
>

82 
	#FORMAT_FLAG_LEFT_JUSTIFY
 (1u << 0)

	)

83 
	#FORMAT_FLAG_PAD_ZERO
 (1u << 1)

	)

84 
	#FORMAT_FLAG_PRINT_SIGN
 (1u << 2)

	)

85 
	#FORMAT_FLAG_ALTERNATE
 (1u << 3)

	)

95 * 
	mpBufãr
;

96 
	mBufãrSize
;

97 
	mCÁ
;

99 
	mR‘uºV®ue
;

101 
	mRTTBufãrIndex
;

102 } 
	tSEGGER_RTT_PRINTF_DESC
;

110 
SEGGER_RTT_v´štf
(
BufãrIndex
, cÚ¡ * 
sFÜm©
, 
va_li¡
 * 
pP¬amLi¡
);

122 
	$_StÜeCh¬
(
SEGGER_RTT_PRINTF_DESC
 * 
p
, 
c
) {

123 
CÁ
;

125 
CÁ
 = 
p
->Cnt;

126 ià((
CÁ
 + 1uè<ğ
p
->
BufãrSize
) {

127 *(
p
->
pBufãr
 + 
CÁ
èğ
c
;

128 
p
->
CÁ
 = Cnt + 1u;

129 
p
->
R‘uºV®ue
++;

134 ià(
p
->
CÁ
 =ğp->
BufãrSize
) {

135 ià(
	`SEGGER_RTT_Wr™e
(
p
->
RTTBufãrIndex
,…->
pBufãr
,…->
CÁ
) !=…->Cnt) {

136 
p
->
R‘uºV®ue
 = -1;

138 
p
->
CÁ
 = 0u;

141 
	}
}

147 
	$_PrštUnsigÃd
(
SEGGER_RTT_PRINTF_DESC
 * 
pBufãrDesc
, 
v
, 
Ba£
, 
NumDig™s
, 
F›ldWidth
, 
FÜm©FÏgs
) {

148 cÚ¡ 
_aV2C
[16] = {'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F' };

149 
Div
;

150 
Dig™
;

151 
Numb”
;

152 
Width
;

153 
c
;

155 
Numb”
 = 
v
;

156 
Dig™
 = 1u;

160 
Width
 = 1u;

161 
Numb”
 >ğ
Ba£
) {

162 
Numb”
 = (Numb” / 
Ba£
);

163 
Width
++;

165 ià(
NumDig™s
 > 
Width
) {

166 
Width
 = 
NumDig™s
;

171 ià((
FÜm©FÏgs
 & 
FORMAT_FLAG_LEFT_JUSTIFY
) == 0u) {

172 ià(
F›ldWidth
 != 0u) {

173 ià(((
FÜm©FÏgs
 & 
FORMAT_FLAG_PAD_ZERO
è=ğFORMAT_FLAG_PAD_ZEROè&& (
NumDig™s
 == 0u)) {

174 
c
 = '0';

176 
c
 = ' ';

178 (
F›ldWidth
 !ğ0uè&& (
Width
 < FieldWidth)) {

179 
F›ldWidth
--;

180 
	`_StÜeCh¬
(
pBufãrDesc
, 
c
);

181 ià(
pBufãrDesc
->
R‘uºV®ue
 < 0) {

187 ià(
pBufãrDesc
->
R‘uºV®ue
 >= 0) {

194 ià(
NumDig™s
 > 1u) {

195 
NumDig™s
--;

197 
Div
 = 
v
 / 
Dig™
;

198 ià(
Div
 < 
Ba£
) {

202 
Dig™
 *ğ
Ba£
;

208 
Div
 = 
v
 / 
Dig™
;

209 
v
 -ğ
Div
 * 
Dig™
;

210 
	`_StÜeCh¬
(
pBufãrDesc
, 
_aV2C
[
Div
]);

211 ià(
pBufãrDesc
->
R‘uºV®ue
 < 0) {

214 
Dig™
 /ğ
Ba£
;

215 } 
Dig™
);

219 ià((
FÜm©FÏgs
 & 
FORMAT_FLAG_LEFT_JUSTIFY
) == FORMAT_FLAG_LEFT_JUSTIFY) {

220 ià(
F›ldWidth
 != 0u) {

221 (
F›ldWidth
 !ğ0uè&& (
Width
 < FieldWidth)) {

222 
F›ldWidth
--;

223 
	`_StÜeCh¬
(
pBufãrDesc
, ' ');

224 ià(
pBufãrDesc
->
R‘uºV®ue
 < 0) {

231 
	}
}

237 
	$_PrštIÁ
(
SEGGER_RTT_PRINTF_DESC
 * 
pBufãrDesc
, 
v
, 
Ba£
, 
NumDig™s
, 
F›ldWidth
, 
FÜm©FÏgs
) {

238 
Width
;

239 
Numb”
;

241 
Numb”
 = (
v
 < 0) ? -v : v;

246 
Width
 = 1u;

247 
Numb”
 >ğ()
Ba£
) {

248 
Numb”
 = (Numb” / ()
Ba£
);

249 
Width
++;

251 ià(
NumDig™s
 > 
Width
) {

252 
Width
 = 
NumDig™s
;

254 ià((
F›ldWidth
 > 0uè&& ((
v
 < 0è|| ((
FÜm©FÏgs
 & 
FORMAT_FLAG_PRINT_SIGN
) == FORMAT_FLAG_PRINT_SIGN))) {

255 
F›ldWidth
--;

261 ià((((
FÜm©FÏgs
 & 
FORMAT_FLAG_PAD_ZERO
è=ğ0uè|| (
NumDig™s
 !ğ0u)è&& ((FÜm©FÏg & 
FORMAT_FLAG_LEFT_JUSTIFY
) == 0u)) {

262 ià(
F›ldWidth
 != 0u) {

263 (
F›ldWidth
 !ğ0uè&& (
Width
 < FieldWidth)) {

264 
F›ldWidth
--;

265 
	`_StÜeCh¬
(
pBufãrDesc
, ' ');

266 ià(
pBufãrDesc
->
R‘uºV®ue
 < 0) {

275 ià(
pBufãrDesc
->
R‘uºV®ue
 >= 0) {

276 ià(
v
 < 0) {

277 
v
 = -v;

278 
	`_StÜeCh¬
(
pBufãrDesc
, '-');

279 } ià((
FÜm©FÏgs
 & 
FORMAT_FLAG_PRINT_SIGN
) == FORMAT_FLAG_PRINT_SIGN) {

280 
	`_StÜeCh¬
(
pBufãrDesc
, '+');

284 ià(
pBufãrDesc
->
R‘uºV®ue
 >= 0) {

288 ià(((
FÜm©FÏgs
 & 
FORMAT_FLAG_PAD_ZERO
è=ğFORMAT_FLAG_PAD_ZEROè&& ((FÜm©FÏg & 
FORMAT_FLAG_LEFT_JUSTIFY
è=ğ0uè&& (
NumDig™s
 == 0u)) {

289 ià(
F›ldWidth
 != 0u) {

290 (
F›ldWidth
 !ğ0uè&& (
Width
 < FieldWidth)) {

291 
F›ldWidth
--;

292 
	`_StÜeCh¬
(
pBufãrDesc
, '0');

293 ià(
pBufãrDesc
->
R‘uºV®ue
 < 0) {

299 ià(
pBufãrDesc
->
R‘uºV®ue
 >= 0) {

303 
	`_PrštUnsigÃd
(
pBufãrDesc
, ()
v
, 
Ba£
, 
NumDig™s
, 
F›ldWidth
, 
FÜm©FÏgs
);

307 
	}
}

332 
	$SEGGER_RTT_v´štf
(
BufãrIndex
, cÚ¡ * 
sFÜm©
, 
va_li¡
 * 
pP¬amLi¡
) {

333 
c
;

334 
SEGGER_RTT_PRINTF_DESC
 
BufãrDesc
;

335 
v
;

336 
NumDig™s
;

337 
FÜm©FÏgs
;

338 
F›ldWidth
;

339 
acBufãr
[
SEGGER_RTT_PRINTF_BUFFER_SIZE
];

341 
BufãrDesc
.
pBufãr
 = 
acBufãr
;

342 
BufãrDesc
.
BufãrSize
 = 
SEGGER_RTT_PRINTF_BUFFER_SIZE
;

343 
BufãrDesc
.
CÁ
 = 0u;

344 
BufãrDesc
.
RTTBufãrIndex
 = 
BufãrIndex
;

345 
BufãrDesc
.
R‘uºV®ue
 = 0;

348 
c
 = *
sFÜm©
;

349 
sFÜm©
++;

350 ià(
c
 == 0u) {

353 ià(
c
 == '%') {

357 
FÜm©FÏgs
 = 0u;

358 
v
 = 1;

360 
c
 = *
sFÜm©
;

361 
c
) {

362 '-': 
FÜm©FÏgs
 |ğ
FORMAT_FLAG_LEFT_JUSTIFY
; 
sFÜm©
++; ;

363 '0': 
FÜm©FÏgs
 |ğ
FORMAT_FLAG_PAD_ZERO
; 
sFÜm©
++; ;

364 '+': 
FÜm©FÏgs
 |ğ
FORMAT_FLAG_PRINT_SIGN
; 
sFÜm©
++; ;

365 '#': 
FÜm©FÏgs
 |ğ
FORMAT_FLAG_ALTERNATE
; 
sFÜm©
++; ;

366 : 
v
 = 0; ;

368 } 
v
);

372 
F›ldWidth
 = 0u;

374 
c
 = *
sFÜm©
;

375 ià((
c
 < '0') || (c > '9')) {

378 
sFÜm©
++;

379 
F›ldWidth
 = (F›ldWidth * 10uè+ (()
c
 - '0');

385 
NumDig™s
 = 0u;

386 
c
 = *
sFÜm©
;

387 ià(
c
 == '.') {

388 
sFÜm©
++;

390 
c
 = *
sFÜm©
;

391 ià((
c
 < '0') || (c > '9')) {

394 
sFÜm©
++;

395 
NumDig™s
 = NumDig™ * 10u + (()
c
 - '0');

401 
c
 = *
sFÜm©
;

403 ià((
c
 == 'l') || (c == 'h')) {

404 
sFÜm©
++;

405 
c
 = *
sFÜm©
;

413 
c
) {

415 
c0
;

416 
v
 = 
	`va_¬g
(*
pP¬amLi¡
, );

417 
c0
 = ()
v
;

418 
	`_StÜeCh¬
(&
BufãrDesc
, 
c0
);

422 
v
 = 
	`va_¬g
(*
pP¬amLi¡
, );

423 
	`_PrštIÁ
(&
BufãrDesc
, 
v
, 10u, 
NumDig™s
, 
F›ldWidth
, 
FÜm©FÏgs
);

426 
v
 = 
	`va_¬g
(*
pP¬amLi¡
, );

427 
	`_PrštUnsigÃd
(&
BufãrDesc
, ()
v
, 10u, 
NumDig™s
, 
F›ldWidth
, 
FÜm©FÏgs
);

431 
v
 = 
	`va_¬g
(*
pP¬amLi¡
, );

432 
	`_PrštUnsigÃd
(&
BufãrDesc
, ()
v
, 16u, 
NumDig™s
, 
F›ldWidth
, 
FÜm©FÏgs
);

436 cÚ¡ * 
s
 = 
	`va_¬g
(*
pP¬amLi¡
, const *);

438 
c
 = *
s
;

439 
s
++;

440 ià(
c
 == '\0') {

443 
	`_StÜeCh¬
(&
BufãrDesc
, 
c
);

444 } 
BufãrDesc
.
R‘uºV®ue
 >= 0);

448 
v
 = 
	`va_¬g
(*
pP¬amLi¡
, );

449 
	`_PrštUnsigÃd
(&
BufãrDesc
, ()
v
, 16u, 8u, 8u, 0u);

452 
	`_StÜeCh¬
(&
BufãrDesc
, '%');

457 
sFÜm©
++;

459 
	`_StÜeCh¬
(&
BufãrDesc
, 
c
);

461 } 
BufãrDesc
.
R‘uºV®ue
 >= 0);

463 ià(
BufãrDesc
.
R‘uºV®ue
 > 0) {

467 ià(
BufãrDesc
.
CÁ
 != 0u) {

468 
	`SEGGER_RTT_Wr™e
(
BufãrIndex
, 
acBufãr
, 
BufãrDesc
.
CÁ
);

470 
BufãrDesc
.
R‘uºV®ue
 +ğ()BufãrDesc.
CÁ
;

472  
BufãrDesc
.
R‘uºV®ue
;

473 
	}
}

506 
	$SEGGER_RTT_´štf
(
BufãrIndex
, cÚ¡ * 
sFÜm©
, ...) {

507 
r
;

508 
va_li¡
 
P¬amLi¡
;

510 
	`va_¡¬t
(
P¬amLi¡
, 
sFÜm©
);

511 
r
 = 
	`SEGGER_RTT_v´štf
(
BufãrIndex
, 
sFÜm©
, &
P¬amLi¡
);

512 
	`va_’d
(
P¬amLi¡
);

513  
r
;

514 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\orderProcessing.c

5 
	~"¡dšt.h
"

6 
	~"¡ršg.h
"

7 
	~"¡dboŞ.h
"

8 
	~"Üd”Proûssšg.h
"

10 
	#ORDER_ITEM_FREE
 0xFF

	)

12 
	#ORDER_HEAP_ITEM_FREE
 0xFF

	)

13 
	#ORDER_HEAP_ITEM_BUSY
 0x00

	)

16 
	sÜd”


18 
ušt8_t
 
	mÜd”
[
ORDER_ITEM_QUANTITY
];

19 } 
	tdeviûOrd”S
;

24 
deviûOrd”S
 
	mh—p
[
HEAP_ORDER_QUANTITY
];

25 
ušt8_t
 
	mh—pI‹mS‹
[
HEAP_ORDER_QUANTITY
];

26 }
	gh—pDesütÜ
 =

28 .
h—pI‹mS‹
 = {[0 ... 
HEAP_ORDER_QUANTITY
 - 1] = 
ORDER_HEAP_ITEM_FREE
}

32 
šlše
 
boŞ
 
	$g‘IDPos
(
Üd”T
 
Üd”In
, 
ušt8_t
 *
»zPos
, ušt8_ˆ
šI‹m
)

34 
ušt8_t
 
út
 = 0; cÁ < 
ORDER_ITEM_QUANTITY
; cnt++ )

36 ifĞ
šI‹m
 !ğ
Üd”In
->
Üd”
[
út
])

40 *
»zPos
 = 
út
;

41  
Œue
;

43  
çl£
;

44 
	}
}

47 
Üd”T
 
	$Üd”M®loc
()

49 
ušt8_t
 
út
 = 0; cÁ < 
HEAP_ORDER_QUANTITY
; cnt++)

51 if(
h—pDesütÜ
.
h—pI‹mS‹
[
út
] !ğ
ORDER_HEAP_ITEM_FREE
)

55 
h—pDesütÜ
.
h—pI‹mS‹
[
út
] = 
ORDER_HEAP_ITEM_BUSY
;

56 
	`mem£t
(
h—pDesütÜ
.
h—p
[
út
].
Üd”
, 
ORDER_ITEM_FREE
, (heapDescriptor.heap[cnt].order));

57  &
h—pDesütÜ
.
h—p
[
út
];

59  
NULL
;

60 
	}
}

62 
boŞ
 
	$Üd”F»e
(
Üd”T
 
Üd”In
)

64 
ušt8_t
 
út
 = 0; cÁ < 
HEAP_ORDER_QUANTITY
; cnt++)

66 if(
Üd”In
 !ğ&
h—pDesütÜ
.
h—p
[
út
])

70 
h—pDesütÜ
.
h—pI‹mS‹
[
út
] = 
ORDER_HEAP_ITEM_FREE
;

71  
Œue
;

73  
çl£
;

74 
	}
}

77 
boŞ
 
	$Üd”S‘Fœ¡
 (
Üd”T
 
Üd”In
, 
ušt8_t
 
šI‹m
)

79 
ušt8_t
 
cu¼’tPos
;

80 ifĞ
Üd”In
 =ğ
NULL
)

82  
çl£
;

84 ifĞ!
	`g‘IDPos
(
Üd”In
, &
cu¼’tPos
, 
šI‹m
))

86 
cu¼’tPos
 = 
ORDER_ITEM_QUANTITY
 - 1;

88 if(
cu¼’tPos
 == 0)

90  
Œue
;

92 ; 
cu¼’tPos
 > 0; currentPos--)

94 
Üd”In
->
Üd”
[
cu¼’tPos
] = orderIn->order[currentPos - 1];

96 
Üd”In
->
Üd”
[0] = 
šI‹m
;

97  
Œue
;

98 
	}
}

101 
boŞ
 
	$Üd”G‘Pos
(cÚ¡ 
Üd”T
 
Üd”In
, 
ušt8_t
 
deviûID
, ušt8_ˆ*
pos
)

103 
ušt8_t
 
út
 = 0; cÁ < 
ORDER_ITEM_QUANTITY
; cnt++)

105 if(
Üd”In
->
Üd”
[
út
] !ğ
deviûID
)

109 *
pos
 = 
út
;

110  
Œue
;

112  
çl£
;

113 
	}
}

116 
ušt8_t
 
	$Üd”G‘Quªt™y
(cÚ¡ 
Üd”T
 
Üd”In
)

118 
ušt8_t
 
út
 = 0;

119 ; 
út
 < 
ORDER_ITEM_QUANTITY
; cnt++)

121 if(
Üd”In
->
Üd”
[
út
] =ğ
ORDER_ITEM_FREE
)

126  
út
;

127 
	}
}

130 
	$Üd”CËª
(
Üd”T
 
Üd”In
)

132 
	`mem£t
(
Üd”In
->
Üd”
, 
ORDER_ITEM_FREE
, (orderIn->order));

133 
	}
}

	@C:\Private\Programing\Nordic\NRF52840Mouse\orderProcessing.h

5 #iâdeà
ORDERPROCESSING


6 
	#ORDERPROCESSING


	)

8 
	~"¡dšt.h
"

9 
	~"¡dboŞ.h
"

11 
	#ORDER_ITEM_QUANTITY
 5

	)

12 
	#HEAP_ORDER_QUANTITY
 2

	)

14 
Üd”
 *
	tÜd”T
;

16 
Üd”T
 
Üd”M®loc
 ();

17 
boŞ
 
Üd”F»e
 (
Üd”T
 
Üd”In
);

18 
boŞ
 
Üd”S‘Fœ¡
 (
Üd”T
 
Üd”In
, 
ušt8_t
 
šI‹m
);

19 
boŞ
 
Üd”G‘Pos
 (cÚ¡ 
Üd”T
 
Üd”In
, 
ušt8_t
 
deviûID
, ušt8_ˆ*
pos
);

20 
ušt8_t
 
Üd”G‘Quªt™y
(cÚ¡ 
Üd”T
 
Üd”In
);

21 
Üd”CËª
 (
Üd”T
 
Üd”In
);

	@orderProcessing.h

5 #iâdeà
ORDERPROCESSING


6 
	#ORDERPROCESSING


	)

8 
	~"¡dšt.h
"

9 
	~"¡dboŞ.h
"

11 
	#ORDER_ITEM_QUANTITY
 5

	)

12 
	#HEAP_ORDER_QUANTITY
 2

	)

14 
Üd”
 *
	tÜd”T
;

16 
Üd”T
 
Üd”M®loc
 ();

17 
boŞ
 
Üd”F»e
 (
Üd”T
 
Üd”In
);

18 
boŞ
 
Üd”S‘Fœ¡
 (
Üd”T
 
Üd”In
, 
ušt8_t
 
šI‹m
);

19 
boŞ
 
Üd”G‘Pos
 (cÚ¡ 
Üd”T
 
Üd”In
, 
ušt8_t
 
deviûID
, ušt8_ˆ*
pos
);

20 
ušt8_t
 
Üd”G‘Quªt™y
(cÚ¡ 
Üd”T
 
Üd”In
);

21 
Üd”CËª
 (
Üd”T
 
Üd”In
);

	@
1
.
0
70
7692
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\ble_advertising\ble_advertising.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\ble_services\ble_bas\ble_bas.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\ble_services\ble_dis\ble_dis.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\ble_services\ble_hids\ble_hids.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\common\ble_advdata.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\common\ble_conn_params.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\common\ble_conn_state.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\common\ble_srv_common.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\nrf_ble_gatt\nrf_ble_gatt.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\gatt_cache_manager.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\gatts_cache_manager.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\id_manager.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\peer_data_storage.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\peer_database.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\peer_id.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\peer_manager.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\pm_buffer.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\pm_mutex.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\security_dispatcher.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\ble\peer_manager\security_manager.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\boards\boards.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\drivers_nrf\clock\nrf_drv_clock.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\drivers_nrf\common\nrf_drv_common.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\drivers_nrf\gpiote\nrf_drv_gpiote.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\drivers_nrf\uart\nrf_drv_uart.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\atomic_fifo\nrf_atfifo.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\balloc\nrf_balloc.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\bsp\bsp.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\bsp\bsp_btn_ble.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\bsp\bsp_nfc.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\button\app_button.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\crc16\crc16.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_log\src\nrf_log_backend_rtt.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_log\src\nrf_log_backend_serial.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_log\src\nrf_log_backend_uart.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_log\src\nrf_log_default_backends.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_log\src\nrf_log_frontend.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_log\src\nrf_log_str_formatter.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_memobj\nrf_memobj.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\experimental_section_vars\nrf_section_iter.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\fds\fds.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\fstorage\nrf_fstorage.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\fstorage\nrf_fstorage_sd.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\hardfault\hardfault_implementation.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\pwr_mgmt\nrf_pwr_mgmt.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\scheduler\app_scheduler.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\sensorsim\sensorsim.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\strerror\nrf_strerror.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\timer\app_timer.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\util\app_error.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\util\app_error_weak.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\util\app_util_platform.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\util\nrf_assert.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\libraries\util\sdk_mapped_flags.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\softdevice\common\nrf_sdh.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\softdevice\common\nrf_sdh_ble.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\softdevice\common\nrf_sdh_soc.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\toolchain\gcc\gcc_startup_nrf52840.S
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\toolchain\gcc\nrf5x_common.ld
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\components\toolchain\system_nrf52840.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\examples\ble_peripheral\ble_app_hids_mouse\main.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\examples\ble_peripheral\ble_app_hids_mouse\pca10056\s140\armgcc\ble_app_hids_mouse_gcc_nrf52.ld
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\external\fprintf\nrf_fprintf.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\external\fprintf\nrf_fprintf_format.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\external\segger_rtt\SEGGER_RTT.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\external\segger_rtt\SEGGER_RTT_Syscalls_GCC.c
C:\Private\Programing\Nordic\NRF52840Mouse\nRF5_SDK_14.2.0_17b948a\external\segger_rtt\SEGGER_RTT_printf.c
C:\Private\Programing\Nordic\NRF52840Mouse\orderProcessing.c
C:\Private\Programing\Nordic\NRF52840Mouse\orderProcessing.h
orderProcessing.h
